import{j as e,b as j,t as L,v as H,u as W}from"./react-flow-ruwbRUGr.js";import{au as M,d as F,W as J,av as U,l as Y}from"./style-tArnu08A.js";import{a as y,d as q}from"./Toast-Bv7rl_JM.js";import{u as $}from"./ConceptionPage-BocKiW0k.js";import"./ts-morph-SaAo0aQ4.js";import"./index-CPYQZmO7.js";import"./ToastContext-BpLXtKbY.js";const O=a=>typeof a=="string"?a:a&&typeof a=="object"&&"id"in a?a.id:null;function A({id:a,type:b,onClick:g}){return g?e.jsx("span",{className:"debug-event-clickable",onClick:n=>{n.stopPropagation(),g(a)},title:`Select ${b}`,children:M(a)}):e.jsx("span",{children:M(a)})}function B({event:a,onNodeDefClick:b,onTransitionClick:g}){const n=a.data;if(!n)return null;switch(a.type){case"node:enter":case"node:active":case"node:exit":case"node:complete":{const i=O(n.node);return i?e.jsxs("div",{className:"debug-event-description",children:["Node ",e.jsx(A,{id:i,type:"node",onClick:b})]}):null}case"node:waiting":{const i=O(n.node),r=n.availableTransitions,p=(r==null?void 0:r.map(O).filter(o=>o!==null))||[];return e.jsxs("div",{className:"debug-event-description",children:[i&&e.jsxs(e.Fragment,{children:["Node ",e.jsx(A,{id:i,type:"node",onClick:b})]}),p.length>0&&e.jsxs(e.Fragment,{children:[" → choices: ",p.map((o,f)=>e.jsxs("span",{children:[f>0&&", ",e.jsx(A,{id:o,type:"transition",onClick:g})]},o))]})]})}case"transition:start":case"transition:complete":{const i=O(n.transition);return i?e.jsxs("div",{className:"debug-event-description",children:["Transition ",e.jsx(A,{id:i,type:"transition",onClick:g})]}):null}case"error":{const i=n.message;return i?e.jsx("div",{className:"debug-event-description",children:i}):null}default:return null}}const z=a=>new Date(a).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3});function K(a){var n,i;const b=[];let g=0;for(;g<a.length;){const r=a[g];if(r.type==="node:reset"||r.type==="transition:reset"){const p=[],o=[],f=r.timestamp;for(;g<a.length;){const E=a[g];if(E.timestamp-f>100)break;if(E.type==="node:reset"){const d=O((n=E.data)==null?void 0:n.node);d&&p.push(d),g++}else if(E.type==="transition:reset"){const d=O((i=E.data)==null?void 0:i.transition);d&&o.push(d),g++}else break}(p.length>0||o.length>0)&&b.push({kind:"reset-group",timestamp:f,nodes:p,transitions:o})}else b.push({kind:"single",event:r}),g++}return b}function X(a){return a.startsWith("simulation:")?"lifecycle":a==="error"?"error":a==="node:complete"||a==="transition:complete"?"success":""}function _(a){switch(a){case"simulation:start":return"Simulation Started";case"simulation:stop":return"Simulation Stopped";case"simulation:reset":return"Simulation Reset";case"node:enter":return"Node Enter";case"node:active":return"Node Active";case"node:waiting":return"Node Waiting";case"node:exit":return"Node Exit";case"node:complete":return"Node Complete";case"transition:start":return"Transition Start";case"transition:complete":return"Transition Complete";case"error":return"Error";default:return a}}function Q({events:a,onNodeDefClick:b,onTransitionClick:g}){const[n,i]=j.useState(new Set),[r,p]=j.useState(!1),o=j.useMemo(()=>K(a),[a]),f=async()=>{const d=a.map(u=>({type:u.type,timestamp:new Date(u.timestamp).toISOString(),data:u.data})),s=JSON.stringify(d,null,2);await navigator.clipboard.writeText(s),p(!0),setTimeout(()=>p(!1),2e3)},E=d=>{i(s=>{const u=new Set(s);return u.has(d)?u.delete(d):u.add(d),u})};return a.length===0?e.jsx("div",{className:"debug-empty",children:"No events yet. Start the simulation to see events."}):e.jsxs("div",{className:"debug-event-log",children:[e.jsx("div",{className:"debug-event-header",children:e.jsx("button",{className:"debug-dump-btn",onClick:f,children:r?"Copied!":"Dump"})}),e.jsx("div",{className:"debug-event-list",children:o.map(d=>{if(d.kind==="reset-group"){const u=n.has(d.timestamp),c=d.nodes.length+d.transitions.length;return e.jsxs("div",{className:"debug-event-item",children:[e.jsxs("div",{className:"debug-event-row cursor-pointer",onClick:()=>E(d.timestamp),children:[e.jsx("span",{className:"debug-accordion-icon",children:u?"▼":"▶"}),e.jsx("span",{className:"debug-event-type reset",children:"Reset"}),e.jsxs("span",{className:"debug-reset-count",children:[c," items"]}),e.jsx("span",{className:"debug-event-time",children:z(d.timestamp)})]}),u&&e.jsxs("div",{className:"debug-reset-details",children:[d.nodes.length>0&&e.jsxs("div",{className:"debug-reset-section",children:[e.jsxs("span",{className:"debug-reset-label",children:["Nodes (",d.nodes.length,")"]}),e.jsx("div",{className:"debug-reset-list",children:d.nodes.map(N=>e.jsx("span",{className:y("debug-reset-item",b&&"clickable"),onClick:()=>b==null?void 0:b(N),children:M(N)},N))})]}),d.transitions.length>0&&e.jsxs("div",{className:"debug-reset-section",children:[e.jsxs("span",{className:"debug-reset-label",children:["Transitions (",d.transitions.length,")"]}),e.jsx("div",{className:"debug-reset-list",children:d.transitions.map(N=>e.jsx("span",{className:y("debug-reset-item",g&&"clickable"),onClick:()=>g==null?void 0:g(N),children:M(N)},N))})]})]})]},`reset-${d.timestamp}`)}const{event:s}=d;return e.jsxs("div",{className:y("debug-event-item",X(s.type)),children:[e.jsxs("div",{className:"debug-event-row",children:[e.jsx("span",{className:"debug-event-type",children:_(s.type)}),e.jsx("span",{className:"debug-event-time",children:z(s.timestamp)})]}),e.jsx(B,{event:s,onNodeDefClick:b,onTransitionClick:g})]},s.id)})})]})}const Z=new J,C=new U;function ee(){const[a,b]=j.useState(null),g=F(),{workflowName:n,slugName:i,targetPlugin:r,pluginConfig:p}=$(),o=d=>{b(s=>s===d?null:d)},f=j.useMemo(()=>{if(a!=="workflow")return"";const d=g.getWorkflowState(),s=Z.serialize(d);if(!s.success)return JSON.stringify({error:s.error},null,2);const u=new Date().toISOString(),c={version:q,metadata:{name:n,slugName:i,targetPlugin:r,pluginConfig:p,createdAt:u,updatedAt:u},workflow:s.workflow};return JSON.stringify(c,null,2)},[a,g,n,i,r,p]),E=j.useMemo(()=>{if(a!=="ir")return"";const d=g.getWorkflowState(),s=new Date().toISOString(),u=C.compile(d,{metadata:{name:n,slugName:i||"workflow",targetPlugin:r,pluginConfig:p,createdAt:s,updatedAt:s}});return u.success?JSON.stringify(u.ir,null,2):JSON.stringify({error:u.error},null,2)},[a,g,n,i,r,p]);return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"debug-subtabs",children:[e.jsx("button",{className:y("debug-subtab",a==="workflow"&&"active"),onClick:()=>o("workflow"),children:"Show Workflow"}),e.jsx("button",{className:y("debug-subtab",a==="ir"&&"active"),onClick:()=>o("ir"),children:"Show IR"})]}),a===null&&e.jsx("div",{className:"debug-empty",children:"Select a view to display workflow data."}),a==="workflow"&&e.jsx("pre",{className:"debug-state-viewer",children:f}),a==="ir"&&e.jsx("pre",{className:"debug-state-viewer",children:E})]})}function se({nodes:a,edges:b,graph:g,onNodeClick:n,onEdgeClick:i,onLogicalNodeClick:r}){const[p,o]=j.useState(null),[f,E]=j.useState(null),d=j.useRef(new Map),s=j.useRef(null),u=a.find(t=>t.selected),c=(u==null?void 0:u.id)??null;c!==f&&(E(c),c&&o(c)),j.useEffect(()=>{if(c&&c!==s.current){s.current=c;const t=d.current.get(c);t&&t.scrollIntoView({behavior:"smooth",block:"nearest"})}},[c]);const N=t=>{o(t),n==null||n(t)},S=(t,I)=>{I.stopPropagation(),o(p===t?null:t)},m=t=>{var k;const I=a.find(G=>G.id===t);if(!I)return t.slice(0,12)+"...";const l=(k=I.data)==null?void 0:k.label;return l&&l.trim()?l:I.type||"node"};return a.length===0?e.jsx("div",{className:"debug-empty",children:"No nodes yet. Drag nodes from the sidebar."}):e.jsx("div",{className:"debug-list",children:a.map(t=>{var R,P,D,V;const I=t.data,l=p===t.id,k=t.selected,G=I.definitionId,T=G&&g?g.getNode(G):null,v=b.filter(x=>x.target===t.id),h=b.filter(x=>x.source===t.id),w=t.type==="policy"?a.filter(x=>x.type==="outcome"&&x.data.parentPolicyInstanceId===t.id):[];return e.jsxs("div",{ref:x=>{x?d.current.set(t.id,x):d.current.delete(t.id)},className:y("debug-accordion-item",k&&"selected"),children:[e.jsxs("div",{className:"debug-accordion-header",children:[e.jsx("button",{className:"debug-accordion-toggle",onClick:x=>S(t.id,x),children:e.jsx("span",{className:"debug-accordion-icon",children:l?"▼":"▶"})}),e.jsxs("div",{className:"debug-accordion-content",onClick:()=>N(t.id),children:[e.jsx("span",{className:y("debug-type-badge",t.type||"default"),children:t.type||"node"}),e.jsx("span",{className:"debug-item-label",children:I.label&&I.label.trim()?I.label:t.type||"node"}),e.jsx("span",{className:"debug-item-id",children:M(t.id)})]})]}),l&&e.jsxs("div",{className:"debug-accordion-details",children:[e.jsxs("div",{className:"debug-details-grid",children:[e.jsxs("div",{className:"debug-detail-row",children:[e.jsx("span",{className:"debug-detail-label",children:"ID"}),e.jsx("span",{className:"debug-detail-value",children:t.id})]}),e.jsxs("div",{className:"debug-detail-row",children:[e.jsx("span",{className:"debug-detail-label",children:"Type"}),e.jsx("span",{className:"debug-detail-value",children:t.type||"default"})]}),e.jsxs("div",{className:"debug-detail-row",children:[e.jsx("span",{className:"debug-detail-label",children:"Label"}),e.jsx("span",{className:"debug-detail-value",children:I.label&&I.label.trim()?I.label:e.jsx("em",{children:"(empty)"})})]}),I.executionMode&&e.jsxs("div",{className:"debug-detail-row",children:[e.jsx("span",{className:"debug-detail-label",children:"Mode"}),e.jsx("span",{className:"debug-detail-value",children:I.executionMode})]}),e.jsxs("div",{className:"debug-detail-row",children:[e.jsx("span",{className:"debug-detail-label",children:"Pos/Size"}),e.jsxs("span",{className:"debug-detail-value",children:["(x: ",Math.round(t.position.x),", y: ",Math.round(t.position.y),")",(((R=t.measured)==null?void 0:R.width)||((P=t.measured)==null?void 0:P.height))&&e.jsxs(e.Fragment,{children:[" (",((D=t.measured)==null?void 0:D.width)||"?"," × ",((V=t.measured)==null?void 0:V.height)||"?",")"]})]})]}),e.jsxs("div",{className:"debug-detail-row",children:[e.jsx("span",{className:"debug-detail-label",children:"Def ID"}),T?e.jsx("span",{className:"debug-definition-link",onClick:()=>r==null?void 0:r(T.id),title:"View in Graph tab",children:T.id}):e.jsx("span",{className:"debug-detail-value",children:"-"})]}),t.type==="outcome"&&t.data.parentPolicyInstanceId&&e.jsxs("div",{className:"debug-detail-row",children:[e.jsx("span",{className:"debug-detail-label",children:"Parent Policy"}),e.jsxs("span",{className:"debug-link",onClick:()=>n==null?void 0:n(t.data.parentPolicyInstanceId),title:"Go to parent policy",children:[m(t.data.parentPolicyInstanceId)," (",M(t.data.parentPolicyInstanceId),")"]})]})]}),e.jsxs("div",{className:"debug-details-section",children:[e.jsxs("h4",{className:"debug-section-title",children:["Incoming (",v.length,")"]}),v.length===0?e.jsx("span",{className:"debug-section-empty",children:"No incoming edges"}):e.jsx("div",{className:"debug-edges-list",children:v.map(x=>e.jsxs("div",{className:"debug-edge-compact",children:[e.jsx("span",{className:"debug-link",onClick:()=>i==null?void 0:i(x.id),title:"Select edge",children:M(x.id)}),e.jsx("span",{className:"debug-edge-arrow",children:"←"}),e.jsxs("span",{className:"debug-link",onClick:()=>n==null?void 0:n(x.source),title:"Go to source node",children:[M(x.source)," (",m(x.source),")"]})]},x.id))})]}),e.jsxs("div",{className:"debug-details-section",children:[e.jsxs("h4",{className:"debug-section-title",children:["Outgoing (",h.length,")"]}),h.length===0?e.jsx("span",{className:"debug-section-empty",children:"No outgoing edges"}):e.jsx("div",{className:"debug-edges-list",children:h.map(x=>e.jsxs("div",{className:"debug-edge-compact",children:[e.jsx("span",{className:"debug-link",onClick:()=>i==null?void 0:i(x.id),title:"Select edge",children:M(x.id)}),e.jsx("span",{className:"debug-edge-arrow",children:"→"}),e.jsxs("span",{className:"debug-link",onClick:()=>n==null?void 0:n(x.target),title:"Go to target node",children:[M(x.target)," (",m(x.target),")"]})]},x.id))})]}),t.type==="policy"&&e.jsxs("div",{className:"debug-details-section",children:[e.jsxs("h4",{className:"debug-section-title",children:["Outcomes (",w.length,")"]}),w.length===0?e.jsx("span",{className:"debug-section-empty",children:"No outcomes"}):e.jsx("div",{className:"debug-edges-list",children:w.map(x=>e.jsx("div",{className:"debug-edge-compact",children:e.jsxs("span",{className:"debug-link",onClick:()=>n==null?void 0:n(x.id),title:"Go to outcome",children:[x.data.label||"Outcome"," (",M(x.id),")"]})},x.id))})]})]})]},t.id)})})}function ae({edges:a,nodes:b,graph:g,onEdgeClick:n,onNodeClick:i,onLogicalTransitionClick:r}){const[p,o]=j.useState(null),[f,E]=j.useState(null),d=j.useRef(new Map),s=j.useRef(null),u=a.find(l=>l.selected),c=(u==null?void 0:u.id)??null;c!==f&&(E(c),c&&o(c)),j.useEffect(()=>{if(c&&c!==s.current){s.current=c;const l=d.current.get(c);l&&l.scrollIntoView({behavior:"smooth",block:"nearest"})}},[c]);const N=l=>{o(l),n==null||n(l)},S=(l,k)=>{k.stopPropagation(),o(p===l?null:l)},m=l=>b.find(k=>k.id===l),t=l=>{var T;const k=m(l);if(!k)return l.slice(0,8)+"...";const G=(T=k.data)==null?void 0:T.label;return G&&G.trim()?G:k.type||"node"},I=l=>{const k=m(l);return(k==null?void 0:k.type)||"node"};return a.length===0?e.jsx("div",{className:"debug-empty",children:"No edges yet. Connect nodes to create edges."}):e.jsx("div",{className:"debug-list",children:a.map(l=>{const k=p===l.id,G=l.selected,T=l.data,v=g?g.getTransition(l.id):null;return e.jsxs("div",{ref:h=>{h?d.current.set(l.id,h):d.current.delete(l.id)},className:y("debug-accordion-item",G&&"selected"),children:[e.jsxs("div",{className:"debug-accordion-header",children:[e.jsx("button",{className:"debug-accordion-toggle",onClick:h=>S(l.id,h),children:e.jsx("span",{className:"debug-accordion-icon",children:k?"▼":"▶"})}),e.jsxs("div",{className:"debug-accordion-content",onClick:()=>N(l.id),children:[e.jsx("span",{className:"debug-type-badge",children:"edge"}),e.jsxs("span",{className:"debug-item-label",children:[t(l.source)," → ",t(l.target)]})]})]}),k&&e.jsxs("div",{className:"debug-accordion-details",children:[e.jsxs("div",{className:"debug-details-grid",children:[e.jsxs("div",{className:"debug-detail-row",children:[e.jsx("span",{className:"debug-detail-label",children:"ID"}),e.jsx("span",{className:"debug-detail-value",children:l.id})]}),e.jsxs("div",{className:"debug-detail-row",children:[e.jsx("span",{className:"debug-detail-label",children:"Type"}),e.jsx("span",{className:"debug-detail-value",children:l.type||"default"})]}),(T==null?void 0:T.state)&&e.jsxs("div",{className:"debug-detail-row",children:[e.jsx("span",{className:"debug-detail-label",children:"State"}),e.jsx("span",{className:"debug-detail-value",children:T.state})]}),(T==null?void 0:T.transitionId)&&e.jsxs("div",{className:"debug-detail-row",children:[e.jsx("span",{className:"debug-detail-label",children:"Trans."}),e.jsx("span",{className:"debug-definition-link",onClick:()=>r==null?void 0:r(T.transitionId),title:"View in Graph tab",children:M(T.transitionId)})]})]}),e.jsxs("div",{className:"debug-details-section",children:[e.jsxs("h4",{className:"debug-section-title",children:["Source ",l.sourceHandle&&e.jsx("span",{className:"debug-handle-badge",children:l.sourceHandle})]}),e.jsxs("div",{className:"debug-node-link",onClick:()=>i==null?void 0:i(l.source),children:[e.jsx("span",{className:y("debug-type-badge",I(l.source)),children:I(l.source)}),e.jsx("span",{className:"debug-item-label",children:t(l.source)}),e.jsx("span",{className:"debug-item-id",children:M(l.source)})]})]}),e.jsxs("div",{className:"debug-details-section",children:[e.jsxs("h4",{className:"debug-section-title",children:["Target ",l.targetHandle&&e.jsx("span",{className:"debug-handle-badge",children:l.targetHandle})]}),e.jsxs("div",{className:"debug-node-link",onClick:()=>i==null?void 0:i(l.target),children:[e.jsx("span",{className:y("debug-type-badge",I(l.target)),children:I(l.target)}),e.jsx("span",{className:"debug-item-label",children:t(l.target)}),e.jsx("span",{className:"debug-item-id",children:M(l.target)})]})]}),v&&e.jsxs("div",{className:"debug-details-section",children:[e.jsx("h4",{className:"debug-section-title",children:"Logical Definition"}),e.jsxs("div",{className:"debug-logical-link",onClick:()=>r==null?void 0:r(v.id),children:[e.jsx("span",{className:"debug-logical-icon",children:"◆"}),e.jsxs("span",{className:"debug-logical-label",children:["transition - ",M(v.id)]}),e.jsx("span",{className:"debug-logical-arrow",children:"→ Graph"})]})]})]})]},l.id)})})}function te({nodes:a,edges:b,graph:g,onNodeClick:n,onEdgeClick:i,onLogicalNodeClick:r,onLogicalTransitionClick:p}){const[o,f]=j.useState("nodes");return e.jsxs("div",{className:"flex flex-col gap-2 h-full",children:[e.jsxs("div",{className:"debug-subtabs",children:[e.jsxs("button",{className:y("debug-subtab",o==="nodes"&&"active"),onClick:()=>f("nodes"),children:["Nodes (",a.length,")"]}),e.jsxs("button",{className:y("debug-subtab",o==="edges"&&"active"),onClick:()=>f("edges"),children:["Edges (",b.length,")"]})]}),o==="nodes"?e.jsx(se,{nodes:a,edges:b,graph:g,onNodeClick:n,onEdgeClick:i,onLogicalNodeClick:r}):e.jsx(ae,{edges:b,nodes:a,graph:g,onEdgeClick:i,onNodeClick:n,onLogicalTransitionClick:p})]})}function ne({nodes:a,graph:b,visualNodes:g,expandedNodeId:n,onToggleExpand:i,onSelectNode:r,onNavigateToTransition:p,onVisualNodeClick:o}){const f=j.useRef(new Map),E=s=>g.filter(u=>u.data.definitionId===s),d=s=>s?s.label&&s.label.trim()?s.label:s.kind:"?";return e.jsx("div",{className:"debug-list",children:a.map(s=>{const u=n===s.id,c=E(s.id),N=b.getIncomingTransitions(s.id),S=b.getOutgoingTransitions(s.id);return e.jsxs("div",{ref:m=>{m?f.current.set(s.id,m):f.current.delete(s.id)},className:y("debug-accordion-item",u&&"selected"),children:[e.jsxs("div",{className:"debug-accordion-header",children:[e.jsx("button",{className:"debug-accordion-toggle",onClick:m=>i(s.id,m),children:e.jsx("span",{className:"debug-accordion-icon",children:u?"▼":"▶"})}),e.jsxs("div",{className:"debug-accordion-content",onClick:()=>r(s.id),children:[e.jsx("span",{className:y("debug-type-badge",s.kind),children:s.kind}),e.jsx("span",{className:"debug-item-label",children:d(s)}),c.length>0&&e.jsx("span",{className:"debug-instance-badge",title:"Visual instances",children:c.length}),e.jsx("span",{className:y("debug-mode-badge",s.executionMode),children:s.executionMode==="automatic"?"auto":"manual"})]})]}),u&&e.jsxs("div",{className:"debug-accordion-details",children:[e.jsxs("div",{className:"debug-details-grid",children:[e.jsxs("div",{className:"debug-detail-row",children:[e.jsx("span",{className:"debug-detail-label",children:"ID"}),e.jsx("span",{className:"debug-detail-value",children:s.id})]}),e.jsxs("div",{className:"debug-detail-row",children:[e.jsx("span",{className:"debug-detail-label",children:"Kind"}),e.jsx("span",{className:"debug-detail-value",children:s.kind})]}),e.jsxs("div",{className:"debug-detail-row",children:[e.jsx("span",{className:"debug-detail-label",children:"Category"}),e.jsx("span",{className:"debug-detail-value",children:s.category})]}),e.jsxs("div",{className:"debug-detail-row",children:[e.jsx("span",{className:"debug-detail-label",children:"Mode"}),e.jsx("span",{className:"debug-detail-value",children:s.executionMode})]}),e.jsxs("div",{className:"debug-detail-row",children:[e.jsx("span",{className:"debug-detail-label",children:"Auto-traverse"}),e.jsx("span",{className:"debug-detail-value",children:b.canAutoTraverse(s.id)?"Yes":"No"})]}),e.jsxs("div",{className:"debug-detail-row",children:[e.jsx("span",{className:"debug-detail-label",children:"Requires action"}),e.jsx("span",{className:"debug-detail-value",children:b.requiresUserAction(s.id)?"Yes":"No"})]})]}),e.jsxs("div",{className:"debug-details-section",children:[e.jsxs("h4",{className:"debug-section-title",children:["Visual Instances (",c.length,")"]}),c.length===0?e.jsx("span",{className:"debug-section-empty",children:"No visual instances"}):e.jsx("div",{className:"debug-edges-list",children:c.map(m=>e.jsx("div",{className:"debug-edge-compact",onClick:()=>o==null?void 0:o(m.id),children:e.jsxs("span",{className:"debug-link",title:"Go to visual node",children:[M(m.id)," (x: ",Math.round(m.position.x),", y: ",Math.round(m.position.y),")"]})},m.id))})]}),e.jsxs("div",{className:"debug-details-section",children:[e.jsxs("h4",{className:"debug-section-title",children:["Incoming (",N.length,")"]}),N.length===0?e.jsx("span",{className:"debug-section-empty",children:"Entry point (no incoming)"}):e.jsx("div",{className:"debug-edges-list",children:N.map(m=>{const t=b.getNode(m.sourceDefId);return e.jsxs("div",{className:"debug-edge-compact",children:[e.jsx("span",{className:"debug-link",onClick:()=>p(m.id),title:"Go to transition",children:M(m.id)}),e.jsx("span",{className:"debug-edge-arrow",children:"←"}),e.jsx("span",{className:"debug-detail-value",children:d(t)})]},m.id)})})]}),e.jsxs("div",{className:"debug-details-section",children:[e.jsxs("h4",{className:"debug-section-title",children:["Outgoing (",S.length,")"]}),S.length===0?e.jsx("span",{className:"debug-section-empty",children:"Terminal node (no outgoing)"}):e.jsx("div",{className:"debug-edges-list",children:S.map(m=>{const t=b.getNode(m.targetDefId);return e.jsxs("div",{className:"debug-edge-compact",children:[e.jsx("span",{className:"debug-link",onClick:()=>p(m.id),title:"Go to transition",children:M(m.id)}),e.jsx("span",{className:"debug-edge-arrow",children:"→"}),e.jsx("span",{className:"debug-detail-value",children:d(t)})]},m.id)})})]})]})]},s.id)})})}function ie({transitions:a,graph:b,visualEdges:g,expandedTransitionId:n,onToggleExpand:i,onSelectTransition:r,onNavigateToNode:p,onVisualEdgeClick:o}){const f=j.useRef(new Map),E=s=>g.filter(u=>{var c;return((c=u.data)==null?void 0:c.transitionId)===s}),d=s=>s?s.label&&s.label.trim()?s.label:s.kind:"?";return e.jsx("div",{className:"debug-list",children:a.map(s=>{const u=n===s.id,c=b.getNode(s.sourceDefId),N=b.getNode(s.targetDefId),S=E(s.id);return e.jsxs("div",{ref:m=>{m?f.current.set(s.id,m):f.current.delete(s.id)},className:y("debug-accordion-item",u&&"selected"),children:[e.jsxs("div",{className:"debug-accordion-header",children:[e.jsx("button",{className:"debug-accordion-toggle",onClick:m=>i(s.id,m),children:e.jsx("span",{className:"debug-accordion-icon",children:u?"▼":"▶"})}),e.jsxs("div",{className:"debug-accordion-content",onClick:()=>r(s.id),children:[e.jsx("span",{className:"debug-type-badge",children:"trans"}),e.jsxs("span",{className:"debug-item-label",children:[d(c)," → ",d(N)]}),S.length>0&&e.jsx("span",{className:"debug-instance-badge",title:"Visual instances",children:S.length})]})]}),u&&e.jsxs("div",{className:"debug-accordion-details",children:[e.jsx("div",{className:"debug-details-grid",children:e.jsxs("div",{className:"debug-detail-row",children:[e.jsx("span",{className:"debug-detail-label",children:"ID"}),e.jsx("span",{className:"debug-detail-value",children:s.id})]})}),e.jsxs("div",{className:"debug-details-section",children:[e.jsxs("h4",{className:"debug-section-title",children:["Visual Instances (",S.length,")"]}),S.length===0?e.jsx("span",{className:"debug-section-empty",children:"No visual instances"}):e.jsx("div",{className:"debug-edges-list",children:S.map(m=>e.jsx("div",{className:"debug-edge-compact",onClick:()=>o==null?void 0:o(m.id),children:e.jsx("span",{className:"debug-link",title:"Go to visual edge",children:M(m.id)})},m.id))})]}),e.jsxs("div",{className:"debug-details-section",children:[e.jsx("h4",{className:"debug-section-title",children:"Source"}),c?e.jsxs("div",{className:"debug-edge-compact",children:[e.jsx("span",{className:y("debug-type-badge",c.kind),children:c.kind}),e.jsx("span",{className:"debug-link",onClick:()=>p(c.id),title:"Go to source node",children:d(c)})]}):e.jsx("span",{className:"debug-section-empty",children:"Unknown source"})]}),e.jsxs("div",{className:"debug-details-section",children:[e.jsx("h4",{className:"debug-section-title",children:"Target"}),N?e.jsxs("div",{className:"debug-edge-compact",children:[e.jsx("span",{className:y("debug-type-badge",N.kind),children:N.kind}),e.jsx("span",{className:"debug-link",onClick:()=>p(N.id),title:"Go to target node",children:d(N)})]}):e.jsx("span",{className:"debug-section-empty",children:"Unknown target"})]})]})]},s.id)})})}function le({graph:a,onVisualNodeClick:b,onVisualEdgeClick:g,initialSelectedNodeId:n=null,initialSelectedTransitionId:i=null,initialViewMode:r="nodes"}){const[p,o]=j.useState(n),[f,E]=j.useState(n),[d,s]=j.useState(i),[u,c]=j.useState(i),[N,S]=j.useState(()=>i?"transitions":n?"nodes":r);n!==f&&(E(n),n&&(o(n),S("nodes"))),i!==u&&(c(i),i&&(s(i),S("transitions")));const m=L(),t=H(),I=j.useCallback((h,w)=>{w.stopPropagation(),o(R=>R===h?null:h)},[o]),l=j.useCallback((h,w)=>{w.stopPropagation(),s(R=>R===h?null:h)},[s]),k=j.useCallback(h=>{s(h),S("transitions")},[s]),G=j.useCallback(h=>{o(h),S("nodes")},[o]);if(!a)return e.jsx("div",{className:"debug-empty",children:"No logical graph available."});const T=a.getAllNodes(),v=a.getAllTransitions();return e.jsxs("div",{className:"flex flex-col gap-2 h-full",children:[e.jsxs("div",{className:"debug-subtabs",children:[e.jsxs("button",{className:y("debug-subtab",N==="nodes"&&"active"),onClick:()=>S("nodes"),children:["Nodes (",T.length,")"]}),e.jsxs("button",{className:y("debug-subtab",N==="transitions"&&"active"),onClick:()=>S("transitions"),children:["Transitions (",v.length,")"]})]}),N==="nodes"?e.jsx(ne,{nodes:T,graph:a,visualNodes:m,expandedNodeId:p,onToggleExpand:I,onSelectNode:o,onNavigateToTransition:k,onVisualNodeClick:b}):e.jsx(ie,{transitions:v,graph:a,visualEdges:t,expandedTransitionId:d,onToggleExpand:l,onSelectTransition:s,onNavigateToNode:G,onVisualEdgeClick:g})]})}function be(){const{events:a}=Y(),{graph:b}=F(),[g,n]=j.useState(!1),[i,r]=j.useState("ui"),[p,o]=j.useState(null),[f,E]=j.useState(null),{setCenter:d,setNodes:s,setEdges:u}=W(),c=L(),N=H(),S=v=>{let h=v.position;if(v.parentId){const w=c.find(R=>R.id===v.parentId);w&&(h={x:w.position.x+v.position.x,y:w.position.y+v.position.y})}return h},m=v=>{const h=c.find(w=>w.id===v);if(h){s(R=>R.map(P=>({...P,selected:P.id===v}))),u(R=>R.map(P=>({...P,selected:!1})));const w=S(h);d(w.x+60,w.y+40,{zoom:1.5,duration:500}),r("ui")}},t=v=>{const h=N.find(w=>w.id===v);if(h){u(P=>P.map(D=>({...D,selected:D.id===v}))),s(P=>P.map(D=>({...D,selected:!1})));const w=c.find(P=>P.id===h.source),R=c.find(P=>P.id===h.target);if(w&&R){const P=S(w),D=S(R),V=(P.x+D.x)/2+60,x=(P.y+D.y)/2+40;d(V,x,{zoom:1.5,duration:500})}r("ui")}},I=v=>{o(v),E(null),r("graph")},l=v=>{E(v),o(null),r("graph")},k=v=>{const h=c.find(w=>{var R;return((R=w.data)==null?void 0:R.definitionId)===v});h&&m(h.id)},G=v=>{const h=N.find(w=>{var R;return((R=w.data)==null?void 0:R.transitionId)===v});h&&t(h.id)},T=()=>{switch(i){case"ui":return e.jsx(te,{nodes:c,edges:N,graph:b,onNodeClick:m,onEdgeClick:t,onLogicalNodeClick:I,onLogicalTransitionClick:l});case"graph":return e.jsx(le,{graph:b,onVisualNodeClick:m,onVisualEdgeClick:t,initialSelectedNodeId:p,initialSelectedTransitionId:f});case"events":return e.jsx(Q,{events:a,onNodeDefClick:k,onTransitionClick:G});case"state":return e.jsx(ee,{})}};return e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"debug-toggle-btn",onClick:()=>n(!g),title:"Toggle Debug Panel",children:e.jsx("svg",{viewBox:"0 0 24 24",width:"20",height:"20",fill:"currentColor",children:e.jsx("path",{d:"M20 8h-2.81c-.45-.78-1.07-1.45-1.82-1.96L17 4.41 15.59 3l-2.17 2.17C12.96 5.06 12.49 5 12 5c-.49 0-.96.06-1.41.17L8.41 3 7 4.41l1.62 1.63C7.88 6.55 7.26 7.22 6.81 8H4v2h2.09c-.05.33-.09.66-.09 1v1H4v2h2v1c0 .34.04.67.09 1H4v2h2.81c1.04 1.79 2.97 3 5.19 3s4.15-1.21 5.19-3H20v-2h-2.09c.05-.33.09-.66.09-1v-1h2v-2h-2v-1c0-.34-.04-.67-.09-1H20V8zm-6 8h-4v-2h4v2zm0-4h-4v-2h4v2z"})})}),e.jsxs("div",{className:y("debug-drawer",g&&"open"),children:[e.jsxs("div",{className:"debug-header",children:[e.jsx("h2",{className:"debug-title",children:"Debug Panel"}),e.jsx("button",{className:"debug-close-btn",onClick:()=>n(!1),children:"✕"})]}),e.jsxs("div",{className:"debug-tabs",children:[e.jsx("button",{className:y("debug-tab",i==="ui"&&"active"),onClick:()=>r("ui"),children:"UI"}),e.jsx("button",{className:y("debug-tab",i==="graph"&&"active"),onClick:()=>r("graph"),children:"Graph"}),e.jsx("button",{className:y("debug-tab",i==="events"&&"active"),onClick:()=>r("events"),children:"Events"}),e.jsx("button",{className:y("debug-tab",i==="state"&&"active"),onClick:()=>r("state"),children:"State"})]}),e.jsx("div",{className:"debug-content",children:T()})]})]})}export{be as DebugPanel,ae as EdgesList,Q as EventLog,le as GraphViewer,se as NodesList,ee as StateViewer,te as UIViewer};
