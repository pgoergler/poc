var kc=Object.defineProperty;var Ic=(e,t,n)=>t in e?kc(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var ae=(e,t,n)=>Ic(e,typeof t!="symbol"?t+"":t,n);import{c as ie,u as ln,C as Ut,R as Ac,j as Oc,k as Fr,a as B,l as $r,m as Dc,O as zr,D as Hr,n as ee,o as ve,p as _e,q as oe,r as We,s as ke,t as _t,v as ho,w as xo,x as mt,y as H,z as vo,F as wo,B as un,E as dn,G as St,H as Wr,I as Br,J as jc,K as Lc,L as Fc,A as $c,b as zc,d as Hc,e as Wc,f as Bc,g as Vc,h as Gc,i as Uc,T as Kc,P as Xc}from"./AlertDialog-CqlDNawf.js";import{P as G,b as c,l as Jo,m as Yc,h as Vr,k as Gr,u as Rt,j as f,n as ye,c as Nt,H as K,o as qc,p as Jc,N as Zc,d as Qc,q as Ur,E as el}from"./react-flow-JpbcPcxa.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tl=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],yo=ie("check",tl);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nl=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Kr=ie("chevron-down",nl);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ol=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],rl=ie("chevron-right",ol);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sl=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],il=ie("chevron-up",sl);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const al=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],cl=ie("circle",al);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ll=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]],ul=ie("clipboard-list",ll);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dl=[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]],Zo=ie("cloud",dl);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fl=[["path",{d:"M12 3q1 4 4 6.5t3 5.5a1 1 0 0 1-14 0 5 5 0 0 1 1-3 1 1 0 0 0 5 0c0-2-1.5-3-1.5-5q0-2 2.5-4",key:"1slcih"}]],Lh=ie("flame",fl);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pl=[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]],Fh=ie("moon",pl);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ml=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],bo=ie("play",ml);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gl=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],$h=ie("refresh-cw",gl);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hl=[["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"m19 8 3 8a5 5 0 0 1-6 0zV7",key:"zcdpyk"}],["path",{d:"M3 7h1a17 17 0 0 0 8-2 17 17 0 0 0 8 2h1",key:"1yorad"}],["path",{d:"m5 8 3 8a5 5 0 0 1-6 0zV7",key:"eua70x"}],["path",{d:"M7 21h10",key:"1b0cd5"}]],zh=ie("scale",hl);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xl=[["path",{d:"M21 9a2.4 2.4 0 0 0-.706-1.706l-3.588-3.588A2.4 2.4 0 0 0 15 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2z",key:"1dfntj"}],["path",{d:"M15 3v5a1 1 0 0 0 1 1h5",key:"6s6qgf"}]],Hh=ie("sticky-note",xl);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vl=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],Wh=ie("sun",vl);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wl=[["path",{d:"M12 19h8",key:"baeox8"}],["path",{d:"m4 17 6-6-6-6",key:"1yngyt"}]],yl=ie("terminal",wl);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bl=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],Bh=ie("user",bl);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const El=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Xr=ie("x",El);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cl=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],Yr=ie("zap",Cl);function Fe(e){switch(e){case"trigger":case"externalSystem":case"externalEvent":case"hotspot":case"note":case"actor":return"manual";case"event":case"policy":case"command":default:return"automatic"}}function Tl(e,t){if(e!=="command"&&e!=="policy")throw new Error(`calculateDynamicExecutionMode called with non-dynamic kind: ${e}`);return t<=1?"automatic":"manual"}function _l(e){return e.executionMode==="manual"}function Sl(e,t){return e.executionMode==="manual"?!1:t>0}class gt{constructor(){ae(this,"nodes",new Map);ae(this,"transitions",new Map);ae(this,"outgoingEdges",new Map);ae(this,"incomingEdges",new Map)}addNode(t){if(this.nodes.has(t.id))throw new Error(`Node with id ${t.id} already exists`);this.nodes.set(t.id,t),this.outgoingEdges.set(t.id,new Set),this.incomingEdges.set(t.id,new Set)}getNode(t){return this.nodes.get(t)}hasNode(t){return this.nodes.has(t)}getAllNodes(){return Array.from(this.nodes.values())}updateNode(t,n){const o=this.nodes.get(t);if(!o)return;const r={...o,...n};return this.nodes.set(t,r),r}removeNode(t){if(!this.nodes.has(t))return!1;const n=this.outgoingEdges.get(t)??new Set,o=this.incomingEdges.get(t)??new Set;for(const r of n)this.removeTransition(r);for(const r of o)this.removeTransition(r);return this.nodes.delete(t),this.outgoingEdges.delete(t),this.incomingEdges.delete(t),!0}addTransition(t){if(this.transitions.has(t.id))throw new Error(`Transition with id ${t.id} already exists`);if(!this.nodes.has(t.sourceDefId))throw new Error(`Source node ${t.sourceDefId} does not exist`);if(!this.nodes.has(t.targetDefId))throw new Error(`Target node ${t.targetDefId} does not exist`);this.transitions.set(t.id,t),this.outgoingEdges.get(t.sourceDefId).add(t.id),this.incomingEdges.get(t.targetDefId).add(t.id),this.recalculateExecutionMode(t.sourceDefId)}getTransition(t){return this.transitions.get(t)}getAllTransitions(){return Array.from(this.transitions.values())}removeTransition(t){var r,s;const n=this.transitions.get(t);if(!n)return!1;const o=n.sourceDefId;return(r=this.outgoingEdges.get(n.sourceDefId))==null||r.delete(t),(s=this.incomingEdges.get(n.targetDefId))==null||s.delete(t),this.transitions.delete(t),this.recalculateExecutionMode(o),!0}getOutgoingTransitions(t){const n=this.outgoingEdges.get(t);return n?Array.from(n).map(o=>this.transitions.get(o)).filter(Boolean):[]}getIncomingTransitions(t){const n=this.incomingEdges.get(t);return n?Array.from(n).map(o=>this.transitions.get(o)).filter(Boolean):[]}getSuccessors(t){return this.getOutgoingTransitions(t).map(n=>this.nodes.get(n.targetDefId)).filter(Boolean)}getPredecessors(t){return this.getIncomingTransitions(t).map(n=>this.nodes.get(n.sourceDefId)).filter(Boolean)}get nodeCount(){return this.nodes.size}get transitionCount(){return this.transitions.size}getEntryNodes(){return this.getAllNodes().filter(t=>{var n;return(((n=this.incomingEdges.get(t.id))==null?void 0:n.size)??0)===0})}getTerminalNodes(){return this.getAllNodes().filter(t=>{var n;return(((n=this.outgoingEdges.get(t.id))==null?void 0:n.size)??0)===0})}recalculateExecutionMode(t){var s;const n=this.nodes.get(t);if(!n||n.kind!=="command"&&n.kind!=="policy")return;const o=((s=this.outgoingEdges.get(t))==null?void 0:s.size)??0,r=Tl(n.kind,o);n.executionMode!==r&&this.nodes.set(t,{...n,executionMode:r})}requiresUserAction(t){const n=this.nodes.get(t);return n?_l(n):!1}canAutoTraverse(t){var r;const n=this.nodes.get(t);if(!n)return!1;const o=((r=this.outgoingEdges.get(t))==null?void 0:r.size)??0;return Sl(n,o)}getReachableNodes(t){const n=[],o=new Set,r=[];for(const s of this.getSuccessors(t))o.has(s.id)||(o.add(s.id),r.push(s.id),n.push(s));for(;r.length>0;){const s=r.shift();for(const i of this.getSuccessors(s))o.has(i.id)||(o.add(i.id),r.push(i.id),n.push(i))}return n}getReachableTransitions(t){const n=[],o=new Set;for(const r of this.getOutgoingTransitions(t))o.has(r.id)||(o.add(r.id),n.push(r));for(const r of this.getReachableNodes(t))for(const s of this.getOutgoingTransitions(r.id))o.has(s.id)||(o.add(s.id),n.push(s));return n}}function be(e,t=""){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]+/g,"-").replace(/^-+|-+$/g,"").replace(/-+/g,"-")||t}function fn(e,t=""){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase().replace(/\s+/g,".").replace(/[^a-z0-9.-]+/g,".").replace(/^[.-]+|[.-]+$/g,"").replace(/\.+/g,".").replace(/-+/g,"-")||t}function Vh(e){return e.length<=13?e:`${e.slice(0,5)}...${e.slice(-5)}`}function ze(e){return e.replace(/^(def_|trans_|inst_|outcome_)/,"")}function Gh(e,t,n){const o=be(e);if(o)return o;const r=t.replace(/^def_/,"").toLowerCase();return`${n}-${r.slice(0,8)}`}function Uh(e,t){const n=fn(e);return n||`event.${t.replace(/^def_/,"").toLowerCase().slice(0,8)}`}function Rl(e){const t=e.match(/\{([^}]+)\}/g);return t?t.map(n=>n.slice(1,-1)):[]}function Nl(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)})}function Qo(e,t,n,o){switch(n){case G.Top:return{x:e,y:t-o};case G.Bottom:return{x:e,y:t+o};case G.Left:return{x:e-o,y:t};case G.Right:return{x:e+o,y:t};default:return{x:e,y:t}}}function Pl(e,t,n,o,r=100){const s=n-e,i=o-t,a=Math.sqrt(s*s+i*i);return Math.min(r,a/2)}function qr(e,t,n,o,r,s){const i=Pl(e,t,n,o),a=Qo(e,t,r,i),l=Qo(n,o,s,i);return`M${e},${t} C${a.x},${a.y} ${l.x},${l.y} ${n},${o}`}function $e(){return`def_${ln()}`}function Ml(){return`trans_${ln()}`}function Ft(){return`inst_${ln()}`}function Gn(){return`outcome_${ln()}`}function jn(e){const t=fn(e.label);return{id:$e(),label:e.label,kind:"event",category:"business",executionMode:Fe("event"),config:t?{type:t}:void 0}}function er(e){return{id:$e(),label:e.label,kind:"policy",category:"business",executionMode:Fe("policy")}}function kl(e){const t=be(e.label);return{id:$e(),label:e.label,kind:"trigger",category:"business",executionMode:Fe("trigger"),config:t?{slugName:t}:void 0}}function tr(e){const t=be(e.label);return{id:$e(),label:e.label,kind:"externalSystem",category:"technical",executionMode:Fe("externalSystem"),config:t?{slugName:t}:void 0}}function Il(e){const t=be(e.label);return{id:$e(),label:e.label,kind:"externalEvent",category:"technical",executionMode:Fe("externalEvent"),config:t?{slugName:t}:void 0}}function nr(e){const t=be(e.label);return{id:$e(),label:e.label,kind:"command",category:"business",executionMode:Fe("command"),config:t?{slugName:t}:void 0}}function or(e){return{id:$e(),label:e.label,kind:"hotspot",category:"business",executionMode:Fe("hotspot")}}function rr(e){return{id:$e(),label:e.label,kind:"note",category:"business",executionMode:Fe("note")}}function sr(e){return{id:$e(),label:e.label,kind:"actor",category:"business",executionMode:Fe("actor")}}function Al(e){return{id:Ml(),sourceDefId:e.sourceDefId,targetDefId:e.targetDefId}}const Ol={transitionDelay:1e3,autoStart:!1};class Dl{constructor(){ae(this,"listeners",new Map)}on(t,n){return this.listeners.has(t)||this.listeners.set(t,new Set),this.listeners.get(t).add(n),()=>this.off(t,n)}off(t,n){var o;(o=this.listeners.get(t))==null||o.delete(n)}emit(t,n){const o=this.listeners.get(t);if(o)for(const r of o)try{r(n)}catch(s){console.error(`Error in event handler for ${String(t)}:`,s)}}once(t,n){const o=r=>{this.off(t,o),n(r)};return this.on(t,o)}removeAllListeners(t){t?this.listeners.delete(t):this.listeners.clear()}listenerCount(t){var n;return((n=this.listeners.get(t))==null?void 0:n.size)??0}}class jl extends Dl{constructor(n,o={}){super();ae(this,"graph");ae(this,"config");ae(this,"running",!1);ae(this,"nodeStates",new Map);ae(this,"transitionStates",new Map);ae(this,"activeNodes",new Set);ae(this,"pendingActions",new Set);ae(this,"activeTimeouts",new Set);this.graph=n,this.config={...Ol,...o},this.initializeState()}initializeState(){for(const n of this.graph.getAllNodes())this.nodeStates.set(n.id,"idle");for(const n of this.graph.getAllTransitions())this.transitionStates.set(n.id,"idle")}getState(){return{isRunning:this.running,nodeStates:new Map(this.nodeStates),transitionStates:new Map(this.transitionStates),activeNodes:new Set(this.activeNodes),pendingActions:new Set(this.pendingActions)}}getNodeState(n){return this.nodeStates.get(n)}getTransitionState(n){return this.transitionStates.get(n)}isSimulationRunning(){return this.running}start(){if(!this.running&&(this.running=!0,this.emit("simulation:start",{timestamp:Date.now()}),this.config.autoStart))for(const n of this.graph.getEntryNodes())this.triggerNode(n.id)}stop(){if(this.running){this.running=!1;for(const n of this.activeTimeouts)clearTimeout(n);this.activeTimeouts.clear(),this.emit("simulation:stop",{timestamp:Date.now()})}}reset(){this.stop(),this.nodeStates.clear(),this.transitionStates.clear(),this.activeNodes.clear(),this.pendingActions.clear(),this.initializeState(),this.emit("simulation:reset",{timestamp:Date.now()})}resetAllStates(){const n=Date.now();for(const o of this.graph.getAllNodes())this.nodeStates.set(o.id,"idle"),this.emit("node:reset",{node:o,timestamp:n});for(const o of this.graph.getAllTransitions())this.transitionStates.set(o.id,"idle"),this.emit("transition:reset",{transition:o,timestamp:n});this.activeNodes.clear(),this.pendingActions.clear()}triggerNode(n){if(!this.running){this.emitError(`Cannot trigger node ${n}: simulation is not running`,n);return}if(!this.graph.getNode(n)){this.emitError(`Node ${n} not found`,n);return}this.resetAllStates(),this.enterNode(n)}selectTransition(n){if(!this.running){this.emitError("Cannot select transition: simulation is not running",void 0,n);return}const o=this.graph.getTransition(n);if(!o){this.emitError(`Transition ${n} not found`,void 0,n);return}if(!this.graph.getNode(o.sourceDefId)){this.emitError("Source node for transition not found",o.sourceDefId,n);return}if(!this.pendingActions.has(o.sourceDefId)){this.emitError(`Node ${o.sourceDefId} is not waiting for action`,o.sourceDefId);return}this.resetAllStates(),this.executeTransition(o)}completeManualNode(n){if(!this.running){this.emitError("Cannot complete node: simulation is not running",n);return}if(!this.graph.getNode(n)){this.emitError(`Node ${n} not found`,n);return}if(!this.pendingActions.has(n)){this.emitError(`Node ${n} is not waiting for action`,n);return}this.resetAllStates(),this.pendingActions.delete(n),this.exitNode(n)}enterNode(n){const o=this.graph.getNode(n);o&&(this.nodeStates.set(n,"entering"),this.activeNodes.add(n),this.emit("node:enter",{node:o,timestamp:Date.now()}),this.activateNode(n))}activateNode(n){const o=this.graph.getNode(n);o&&(this.nodeStates.set(n,"active"),this.emit("node:active",{node:o,timestamp:Date.now()}),this.graph.requiresUserAction(n)?this.waitForAction(n):this.graph.canAutoTraverse(n)?this.exitNode(n):this.completeNode(n))}waitForAction(n){const o=this.graph.getNode(n);if(!o)return;this.nodeStates.set(n,"waiting_for_action"),this.pendingActions.add(n);const r=this.graph.getOutgoingTransitions(n);this.emit("node:waiting",{node:o,availableTransitions:r,timestamp:Date.now()})}exitNode(n){const o=this.graph.getNode(n);if(!o)return;this.nodeStates.set(n,"exiting"),this.emit("node:exit",{node:o,timestamp:Date.now()});const r=this.graph.getOutgoingTransitions(n);if(r.length===0)this.completeNode(n);else if(r.length===1)this.executeTransition(r[0]),this.completeNode(n);else{for(const s of r)this.executeTransition(s);this.completeNode(n)}}completeNode(n){const o=this.graph.getNode(n);o&&(this.nodeStates.set(n,"completed"),this.activeNodes.delete(n),this.emit("node:complete",{node:o,timestamp:Date.now()}))}executeTransition(n){this.transitionStates.set(n.id,"in_progress"),this.emit("transition:start",{transition:n,timestamp:Date.now()});const o=setTimeout(()=>{this.activeTimeouts.delete(o),this.completeTransition(n)},this.config.transitionDelay);this.activeTimeouts.add(o)}completeTransition(n){this.transitionStates.set(n.id,"completed"),this.emit("transition:complete",{transition:n,timestamp:Date.now()}),this.enterNode(n.targetDefId)}emitError(n,o,r){this.emit("error",{message:n,nodeId:o,transitionId:r,timestamp:Date.now()})}}function Jr(){const e=c.useRef(new Map),t=c.useRef(new Map),n=c.useRef(new Map),o=c.useRef(new Map),r=c.useCallback(m=>e.current.get(m),[]),s=c.useCallback(m=>{const d=t.current.get(m);return d?Array.from(d):[]},[]),i=c.useCallback((m,d,h)=>{if(!m.current)return;const v=m.current.getOutgoingTransitions(d).find(b=>b.targetDefId===h);return v==null?void 0:v.id},[]),a=c.useCallback(m=>n.current.get(m),[]),l=c.useCallback(m=>o.current.get(m),[]),u=c.useCallback((m,d)=>{e.current.set(m,d);let h=t.current.get(d);h||(h=new Set,t.current.set(d,h)),h.add(m)},[]),p=c.useCallback(m=>{const d=e.current.get(m);if(!d)return;e.current.delete(m);const h=t.current.get(d);return h&&(h.delete(m),h.size===0&&t.current.delete(d)),d},[]),g=c.useCallback((m,d)=>{n.current.set(m,d);let h=o.current.get(d);h||(h=new Set,o.current.set(d,h)),h.add(m)},[]),x=c.useCallback(m=>{const d=n.current.get(m);if(!d)return;n.current.delete(m);const h=o.current.get(d);return h&&(h.delete(m),h.size===0&&o.current.delete(d)),d},[]),w=c.useCallback(()=>{e.current.clear(),t.current.clear(),n.current.clear(),o.current.clear()},[]);return{instanceToDefRef:e,defToInstancesRef:t,edgeToTransitionRef:n,transitionToEdgesRef:o,getDefinitionForInstance:r,getInstancesForDefinition:s,findExistingTransition:i,getEdgeTransition:a,getEdgesForTransition:l,registerInstance:u,unregisterInstance:p,registerEdge:g,unregisterEdge:x,resetMappings:w}}function Kh(e,t){return{x:e.x-t.x,y:e.y-t.y}}function Ll(e,t){return{x:e.x+t.x,y:e.y+t.y}}function Fl(e,t){return t?Ll(e,t):e}const ht=152,Zr=102,Qr=80,pn=32,ue=10;function Xt(e,t,n=ht,o=Zr,r=Qr,s=pn){const i=e+r<=0,a=e>=n,l=t+s<=0,u=t>=o;if(i)return{x:-r-ue,y:Math.max(-s,Math.min(t,o))};if(a)return{x:n+ue,y:Math.max(-s,Math.min(t,o))};if(l)return{x:Math.max(-r,Math.min(e,n)),y:-s-ue};if(u)return{x:Math.max(-r,Math.min(e,n)),y:o+ue};const p=e+r/2,g=t+s/2,x=n/2,w=o/2,m=p-x,d=g-w;return Math.abs(m)>Math.abs(d)?m>0?{x:n+ue,y:Math.max(-s,Math.min(t,o))}:{x:-r-ue,y:Math.max(-s,Math.min(t,o))}:d>0?{x:Math.max(-r,Math.min(e,n)),y:o+ue}:{x:Math.max(-r,Math.min(e,n)),y:-s-ue}}const Un={command:{canConnectTo:["event"],canReceiveFrom:["event","policy","externalEvent"]},policy:{canConnectTo:["command","externalEvent","trigger","externalSystem"],canReceiveFrom:["event"]},externalEvent:{canConnectTo:["command","trigger"],canReceiveFrom:["event","policy"]},externalSystem:{canConnectTo:["event"],canReceiveFrom:["event","policy","externalEvent"]},trigger:{canConnectTo:["event"],canReceiveFrom:["event","policy","externalEvent"]},event:{canConnectTo:["policy","command","externalEvent","trigger","externalSystem"],canReceiveFrom:["command","trigger","externalSystem"]}};function $l(e,t){const n=Un[e],o=Un[t];if(!n||!o)return!1;const r=n.canConnectTo.includes(t),s=o.canReceiveFrom.includes(e);return r&&s}function zl(e,t){return t?"policy":e}function es(e){return e==="command"?"commandEdge":"floating"}function Ln(e){return e>=2?"commandEdge":"floating"}function Hl(e,t){return{sourceHandle:"source-right",targetHandle:"target-left"}}function Yt(){return{label:"Path",labelOffset:.5}}function qt(e,t){return!e||!t?{isNonStandard:!1}:{isNonStandard:!$l(e,t),sourceKind:e,targetKind:t}}function Wl(e,t,n,o){const r=e.source,s=e.target,i=o.has(r);let a;if(i){const m=o.get(r);a=m?n.get(m):void 0}else a=n.get(r);const l=n.get(s);if(!a||!l)return e;const u=t.getNode(a),p=t.getNode(l),g=i?"policy":u==null?void 0:u.kind,x=p==null?void 0:p.kind,w=qt(g,x);return{...e,data:{...e.data,...w}}}const $t=120,Bl=152,Vl=112,Gl={top:{source:"source-top",target:"target-bottom"},right:{source:"source-right",target:"target-left"},bottom:{source:"source-bottom",target:"target-top"},left:{source:"source-left",target:"target-right"}};function Ul(e){return Gl[e]}function Kl(e,t,n,o){switch(o){case"top":return{x:e.x,y:e.y-$t};case"right":return{x:e.x+t+$t,y:e.y};case"bottom":return{x:e.x,y:e.y+n+$t};case"left":return{x:e.x-$t,y:e.y}}}function ts(e,t,n,o){e.set(n,o);let r=t.get(o);r||(r=new Set,t.set(o,r)),r.add(n)}function ns(e,t,n,o){const r=e.get(o);if(!r)return;e.delete(o),n.delete(o);const s=t.get(r);s&&(s.delete(o),s.size===0&&t.delete(r))}function os(e,t){var n;return((n=e.get(t))==null?void 0:n.size)??0}function Xl(e,t,n){var s;const o=t.get(e);return o?(((s=n.get(o))==null?void 0:s.size)??0)>2:!1}function Yl(e,t,n,o){return e.filter(r=>{const s=r;return s.type!=="remove"||!s.id||!t.has(s.id)||o!=null&&o.has(s.id)?!0:Xl(s.id,t,n)})}function ql(e,t,n,o){return e}function Jl(e,t=ht){return Xt(t+ue,e*(pn+ue))}function Zl(e,t,n,o,r){return{id:e,type:"outcome",position:r,parentId:t,data:{label:o,parentPolicyId:t,parentPolicyInstanceId:t,parentPolicyDefId:n}}}function Ql(e,t,n,o,r,s,i){var p;const a=t.get(e);if(!a||(((p=n.get(a))==null?void 0:p.size)??0)<=2)return!1;if(o.get(e)){const g=r.cleanupEdgesFromSource(e);g.length>0&&i(x=>x.filter(w=>!g.includes(w.id)))}return ns(t,n,o,e),s(g=>g.filter(x=>x.id!==e)),!0}function eu(e,t,n,o,r,s,i){const a=i(),l=os(r,e),u=Jl(l),p=Zl(a,e,t,n,u);return ts(o,r,a,e),s(g=>[...g,p]),a}function tu(e,t,n){n(o=>o.map(r=>r.id===e?{...r,data:{...r.data,label:t}}:r))}function rs(e){const{instanceToDefRef:t,setNodes:n,getNodes:o}=e,r=c.useRef(new Map),s=c.useRef(new Map),i=c.useRef(new Map),a=c.useCallback(E=>i.current.get(E),[]),l=c.useCallback(E=>{const C=s.current.get(E);return C?Array.from(C):[]},[]),u=c.useCallback(E=>{const C=s.current.get(E);if(!C)return[];const R=o();return Array.from(C).map(k=>{var z;const N=R.find(D=>D.id===k),S=((z=N==null?void 0:N.data)==null?void 0:z.label)||"Outcome";return{id:k,label:S}})},[o]),p=c.useCallback(E=>r.current.has(E),[]),g=c.useCallback(E=>r.current.get(E),[]),x=c.useCallback(E=>os(s.current,E),[]),w=c.useCallback((E,C)=>{ts(r.current,s.current,E,C)},[]),m=c.useCallback(E=>{ns(r.current,s.current,i.current,E)},[]),d=c.useCallback((E,C)=>{i.current.set(E,C)},[]),h=c.useCallback(E=>{i.current.delete(E)},[]),y=c.useCallback((E,C)=>{var k;const R=(k=t.current)==null?void 0:k.get(E);if(!R)throw new Error(`Policy instance ${E} not found`);return eu(E,R,C,r.current,s.current,n,Gn)},[t,n]),v=c.useCallback((E,C)=>{tu(E,C,n)},[n]),b=c.useCallback(()=>{r.current.clear(),s.current.clear(),i.current.clear()},[]);return{outcomeToParentRef:r,policyToOutcomesRef:s,outcomeToTransitionRef:i,getOutcomeTransition:a,getOutcomesForPolicy:l,getOutcomesWithLabels:u,isOutcome:p,getOutcomeParent:g,getOutcomeCount:x,registerOutcome:w,unregisterOutcome:m,setOutcomeTransition:d,clearOutcomeTransition:h,addOutcomeToPolicy:y,updateOutcomeLabel:v,resetMappings:b}}function ss(e,t){const{edgeToTransitionRef:n,transitionToEdgesRef:o}=t,r=c.useCallback(x=>n.current.get(x),[n]),s=c.useCallback(x=>o.current.get(x),[o]),i=c.useCallback(x=>{const w=o.current.get(x);return w!==void 0&&w.size>0},[o]),a=c.useCallback((x,w)=>{if(!e.current)return;const d=e.current.getOutgoingTransitions(x).find(h=>h.targetDefId===w);return d==null?void 0:d.id},[e]),l=c.useCallback((x,w)=>{n.current.set(x,w);let m=o.current.get(w);m||(m=new Set,o.current.set(w,m)),m.add(x)},[n,o]),u=c.useCallback((x,w,m)=>{const d=Al({sourceDefId:w,targetDefId:m});return e.current.addTransition(d),n.current.set(x,d.id),o.current.set(d.id,new Set([x])),d.id},[e,n,o]),p=c.useCallback(x=>{const w=n.current.get(x);if(!w)return{transitionDeleted:!1};n.current.delete(x);const m=o.current.get(w);return m==null||m.delete(x),!m||m.size===0?(o.current.delete(w),e.current.removeTransition(w),{transitionDeleted:!0,transitionId:w}):{transitionDeleted:!1,transitionId:w}},[e,n,o]),g=c.useCallback((x,w,m,d)=>{if((d==null?void 0:d.allowReuseExisting)??!0){const y=a(w,m);if(y)return l(x,y),y}return u(x,w,m)},[a,l,u]);return{getTransitionForEdge:r,getEdgesForTransition:s,hasEdgesForTransition:i,findExistingTransition:a,linkEdgeToTransition:l,linkEdgeToNewTransition:u,unlinkEdgeFromTransition:p,getOrCreateTransitionAndLink:g}}function is(e,t){const n=c.useCallback(l=>{var p;const u=(p=t.current)==null?void 0:p.get(l);return u?Array.from(u):[]},[t]),o=c.useCallback(l=>{var u,p;return((p=(u=e.current)==null?void 0:u.getNode(l))==null?void 0:p.kind)==="command"},[e]),r=c.useCallback((l,u)=>{const p=n(l);if(p.length===0)return 0;const g=new Set(p);let x=0;for(const w of u)g.has(w.source)&&x++;return x},[n]),s=c.useCallback((l,u,p)=>{let g=r(l,u);return g+=(p==null?void 0:p.pendingAdd)??0,Ln(g)},[r]),i=c.useCallback((l,u,p)=>{const g=n(l);if(g.length===0)return u;const x=new Set(g);let w=0;for(const d of u)x.has(d.source)&&w++;w+=(p==null?void 0:p.pendingAdd)??0;const m=Ln(w);return u.map(d=>{var h;return!x.has(d.source)||d.type===m?d:{...d,type:m,data:{...d.data,...m==="commandEdge"&&!((h=d.data)!=null&&h.label)?Yt():{}}}})},[n]),a=c.useCallback((l,u,p,g)=>{const x=new Map;for(const w of l){const m=p.get(w.source);if(!m)continue;const d=u.getNode(m);(d==null?void 0:d.kind)==="command"&&x.set(m,(x.get(m)??0)+1)}return l.map(w=>{var v;const m=p.get(w.source);if(!m)return w;const d=u.getNode(m);if((d==null?void 0:d.kind)!=="command")return w;const h=x.get(m)??0,y=Ln(h);return w.type===y?w:{...w,type:y,data:{...w.data,...y==="commandEdge"&&!((v=w.data)!=null&&v.label)?Yt():{}}}})},[]);return{countCommandEdges:r,resolveEdgeType:s,normalizeCommandEdges:i,normalizeAllCommandEdges:a,isCommandDefinition:o,getCommandInstanceIds:n}}const ir=["hotspot","note","actor"];function nu(e){const{edges:t,setNodes:n,setEdges:o,onNodesChangeInternal:r,onEdgesChangeInternal:s,graphRef:i,getNode:a,nodesRef:l,instanceToDefRef:u,defToInstancesRef:p,edgeToTransitionRef:g,transitionToEdgesRef:x,outcomeManagement:w,edgeTransitionManager:m,commandEdgeResolver:d}=e,{isOutcome:h,unregisterOutcome:y,getOutcomesForPolicy:v,setOutcomeTransition:b,clearOutcomeTransition:E,outcomeToParentRef:C,policyToOutcomesRef:R}=w,k=c.useCallback(T=>{const M=u.current.get(T);if(!M)return;const P=v(T);for(const I of P)y(I);u.current.delete(T);const L=p.current.get(M);if(L==null||L.delete(T),!L||L.size===0){p.current.delete(M),i.current.removeNode(M);for(const[I,_]of g.current)i.current.getTransition(_)||(g.current.delete(I),x.current.delete(_))}},[i,u,p,g,x,v,y]),N=c.useCallback(T=>{m.unlinkEdgeFromTransition(T)},[m]),S=c.useCallback(T=>{const M=new Set;for(const $ of T)if($.type==="remove"){const X=R.current.get($.id);if(X)for(const U of X)M.add(U)}const P=Yl(T,C.current,R.current,M);for(const $ of M)P.some(X=>X.type==="remove"&&X.id===$)||P.push({type:"remove",id:$});const L=P.map($=>{var X,U,q,J;if($.type==="position"&&$.position){const Q=C.current.get($.id);if(Q){const te=a($.id),W=a(Q),O=Xt($.position.x,$.position.y,((X=W==null?void 0:W.measured)==null?void 0:X.width)??ht,((U=W==null?void 0:W.measured)==null?void 0:U.height)??Zr,((q=te==null?void 0:te.measured)==null?void 0:q.width)??Qr,((J=te==null?void 0:te.measured)==null?void 0:J.height)??pn);return{...$,position:O}}}return $}),I=new Set;for(const $ of L)$.type==="remove"&&I.add($.id);const _=new Set;for(const $ of t)(I.has($.source)||I.has($.target))&&_.add($.id);for(const $ of _)N($);_.size>0&&o($=>$.filter(X=>!_.has(X.id)));for(const $ of L)$.type==="remove"&&k($.id);r(L)},[r,k,N,a,t,o,R,C]),z=c.useCallback(T=>{const M=ql(T,t,C.current,R.current),P=new Set,L=new Set;for(const I of M)if(I.type==="remove"){const _=t.find($=>$.id===I.id);if(_){const $=_.source,X=_.target,U=u.current.get($);if(U){const q=i.current.getNode(U);if((q==null?void 0:q.kind)==="command"){P.add(U);const J=u.current.get(X);if(J){const Q=i.current.getNode(J);(Q==null?void 0:Q.kind)==="event"&&L.add(X)}}}}N(I.id)}s(M),P.size>0&&o(I=>{let _=I;for(const $ of P)_=d.normalizeCommandEdges($,_);return _}),L.size>0&&n(I=>I.map(_=>L.has(_.id)?t.some(X=>{if(X.target!==_.id||M.some(Q=>Q.type==="remove"&&Q.id===X.id))return!1;const q=u.current.get(X.source);if(!q)return!1;const J=i.current.getNode(q);return(J==null?void 0:J.kind)==="command"})?_:{..._,data:{..._.data,hasCommandParent:!1}}:_))},[s,N,t,o,n,d,i,u,C,R]),D=c.useCallback(T=>{if(!T.source||!T.target)return!1;const M=T.source,P=T.target;if(M===P)return!1;const L=h(M),I=l.current.find(U=>U.id===M),_=zl(I==null?void 0:I.type,L),$=l.current.find(U=>U.id===P),X=$==null?void 0:$.type;return!(!_||!X||ir.includes(_)||ir.includes(X))},[h,l]),A=c.useCallback(T=>{if(!T.source||!T.target)return;const M=T.source,P=T.target,L=`edge_${M}_${P}`;if(g.current.has(L))return;const I=h(M);let _;if(I){const O=M,j=C.current.get(O);_=u.current.get(j)}else _=u.current.get(M);const $=u.current.get(P);if(!_||!$)return;const X=m.findExistingTransition(_,$);if(X&&!I&&m.hasEdgesForTransition(X))return;const U=I?m.linkEdgeToNewTransition(L,_,$):m.getOrCreateTransitionAndLink(L,_,$);I&&b(M,U);const q=i.current.getNode(_),J=i.current.getNode($),Q=(q==null?void 0:q.kind)==="command",te=I?"policy":q==null?void 0:q.kind,W=qt(te,J==null?void 0:J.kind);Q?(o(O=>{const j=d.resolveEdgeType(_,O,{pendingAdd:1}),V=Jo({...T,id:L,type:j,data:{state:"idle",transitionId:U,...W,...j==="commandEdge"?Yt():{}}},O);return d.normalizeCommandEdges(_,V)}),(J==null?void 0:J.kind)==="event"&&n(O=>O.map(j=>j.id===P?{...j,data:{...j.data,hasCommandParent:!0}}:j))):o(O=>Jo({...T,id:L,type:"floating",data:{state:"idle",transitionId:U,...W}},O))},[o,n,m,d,i,u,g,C,h,b]),F=c.useCallback((T,M)=>{if(!M.source||!M.target)return;const P=T.id,L=M.source,I=M.target,_=`edge_${L}_${I}`,$=P!==_;if(t.some(ne=>ne.id!==P&&ne.id!==_&&ne.source===L&&ne.target===I)||$&&g.current.has(_))return;const U=h(L);let q;if(U){const ne=L,Se=C.current.get(ne);q=u.current.get(Se)}else q=u.current.get(L);const J=u.current.get(I);if(!q||!J)return;const Q=g.current.get(P),te=Q?i.current.getTransition(Q):void 0,W=!te||te.sourceDefId!==q||te.targetDefId!==J;let O;const j=T.source,V=C.current.has(j);if(W){Q&&(m.unlinkEdgeFromTransition(P),V&&E(j));const ne=m.findExistingTransition(q,J);if(ne&&!U&&m.hasEdgesForTransition(ne))return;O=U?m.linkEdgeToNewTransition(_,q,J):m.getOrCreateTransitionAndLink(_,q,J),U&&b(L,O)}else{if(O=Q,$){g.current.delete(P),g.current.set(_,O);const ne=x.current.get(O);ne&&(ne.delete(P),ne.add(_))}V&&j!==L&&E(j),U&&b(L,O)}const Y=i.current.getNode(q),Z=i.current.getNode(J),re=(Y==null?void 0:Y.kind)==="command",ce=re?"commandEdge":"floating",me=U?"policy":Y==null?void 0:Y.kind,ge=qt(me,Z==null?void 0:Z.kind);o(ne=>Yc(T,M,ne).map(se=>{var he;return se.source===M.source&&se.target===M.target?{...se,id:_,type:ce,data:{...se.data,...W?{state:"idle",progress:0}:{},transitionId:O,...ge,...re&&!((he=se.data)!=null&&he.label)?{label:"Path",labelOffset:.5}:{}}}:se}))},[t,o,m,i,u,g,x,C,h,b,E]);return{onNodesChange:S,onEdgesChange:z,onConnect:A,onReconnect:F,isValidConnection:D}}function ar(e,t,n,o,r){return{id:e,type:"outcome",position:r,parentId:n,data:{label:t,parentPolicyInstanceId:n,parentPolicyDefId:o}}}function ou(e){const{edges:t,setNodes:n,setEdges:o,graphRef:r,getNode:s,instanceMapping:i,outcomeManagement:a,edgeTransitionManager:l}=e,{instanceToDefRef:u,defToInstancesRef:p,edgeToTransitionRef:g,transitionToEdgesRef:x}=i,{outcomeToParentRef:w,policyToOutcomesRef:m,getOutcomesForPolicy:d,registerOutcome:h,unregisterOutcome:y}=a,v=c.useCallback(S=>{const z=u.current.get(S);if(!z)return;const D=d(S);for(const F of D)y(F);u.current.delete(S);const A=p.current.get(z);if(A==null||A.delete(S),!A||A.size===0){p.current.delete(z),r.current.removeNode(z);for(const[F,T]of g.current)r.current.getTransition(T)||(g.current.delete(F),x.current.delete(T))}},[r,u,p,g,x,d,y]),b=c.useCallback((S,z,D)=>{let A,F="event";if(S==="event"){const M=jn({label:D||"Event"});r.current.addNode(M);const P=Ft();u.current.set(P,M.id),p.current.set(M.id,new Set([P]));const L={id:P,type:"event",position:z,data:{label:M.label,executionMode:M.executionMode,definitionId:M.id}};return n(I=>[...I,L]),P}if(S==="trigger"){const M=kl({label:D||"Trigger"});r.current.addNode(M);const P=Ft();u.current.set(P,M.id),p.current.set(M.id,new Set([P]));const L={id:P,type:"trigger",position:z,data:{label:M.label,definitionId:M.id}};return n(I=>[...I,L]),P}S==="policy"?(A=er({label:D||"Policy"}),F="policy"):S==="externalSystem"?(A=tr({label:D||"External System"}),F="externalSystem"):S==="externalEvent"?(A=Il({label:D||"External Event"}),F="externalEvent"):S==="command"?(A=nr({label:D??"Command"}),F="command"):S==="hotspot"?(A=or({label:D||"HotSpot"}),F="hotspot"):S==="note"?(A=rr({label:D||"Note"}),F="note"):S==="actor"?(A=sr({label:D||"Actor"}),F="actor"):(A=jn({label:D||"Event"}),F="event"),r.current.addNode(A);const T=Ft();if(u.current.set(T,A.id),p.current.set(A.id,new Set([T])),S==="policy"){const M={id:T,type:"policy",position:z,data:{label:A.label,executionMode:A.executionMode,definitionId:A.id}},P=Gn(),L=Gn(),I=Xt(ht+ue,0),_=Xt(ht+ue,pn+ue),$=ar(P,"Yes",T,A.id,I),X=ar(L,"No",T,A.id,_);h(P,T),h(L,T),n(U=>[...U,M,$,X])}else{const M={id:T,type:F,position:z,data:{label:A.label,executionMode:A.executionMode,definitionId:A.id}};n(P=>[...P,M])}return T},[r,u,p,n,h]),E=c.useCallback((S,z)=>{const D=r.current.getNode(S);if(!D)throw new Error(`Definition ${S} does not exist`);const A=Ft();u.current.set(A,S);const F=p.current.get(S)??new Set;F.add(A),p.current.set(S,F);const T={id:A,type:D.kind,position:z,data:{label:D.label,executionMode:D.executionMode,definitionId:S}};return n(M=>[...M,T]),A},[r,u,p,n]),C=c.useCallback(S=>{const z=u.current.get(S);if(!z)return;const D=s(S);if(!D)return;const A={x:D.position.x+50,y:D.position.y+50};return E(z,A)},[u,s,E]),R=c.useCallback(S=>{const z=u.current.get(S);if(!z)return;const D=r.current.getNode(z);if(!D)return;const A=p.current.get(z);if(!A||A.size<=1)return;let F;D.kind==="event"?F=jn({label:D.label}):D.kind==="policy"?F=er({label:D.label}):D.kind==="command"?F=nr({label:D.label}):D.kind==="hotspot"?F=or({label:D.label}):D.kind==="note"?F=rr({label:D.label}):D.kind==="actor"?F=sr({label:D.label}):F=tr({label:D.label}),r.current.addNode(F),u.current.set(S,F.id),A.delete(S),p.current.set(F.id,new Set([S]));const T=t.filter(M=>M.source===S||M.target===S);for(const M of T){const P=M.source===S,L=P?M.target:M.source;if(w.current.has(L))continue;const I=u.current.get(L);if(!I||I===z)continue;const _=P?F.id:I,$=P?I:F.id;l.getOrCreateTransitionAndLink(M.id,_,$)}n(M=>M.map(P=>P.id===S?{...P,data:{...P.data,definitionId:F.id}}:P)),o(M=>M.map(P=>{if(P.source===S||P.target===S){const L=g.current.get(P.id);if(L)return{...P,data:{...P.data,transitionId:L}}}return P}))},[r,u,p,w,g,t,n,o,l]),k=c.useCallback(S=>{const z=m.current.get(S),D=new Set([S]);if(z)for(const A of z)D.add(A);v(S),n(A=>A.filter(F=>!D.has(F.id)))},[m,v,n]),N=c.useCallback(S=>{const z=p.current.get(S);if(!z)return;const D=new Set(z);for(const A of D)u.current.delete(A);p.current.delete(S),r.current.removeNode(S),n(A=>A.filter(F=>!D.has(F.id)))},[r,u,p,n]);return{addNode:b,addInstance:E,duplicateInstance:C,dissociateInstance:R,deleteInstance:k,deleteDefinition:N,handleInstanceDeletion:v}}function ru(e){const{setNodes:t,graphRef:n,instanceMapping:o}=e,{defToInstancesRef:r,getDefinitionForInstance:s,getInstancesForDefinition:i}=o,a=c.useCallback(d=>i(d),[i]),l=c.useCallback((d,h)=>{n.current.updateNode(d,{executionMode:h});const y=r.current.get(d);y&&t(v=>v.map(b=>y.has(b.id)?{...b,data:{...b.data,executionMode:h}}:b))},[n,r,t]),u=c.useCallback((d,h)=>{const y=n.current.getNode(d);if(!y)return;n.current.updateNode(d,{label:h});const v=y.config;if(y.kind==="command"||y.kind==="trigger"||y.kind==="externalSystem"||y.kind==="externalEvent"){const E=be(h);if(E){const C=v;if((C==null?void 0:C.slugName)!==E){const k={...C,slugName:E};n.current.updateNode(d,{config:k})}}}else if(y.kind==="event"){const E=fn(h);if(E){const C=v;if((C==null?void 0:C.type)!==E){const k={...C,type:E};n.current.updateNode(d,{config:k})}}}const b=r.current.get(d);b&&t(E=>E.map(C=>b.has(C.id)?{...C,data:{...C.data,label:h}}:C))},[n,r,t]),p=c.useCallback((d,h)=>{n.current.updateNode(d,{config:h})},[n]),g=c.useCallback((d,h)=>{n.current.updateNode(d,{awsExtension:h})},[n]),x=c.useCallback(d=>{var h;return(h=n.current.getNode(d))==null?void 0:h.config},[n]),w=c.useCallback(d=>{var h;return(h=n.current.getNode(d))==null?void 0:h.awsExtension},[n]),m=c.useCallback((d,h)=>{var C;const y=n.current.getNode(d);if(!y||y.kind!=="command"&&y.kind!=="trigger"||y.kind===h)return;const v=h==="trigger"?"manual":"automatic";n.current.updateNode(d,{kind:h,executionMode:v}),h==="command"&&n.current.recalculateExecutionMode(d);const b=r.current.get(d);if(!b)return;const E=(C=n.current.getNode(d))==null?void 0:C.executionMode;t(R=>R.map(k=>b.has(k.id)?{...k,type:h,data:{...k.data,executionMode:E}}:k))},[n,r,t]);return{getDefinitionForInstance:s,getInstancesForDefinition:a,updateNodeExecutionMode:l,updateNodeLabel:u,updateNodeConfig:p,updateNodeAwsExtension:g,getNodeConfig:x,getNodeAwsExtension:w,convertNodeKind:m}}function su(e){const{edges:t,setNodes:n,setEdges:o,outcomeManagement:r,edgeTransitionManager:s}=e,{outcomeToParentRef:i,policyToOutcomesRef:a,outcomeToTransitionRef:l,getOutcomeTransition:u,getOutcomesForPolicy:p,getOutcomesWithLabels:g,addOutcomeToPolicy:x,updateOutcomeLabel:w}=r,m=c.useMemo(()=>({cleanupEdgesFromSource:h=>{const y=t.filter(v=>v.source===h).map(v=>v.id);for(const v of y)s.unlinkEdgeFromTransition(v);return y}}),[t,s]),d=c.useCallback(h=>Ql(h,i.current,a.current,l.current,m,n,o),[i,a,l,m,n,o]);return{getOutcomeTransition:u,getOutcomesForPolicy:p,getOutcomesWithLabels:g,addOutcomeToPolicy:x,deleteOutcome:d,updateOutcomeLabel:w}}const zt=16;function iu(e){const{nodes:t,edges:n,setNodes:o,setEdges:r,graphRef:s,instanceMapping:i,outcomeManagement:a,commandEdgeResolver:l,incrementGraphVersion:u}=e,{instanceToDefRef:p,defToInstancesRef:g,edgeToTransitionRef:x,transitionToEdgesRef:w}=i,{outcomeToParentRef:m,policyToOutcomesRef:d,outcomeToTransitionRef:h,resetMappings:y}=a,v=c.useCallback(()=>{s.current=new gt,i.resetMappings(),y(),o([]),r([]),u()},[s,o,r,i,y,u]),b=c.useCallback(()=>({graph:s.current,nodes:t,edges:n,mappings:{instanceToDefRef:new Map(p.current),defToInstancesRef:new Map(Array.from(g.current.entries()).map(([C,R])=>[C,new Set(R)])),edgeToTransitionRef:new Map(x.current),transitionToEdgesRef:new Map(Array.from(w.current.entries()).map(([C,R])=>[C,new Set(R)])),outcomeToParentRef:new Map(m.current),policyToOutcomesRef:new Map(Array.from(d.current.entries()).map(([C,R])=>[C,new Set(R)])),outcomeToTransitionRef:new Map(h.current)}}),[t,n,s,p,g,x,w,m,d,h]),E=c.useCallback(C=>{s.current=C.graph,p.current=C.mappings.instanceToDefRef,g.current=C.mappings.defToInstancesRef,x.current=C.mappings.edgeToTransitionRef,w.current=C.mappings.transitionToEdgesRef,m.current=C.mappings.outcomeToParentRef??new Map,d.current=C.mappings.policyToOutcomesRef??new Map,h.current=C.mappings.outcomeToTransitionRef??new Map;const R=C.nodes.map(S=>({...S,position:{x:Math.round(S.position.x/zt)*zt,y:Math.round(S.position.y/zt)*zt}})),N=l.normalizeAllCommandEdges(C.edges,C.graph,C.mappings.instanceToDefRef,C.mappings.defToInstancesRef).map(S=>Wl(S,C.graph,C.mappings.instanceToDefRef,C.mappings.outcomeToParentRef??new Map));o(R),r(N),u()},[s,p,g,x,w,m,d,h,o,r,l,u]);return{reset:v,getWorkflowState:b,hydrateWorkflow:E}}const au=[],cu=[];function lu(e){const t=c.useRef(new gt),[n,o]=c.useState(0),r=Jr(),[s,i,a]=Vr(au),[l,u,p]=Gr(cu),g=c.useRef([]);g.current=s;const{getNode:x,getNodes:w}=Rt(),m=ss(t,{edgeToTransitionRef:r.edgeToTransitionRef,transitionToEdgesRef:r.transitionToEdgesRef}),d=is(t,r.defToInstancesRef),h=rs({instanceToDefRef:r.instanceToDefRef,setNodes:i,getNodes:w}),y=(e==null?void 0:e.graphRef)??t,v=e?e.incrementGraphVersion:()=>o(Lt=>Lt+1),b=(e==null?void 0:e.nodes)??s,E=(e==null?void 0:e.edges)??l,C=(e==null?void 0:e.setNodes)??i,R=(e==null?void 0:e.setEdges)??u,k=(e==null?void 0:e.onNodesChangeInternal)??a,N=(e==null?void 0:e.onEdgesChangeInternal)??p,S=(e==null?void 0:e.nodesRef)??g,z=(e==null?void 0:e.instanceMapping)??r,{instanceToDefRef:D,defToInstancesRef:A,edgeToTransitionRef:F,transitionToEdgesRef:T}=z,M=(e==null?void 0:e.edgeTransitionManager)??m,P=(e==null?void 0:e.commandEdgeResolver)??d,L=(e==null?void 0:e.outcomeManagement)??h,I=c.useMemo(()=>E.map(Lt=>({...Lt,reconnectable:Lt.selected??!1})),[E]),{outcomeToParentRef:_,policyToOutcomesRef:$,outcomeToTransitionRef:X}=L,U={nodes:b,edges:E,setNodes:C,setEdges:R,onNodesChangeInternal:k,onEdgesChangeInternal:N,graphRef:y,graph:y.current,getNode:x,nodesRef:S,instanceMapping:z,instanceToDefRef:D,defToInstancesRef:A,edgeToTransitionRef:F,transitionToEdgesRef:T,outcomeManagement:L,edgeTransitionManager:M,commandEdgeResolver:P,incrementGraphVersion:v},{onNodesChange:q,onEdgesChange:J,onConnect:Q,onReconnect:te,isValidConnection:W}=nu(U),{addNode:O,addInstance:j,duplicateInstance:V,dissociateInstance:Y,deleteInstance:Z,deleteDefinition:re}=ou(U),{getDefinitionForInstance:ce,getInstancesForDefinition:me,updateNodeExecutionMode:ge,updateNodeLabel:ne,updateNodeConfig:Se,updateNodeAwsExtension:se,getNodeConfig:he,getNodeAwsExtension:jt,convertNodeKind:wc}=ru(U),{getOutcomeTransition:yc,getOutcomesForPolicy:bc,getOutcomesWithLabels:Ec,addOutcomeToPolicy:Cc,deleteOutcome:Tc,updateOutcomeLabel:_c}=su(U),{reset:Sc,getWorkflowState:Rc,hydrateWorkflow:Nc}=iu(U),Pc=c.useMemo(()=>t.current,[n]),Mc=(e==null?void 0:e.graph)??Pc;return{nodes:b,edges:I,graph:Mc,onNodesChange:q,onEdgesChange:J,onConnect:Q,isValidConnection:W,onReconnect:te,addNode:O,addInstance:j,duplicateInstance:V,dissociateInstance:Y,deleteInstance:Z,deleteDefinition:re,getDefinitionForInstance:ce,getInstancesForDefinition:me,updateNodeExecutionMode:ge,updateNodeLabel:ne,updateNodeConfig:Se,updateNodeAwsExtension:se,getNodeConfig:he,getNodeAwsExtension:jt,convertNodeKind:wc,reset:Sc,getWorkflowState:Rc,hydrateWorkflow:Nc,getOutcomeTransition:yc,getOutcomesForPolicy:bc,getOutcomesWithLabels:Ec,addOutcomeToPolicy:Cc,deleteOutcome:Tc,updateOutcomeLabel:_c}}const uu=[],du=[];function fu(){const e=c.useRef(new gt),[t,n]=c.useState(0),o=Jr(),{instanceToDefRef:r,defToInstancesRef:s,edgeToTransitionRef:i,transitionToEdgesRef:a}=o,[l,u,p]=Vr(uu),[g,x,w]=Gr(du),m=c.useRef([]);m.current=l;const d=c.useMemo(()=>g.map(A=>({...A,reconnectable:A.selected??!1})),[g]),{getNode:h,getNodes:y}=Rt(),v=ss(e,{edgeToTransitionRef:i,transitionToEdgesRef:a}),b=is(e,s),E=rs({instanceToDefRef:r,setNodes:u,getNodes:y}),{outcomeToParentRef:C,policyToOutcomesRef:R,outcomeToTransitionRef:k,resetMappings:N}=E,S=c.useCallback(()=>{n(A=>A+1)},[]),z=c.useCallback(()=>{e.current=new gt,o.resetMappings(),N(),u([]),x([]),n(A=>A+1)},[u,x,o,N]),D=c.useMemo(()=>e.current,[t]);return{nodes:l,edges:g,edgesWithReconnectable:d,setNodes:u,setEdges:x,onNodesChangeInternal:p,onEdgesChangeInternal:w,graphRef:e,graph:D,getNode:h,getNodes:y,nodesRef:m,instanceMapping:o,instanceToDefRef:r,defToInstancesRef:s,edgeToTransitionRef:i,transitionToEdgesRef:a,outcomeManagement:E,outcomeToParentRef:C,policyToOutcomesRef:R,outcomeToTransitionRef:k,edgeTransitionManager:v,commandEdgeResolver:b,incrementGraphVersion:S,reset:z}}const as=c.createContext(null);function pu({children:e}){const t=fu();return f.jsx(as.Provider,{value:t,children:e})}function mu(){const e=c.useContext(as);if(!e)throw new Error("useWorkflowCoreContext must be used within a WorkflowCoreProvider");return e}const cs=c.createContext(null);function gu({children:e}){const t=mu(),n=lu(t);return f.jsx(cs.Provider,{value:n,children:e})}function Xh({children:e}){return f.jsx(pu,{children:f.jsx(gu,{children:e})})}function mn(){const e=c.useContext(cs);if(!e)throw new Error("useWorkflow must be used within a WorkflowProvider");return e}function hu(e){const t=c.useRef(null),[n,o]=c.useState(null),[r,s]=c.useState([]),[i,a]=c.useState(!1);c.useEffect(()=>{const m=new jl(e,{transitionDelay:1e3});t.current=m;const d=(y,v)=>{const b={id:`${Date.now()}-${Math.random()}`,type:y,timestamp:v.timestamp,data:v};s(E=>[...E,b]),o(m.getState())},h=[m.on("simulation:start",y=>{d("simulation:start",y),a(!0)}),m.on("simulation:stop",y=>{d("simulation:stop",y),a(!1)}),m.on("simulation:reset",y=>{d("simulation:reset",y),a(!1)}),m.on("node:enter",y=>d("node:enter",y)),m.on("node:active",y=>d("node:active",y)),m.on("node:waiting",y=>d("node:waiting",y)),m.on("node:exit",y=>d("node:exit",y)),m.on("node:complete",y=>d("node:complete",y)),m.on("node:reset",y=>d("node:reset",y)),m.on("transition:start",y=>d("transition:start",y)),m.on("transition:complete",y=>d("transition:complete",y)),m.on("transition:reset",y=>d("transition:reset",y)),m.on("error",y=>d("error",y)),m.on("state:initialized",()=>{o(m.getState())})];return queueMicrotask(()=>{o(m.getState())}),()=>{h.forEach(y=>y()),m.stop(),t.current=null}},[e]);const l=c.useCallback(()=>{var m;(m=t.current)==null||m.start()},[]),u=c.useCallback(()=>{var m;(m=t.current)==null||m.stop()},[]),p=c.useCallback(()=>{var m;(m=t.current)==null||m.reset(),s([])},[]),g=c.useCallback(m=>{var d;(d=t.current)==null||d.triggerNode(m)},[]),x=c.useCallback(m=>{var d;(d=t.current)==null||d.selectTransition(m)},[]),w=c.useCallback(m=>{var d;(d=t.current)==null||d.completeManualNode(m)},[]);return{isRunning:i,state:n,events:r,start:l,stop:u,reset:p,triggerNode:g,selectTransition:x,completeManualNode:w}}const ls=c.createContext(null);function Yh({children:e}){const{graph:t}=mn(),n=hu(t);return f.jsx(ls.Provider,{value:n,children:e})}function xu(){const e=c.useContext(ls);if(!e)throw new Error("useSimulationContext must be used within a SimulationProvider");return e}const us=c.createContext(null);function qh({children:e}){const[t,n]=c.useState(null),[o,r]=c.useState(null),s=c.useCallback(l=>{n(l)},[]),i=c.useCallback(()=>{n(null)},[]),a={pendingTooltip:t,hoveredWarningEdgeId:o,showTooltip:s,hideTooltip:i,setHoveredWarningEdgeId:r};return f.jsx(us.Provider,{value:a,children:e})}function ds(){const e=c.useContext(us);if(!e)throw new Error("useNonStandardConnectionContext must be used within a NonStandardConnectionProvider");return e}const cr=e=>{let t;const n=new Set,o=(u,p)=>{const g=typeof u=="function"?u(t):u;if(!Object.is(g,t)){const x=t;t=p??(typeof g!="object"||g===null)?g:Object.assign({},t,g),n.forEach(w=>w(t,x))}},r=()=>t,a={setState:o,getState:r,getInitialState:()=>l,subscribe:u=>(n.add(u),()=>n.delete(u))},l=t=e(o,r,a);return a},vu=(e=>e?cr(e):cr),wu=e=>e;function yu(e,t=wu){const n=ye.useSyncExternalStore(e.subscribe,ye.useCallback(()=>t(e.getState()),[e,t]),ye.useCallback(()=>t(e.getInitialState()),[e,t]));return ye.useDebugValue(n),n}const lr=e=>{const t=vu(e),n=o=>yu(t,o);return Object.assign(n,t),n},fs=(e=>e?lr(e):lr),bu=e=>(t,n,o)=>{const r=o.subscribe;return o.subscribe=((i,a,l)=>{let u=i;if(a){const p=(l==null?void 0:l.equalityFn)||Object.is;let g=i(o.getState());u=x=>{const w=i(x);if(!p(g,w)){const m=g;a(g=w,m)}},l!=null&&l.fireImmediately&&a(g,g)}return r(u)}),e(t,n,o)},Eu=bu;function Cu(e,t){let n;try{n=e()}catch{return}return{getItem:r=>{var s;const i=l=>l===null?null:JSON.parse(l,void 0),a=(s=n.getItem(r))!=null?s:null;return a instanceof Promise?a.then(i):i(a)},setItem:(r,s)=>n.setItem(r,JSON.stringify(s,void 0)),removeItem:r=>n.removeItem(r)}}const Kn=e=>t=>{try{const n=e(t);return n instanceof Promise?n:{then(o){return Kn(o)(n)},catch(o){return this}}}catch(n){return{then(o){return this},catch(o){return Kn(o)(n)}}}},Tu=(e,t)=>(n,o,r)=>{let s={storage:Cu(()=>localStorage),partialize:d=>d,version:0,merge:(d,h)=>({...h,...d}),...t},i=!1;const a=new Set,l=new Set;let u=s.storage;if(!u)return e((...d)=>{console.warn(`[zustand persist middleware] Unable to update item '${s.name}', the given storage is currently unavailable.`),n(...d)},o,r);const p=()=>{const d=s.partialize({...o()});return u.setItem(s.name,{state:d,version:s.version})},g=r.setState;r.setState=(d,h)=>(g(d,h),p());const x=e((...d)=>(n(...d),p()),o,r);r.getInitialState=()=>x;let w;const m=()=>{var d,h;if(!u)return;i=!1,a.forEach(v=>{var b;return v((b=o())!=null?b:x)});const y=((h=s.onRehydrateStorage)==null?void 0:h.call(s,(d=o())!=null?d:x))||void 0;return Kn(u.getItem.bind(u))(s.name).then(v=>{if(v)if(typeof v.version=="number"&&v.version!==s.version){if(s.migrate){const b=s.migrate(v.state,v.version);return b instanceof Promise?b.then(E=>[!0,E]):[!0,b]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,v.state];return[!1,void 0]}).then(v=>{var b;const[E,C]=v;if(w=s.merge(C,(b=o())!=null?b:x),n(w,!0),E)return p()}).then(()=>{y==null||y(w,void 0),w=o(),i=!0,l.forEach(v=>v(w))}).catch(v=>{y==null||y(void 0,v)})};return r.persist={setOptions:d=>{s={...s,...d},d.storage&&(u=d.storage)},clearStorage:()=>{u==null||u.removeItem(s.name)},getOptions:()=>s,rehydrate:()=>m(),hasHydrated:()=>i,onHydrate:d=>(a.add(d),()=>{a.delete(d)}),onFinishHydration:d=>(l.add(d),()=>{l.delete(d)})},s.skipHydration||m(),w||x},_u=Tu;var ps=Symbol.for("immer-nothing"),ur=Symbol.for("immer-draftable"),pe=Symbol.for("immer-state");function Ee(e,...t){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var xt=Object.getPrototypeOf;function rt(e){return!!e&&!!e[pe]}function qe(e){var t;return e?ms(e)||Array.isArray(e)||!!e[ur]||!!((t=e.constructor)!=null&&t[ur])||Pt(e)||hn(e):!1}var Su=Object.prototype.constructor.toString(),dr=new WeakMap;function ms(e){if(!e||typeof e!="object")return!1;const t=Object.getPrototypeOf(e);if(t===null||t===Object.prototype)return!0;const n=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;if(n===Object)return!0;if(typeof n!="function")return!1;let o=dr.get(n);return o===void 0&&(o=Function.toString.call(n),dr.set(n,o)),o===Su}function Jt(e,t,n=!0){gn(e)===0?(n?Reflect.ownKeys(e):Object.keys(e)).forEach(r=>{t(r,e[r],e)}):e.forEach((o,r)=>t(r,o,e))}function gn(e){const t=e[pe];return t?t.type_:Array.isArray(e)?1:Pt(e)?2:hn(e)?3:0}function Xn(e,t){return gn(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function gs(e,t,n){const o=gn(e);o===2?e.set(t,n):o===3?e.add(n):e[t]=n}function Ru(e,t){return e===t?e!==0||1/e===1/t:e!==e&&t!==t}function Pt(e){return e instanceof Map}function hn(e){return e instanceof Set}function Ye(e){return e.copy_||e.base_}function Yn(e,t){if(Pt(e))return new Map(e);if(hn(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);const n=ms(e);if(t===!0||t==="class_only"&&!n){const o=Object.getOwnPropertyDescriptors(e);delete o[pe];let r=Reflect.ownKeys(o);for(let s=0;s<r.length;s++){const i=r[s],a=o[i];a.writable===!1&&(a.writable=!0,a.configurable=!0),(a.get||a.set)&&(o[i]={configurable:!0,writable:!0,enumerable:a.enumerable,value:e[i]})}return Object.create(xt(e),o)}else{const o=xt(e);if(o!==null&&n)return{...e};const r=Object.create(o);return Object.assign(r,e)}}function Eo(e,t=!1){return xn(e)||rt(e)||!qe(e)||(gn(e)>1&&Object.defineProperties(e,{set:Ht,add:Ht,clear:Ht,delete:Ht}),Object.freeze(e),t&&Object.values(e).forEach(n=>Eo(n,!0))),e}function Nu(){Ee(2)}var Ht={value:Nu};function xn(e){return e===null||typeof e!="object"?!0:Object.isFrozen(e)}var Pu={};function Je(e){const t=Pu[e];return t||Ee(0,e),t}var vt;function hs(){return vt}function Mu(e,t){return{drafts_:[],parent_:e,immer_:t,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function fr(e,t){t&&(Je("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function qn(e){Jn(e),e.drafts_.forEach(ku),e.drafts_=null}function Jn(e){e===vt&&(vt=e.parent_)}function pr(e){return vt=Mu(vt,e)}function ku(e){const t=e[pe];t.type_===0||t.type_===1?t.revoke_():t.revoked_=!0}function mr(e,t){t.unfinalizedDrafts_=t.drafts_.length;const n=t.drafts_[0];return e!==void 0&&e!==n?(n[pe].modified_&&(qn(t),Ee(4)),qe(e)&&(e=Zt(t,e),t.parent_||Qt(t,e)),t.patches_&&Je("Patches").generateReplacementPatches_(n[pe].base_,e,t.patches_,t.inversePatches_)):e=Zt(t,n,[]),qn(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==ps?e:void 0}function Zt(e,t,n){if(xn(t))return t;const o=e.immer_.shouldUseStrictIteration(),r=t[pe];if(!r)return Jt(t,(s,i)=>gr(e,r,t,s,i,n),o),t;if(r.scope_!==e)return t;if(!r.modified_)return Qt(e,r.base_,!0),r.base_;if(!r.finalized_){r.finalized_=!0,r.scope_.unfinalizedDrafts_--;const s=r.copy_;let i=s,a=!1;r.type_===3&&(i=new Set(s),s.clear(),a=!0),Jt(i,(l,u)=>gr(e,r,s,l,u,n,a),o),Qt(e,s,!1),n&&e.patches_&&Je("Patches").generatePatches_(r,n,e.patches_,e.inversePatches_)}return r.copy_}function gr(e,t,n,o,r,s,i){if(r==null||typeof r!="object"&&!i)return;const a=xn(r);if(!(a&&!i)){if(rt(r)){const l=s&&t&&t.type_!==3&&!Xn(t.assigned_,o)?s.concat(o):void 0,u=Zt(e,r,l);if(gs(n,o,u),rt(u))e.canAutoFreeze_=!1;else return}else i&&n.add(r);if(qe(r)&&!a){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1||t&&t.base_&&t.base_[o]===r&&a)return;Zt(e,r),(!t||!t.scope_.parent_)&&typeof o!="symbol"&&(Pt(n)?n.has(o):Object.prototype.propertyIsEnumerable.call(n,o))&&Qt(e,r)}}}function Qt(e,t,n=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&Eo(t,n)}function Iu(e,t){const n=Array.isArray(e),o={type_:n?1:0,scope_:t?t.scope_:hs(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1};let r=o,s=Co;n&&(r=[o],s=wt);const{revoke:i,proxy:a}=Proxy.revocable(r,s);return o.draft_=a,o.revoke_=i,a}var Co={get(e,t){if(t===pe)return e;const n=Ye(e);if(!Xn(n,t))return Au(e,n,t);const o=n[t];return e.finalized_||!qe(o)?o:o===Fn(e.base_,t)?($n(e),e.copy_[t]=Qn(o,e)):o},has(e,t){return t in Ye(e)},ownKeys(e){return Reflect.ownKeys(Ye(e))},set(e,t,n){const o=xs(Ye(e),t);if(o!=null&&o.set)return o.set.call(e.draft_,n),!0;if(!e.modified_){const r=Fn(Ye(e),t),s=r==null?void 0:r[pe];if(s&&s.base_===n)return e.copy_[t]=n,e.assigned_[t]=!1,!0;if(Ru(n,r)&&(n!==void 0||Xn(e.base_,t)))return!0;$n(e),Zn(e)}return e.copy_[t]===n&&(n!==void 0||t in e.copy_)||Number.isNaN(n)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=n,e.assigned_[t]=!0),!0},deleteProperty(e,t){return Fn(e.base_,t)!==void 0||t in e.base_?(e.assigned_[t]=!1,$n(e),Zn(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0},getOwnPropertyDescriptor(e,t){const n=Ye(e),o=Reflect.getOwnPropertyDescriptor(n,t);return o&&{writable:!0,configurable:e.type_!==1||t!=="length",enumerable:o.enumerable,value:n[t]}},defineProperty(){Ee(11)},getPrototypeOf(e){return xt(e.base_)},setPrototypeOf(){Ee(12)}},wt={};Jt(Co,(e,t)=>{wt[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}});wt.deleteProperty=function(e,t){return wt.set.call(this,e,t,void 0)};wt.set=function(e,t,n){return Co.set.call(this,e[0],t,n,e[0])};function Fn(e,t){const n=e[pe];return(n?Ye(n):e)[t]}function Au(e,t,n){var r;const o=xs(t,n);return o?"value"in o?o.value:(r=o.get)==null?void 0:r.call(e.draft_):void 0}function xs(e,t){if(!(t in e))return;let n=xt(e);for(;n;){const o=Object.getOwnPropertyDescriptor(n,t);if(o)return o;n=xt(n)}}function Zn(e){e.modified_||(e.modified_=!0,e.parent_&&Zn(e.parent_))}function $n(e){e.copy_||(e.copy_=Yn(e.base_,e.scope_.immer_.useStrictShallowCopy_))}var Ou=class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.useStrictIteration_=!0,this.produce=(t,n,o)=>{if(typeof t=="function"&&typeof n!="function"){const s=n;n=t;const i=this;return function(l=s,...u){return i.produce(l,p=>n.call(this,p,...u))}}typeof n!="function"&&Ee(6),o!==void 0&&typeof o!="function"&&Ee(7);let r;if(qe(t)){const s=pr(this),i=Qn(t,void 0);let a=!0;try{r=n(i),a=!1}finally{a?qn(s):Jn(s)}return fr(s,o),mr(r,s)}else if(!t||typeof t!="object"){if(r=n(t),r===void 0&&(r=t),r===ps&&(r=void 0),this.autoFreeze_&&Eo(r,!0),o){const s=[],i=[];Je("Patches").generateReplacementPatches_(t,r,s,i),o(s,i)}return r}else Ee(1,t)},this.produceWithPatches=(t,n)=>{if(typeof t=="function")return(i,...a)=>this.produceWithPatches(i,l=>t(l,...a));let o,r;return[this.produce(t,n,(i,a)=>{o=i,r=a}),o,r]},typeof(e==null?void 0:e.autoFreeze)=="boolean"&&this.setAutoFreeze(e.autoFreeze),typeof(e==null?void 0:e.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(e.useStrictShallowCopy),typeof(e==null?void 0:e.useStrictIteration)=="boolean"&&this.setUseStrictIteration(e.useStrictIteration)}createDraft(e){qe(e)||Ee(8),rt(e)&&(e=Du(e));const t=pr(this),n=Qn(e,void 0);return n[pe].isManual_=!0,Jn(t),n}finishDraft(e,t){const n=e&&e[pe];(!n||!n.isManual_)&&Ee(9);const{scope_:o}=n;return fr(o,t),mr(void 0,o)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}setUseStrictIteration(e){this.useStrictIteration_=e}shouldUseStrictIteration(){return this.useStrictIteration_}applyPatches(e,t){let n;for(n=t.length-1;n>=0;n--){const r=t[n];if(r.path.length===0&&r.op==="replace"){e=r.value;break}}n>-1&&(t=t.slice(n+1));const o=Je("Patches").applyPatches_;return rt(e)?o(e,t):this.produce(e,r=>o(r,t))}};function Qn(e,t){const n=Pt(e)?Je("MapSet").proxyMap_(e,t):hn(e)?Je("MapSet").proxySet_(e,t):Iu(e,t);return(t?t.scope_:hs()).drafts_.push(n),n}function Du(e){return rt(e)||Ee(10,e),vs(e)}function vs(e){if(!qe(e)||xn(e))return e;const t=e[pe];let n,o=!0;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,n=Yn(e,t.scope_.immer_.useStrictShallowCopy_),o=t.scope_.immer_.shouldUseStrictIteration()}else n=Yn(e,!0);return Jt(n,(r,s)=>{gs(n,r,vs(s))},o),t&&(t.finalized_=!1),n}var ju=new Ou,Lu=ju.produce;const Fu=e=>(t,n,o)=>(o.setState=(r,s,...i)=>{const a=typeof r=="function"?Lu(r):r;return t(a,s,...i)},e(o.setState,n,o)),$u=Fu;let zu=0;const Ne=fs()(Eu(_u($u((e,t)=>({theme:"dark",sidebarCollapsed:!1,infoPanelDismissed:!1,infoPanelSelectedNodeKind:null,modal:{type:null},configSidebar:{isOpen:!1,nodeDefId:null,instanceId:null},projectSidebar:{isOpen:!1},toasts:[],expertMode:!1,setTheme:n=>{e(o=>{o.theme=n})},toggleTheme:()=>{e(n=>{n.theme=n.theme==="dark"?"light":"dark"})},setSidebarCollapsed:n=>{e(o=>{o.sidebarCollapsed=n})},toggleSidebar:()=>{e(n=>{n.sidebarCollapsed=!n.sidebarCollapsed})},setInfoPanelSelectedNodeKind:n=>{e(o=>{o.infoPanelSelectedNodeKind=n})},dismissInfoPanel:()=>{e(n=>{n.infoPanelDismissed=!0})},resetInfoPanel:()=>{e(n=>{n.infoPanelDismissed=!1,n.infoPanelSelectedNodeKind=null})},openProjectModal:()=>{e(n=>{n.modal={type:"project"}})},closeModal:()=>{e(n=>{n.modal={type:null}})},openConfigSidebar:(n,o)=>{e(r=>{r.configSidebar={isOpen:!0,nodeDefId:n,instanceId:o??null}})},closeConfigSidebar:()=>{e(n=>{n.configSidebar={isOpen:!1,nodeDefId:null,instanceId:null}})},openProjectSidebar:()=>{e(n=>{n.projectSidebar={isOpen:!0}})},closeProjectSidebar:()=>{e(n=>{n.projectSidebar={isOpen:!1}})},showToast:n=>{const o=`toast-${++zu}`,r=n.duration??5e3;e(s=>{s.toasts.push({...n,id:o,duration:r})}),r>0&&setTimeout(()=>{t().dismissToast(o)},r)},showSuccess:(n,o)=>{t().showToast({type:"success",title:n,message:o})},showError:(n,o)=>{t().showToast({type:"error",title:n,message:o,duration:8e3})},showInfo:(n,o)=>{t().showToast({type:"info",title:n,message:o})},showWarning:(n,o)=>{t().showToast({type:"warning",title:n,message:o,duration:6e3})},dismissToast:n=>{e(o=>{o.toasts=o.toasts.filter(r=>r.id!==n)})},setExpertMode:n=>{e(o=>{o.expertMode=n})}})),{name:"arko:ui",partialize:e=>({theme:e.theme,sidebarCollapsed:e.sidebarCollapsed,infoPanelDismissed:e.infoPanelDismissed,expertMode:e.expertMode})}))),Jh=()=>Ne(e=>e.expertMode),Zh=()=>Ne(e=>e.setExpertMode);function hr(e){const t=document.documentElement;t.classList.remove("dark","light"),t.classList.add(e)}if(typeof window<"u"){const e=Ne.getState().theme;hr(e),Ne.subscribe(t=>t.theme,t=>{hr(t)})}class Hu{diff(t,n,o={}){let r;typeof o=="function"?(r=o,o={}):"callback"in o&&(r=o.callback);const s=this.castInput(t,o),i=this.castInput(n,o),a=this.removeEmpty(this.tokenize(s,o)),l=this.removeEmpty(this.tokenize(i,o));return this.diffWithOptionsObj(a,l,o,r)}diffWithOptionsObj(t,n,o,r){var s;const i=v=>{if(v=this.postProcess(v,o),r){setTimeout(function(){r(v)},0);return}else return v},a=n.length,l=t.length;let u=1,p=a+l;o.maxEditLength!=null&&(p=Math.min(p,o.maxEditLength));const g=(s=o.timeout)!==null&&s!==void 0?s:1/0,x=Date.now()+g,w=[{oldPos:-1,lastComponent:void 0}];let m=this.extractCommon(w[0],n,t,0,o);if(w[0].oldPos+1>=l&&m+1>=a)return i(this.buildValues(w[0].lastComponent,n,t));let d=-1/0,h=1/0;const y=()=>{for(let v=Math.max(d,-u);v<=Math.min(h,u);v+=2){let b;const E=w[v-1],C=w[v+1];E&&(w[v-1]=void 0);let R=!1;if(C){const N=C.oldPos-v;R=C&&0<=N&&N<a}const k=E&&E.oldPos+1<l;if(!R&&!k){w[v]=void 0;continue}if(!k||R&&E.oldPos<C.oldPos?b=this.addToPath(C,!0,!1,0,o):b=this.addToPath(E,!1,!0,1,o),m=this.extractCommon(b,n,t,v,o),b.oldPos+1>=l&&m+1>=a)return i(this.buildValues(b.lastComponent,n,t))||!0;w[v]=b,b.oldPos+1>=l&&(h=Math.min(h,v-1)),m+1>=a&&(d=Math.max(d,v+1))}u++};if(r)(function v(){setTimeout(function(){if(u>p||Date.now()>x)return r(void 0);y()||v()},0)})();else for(;u<=p&&Date.now()<=x;){const v=y();if(v)return v}}addToPath(t,n,o,r,s){const i=t.lastComponent;return i&&!s.oneChangePerToken&&i.added===n&&i.removed===o?{oldPos:t.oldPos+r,lastComponent:{count:i.count+1,added:n,removed:o,previousComponent:i.previousComponent}}:{oldPos:t.oldPos+r,lastComponent:{count:1,added:n,removed:o,previousComponent:i}}}extractCommon(t,n,o,r,s){const i=n.length,a=o.length;let l=t.oldPos,u=l-r,p=0;for(;u+1<i&&l+1<a&&this.equals(o[l+1],n[u+1],s);)u++,l++,p++,s.oneChangePerToken&&(t.lastComponent={count:1,previousComponent:t.lastComponent,added:!1,removed:!1});return p&&!s.oneChangePerToken&&(t.lastComponent={count:p,previousComponent:t.lastComponent,added:!1,removed:!1}),t.oldPos=l,u}equals(t,n,o){return o.comparator?o.comparator(t,n):t===n||!!o.ignoreCase&&t.toLowerCase()===n.toLowerCase()}removeEmpty(t){const n=[];for(let o=0;o<t.length;o++)t[o]&&n.push(t[o]);return n}castInput(t,n){return t}tokenize(t,n){return Array.from(t)}join(t){return t.join("")}postProcess(t,n){return t}get useLongestToken(){return!1}buildValues(t,n,o){const r=[];let s;for(;t;)r.push(t),s=t.previousComponent,delete t.previousComponent,t=s;r.reverse();const i=r.length;let a=0,l=0,u=0;for(;a<i;a++){const p=r[a];if(p.removed)p.value=this.join(o.slice(u,u+p.count)),u+=p.count;else{if(!p.added&&this.useLongestToken){let g=n.slice(l,l+p.count);g=g.map(function(x,w){const m=o[u+w];return m.length>x.length?m:x}),p.value=this.join(g)}else p.value=this.join(n.slice(l,l+p.count));l+=p.count,p.added||(u+=p.count)}}return r}}class Wu extends Hu{constructor(){super(...arguments),this.tokenize=Vu}equals(t,n,o){return o.ignoreWhitespace?((!o.newlineIsToken||!t.includes(`
`))&&(t=t.trim()),(!o.newlineIsToken||!n.includes(`
`))&&(n=n.trim())):o.ignoreNewlineAtEof&&!o.newlineIsToken&&(t.endsWith(`
`)&&(t=t.slice(0,-1)),n.endsWith(`
`)&&(n=n.slice(0,-1))),super.equals(t,n,o)}}const Bu=new Wu;function xr(e,t,n){return Bu.diff(e,t,n)}function Vu(e,t){t.stripTrailingCr&&(e=e.replace(/\r\n/g,`
`));const n=[],o=e.split(/(\n|\r\n)/);o[o.length-1]||o.pop();for(let r=0;r<o.length;r++){const s=o[r];r%2&&!t.newlineIsToken?n[n.length-1]+=s:n.push(s)}return n}function Gu(e,t,n,o,r,s,i){let a;i?typeof i=="function"?a={callback:i}:a=i:a={},typeof a.context>"u"&&(a.context=4);const l=a.context;if(a.newlineIsToken)throw new Error("newlineIsToken may not be used with patch-generation functions, only with diffing functions");if(a.callback){const{callback:p}=a;xr(n,o,Object.assign(Object.assign({},a),{callback:g=>{const x=u(g);p(x)}}))}else return u(xr(n,o,a));function u(p){if(!p)return;p.push({value:"",lines:[]});function g(v){return v.map(function(b){return" "+b})}const x=[];let w=0,m=0,d=[],h=1,y=1;for(let v=0;v<p.length;v++){const b=p[v],E=b.lines||Uu(b.value);if(b.lines=E,b.added||b.removed){if(!w){const C=p[v-1];w=h,m=y,C&&(d=l>0?g(C.lines.slice(-l)):[],w-=d.length,m-=d.length)}for(const C of E)d.push((b.added?"+":"-")+C);b.added?y+=E.length:h+=E.length}else{if(w)if(E.length<=l*2&&v<p.length-2)for(const C of g(E))d.push(C);else{const C=Math.min(E.length,l);for(const k of g(E.slice(0,C)))d.push(k);const R={oldStart:w,oldLines:h-w+C,newStart:m,newLines:y-m+C,lines:d};x.push(R),w=0,m=0,d=[]}h+=E.length,y+=E.length}}for(const v of x)for(let b=0;b<v.lines.length;b++)v.lines[b].endsWith(`
`)?v.lines[b]=v.lines[b].slice(0,-1):(v.lines.splice(b+1,0,"\\ No newline at end of file"),b++);return{oldFileName:e,newFileName:t,oldHeader:r,newHeader:s,hunks:x}}}function Uu(e){const t=e.endsWith(`
`),n=e.split(`
`).map(o=>o+`
`);return t?n.pop():n.push(n.pop().slice(0,-1)),n}function vr(e){return e.split(/\r?\n/).map(t=>t.trimEnd()).join(`
`).trimEnd()+`
`}class Ku{computeHunks(t,n){const o=vr(t),r=vr(n);return Gu("old","new",o,r,"","",{context:3}).hunks.map((i,a)=>({id:`hunk-${a}`,oldStart:i.oldStart,oldLines:i.oldLines,newStart:i.newStart,newLines:i.newLines,lines:i.lines}))}areAllHunksResolved(t,n){return t.every(o=>{const r=n[o.id];return r==="keep-mine"||r==="accept-new"})}applyHunkResolutions(t,n,o,r){if(o.length===0)return t;const s=t.split(`
`),i=[];let a=0;for(const l of o){const u=r[l.id]??"pending",p=l.oldStart-1;for(;a<p;)i.push(s[a]),a++;if(u==="keep-mine"){for(const g of l.lines)if(g.startsWith(" ")||g.startsWith("-")){const x=g.slice(1);(g.startsWith("-")||g.startsWith(" "))&&i.push(x)}a+=l.oldLines}else if(u==="accept-new"){for(const g of l.lines)if(g.startsWith(" ")||g.startsWith("+")){const x=g.slice(1);(g.startsWith("+")||g.startsWith(" "))&&i.push(x)}a+=l.oldLines}else{for(let g=0;g<l.oldLines;g++)i.push(s[a+g]);a+=l.oldLines}}for(;a<s.length;)i.push(s[a]),a++;return i.join(`
`)}getDefaultResolutions(t){const n={};for(const o of t)n[o.id]="pending";return n}resolveAllHunks(t,n){const o={};for(const r of t)o[r.id]=n;return o}}const wr={isOpen:!1,report:null,vfs:null,directoryHandle:null,selectedFilePath:null,isApplying:!1,hunkResolutions:new Map,computedHunks:new Map},Oe=new Ku;fs()((e,t)=>({...wr,openConflictResolution:(n,o,r)=>{var i;const s=n.files.find(a=>a.status==="modified"||a.status==="deleted");e({isOpen:!0,report:n,vfs:o,directoryHandle:r,selectedFilePath:(s==null?void 0:s.path)??((i=n.files[0])==null?void 0:i.path)??null,isApplying:!1,hunkResolutions:new Map,computedHunks:new Map})},closeConflictResolution:()=>{e(wr)},selectFile:n=>{e({selectedFilePath:n})},setResolution:(n,o)=>{const{report:r}=t();if(!r)return;const s=r.files.map(i=>i.path===n?{...i,resolution:o}:i);e({report:{...r,files:s}})},resolveAllWithMine:()=>{const{report:n}=t();if(!n)return;const o=n.files.map(r=>r.status==="modified"||r.status==="deleted"?{...r,resolution:"keep-mine"}:r);e({report:{...n,files:o}})},resolveAllWithNew:()=>{const{report:n}=t();if(!n)return;const o=n.files.map(r=>r.status==="modified"||r.status==="deleted"?{...r,resolution:"accept-new"}:r);e({report:{...n,files:o}})},getHunksForFile:n=>{var u;const o=t(),r=o.computedHunks.get(n);if(r)return r;const s=(u=o.report)==null?void 0:u.files.find(p=>p.path===n);if(!s||!s.currentContent||s.status!=="modified")return[];const i=Oe.computeHunks(s.currentContent,s.newContent),a=new Map(o.computedHunks);a.set(n,i);const l=new Map(o.hunkResolutions);return l.has(n)||l.set(n,Oe.getDefaultResolutions(i)),e({computedHunks:a,hunkResolutions:l}),i},getHunkResolutions:n=>t().hunkResolutions.get(n)??{},setHunkResolution:(n,o,r)=>{const s=t(),a={...s.hunkResolutions.get(n)??{},[o]:r},l=new Map(s.hunkResolutions);l.set(n,a),e({hunkResolutions:l})},resolveAllHunksWithMine:n=>{const o=t(),r=o.computedHunks.get(n)??[],s=Oe.resolveAllHunks([...r],"keep-mine"),i=new Map(o.hunkResolutions);i.set(n,s),e({hunkResolutions:i})},resolveAllHunksWithNew:n=>{const o=t(),r=o.computedHunks.get(n)??[],s=Oe.resolveAllHunks([...r],"accept-new"),i=new Map(o.hunkResolutions);i.set(n,s),e({hunkResolutions:i})},areAllHunksResolved:n=>{const o=t(),r=o.computedHunks.get(n)??[],s=o.hunkResolutions.get(n)??{};return Oe.areAllHunksResolved([...r],s)},getMergedContentForFile:n=>{var a;const o=t(),r=(a=o.report)==null?void 0:a.files.find(l=>l.path===n);if(!r||!r.currentContent)return null;const s=o.computedHunks.get(n)??[],i=o.hunkResolutions.get(n)??{};return s.length===0?r.currentContent:Oe.applyHunkResolutions(r.currentContent,r.newContent,[...s],i)},getSelectedFile:()=>{const n=t();return!n.report||!n.selectedFilePath?null:n.report.files.find(o=>o.path===n.selectedFilePath)??null},getFilesNeedingResolution:()=>{const n=t();return n.report?n.report.files.filter(o=>o.status==="modified"||o.status==="deleted"):[]},areAllConflictsResolved:()=>{const n=t();return n.report?n.report.files.every(o=>{if(o.status==="safe"||o.status==="new")return!0;if(o.status==="modified"&&o.currentContent){const r=n.computedHunks.get(o.path)??[];if(r.length>0){const s=n.hunkResolutions.get(o.path)??{};return Oe.areAllHunksResolved([...r],s)}}return o.resolution!=="pending"}):!0},getResolvedFiles:()=>{const n=t();return n.report?n.report.files:[]},getReportWithHunkMerges:()=>{const n=t();if(!n.report)return null;const o=n.report.files.map(r=>{if(r.status!=="modified"||!r.currentContent)return r;const s=n.computedHunks.get(r.path)??[],i=n.hunkResolutions.get(r.path)??{};if(s.length===0||!Oe.areAllHunksResolved([...s],i))return r;const l=Oe.applyHunkResolutions(r.currentContent,r.newContent,[...s],i);return{...r,resolution:"merged",mergeInfo:{strategy:"per-hunk",mergedContent:l,conflicts:[]}}});return{...n.report,files:o}},setIsApplying:n=>{e({isApplying:n})}}));function Xu(){const e=Ne(o=>o.theme),t=Ne(o=>o.setTheme),n=Ne(o=>o.toggleTheme);return{theme:e,setTheme:t,toggleTheme:n}}function Yu({pathRef:e,edgeId:t,onOffsetChange:n}){const[o,r]=c.useState(!1),s=c.useRef(!1),i=c.useCallback(a=>{a.stopPropagation(),a.preventDefault(),s.current=!1,r(!0)},[]);return c.useEffect(()=>{if(!o||!e.current)return;const a=u=>{var y;if(!e.current)return;s.current=!0;const p=e.current.ownerSVGElement;if(!p)return;const g=p.createSVGPoint();g.x=u.clientX,g.y=u.clientY;const x=g.matrixTransform((y=p.getScreenCTM())==null?void 0:y.inverse()),w=e.current.getTotalLength();let m=.5,d=1/0;for(let v=0;v<=100;v++){const b=v/100,E=e.current.getPointAtLength(w*b),C=Math.sqrt(Math.pow(E.x-x.x,2)+Math.pow(E.y-x.y,2));C<d&&(d=C,m=b)}const h=Math.max(.1,Math.min(.9,m));n(t,h)},l=()=>{r(!1)};return document.addEventListener("mousemove",a),document.addEventListener("mouseup",l),()=>{document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",l)}},[o,t,e,n]),{isDragging:o,hasDraggedRef:s,handleDragStart:i}}class qu{serialize(t){try{const{graph:n,nodes:o,edges:r,mappings:s}=t,i=n.getAllNodes().map(x=>({id:x.id,label:x.label,kind:x.kind,category:x.category,executionMode:x.executionMode,config:x.config,awsExtension:x.awsExtension})),a=n.getAllTransitions().map(x=>({id:x.id,sourceDefId:x.sourceDefId,targetDefId:x.targetDefId})),l=o.filter(x=>x.type!=="outcome").map(x=>({id:x.id,definitionId:s.instanceToDefRef.get(x.id),position:{x:x.position.x,y:x.position.y}})),u=o.filter(x=>x.type==="outcome").map(x=>({id:x.id,label:x.data.label||"Outcome",parentPolicyInstanceId:x.parentId,parentPolicyDefId:x.data.parentPolicyDefId||"",position:{x:x.position.x,y:x.position.y}})),p=s.outcomeToTransitionRef?Array.from(s.outcomeToTransitionRef.entries()).map(([x,w])=>({outcomeId:x,transitionId:w})):[],g=r.filter(x=>s.edgeToTransitionRef.has(x.id)).map(x=>{const w=x.data;return{edgeId:x.id,transitionId:s.edgeToTransitionRef.get(x.id),source:x.source,target:x.target,sourceHandle:x.sourceHandle??void 0,targetHandle:x.targetHandle??void 0,label:w==null?void 0:w.label,labelOffset:w==null?void 0:w.labelOffset}});return{success:!0,workflow:{definitions:i,transitions:a,instances:l,edgeMappings:g,outcomes:u,outcomeEdgeMappings:p}}}catch(n){return{success:!1,error:{code:"VALIDATION_ERROR",message:"Failed to serialize workflow",details:n}}}}}class Ju{recoverOrphanEdges(t,n,o,r){var w;const{instanceToDefRef:s,defToInstancesRef:i,edgeToTransitionRef:a,transitionToEdgesRef:l}=o,u=t.filter(m=>{const d=a.get(m.id);return d?n.getTransition(d)!==void 0:!1}),p=new Set(u.map(m=>m.id));for(const m of a.keys())if(!p.has(m)){const d=a.get(m);a.delete(m),d&&((w=l.get(d))==null||w.delete(m))}const g=new Set(a.values()),x=n.getAllTransitions().filter(m=>!g.has(m.id));for(const m of x){const d=this.createEdgeForTransition(m,n,s,i,r);d&&(u.push(d),a.set(d.id,m.id),l.has(m.id)||l.set(m.id,new Set),l.get(m.id).add(d.id))}return{edges:u,edgeToTransitionRef:a,transitionToEdgesRef:l}}createEdgeForTransition(t,n,o,r,s){const i=r.get(t.sourceDefId),a=r.get(t.targetDefId);if(!(i!=null&&i.size)||!(a!=null&&a.size))return null;const l=i.values().next().value,u=a.values().next().value,p=s.get(l),g=s.get(u);if(!p||!g)return null;const{sourceHandle:x,targetHandle:w}=Hl(),m=`edge_${l}_${u}`,d=n.getNode(t.sourceDefId),h=n.getNode(t.targetDefId),y=d?es(d.kind):"floating",v=qt(d==null?void 0:d.kind,h==null?void 0:h.kind);return{id:m,source:l,target:u,sourceHandle:x,targetHandle:w,type:y,data:{state:"idle",transitionId:t.id,...v,...y==="commandEdge"?Yt():{}}}}}class Zu{constructor(){ae(this,"edgeRecovery",new Ju)}deserialize(t){try{const n=new gt;for(const h of t.definitions){const y={id:h.id,label:h.label,kind:h.kind,category:h.category,executionMode:h.executionMode,config:h.config,awsExtension:h.awsExtension};n.addNode(y)}for(const h of t.transitions){const y={id:h.id,sourceDefId:h.sourceDefId,targetDefId:h.targetDefId};n.addTransition(y)}const o=new Map,r=new Map,s=t.instances.map(h=>{const y=h.id,v=h.definitionId,b=n.getNode(v);o.set(y,v),r.has(v)||r.set(v,new Set),r.get(v).add(y);let E="event";return b.kind==="policy"?E="policy":b.kind==="externalSystem"?E="externalSystem":b.kind==="externalEvent"?E="externalEvent":b.kind==="command"?E="command":b.kind==="trigger"?E="trigger":b.kind==="hotspot"&&(E="hotspot"),{id:h.id,type:E,position:h.position,data:{label:b.label,executionMode:b.executionMode,definitionId:v}}}),i=new Map,a=new Map,l=new Map;if(t.outcomes)for(const h of t.outcomes){const y=h.id,v=h.parentPolicyInstanceId,b=h.parentPolicyDefId;i.set(y,v),a.has(v)||a.set(v,new Set),a.get(v).add(y),s.push({id:h.id,type:"outcome",position:h.position,parentId:h.parentPolicyInstanceId,data:{label:h.label,parentPolicyInstanceId:v,parentPolicyDefId:b}})}if(t.outcomeEdgeMappings)for(const h of t.outcomeEdgeMappings)l.set(h.outcomeId,h.transitionId);const u=new Map,p=new Map,g=t.edgeMappings.map(h=>{const y=h.transitionId,v=`edge_${h.source}_${h.target}`;u.set(v,y),p.has(y)||p.set(y,new Set),p.get(y).add(v);const b=i.has(h.source);let E;if(b){const k=i.get(h.source);E=k?o.get(k):void 0}else E=o.get(h.source);const C=E?n.getNode(E):void 0,R=C?es(C.kind):"floating";return{id:v,source:h.source,target:h.target,sourceHandle:h.sourceHandle??"source-right",targetHandle:h.targetHandle??"target-left",type:R,data:{state:"idle",transitionId:y,...h.label!==void 0?{label:h.label}:{},...h.labelOffset!==void 0?{labelOffset:h.labelOffset}:{}}}}),x=new Map(s.map(h=>[h.id,h])),w={instanceToDefRef:o,defToInstancesRef:r,edgeToTransitionRef:u,transitionToEdgesRef:p,outcomeToParentRef:i,policyToOutcomesRef:a,outcomeToTransitionRef:l},m=this.edgeRecovery.recoverOrphanEdges(g,n,w,x),d={instanceToDefRef:o,defToInstancesRef:r,edgeToTransitionRef:m.edgeToTransitionRef,transitionToEdgesRef:m.transitionToEdgesRef,outcomeToParentRef:i,policyToOutcomesRef:a,outcomeToTransitionRef:l};return{success:!0,workflow:{graph:n,nodes:s,edges:m.edges,mappings:d}}}catch(n){return{success:!1,error:{code:"VALIDATION_ERROR",message:"Failed to deserialize workflow",details:n}}}}}class Qu{constructor(){ae(this,"serialization",new qu);ae(this,"deserialization",new Zu)}serialize(t){return this.serialization.serialize(t)}deserialize(t){return this.deserialization.deserialize(t)}}const ct=new Map,ed=e=>{const t=e.workflow,n=new Set(t.definitions.filter(i=>i.kind==="command"&&i.label.trim()==="").map(i=>i.id));if(n.size===0)return e;const o=new Set(t.transitions.filter(i=>n.has(i.sourceDefId)).map(i=>i.id)),r=new Set(t.instances.filter(i=>n.has(i.definitionId)).map(i=>i.id)),s=new Set(t.edgeMappings.filter(i=>o.has(i.transitionId)||r.has(i.source)||r.has(i.target)).map(i=>i.edgeId));return{...e,workflow:{...t,definitions:t.definitions.filter(i=>!n.has(i.id)),transitions:t.transitions.filter(i=>!o.has(i.id)),instances:t.instances.filter(i=>!r.has(i.id)),edgeMappings:t.edgeMappings.filter(i=>!s.has(i.edgeId))}}},td=e=>{const t=e.metadata.name.toLowerCase().trim().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-");return{...e,metadata:{...e.metadata,slugName:t}}},nd=e=>{const n=e.metadata.targetPlugin==="none"?void 0:e.metadata.targetPlugin;return{...e,metadata:{...e.metadata,targetPlugin:n}}},od=e=>({...e,metadata:{...e.metadata,pluginConfig:{}}}),rd=e=>({...e,workflow:{...e.workflow,definitions:e.workflow.definitions.map(t=>({...t,kind:t.kind==="externalSystem"?"externalEvent":t.kind}))}});ct.set(2,ed);ct.set(3,td);ct.set(4,nd);ct.set(5,od);ct.set(6,rd);class sd{migrate(t){try{let n=t;for(;n.version<Ut;){const o=ct.get(n.version);if(!o)return{success:!1,error:{code:"MIGRATION_ERROR",message:`No migration found for version ${n.version}`}};n=o(n),n={...n,version:n.version+1}}return{success:!0,document:n}}catch(n){return{success:!1,error:{code:"MIGRATION_ERROR",message:"Migration failed",details:n}}}}validate(t){if(!t.version||typeof t.version!="number"||!t.metadata||!t.workflow||!Array.isArray(t.workflow.definitions)||!Array.isArray(t.workflow.transitions)||!Array.isArray(t.workflow.instances)||!Array.isArray(t.workflow.edgeMappings))return!1;for(const n of t.workflow.definitions)if(!n.id.startsWith("def_"))return!1;for(const n of t.workflow.transitions)if(!n.id.startsWith("trans_"))return!1;for(const n of t.workflow.instances)if(!n.id.startsWith("inst_"))return!1;return!0}}const Wt="arko:workflow";class id{async save(t){try{const n=JSON.stringify(t);return localStorage.setItem(Wt,n),{success:!0}}catch(n){return{success:!1,error:{code:"STORAGE_ERROR",message:"Failed to save to localStorage",details:n}}}}async load(){try{const t=localStorage.getItem(Wt);return t?{success:!0,document:JSON.parse(t)}:{success:!1,error:{code:"NOT_FOUND",message:"No workflow found in localStorage"}}}catch(t){return{success:!1,error:{code:"PARSE_ERROR",message:"Failed to parse stored workflow",details:t}}}}async exists(){return localStorage.getItem(Wt)!==null}async clear(){try{return localStorage.removeItem(Wt),{success:!0}}catch(t){return{success:!1,error:{code:"STORAGE_ERROR",message:"Failed to clear localStorage",details:t}}}}}class ad{exportToFile(t,n){try{const o=JSON.stringify(t,null,2),r=new Blob([o],{type:"application/json"}),s=URL.createObjectURL(r),i=window.document.createElement("a");return i.href=s,i.download=n||`workflow-${Date.now()}.json`,i.click(),URL.revokeObjectURL(s),{success:!0}}catch(o){return{success:!1,error:{code:"STORAGE_ERROR",message:"Failed to export file",details:o}}}}importFromFile(){return new Promise(t=>{const n=window.document.createElement("input");n.type="file",n.accept=".json",n.onchange=async o=>{var s;const r=(s=o.target.files)==null?void 0:s[0];if(!r){t({success:!1,error:{code:"NOT_FOUND",message:"No file selected"}});return}try{const i=await r.text(),a=JSON.parse(i);t({success:!0,document:a})}catch(i){t({success:!1,error:{code:"PARSE_ERROR",message:"Failed to parse file",details:i}})}},n.oncancel=()=>{t({success:!1,error:{code:"NOT_FOUND",message:"File selection cancelled"}})},n.click()})}}const cd="1.0",ld="https://arko.dev/ir/v1.json",ud={id:"serverless-aws-ts",name:"Serverless / TypeScript / AWS",description:"AWS Lambda with TypeScript and Serverless Framework",nodeExtensions:{command:{timeout:30,memory:128},trigger:{timeout:30,memory:128}}},dd={id:"serverless-aws-php",name:"Serverless / PHP / AWS (Bref)",description:"AWS Lambda with PHP 8.3 and Bref.sh",nodeExtensions:{command:{timeout:30,memory:128},trigger:{timeout:30,memory:128}}},ws=new Map([["serverless-aws-ts",ud],["serverless-aws-php",dd]]);function fd(e){return ws.get(e)}function Qh(){return Array.from(ws.values())}class pd{compile(t,n){try{const{graph:o,nodes:r,mappings:s}=t,i=n.metadata.targetPlugin?fd(n.metadata.targetPlugin):void 0,a=i?this.getExtensionProviderForPlugin(i.id):void 0,l=o.getAllNodes(),u=[],p=[],g=[],x=[];for(const v of l)switch(v.kind){case"event":u.push(v);break;case"command":p.push(v);break;case"trigger":g.push(v);break;case"policy":x.push(v);break}const w=this.buildEventTypeMap(u),m=this.compileEvents(u,w),d=this.compilePolicies(x,o,r,s,w),h=this.compileCommands(p,g,o,w,d,a);return{success:!0,ir:{$schema:ld,version:cd,metadata:{workflowId:Nl(),name:n.metadata.name,slugName:n.metadata.slugName||be(n.metadata.name),targetPlugin:n.metadata.targetPlugin,generatedAt:new Date().toISOString(),sourceVersion:6,pluginConfig:n.metadata.pluginConfig},events:m,commands:h,policies:d}}}catch(o){return{success:!1,error:{code:"COMPILATION_ERROR",message:o instanceof Error?o.message:"Unknown compilation error",details:o}}}}getExtensionProviderForPlugin(t){if(t==="serverless-aws-ts")return{getExtensions(n,o){if(!(n.kind!=="command"&&n.kind!=="trigger")&&o)return{aws:{timeout:o.timeout,memory:o.memory}}}}}buildEventTypeMap(t){const n=new Map;for(const o of t){const r=o.config,s=(r==null?void 0:r.type)||fn(o.label);n.set(o.id,s)}return n}compileEvents(t,n){return t.map(o=>{const r=o.config;return{id:ze(o.id),name:o.label,type:n.get(o.id),schema:r!=null&&r.schema?this.convertSchema(r.schema):null,outputPath:r==null?void 0:r.outputPath}})}compilePolicies(t,n,o,r,s){return t.map(i=>{var w,m,d,h;const l=n.getIncomingTransitions(i.id).map(y=>s.get(y.sourceDefId)).filter(y=>y!==void 0),u=r.defToInstancesRef.get(i.id),p=u==null?void 0:u.values().next().value,g=p?(w=r.policyToOutcomesRef)==null?void 0:w.get(p):void 0,x=[];if(g){const y=i.config;for(const v of g){const b=o.find(N=>N.id===v),E=((m=b==null?void 0:b.data)==null?void 0:m.label)||"Outcome",C=(d=y==null?void 0:y.outcomeConditions)==null?void 0:d.find(N=>N.outcomeLabel===E),R=(h=r.outcomeToTransitionRef)==null?void 0:h.get(v),k=[];if(R){const N=n.getTransition(R);if(N){const S=n.getNode(N.targetDefId);S&&(S.kind==="command"||S.kind==="trigger")&&k.push(ze(S.id))}}x.push({id:ze(v),label:E,condition:(C==null?void 0:C.condition)||"",targetCommandIds:k})}}return{id:ze(i.id),name:i.label,slugName:be(i.label),consumes:l,outcomes:x}})}compileCommands(t,n,o,r,s,i){const a=[];for(const l of t){const u=this.compileCommand(l,o,r,s,i);a.push(u)}for(const l of n){const u=this.compileTriggerAsCommand(l,o,r,i);u&&a.push(u)}return a}compileCommand(t,n,o,r,s){const i=t.config,l=n.getOutgoingTransitions(t.id).map(g=>o.get(g.targetDefId)).filter(g=>g!==void 0),u=this.buildConsumptions(t.id,n,o,r),p=s==null?void 0:s.getExtensions(t,t.awsExtension);return{id:ze(t.id),name:t.label,slugName:(i==null?void 0:i.slugName)||be(t.label,"unnamed"),produces:l,trigger:"consumer",consumes:u,requestSchema:i!=null&&i.requestSchema?this.convertSchema(i.requestSchema):null,extensions:p,outputPath:i==null?void 0:i.outputPath}}compileTriggerAsCommand(t,n,o,r){const s=t.config,a=n.getOutgoingTransitions(t.id).map(g=>o.get(g.targetDefId)).filter(g=>g!==void 0),l=r==null?void 0:r.getExtensions(t,t.awsExtension),u={id:ze(t.id),name:t.label,slugName:(s==null?void 0:s.slugName)||be(t.label),produces:a,extensions:l,outputPath:s==null?void 0:s.outputPath};if((s==null?void 0:s.triggerType)==="schedule"&&s.schedule)return{...u,trigger:"scheduled",schedule:s.schedule};const p=(s==null?void 0:s.path)||`/${be(t.label)}`;return{...u,trigger:"http",http:{method:(s==null?void 0:s.httpMethod)||"POST",path:p,pathParameters:Rl(p)},requestSchema:s!=null&&s.schema?this.convertSchema(s.schema):null}}buildConsumptions(t,n,o,r){const s=[],i=n.getIncomingTransitions(t);for(const a of i){const l=n.getNode(a.sourceDefId);if(l){if(l.kind==="event"){const u=o.get(l.id);u&&s.push({type:"event",eventType:u})}else if(l.kind==="policy"){const u=r.find(p=>p.id===ze(l.id));if(u){const p=u.outcomes.find(g=>g.targetCommandIds.includes(ze(t)));p&&s.push({type:"policy",policyId:u.id,outcomeId:p.id})}}}}return s}convertSchema(t){return{properties:t.map(n=>this.convertSchemaProperty(n))}}convertSchemaProperty(t){const n={name:t.name,required:t.required??!1};return t.type==="array"&&t.items?{...n,type:"array",items:{properties:[this.convertSchemaProperty(t.items)]}}:t.type==="object"&&t.properties?{...n,type:"object",nested:this.convertSchema(t.properties)}:{...n,type:t.type}}}const zn={version:7,metadata:{name:"E-commerce Order",slugName:"ecommerce-order",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),description:"Example workflow demonstrating an e-commerce order flow with stock checking"},workflow:{definitions:[{id:"def_01EXAMPLE_TRIGGER",label:"Order Received",kind:"trigger",category:"technical",executionMode:"manual",config:{slugName:"order-received",triggerType:"http",httpMethod:"POST",path:"/orders"}},{id:"def_01EXAMPLE_CMD_CREATE",label:"Create Order",kind:"command",category:"business",executionMode:"automatic",config:{slugName:"create-order"}},{id:"def_01EXAMPLE_EVT_CREATED",label:"Order Created",kind:"event",category:"business",executionMode:"automatic",config:{type:"order.created"}},{id:"def_01EXAMPLE_POLICY",label:"Check Stock",kind:"policy",category:"business",executionMode:"manual",config:{type:"check-stock",outcomeConditions:[{outcomeLabel:"In Stock",condition:"item.quantity > 0"},{outcomeLabel:"Out of Stock",condition:"item.quantity === 0"}]}},{id:"def_01EXAMPLE_CMD_PAYMENT",label:"Process Payment",kind:"command",category:"business",executionMode:"automatic",config:{slugName:"process-payment"}},{id:"def_01EXAMPLE_CMD_NOTIFY",label:"Notify Out of Stock",kind:"command",category:"business",executionMode:"automatic",config:{slugName:"notify-out-of-stock"}},{id:"def_01EXAMPLE_EVT_PAYMENT",label:"Payment Processed",kind:"event",category:"business",executionMode:"automatic",config:{type:"payment.processed"}},{id:"def_01EXAMPLE_EVT_NOTIFIED",label:"Customer Notified",kind:"event",category:"business",executionMode:"automatic",config:{type:"customer.notified"}}],transitions:[{id:"trans_01EXAMPLE_T1",sourceDefId:"def_01EXAMPLE_TRIGGER",targetDefId:"def_01EXAMPLE_CMD_CREATE"},{id:"trans_01EXAMPLE_T2",sourceDefId:"def_01EXAMPLE_CMD_CREATE",targetDefId:"def_01EXAMPLE_EVT_CREATED"},{id:"trans_01EXAMPLE_T3",sourceDefId:"def_01EXAMPLE_EVT_CREATED",targetDefId:"def_01EXAMPLE_POLICY"},{id:"trans_01EXAMPLE_T4",sourceDefId:"def_01EXAMPLE_POLICY",targetDefId:"def_01EXAMPLE_CMD_PAYMENT"},{id:"trans_01EXAMPLE_T5",sourceDefId:"def_01EXAMPLE_POLICY",targetDefId:"def_01EXAMPLE_CMD_NOTIFY"},{id:"trans_01EXAMPLE_T6",sourceDefId:"def_01EXAMPLE_CMD_PAYMENT",targetDefId:"def_01EXAMPLE_EVT_PAYMENT"},{id:"trans_01EXAMPLE_T7",sourceDefId:"def_01EXAMPLE_CMD_NOTIFY",targetDefId:"def_01EXAMPLE_EVT_NOTIFIED"}],instances:[{id:"inst_01EXAMPLE_TRIGGER",definitionId:"def_01EXAMPLE_TRIGGER",position:{x:100,y:300}},{id:"inst_01EXAMPLE_CMD_CREATE",definitionId:"def_01EXAMPLE_CMD_CREATE",position:{x:320,y:300}},{id:"inst_01EXAMPLE_EVT_CREATED",definitionId:"def_01EXAMPLE_EVT_CREATED",position:{x:540,y:300}},{id:"inst_01EXAMPLE_POLICY",definitionId:"def_01EXAMPLE_POLICY",position:{x:760,y:300}},{id:"inst_01EXAMPLE_CMD_PAYMENT",definitionId:"def_01EXAMPLE_CMD_PAYMENT",position:{x:1100,y:180}},{id:"inst_01EXAMPLE_CMD_NOTIFY",definitionId:"def_01EXAMPLE_CMD_NOTIFY",position:{x:1100,y:420}},{id:"inst_01EXAMPLE_EVT_PAYMENT",definitionId:"def_01EXAMPLE_EVT_PAYMENT",position:{x:1320,y:180}},{id:"inst_01EXAMPLE_EVT_NOTIFIED",definitionId:"def_01EXAMPLE_EVT_NOTIFIED",position:{x:1320,y:420}}],edgeMappings:[{edgeId:"edge_01EXAMPLE_E1",transitionId:"trans_01EXAMPLE_T1",source:"inst_01EXAMPLE_TRIGGER",target:"inst_01EXAMPLE_CMD_CREATE"},{edgeId:"edge_01EXAMPLE_E2",transitionId:"trans_01EXAMPLE_T2",source:"inst_01EXAMPLE_CMD_CREATE",target:"inst_01EXAMPLE_EVT_CREATED"},{edgeId:"edge_01EXAMPLE_E3",transitionId:"trans_01EXAMPLE_T3",source:"inst_01EXAMPLE_EVT_CREATED",target:"inst_01EXAMPLE_POLICY"},{edgeId:"edge_01EXAMPLE_E4",transitionId:"trans_01EXAMPLE_T4",source:"outcome_01EXAMPLE_INSTOCK",target:"inst_01EXAMPLE_CMD_PAYMENT"},{edgeId:"edge_01EXAMPLE_E5",transitionId:"trans_01EXAMPLE_T5",source:"outcome_01EXAMPLE_OUTSTOCK",target:"inst_01EXAMPLE_CMD_NOTIFY"},{edgeId:"edge_01EXAMPLE_E6",transitionId:"trans_01EXAMPLE_T6",source:"inst_01EXAMPLE_CMD_PAYMENT",target:"inst_01EXAMPLE_EVT_PAYMENT"},{edgeId:"edge_01EXAMPLE_E7",transitionId:"trans_01EXAMPLE_T7",source:"inst_01EXAMPLE_CMD_NOTIFY",target:"inst_01EXAMPLE_EVT_NOTIFIED"}],outcomes:[{id:"outcome_01EXAMPLE_INSTOCK",label:"In Stock",parentPolicyInstanceId:"inst_01EXAMPLE_POLICY",parentPolicyDefId:"def_01EXAMPLE_POLICY",position:{x:162,y:-30}},{id:"outcome_01EXAMPLE_OUTSTOCK",label:"Out of Stock",parentPolicyInstanceId:"inst_01EXAMPLE_POLICY",parentPolicyDefId:"def_01EXAMPLE_POLICY",position:{x:162,y:100}}],outcomeEdgeMappings:[{outcomeId:"outcome_01EXAMPLE_INSTOCK",transitionId:"trans_01EXAMPLE_T4"},{outcomeId:"outcome_01EXAMPLE_OUTSTOCK",transitionId:"trans_01EXAMPLE_T5"}]}},Bt="Untitled Workflow",md=1e3,ys="arko:workflows";function De(e){return e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"")||"workflow"}function yr(){try{const e=localStorage.getItem(ys);return e?JSON.parse(e):[]}catch{return[]}}function gd(e){try{localStorage.setItem(ys,JSON.stringify(e))}catch(t){console.error("Failed to save workflows to localStorage:",t)}}const hd=c.createContext(null);function ex({children:e,initialWorkflowId:t}){const n=mn(),[o,r]=c.useState(!0),[s,i]=c.useState(null),[a,l]=c.useState(Bt),[u,p]=c.useState(()=>De(Bt)),[g,x]=c.useState(void 0),[w,m]=c.useState({}),[d,h]=c.useState(null),[y,v]=c.useState(null),[b,E]=c.useState(!1),C=c.useRef(null),R=c.useCallback(O=>{l(j=>(p(V=>V===De(j)?De(O):V),O))},[]),k=c.useCallback(O=>{p(O)},[]),N=c.useRef(new Qu),S=c.useRef(new sd),z=c.useRef(new id),D=c.useRef(new ad),A=c.useRef(new pd),F=c.useRef(void 0),T=c.useRef(!1),M=c.useRef(!1),P=c.useCallback(O=>{const j=N.current.deserialize(O.workflow);return j.success?(n.hydrateWorkflow(j.workflow),l(O.metadata.name),p(O.metadata.slugName||De(O.metadata.name)),x(O.metadata.targetPlugin),m(O.metadata.pluginConfig??{}),h(O.metadata.createdAt),!0):!1},[n]);c.useEffect(()=>{(async()=>{try{const j=await z.current.load();if(j.success){if(!S.current.validate(j.document)){console.warn("Invalid workflow document in localStorage, loading example instead"),P(zn),r(!1);return}const V=S.current.migrate(j.document);V.success&&P(V.document)}else console.info("No saved workflow found, loading example workflow"),P(zn)}catch(j){console.error("Failed to load workflow from localStorage:",j),P(zn)}finally{r(!1)}})()},[]);const L=c.useCallback(async()=>{const O=n.getWorkflowState(),j=N.current.serialize(O);if(!j.success)return{success:!1,error:j.error};const V=new Date().toISOString(),Y={version:Ut,metadata:{name:a,slugName:u,targetPlugin:g,pluginConfig:w,createdAt:d||V,updatedAt:V},workflow:j.workflow};return d||h(V),z.current.save(Y)},[n,a,u,g,w,d]),{nodes:I,edges:_}=n;c.useEffect(()=>{if(!o){if(!T.current){T.current=!0;return}return F.current&&clearTimeout(F.current),F.current=setTimeout(()=>{L()},md),()=>{F.current&&clearTimeout(F.current)}}},[I,_,a,u,g,w,L,o]);const $=c.useCallback(()=>{const O=n.getWorkflowState(),j=N.current.serialize(O);if(!j.success)return{success:!1,error:j.error};const V=new Date().toISOString(),Y={version:Ut,metadata:{name:a,slugName:u,targetPlugin:g,pluginConfig:w,createdAt:d||V,updatedAt:V},workflow:j.workflow},Z=`${u||De(a)}.json`;return D.current.exportToFile(Y,Z)},[n,a,u,g,w,d]),X=c.useCallback(()=>{const O=n.getWorkflowState(),j=new Date().toISOString();return A.current.compile(O,{metadata:{name:a,slugName:u||De(a),targetPlugin:g,pluginConfig:w,createdAt:d||j,updatedAt:j}})},[n,a,u,g,w,d]),U=c.useCallback(()=>{const O=n.getWorkflowState(),j=N.current.serialize(O);if(!j.success)throw new Error(j.error.message);const V=new Date().toISOString();return{version:Ut,metadata:{name:a,slugName:u||De(a),targetPlugin:g,pluginConfig:w,createdAt:d||V,updatedAt:V},workflow:j.workflow}},[n,a,u,g,w,d]),q=c.useCallback(async()=>{const O=await D.current.importFromFile();if(!O.success)return O;if(!S.current.validate(O.document))return{success:!1,error:{code:"VALIDATION_ERROR",message:"Invalid workflow file format"}};const j=S.current.migrate(O.document);if(!j.success)return{success:!1,error:j.error};const V=N.current.deserialize(j.document.workflow);return V.success?(n.hydrateWorkflow(V.workflow),l(j.document.metadata.name),p(j.document.metadata.slugName||De(j.document.metadata.name)),x(j.document.metadata.targetPlugin),m(j.document.metadata.pluginConfig??{}),h(j.document.metadata.createdAt),await z.current.save(j.document),{success:!0,document:j.document}):{success:!1,error:V.error}},[n]),J=c.useCallback(async()=>(l(Bt),p(De(Bt)),x(void 0),m({}),h(null),v(null),E(!1),C.current=null,z.current.clear()),[]),Q=c.useCallback(O=>JSON.stringify({workflow:O.workflow,name:O.metadata.name,slugName:O.metadata.slugName,targetPlugin:O.metadata.targetPlugin,pluginConfig:O.metadata.pluginConfig}),[]),te=c.useCallback(async()=>{const O=U();try{const j=yr(),V=new Date().toISOString();if(y){const Y=j.findIndex(Z=>Z.id===y);Y!==-1&&(j[Y]={...j[Y],document:O,updatedAt:V})}else console.warn("saveToApi called without currentWorkflowId");return gd(j),C.current=Q(O),E(!1),{success:!0}}catch(j){return{success:!1,error:{code:"STORAGE_ERROR",message:j instanceof Error?j.message:"Failed to save workflow"}}}},[U,y,Q]),W=c.useCallback(async O=>{try{const V=yr().find(re=>re.id===O);if(!V)return{success:!1,error:{code:"NOT_FOUND",message:"Workflow not found"}};if(!S.current.validate(V.document))return{success:!1,error:{code:"VALIDATION_ERROR",message:"Invalid workflow document"}};const Y=S.current.migrate(V.document);return Y.success?P(Y.document)?(v(V.id),C.current=Q(Y.document),E(!1),await z.current.save(Y.document),{success:!0,document:Y.document}):{success:!1,error:{code:"PARSE_ERROR",message:"Failed to hydrate workflow"}}:{success:!1,error:Y.error}}catch(j){return{success:!1,error:{code:"STORAGE_ERROR",message:j instanceof Error?j.message:"Failed to load workflow"}}}},[P,Q]);return c.useEffect(()=>{if(o||C.current!==null||y!==null)return;const O=U();C.current=Q(O)},[o,y,U,Q]),c.useEffect(()=>{if(o||!T.current||C.current===null)return;const O=U(),j=Q(O);E(j!==C.current)},[I,_,a,u,g,w,o,U,Q]),c.useEffect(()=>{o||t&&!M.current&&(M.current=!0,r(!0),i(null),W(t).then(O=>{O.success||(console.error("Failed to load workflow from URL:",O.error.message),i(O.error))}).finally(()=>{r(!1)}))},[o,t,W]),f.jsx(hd.Provider,{value:{isLoading:o,loadError:s,workflowName:a,setWorkflowName:R,slugName:u,setSlugName:k,targetPlugin:g,setTargetPlugin:x,pluginConfig:w,setPluginConfig:m,saveToLocalStorage:L,exportToFile:$,exportToIR:X,getWorkflowDocument:U,importFromFile:q,clearStorage:J,currentWorkflowId:y,isDirty:b,saveToApi:te,loadFromApi:W,hydrateDocument:P},children:e})}const tx=Ac,xd=Oc,bs=c.forwardRef(({className:e,...t},n)=>f.jsx(zr,{ref:n,className:B("fixed inset-0 z-50 bg-black/60 backdrop-blur-sm","data-[state=open]:animate-fade-in data-[state=closed]:animate-fade-out",e),...t}));bs.displayName=zr.displayName;const vd={sm:"max-w-[400px]",md:"max-w-[560px]",lg:"max-w-[720px]",xl:"max-w-[900px]"},wd=c.forwardRef(({className:e,children:t,width:n="md",...o},r)=>f.jsxs(xd,{children:[f.jsx(bs,{}),f.jsx(Fr,{ref:r,className:B("fixed left-1/2 top-1/2 z-50 w-[90vw] -translate-x-1/2 -translate-y-1/2","bg-bg-secondary border border-border rounded-xl","shadow-[var(--shadow-modal)]","max-h-[85vh] flex flex-col","data-[state=open]:animate-zoom-in",vd[n],e),...o,children:t})]}));wd.displayName=Fr.displayName;const yd=({className:e,children:t,...n})=>f.jsx("div",{className:B("flex items-center justify-between px-5 py-4 border-b border-border shrink-0",e),...n,children:t});yd.displayName="DialogHeader";const bd=c.forwardRef(({className:e,...t},n)=>f.jsx($r,{ref:n,className:B("text-lg font-semibold text-text-primary",e),...t}));bd.displayName=$r.displayName;const Ed=c.forwardRef(({className:e,...t},n)=>f.jsx(Hr,{ref:n,className:B("text-sm text-text-muted",e),...t}));Ed.displayName=Hr.displayName;const Cd=({className:e,...t})=>f.jsx("div",{className:B("p-5 overflow-y-auto flex-1",e),...t});Cd.displayName="DialogBody";const Td=({className:e,...t})=>f.jsx("div",{className:B("flex items-center justify-end gap-3 px-5 py-4 border-t border-border shrink-0",e),...t});Td.displayName="DialogFooter";const _d=c.forwardRef(({className:e,...t},n)=>f.jsx(Dc,{ref:n,className:B("w-8 h-8 rounded-md flex items-center justify-center","bg-transparent text-text-dim hover:bg-bg-tertiary hover:text-text-primary","transition-all duration-150",e),...t,children:f.jsx(Xr,{className:"w-5 h-5"})}));_d.displayName="DialogCloseButton";const Sd=["top","right","bottom","left"],Be=Math.min,de=Math.max,en=Math.round,Vt=Math.floor,Pe=e=>({x:e,y:e}),Rd={left:"right",right:"left",bottom:"top",top:"bottom"},Nd={start:"end",end:"start"};function eo(e,t,n){return de(e,Be(t,n))}function je(e,t){return typeof e=="function"?e(t):e}function Le(e){return e.split("-")[0]}function lt(e){return e.split("-")[1]}function To(e){return e==="x"?"y":"x"}function _o(e){return e==="y"?"height":"width"}const Pd=new Set(["top","bottom"]);function Re(e){return Pd.has(Le(e))?"y":"x"}function So(e){return To(Re(e))}function Md(e,t,n){n===void 0&&(n=!1);const o=lt(e),r=So(e),s=_o(r);let i=r==="x"?o===(n?"end":"start")?"right":"left":o==="start"?"bottom":"top";return t.reference[s]>t.floating[s]&&(i=tn(i)),[i,tn(i)]}function kd(e){const t=tn(e);return[to(e),t,to(t)]}function to(e){return e.replace(/start|end/g,t=>Nd[t])}const br=["left","right"],Er=["right","left"],Id=["top","bottom"],Ad=["bottom","top"];function Od(e,t,n){switch(e){case"top":case"bottom":return n?t?Er:br:t?br:Er;case"left":case"right":return t?Id:Ad;default:return[]}}function Dd(e,t,n,o){const r=lt(e);let s=Od(Le(e),n==="start",o);return r&&(s=s.map(i=>i+"-"+r),t&&(s=s.concat(s.map(to)))),s}function tn(e){return e.replace(/left|right|bottom|top/g,t=>Rd[t])}function jd(e){return{top:0,right:0,bottom:0,left:0,...e}}function Es(e){return typeof e!="number"?jd(e):{top:e,right:e,bottom:e,left:e}}function nn(e){const{x:t,y:n,width:o,height:r}=e;return{width:o,height:r,top:n,left:t,right:t+o,bottom:n+r,x:t,y:n}}function Cr(e,t,n){let{reference:o,floating:r}=e;const s=Re(t),i=So(t),a=_o(i),l=Le(t),u=s==="y",p=o.x+o.width/2-r.width/2,g=o.y+o.height/2-r.height/2,x=o[a]/2-r[a]/2;let w;switch(l){case"top":w={x:p,y:o.y-r.height};break;case"bottom":w={x:p,y:o.y+o.height};break;case"right":w={x:o.x+o.width,y:g};break;case"left":w={x:o.x-r.width,y:g};break;default:w={x:o.x,y:o.y}}switch(lt(t)){case"start":w[i]-=x*(n&&u?-1:1);break;case"end":w[i]+=x*(n&&u?-1:1);break}return w}const Ld=async(e,t,n)=>{const{placement:o="bottom",strategy:r="absolute",middleware:s=[],platform:i}=n,a=s.filter(Boolean),l=await(i.isRTL==null?void 0:i.isRTL(t));let u=await i.getElementRects({reference:e,floating:t,strategy:r}),{x:p,y:g}=Cr(u,o,l),x=o,w={},m=0;for(let d=0;d<a.length;d++){const{name:h,fn:y}=a[d],{x:v,y:b,data:E,reset:C}=await y({x:p,y:g,initialPlacement:o,placement:x,strategy:r,middlewareData:w,rects:u,platform:i,elements:{reference:e,floating:t}});p=v??p,g=b??g,w={...w,[h]:{...w[h],...E}},C&&m<=50&&(m++,typeof C=="object"&&(C.placement&&(x=C.placement),C.rects&&(u=C.rects===!0?await i.getElementRects({reference:e,floating:t,strategy:r}):C.rects),{x:p,y:g}=Cr(u,x,l)),d=-1)}return{x:p,y:g,placement:x,strategy:r,middlewareData:w}};async function yt(e,t){var n;t===void 0&&(t={});const{x:o,y:r,platform:s,rects:i,elements:a,strategy:l}=e,{boundary:u="clippingAncestors",rootBoundary:p="viewport",elementContext:g="floating",altBoundary:x=!1,padding:w=0}=je(t,e),m=Es(w),h=a[x?g==="floating"?"reference":"floating":g],y=nn(await s.getClippingRect({element:(n=await(s.isElement==null?void 0:s.isElement(h)))==null||n?h:h.contextElement||await(s.getDocumentElement==null?void 0:s.getDocumentElement(a.floating)),boundary:u,rootBoundary:p,strategy:l})),v=g==="floating"?{x:o,y:r,width:i.floating.width,height:i.floating.height}:i.reference,b=await(s.getOffsetParent==null?void 0:s.getOffsetParent(a.floating)),E=await(s.isElement==null?void 0:s.isElement(b))?await(s.getScale==null?void 0:s.getScale(b))||{x:1,y:1}:{x:1,y:1},C=nn(s.convertOffsetParentRelativeRectToViewportRelativeRect?await s.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:v,offsetParent:b,strategy:l}):v);return{top:(y.top-C.top+m.top)/E.y,bottom:(C.bottom-y.bottom+m.bottom)/E.y,left:(y.left-C.left+m.left)/E.x,right:(C.right-y.right+m.right)/E.x}}const Fd=e=>({name:"arrow",options:e,async fn(t){const{x:n,y:o,placement:r,rects:s,platform:i,elements:a,middlewareData:l}=t,{element:u,padding:p=0}=je(e,t)||{};if(u==null)return{};const g=Es(p),x={x:n,y:o},w=So(r),m=_o(w),d=await i.getDimensions(u),h=w==="y",y=h?"top":"left",v=h?"bottom":"right",b=h?"clientHeight":"clientWidth",E=s.reference[m]+s.reference[w]-x[w]-s.floating[m],C=x[w]-s.reference[w],R=await(i.getOffsetParent==null?void 0:i.getOffsetParent(u));let k=R?R[b]:0;(!k||!await(i.isElement==null?void 0:i.isElement(R)))&&(k=a.floating[b]||s.floating[m]);const N=E/2-C/2,S=k/2-d[m]/2-1,z=Be(g[y],S),D=Be(g[v],S),A=z,F=k-d[m]-D,T=k/2-d[m]/2+N,M=eo(A,T,F),P=!l.arrow&&lt(r)!=null&&T!==M&&s.reference[m]/2-(T<A?z:D)-d[m]/2<0,L=P?T<A?T-A:T-F:0;return{[w]:x[w]+L,data:{[w]:M,centerOffset:T-M-L,...P&&{alignmentOffset:L}},reset:P}}}),$d=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(t){var n,o;const{placement:r,middlewareData:s,rects:i,initialPlacement:a,platform:l,elements:u}=t,{mainAxis:p=!0,crossAxis:g=!0,fallbackPlacements:x,fallbackStrategy:w="bestFit",fallbackAxisSideDirection:m="none",flipAlignment:d=!0,...h}=je(e,t);if((n=s.arrow)!=null&&n.alignmentOffset)return{};const y=Le(r),v=Re(a),b=Le(a)===a,E=await(l.isRTL==null?void 0:l.isRTL(u.floating)),C=x||(b||!d?[tn(a)]:kd(a)),R=m!=="none";!x&&R&&C.push(...Dd(a,d,m,E));const k=[a,...C],N=await yt(t,h),S=[];let z=((o=s.flip)==null?void 0:o.overflows)||[];if(p&&S.push(N[y]),g){const T=Md(r,i,E);S.push(N[T[0]],N[T[1]])}if(z=[...z,{placement:r,overflows:S}],!S.every(T=>T<=0)){var D,A;const T=(((D=s.flip)==null?void 0:D.index)||0)+1,M=k[T];if(M&&(!(g==="alignment"?v!==Re(M):!1)||z.every(I=>Re(I.placement)===v?I.overflows[0]>0:!0)))return{data:{index:T,overflows:z},reset:{placement:M}};let P=(A=z.filter(L=>L.overflows[0]<=0).sort((L,I)=>L.overflows[1]-I.overflows[1])[0])==null?void 0:A.placement;if(!P)switch(w){case"bestFit":{var F;const L=(F=z.filter(I=>{if(R){const _=Re(I.placement);return _===v||_==="y"}return!0}).map(I=>[I.placement,I.overflows.filter(_=>_>0).reduce((_,$)=>_+$,0)]).sort((I,_)=>I[1]-_[1])[0])==null?void 0:F[0];L&&(P=L);break}case"initialPlacement":P=a;break}if(r!==P)return{reset:{placement:P}}}return{}}}};function Tr(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function _r(e){return Sd.some(t=>e[t]>=0)}const zd=function(e){return e===void 0&&(e={}),{name:"hide",options:e,async fn(t){const{rects:n}=t,{strategy:o="referenceHidden",...r}=je(e,t);switch(o){case"referenceHidden":{const s=await yt(t,{...r,elementContext:"reference"}),i=Tr(s,n.reference);return{data:{referenceHiddenOffsets:i,referenceHidden:_r(i)}}}case"escaped":{const s=await yt(t,{...r,altBoundary:!0}),i=Tr(s,n.floating);return{data:{escapedOffsets:i,escaped:_r(i)}}}default:return{}}}}},Cs=new Set(["left","top"]);async function Hd(e,t){const{placement:n,platform:o,elements:r}=e,s=await(o.isRTL==null?void 0:o.isRTL(r.floating)),i=Le(n),a=lt(n),l=Re(n)==="y",u=Cs.has(i)?-1:1,p=s&&l?-1:1,g=je(t,e);let{mainAxis:x,crossAxis:w,alignmentAxis:m}=typeof g=="number"?{mainAxis:g,crossAxis:0,alignmentAxis:null}:{mainAxis:g.mainAxis||0,crossAxis:g.crossAxis||0,alignmentAxis:g.alignmentAxis};return a&&typeof m=="number"&&(w=a==="end"?m*-1:m),l?{x:w*p,y:x*u}:{x:x*u,y:w*p}}const Wd=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(t){var n,o;const{x:r,y:s,placement:i,middlewareData:a}=t,l=await Hd(t,e);return i===((n=a.offset)==null?void 0:n.placement)&&(o=a.arrow)!=null&&o.alignmentOffset?{}:{x:r+l.x,y:s+l.y,data:{...l,placement:i}}}}},Bd=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(t){const{x:n,y:o,placement:r}=t,{mainAxis:s=!0,crossAxis:i=!1,limiter:a={fn:h=>{let{x:y,y:v}=h;return{x:y,y:v}}},...l}=je(e,t),u={x:n,y:o},p=await yt(t,l),g=Re(Le(r)),x=To(g);let w=u[x],m=u[g];if(s){const h=x==="y"?"top":"left",y=x==="y"?"bottom":"right",v=w+p[h],b=w-p[y];w=eo(v,w,b)}if(i){const h=g==="y"?"top":"left",y=g==="y"?"bottom":"right",v=m+p[h],b=m-p[y];m=eo(v,m,b)}const d=a.fn({...t,[x]:w,[g]:m});return{...d,data:{x:d.x-n,y:d.y-o,enabled:{[x]:s,[g]:i}}}}}},Vd=function(e){return e===void 0&&(e={}),{options:e,fn(t){const{x:n,y:o,placement:r,rects:s,middlewareData:i}=t,{offset:a=0,mainAxis:l=!0,crossAxis:u=!0}=je(e,t),p={x:n,y:o},g=Re(r),x=To(g);let w=p[x],m=p[g];const d=je(a,t),h=typeof d=="number"?{mainAxis:d,crossAxis:0}:{mainAxis:0,crossAxis:0,...d};if(l){const b=x==="y"?"height":"width",E=s.reference[x]-s.floating[b]+h.mainAxis,C=s.reference[x]+s.reference[b]-h.mainAxis;w<E?w=E:w>C&&(w=C)}if(u){var y,v;const b=x==="y"?"width":"height",E=Cs.has(Le(r)),C=s.reference[g]-s.floating[b]+(E&&((y=i.offset)==null?void 0:y[g])||0)+(E?0:h.crossAxis),R=s.reference[g]+s.reference[b]+(E?0:((v=i.offset)==null?void 0:v[g])||0)-(E?h.crossAxis:0);m<C?m=C:m>R&&(m=R)}return{[x]:w,[g]:m}}}},Gd=function(e){return e===void 0&&(e={}),{name:"size",options:e,async fn(t){var n,o;const{placement:r,rects:s,platform:i,elements:a}=t,{apply:l=()=>{},...u}=je(e,t),p=await yt(t,u),g=Le(r),x=lt(r),w=Re(r)==="y",{width:m,height:d}=s.floating;let h,y;g==="top"||g==="bottom"?(h=g,y=x===(await(i.isRTL==null?void 0:i.isRTL(a.floating))?"start":"end")?"left":"right"):(y=g,h=x==="end"?"top":"bottom");const v=d-p.top-p.bottom,b=m-p.left-p.right,E=Be(d-p[h],v),C=Be(m-p[y],b),R=!t.middlewareData.shift;let k=E,N=C;if((n=t.middlewareData.shift)!=null&&n.enabled.x&&(N=b),(o=t.middlewareData.shift)!=null&&o.enabled.y&&(k=v),R&&!x){const z=de(p.left,0),D=de(p.right,0),A=de(p.top,0),F=de(p.bottom,0);w?N=m-2*(z!==0||D!==0?z+D:de(p.left,p.right)):k=d-2*(A!==0||F!==0?A+F:de(p.top,p.bottom))}await l({...t,availableWidth:N,availableHeight:k});const S=await i.getDimensions(a.floating);return m!==S.width||d!==S.height?{reset:{rects:!0}}:{}}}};function vn(){return typeof window<"u"}function ut(e){return Ts(e)?(e.nodeName||"").toLowerCase():"#document"}function fe(e){var t;return(e==null||(t=e.ownerDocument)==null?void 0:t.defaultView)||window}function Ie(e){var t;return(t=(Ts(e)?e.ownerDocument:e.document)||window.document)==null?void 0:t.documentElement}function Ts(e){return vn()?e instanceof Node||e instanceof fe(e).Node:!1}function Ce(e){return vn()?e instanceof Element||e instanceof fe(e).Element:!1}function Me(e){return vn()?e instanceof HTMLElement||e instanceof fe(e).HTMLElement:!1}function Sr(e){return!vn()||typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof fe(e).ShadowRoot}const Ud=new Set(["inline","contents"]);function Mt(e){const{overflow:t,overflowX:n,overflowY:o,display:r}=Te(e);return/auto|scroll|overlay|hidden|clip/.test(t+o+n)&&!Ud.has(r)}const Kd=new Set(["table","td","th"]);function Xd(e){return Kd.has(ut(e))}const Yd=[":popover-open",":modal"];function wn(e){return Yd.some(t=>{try{return e.matches(t)}catch{return!1}})}const qd=["transform","translate","scale","rotate","perspective"],Jd=["transform","translate","scale","rotate","perspective","filter"],Zd=["paint","layout","strict","content"];function Ro(e){const t=No(),n=Ce(e)?Te(e):e;return qd.some(o=>n[o]?n[o]!=="none":!1)||(n.containerType?n.containerType!=="normal":!1)||!t&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!t&&(n.filter?n.filter!=="none":!1)||Jd.some(o=>(n.willChange||"").includes(o))||Zd.some(o=>(n.contain||"").includes(o))}function Qd(e){let t=Ve(e);for(;Me(t)&&!st(t);){if(Ro(t))return t;if(wn(t))return null;t=Ve(t)}return null}function No(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const ef=new Set(["html","body","#document"]);function st(e){return ef.has(ut(e))}function Te(e){return fe(e).getComputedStyle(e)}function yn(e){return Ce(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function Ve(e){if(ut(e)==="html")return e;const t=e.assignedSlot||e.parentNode||Sr(e)&&e.host||Ie(e);return Sr(t)?t.host:t}function _s(e){const t=Ve(e);return st(t)?e.ownerDocument?e.ownerDocument.body:e.body:Me(t)&&Mt(t)?t:_s(t)}function bt(e,t,n){var o;t===void 0&&(t=[]),n===void 0&&(n=!0);const r=_s(e),s=r===((o=e.ownerDocument)==null?void 0:o.body),i=fe(r);if(s){const a=no(i);return t.concat(i,i.visualViewport||[],Mt(r)?r:[],a&&n?bt(a):[])}return t.concat(r,bt(r,[],n))}function no(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function Ss(e){const t=Te(e);let n=parseFloat(t.width)||0,o=parseFloat(t.height)||0;const r=Me(e),s=r?e.offsetWidth:n,i=r?e.offsetHeight:o,a=en(n)!==s||en(o)!==i;return a&&(n=s,o=i),{width:n,height:o,$:a}}function Po(e){return Ce(e)?e:e.contextElement}function ot(e){const t=Po(e);if(!Me(t))return Pe(1);const n=t.getBoundingClientRect(),{width:o,height:r,$:s}=Ss(t);let i=(s?en(n.width):n.width)/o,a=(s?en(n.height):n.height)/r;return(!i||!Number.isFinite(i))&&(i=1),(!a||!Number.isFinite(a))&&(a=1),{x:i,y:a}}const tf=Pe(0);function Rs(e){const t=fe(e);return!No()||!t.visualViewport?tf:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function nf(e,t,n){return t===void 0&&(t=!1),!n||t&&n!==fe(e)?!1:t}function Ze(e,t,n,o){t===void 0&&(t=!1),n===void 0&&(n=!1);const r=e.getBoundingClientRect(),s=Po(e);let i=Pe(1);t&&(o?Ce(o)&&(i=ot(o)):i=ot(e));const a=nf(s,n,o)?Rs(s):Pe(0);let l=(r.left+a.x)/i.x,u=(r.top+a.y)/i.y,p=r.width/i.x,g=r.height/i.y;if(s){const x=fe(s),w=o&&Ce(o)?fe(o):o;let m=x,d=no(m);for(;d&&o&&w!==m;){const h=ot(d),y=d.getBoundingClientRect(),v=Te(d),b=y.left+(d.clientLeft+parseFloat(v.paddingLeft))*h.x,E=y.top+(d.clientTop+parseFloat(v.paddingTop))*h.y;l*=h.x,u*=h.y,p*=h.x,g*=h.y,l+=b,u+=E,m=fe(d),d=no(m)}}return nn({width:p,height:g,x:l,y:u})}function bn(e,t){const n=yn(e).scrollLeft;return t?t.left+n:Ze(Ie(e)).left+n}function Ns(e,t){const n=e.getBoundingClientRect(),o=n.left+t.scrollLeft-bn(e,n),r=n.top+t.scrollTop;return{x:o,y:r}}function of(e){let{elements:t,rect:n,offsetParent:o,strategy:r}=e;const s=r==="fixed",i=Ie(o),a=t?wn(t.floating):!1;if(o===i||a&&s)return n;let l={scrollLeft:0,scrollTop:0},u=Pe(1);const p=Pe(0),g=Me(o);if((g||!g&&!s)&&((ut(o)!=="body"||Mt(i))&&(l=yn(o)),Me(o))){const w=Ze(o);u=ot(o),p.x=w.x+o.clientLeft,p.y=w.y+o.clientTop}const x=i&&!g&&!s?Ns(i,l):Pe(0);return{width:n.width*u.x,height:n.height*u.y,x:n.x*u.x-l.scrollLeft*u.x+p.x+x.x,y:n.y*u.y-l.scrollTop*u.y+p.y+x.y}}function rf(e){return Array.from(e.getClientRects())}function sf(e){const t=Ie(e),n=yn(e),o=e.ownerDocument.body,r=de(t.scrollWidth,t.clientWidth,o.scrollWidth,o.clientWidth),s=de(t.scrollHeight,t.clientHeight,o.scrollHeight,o.clientHeight);let i=-n.scrollLeft+bn(e);const a=-n.scrollTop;return Te(o).direction==="rtl"&&(i+=de(t.clientWidth,o.clientWidth)-r),{width:r,height:s,x:i,y:a}}const Rr=25;function af(e,t){const n=fe(e),o=Ie(e),r=n.visualViewport;let s=o.clientWidth,i=o.clientHeight,a=0,l=0;if(r){s=r.width,i=r.height;const p=No();(!p||p&&t==="fixed")&&(a=r.offsetLeft,l=r.offsetTop)}const u=bn(o);if(u<=0){const p=o.ownerDocument,g=p.body,x=getComputedStyle(g),w=p.compatMode==="CSS1Compat"&&parseFloat(x.marginLeft)+parseFloat(x.marginRight)||0,m=Math.abs(o.clientWidth-g.clientWidth-w);m<=Rr&&(s-=m)}else u<=Rr&&(s+=u);return{width:s,height:i,x:a,y:l}}const cf=new Set(["absolute","fixed"]);function lf(e,t){const n=Ze(e,!0,t==="fixed"),o=n.top+e.clientTop,r=n.left+e.clientLeft,s=Me(e)?ot(e):Pe(1),i=e.clientWidth*s.x,a=e.clientHeight*s.y,l=r*s.x,u=o*s.y;return{width:i,height:a,x:l,y:u}}function Nr(e,t,n){let o;if(t==="viewport")o=af(e,n);else if(t==="document")o=sf(Ie(e));else if(Ce(t))o=lf(t,n);else{const r=Rs(e);o={x:t.x-r.x,y:t.y-r.y,width:t.width,height:t.height}}return nn(o)}function Ps(e,t){const n=Ve(e);return n===t||!Ce(n)||st(n)?!1:Te(n).position==="fixed"||Ps(n,t)}function uf(e,t){const n=t.get(e);if(n)return n;let o=bt(e,[],!1).filter(a=>Ce(a)&&ut(a)!=="body"),r=null;const s=Te(e).position==="fixed";let i=s?Ve(e):e;for(;Ce(i)&&!st(i);){const a=Te(i),l=Ro(i);!l&&a.position==="fixed"&&(r=null),(s?!l&&!r:!l&&a.position==="static"&&!!r&&cf.has(r.position)||Mt(i)&&!l&&Ps(e,i))?o=o.filter(p=>p!==i):r=a,i=Ve(i)}return t.set(e,o),o}function df(e){let{element:t,boundary:n,rootBoundary:o,strategy:r}=e;const i=[...n==="clippingAncestors"?wn(t)?[]:uf(t,this._c):[].concat(n),o],a=i[0],l=i.reduce((u,p)=>{const g=Nr(t,p,r);return u.top=de(g.top,u.top),u.right=Be(g.right,u.right),u.bottom=Be(g.bottom,u.bottom),u.left=de(g.left,u.left),u},Nr(t,a,r));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function ff(e){const{width:t,height:n}=Ss(e);return{width:t,height:n}}function pf(e,t,n){const o=Me(t),r=Ie(t),s=n==="fixed",i=Ze(e,!0,s,t);let a={scrollLeft:0,scrollTop:0};const l=Pe(0);function u(){l.x=bn(r)}if(o||!o&&!s)if((ut(t)!=="body"||Mt(r))&&(a=yn(t)),o){const w=Ze(t,!0,s,t);l.x=w.x+t.clientLeft,l.y=w.y+t.clientTop}else r&&u();s&&!o&&r&&u();const p=r&&!o&&!s?Ns(r,a):Pe(0),g=i.left+a.scrollLeft-l.x-p.x,x=i.top+a.scrollTop-l.y-p.y;return{x:g,y:x,width:i.width,height:i.height}}function Hn(e){return Te(e).position==="static"}function Pr(e,t){if(!Me(e)||Te(e).position==="fixed")return null;if(t)return t(e);let n=e.offsetParent;return Ie(e)===n&&(n=n.ownerDocument.body),n}function Ms(e,t){const n=fe(e);if(wn(e))return n;if(!Me(e)){let r=Ve(e);for(;r&&!st(r);){if(Ce(r)&&!Hn(r))return r;r=Ve(r)}return n}let o=Pr(e,t);for(;o&&Xd(o)&&Hn(o);)o=Pr(o,t);return o&&st(o)&&Hn(o)&&!Ro(o)?n:o||Qd(e)||n}const mf=async function(e){const t=this.getOffsetParent||Ms,n=this.getDimensions,o=await n(e.floating);return{reference:pf(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:o.width,height:o.height}}};function gf(e){return Te(e).direction==="rtl"}const hf={convertOffsetParentRelativeRectToViewportRelativeRect:of,getDocumentElement:Ie,getClippingRect:df,getOffsetParent:Ms,getElementRects:mf,getClientRects:rf,getDimensions:ff,getScale:ot,isElement:Ce,isRTL:gf};function ks(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}function xf(e,t){let n=null,o;const r=Ie(e);function s(){var a;clearTimeout(o),(a=n)==null||a.disconnect(),n=null}function i(a,l){a===void 0&&(a=!1),l===void 0&&(l=1),s();const u=e.getBoundingClientRect(),{left:p,top:g,width:x,height:w}=u;if(a||t(),!x||!w)return;const m=Vt(g),d=Vt(r.clientWidth-(p+x)),h=Vt(r.clientHeight-(g+w)),y=Vt(p),b={rootMargin:-m+"px "+-d+"px "+-h+"px "+-y+"px",threshold:de(0,Be(1,l))||1};let E=!0;function C(R){const k=R[0].intersectionRatio;if(k!==l){if(!E)return i();k?i(!1,k):o=setTimeout(()=>{i(!1,1e-7)},1e3)}k===1&&!ks(u,e.getBoundingClientRect())&&i(),E=!1}try{n=new IntersectionObserver(C,{...b,root:r.ownerDocument})}catch{n=new IntersectionObserver(C,b)}n.observe(e)}return i(!0),s}function vf(e,t,n,o){o===void 0&&(o={});const{ancestorScroll:r=!0,ancestorResize:s=!0,elementResize:i=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:l=!1}=o,u=Po(e),p=r||s?[...u?bt(u):[],...bt(t)]:[];p.forEach(y=>{r&&y.addEventListener("scroll",n,{passive:!0}),s&&y.addEventListener("resize",n)});const g=u&&a?xf(u,n):null;let x=-1,w=null;i&&(w=new ResizeObserver(y=>{let[v]=y;v&&v.target===u&&w&&(w.unobserve(t),cancelAnimationFrame(x),x=requestAnimationFrame(()=>{var b;(b=w)==null||b.observe(t)})),n()}),u&&!l&&w.observe(u),w.observe(t));let m,d=l?Ze(e):null;l&&h();function h(){const y=Ze(e);d&&!ks(d,y)&&n(),d=y,m=requestAnimationFrame(h)}return n(),()=>{var y;p.forEach(v=>{r&&v.removeEventListener("scroll",n),s&&v.removeEventListener("resize",n)}),g==null||g(),(y=w)==null||y.disconnect(),w=null,l&&cancelAnimationFrame(m)}}const wf=Wd,yf=Bd,bf=$d,Ef=Gd,Cf=zd,Mr=Fd,Tf=Vd,_f=(e,t,n)=>{const o=new Map,r={platform:hf,...n},s={...r.platform,_c:o};return Ld(e,t,{...r,platform:s})};var Sf=typeof document<"u",Rf=function(){},Kt=Sf?c.useLayoutEffect:Rf;function on(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if(typeof e=="function"&&e.toString()===t.toString())return!0;let n,o,r;if(e&&t&&typeof e=="object"){if(Array.isArray(e)){if(n=e.length,n!==t.length)return!1;for(o=n;o--!==0;)if(!on(e[o],t[o]))return!1;return!0}if(r=Object.keys(e),n=r.length,n!==Object.keys(t).length)return!1;for(o=n;o--!==0;)if(!{}.hasOwnProperty.call(t,r[o]))return!1;for(o=n;o--!==0;){const s=r[o];if(!(s==="_owner"&&e.$$typeof)&&!on(e[s],t[s]))return!1}return!0}return e!==e&&t!==t}function Is(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function kr(e,t){const n=Is(e);return Math.round(t*n)/n}function Wn(e){const t=c.useRef(e);return Kt(()=>{t.current=e}),t}function Nf(e){e===void 0&&(e={});const{placement:t="bottom",strategy:n="absolute",middleware:o=[],platform:r,elements:{reference:s,floating:i}={},transform:a=!0,whileElementsMounted:l,open:u}=e,[p,g]=c.useState({x:0,y:0,strategy:n,placement:t,middlewareData:{},isPositioned:!1}),[x,w]=c.useState(o);on(x,o)||w(o);const[m,d]=c.useState(null),[h,y]=c.useState(null),v=c.useCallback(I=>{I!==R.current&&(R.current=I,d(I))},[]),b=c.useCallback(I=>{I!==k.current&&(k.current=I,y(I))},[]),E=s||m,C=i||h,R=c.useRef(null),k=c.useRef(null),N=c.useRef(p),S=l!=null,z=Wn(l),D=Wn(r),A=Wn(u),F=c.useCallback(()=>{if(!R.current||!k.current)return;const I={placement:t,strategy:n,middleware:x};D.current&&(I.platform=D.current),_f(R.current,k.current,I).then(_=>{const $={..._,isPositioned:A.current!==!1};T.current&&!on(N.current,$)&&(N.current=$,Nt.flushSync(()=>{g($)}))})},[x,t,n,D,A]);Kt(()=>{u===!1&&N.current.isPositioned&&(N.current.isPositioned=!1,g(I=>({...I,isPositioned:!1})))},[u]);const T=c.useRef(!1);Kt(()=>(T.current=!0,()=>{T.current=!1}),[]),Kt(()=>{if(E&&(R.current=E),C&&(k.current=C),E&&C){if(z.current)return z.current(E,C,F);F()}},[E,C,F,z,S]);const M=c.useMemo(()=>({reference:R,floating:k,setReference:v,setFloating:b}),[v,b]),P=c.useMemo(()=>({reference:E,floating:C}),[E,C]),L=c.useMemo(()=>{const I={position:n,left:0,top:0};if(!P.floating)return I;const _=kr(P.floating,p.x),$=kr(P.floating,p.y);return a?{...I,transform:"translate("+_+"px, "+$+"px)",...Is(P.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:_,top:$}},[n,a,P.floating,p.x,p.y]);return c.useMemo(()=>({...p,update:F,refs:M,elements:P,floatingStyles:L}),[p,F,M,P,L])}const Pf=e=>{function t(n){return{}.hasOwnProperty.call(n,"current")}return{name:"arrow",options:e,fn(n){const{element:o,padding:r}=typeof e=="function"?e(n):e;return o&&t(o)?o.current!=null?Mr({element:o.current,padding:r}).fn(n):{}:o?Mr({element:o,padding:r}).fn(n):{}}}},Mf=(e,t)=>({...wf(e),options:[e,t]}),kf=(e,t)=>({...yf(e),options:[e,t]}),If=(e,t)=>({...Tf(e),options:[e,t]}),Af=(e,t)=>({...bf(e),options:[e,t]}),Of=(e,t)=>({...Ef(e),options:[e,t]}),Df=(e,t)=>({...Cf(e),options:[e,t]}),jf=(e,t)=>({...Pf(e),options:[e,t]});var Lf="Arrow",As=c.forwardRef((e,t)=>{const{children:n,width:o=10,height:r=5,...s}=e;return f.jsx(ee.svg,{...s,ref:t,width:o,height:r,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?n:f.jsx("polygon",{points:"0,0 30,0 15,10"})})});As.displayName=Lf;var Ff=As;function Mo(e){const[t,n]=c.useState(void 0);return ve(()=>{if(e){n({width:e.offsetWidth,height:e.offsetHeight});const o=new ResizeObserver(r=>{if(!Array.isArray(r)||!r.length)return;const s=r[0];let i,a;if("borderBoxSize"in s){const l=s.borderBoxSize,u=Array.isArray(l)?l[0]:l;i=u.inlineSize,a=u.blockSize}else i=e.offsetWidth,a=e.offsetHeight;n({width:i,height:a})});return o.observe(e,{box:"border-box"}),()=>o.unobserve(e)}else n(void 0)},[e]),t}var ko="Popper",[Os,Ge]=_e(ko),[$f,Ds]=Os(ko),js=e=>{const{__scopePopper:t,children:n}=e,[o,r]=c.useState(null);return f.jsx($f,{scope:t,anchor:o,onAnchorChange:r,children:n})};js.displayName=ko;var Ls="PopperAnchor",Fs=c.forwardRef((e,t)=>{const{__scopePopper:n,virtualRef:o,...r}=e,s=Ds(Ls,n),i=c.useRef(null),a=oe(t,i),l=c.useRef(null);return c.useEffect(()=>{const u=l.current;l.current=(o==null?void 0:o.current)||i.current,u!==l.current&&s.onAnchorChange(l.current)}),o?null:f.jsx(ee.div,{...r,ref:a})});Fs.displayName=Ls;var Io="PopperContent",[zf,Hf]=Os(Io),$s=c.forwardRef((e,t)=>{var W,O,j,V,Y,Z;const{__scopePopper:n,side:o="bottom",sideOffset:r=0,align:s="center",alignOffset:i=0,arrowPadding:a=0,avoidCollisions:l=!0,collisionBoundary:u=[],collisionPadding:p=0,sticky:g="partial",hideWhenDetached:x=!1,updatePositionStrategy:w="optimized",onPlaced:m,...d}=e,h=Ds(Io,n),[y,v]=c.useState(null),b=oe(t,re=>v(re)),[E,C]=c.useState(null),R=Mo(E),k=(R==null?void 0:R.width)??0,N=(R==null?void 0:R.height)??0,S=o+(s!=="center"?"-"+s:""),z=typeof p=="number"?p:{top:0,right:0,bottom:0,left:0,...p},D=Array.isArray(u)?u:[u],A=D.length>0,F={padding:z,boundary:D.filter(Bf),altBoundary:A},{refs:T,floatingStyles:M,placement:P,isPositioned:L,middlewareData:I}=Nf({strategy:"fixed",placement:S,whileElementsMounted:(...re)=>vf(...re,{animationFrame:w==="always"}),elements:{reference:h.anchor},middleware:[Mf({mainAxis:r+N,alignmentAxis:i}),l&&kf({mainAxis:!0,crossAxis:!1,limiter:g==="partial"?If():void 0,...F}),l&&Af({...F}),Of({...F,apply:({elements:re,rects:ce,availableWidth:me,availableHeight:ge})=>{const{width:ne,height:Se}=ce.reference,se=re.floating.style;se.setProperty("--radix-popper-available-width",`${me}px`),se.setProperty("--radix-popper-available-height",`${ge}px`),se.setProperty("--radix-popper-anchor-width",`${ne}px`),se.setProperty("--radix-popper-anchor-height",`${Se}px`)}}),E&&jf({element:E,padding:a}),Vf({arrowWidth:k,arrowHeight:N}),x&&Df({strategy:"referenceHidden",...F})]}),[_,$]=Ws(P),X=We(m);ve(()=>{L&&(X==null||X())},[L,X]);const U=(W=I.arrow)==null?void 0:W.x,q=(O=I.arrow)==null?void 0:O.y,J=((j=I.arrow)==null?void 0:j.centerOffset)!==0,[Q,te]=c.useState();return ve(()=>{y&&te(window.getComputedStyle(y).zIndex)},[y]),f.jsx("div",{ref:T.setFloating,"data-radix-popper-content-wrapper":"",style:{...M,transform:L?M.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Q,"--radix-popper-transform-origin":[(V=I.transformOrigin)==null?void 0:V.x,(Y=I.transformOrigin)==null?void 0:Y.y].join(" "),...((Z=I.hide)==null?void 0:Z.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:f.jsx(zf,{scope:n,placedSide:_,onArrowChange:C,arrowX:U,arrowY:q,shouldHideArrow:J,children:f.jsx(ee.div,{"data-side":_,"data-align":$,...d,ref:b,style:{...d.style,animation:L?void 0:"none"}})})})});$s.displayName=Io;var zs="PopperArrow",Wf={top:"bottom",right:"left",bottom:"top",left:"right"},Hs=c.forwardRef(function(t,n){const{__scopePopper:o,...r}=t,s=Hf(zs,o),i=Wf[s.placedSide];return f.jsx("span",{ref:s.onArrowChange,style:{position:"absolute",left:s.arrowX,top:s.arrowY,[i]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[s.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[s.placedSide],visibility:s.shouldHideArrow?"hidden":void 0},children:f.jsx(Ff,{...r,ref:n,style:{...r.style,display:"block"}})})});Hs.displayName=zs;function Bf(e){return e!==null}var Vf=e=>({name:"transformOrigin",options:e,fn(t){var h,y,v;const{placement:n,rects:o,middlewareData:r}=t,i=((h=r.arrow)==null?void 0:h.centerOffset)!==0,a=i?0:e.arrowWidth,l=i?0:e.arrowHeight,[u,p]=Ws(n),g={start:"0%",center:"50%",end:"100%"}[p],x=(((y=r.arrow)==null?void 0:y.x)??0)+a/2,w=(((v=r.arrow)==null?void 0:v.y)??0)+l/2;let m="",d="";return u==="bottom"?(m=i?g:`${x}px`,d=`${-l}px`):u==="top"?(m=i?g:`${x}px`,d=`${o.floating.height+l}px`):u==="right"?(m=`${-l}px`,d=i?g:`${w}px`):u==="left"&&(m=`${o.floating.width+l}px`,d=i?g:`${w}px`),{data:{x:m,y:d}}}});function Ws(e){const[t,n="center"]=e.split("-");return[t,n]}var Gf=js,kt=Fs,En=$s,Cn=Hs,Bs="Popover",[Vs]=_e(Bs,[Ge]),Tn=Ge(),[nx,Ue]=Vs(Bs),Gs="PopoverAnchor",Uf=c.forwardRef((e,t)=>{const{__scopePopover:n,...o}=e,r=Ue(Gs,n),s=Tn(n),{onCustomAnchorAdd:i,onCustomAnchorRemove:a}=r;return c.useEffect(()=>(i(),()=>a()),[i,a]),f.jsx(kt,{...s,...o,ref:t})});Uf.displayName=Gs;var Us="PopoverTrigger",Kf=c.forwardRef((e,t)=>{const{__scopePopover:n,...o}=e,r=Ue(Us,n),s=Tn(n),i=oe(t,r.triggerRef),a=f.jsx(ee.button,{type:"button","aria-haspopup":"dialog","aria-expanded":r.open,"aria-controls":r.contentId,"data-state":Js(r.open),...o,ref:i,onClick:H(e.onClick,r.onOpenToggle)});return r.hasCustomAnchor?a:f.jsx(kt,{asChild:!0,...s,children:a})});Kf.displayName=Us;var Ao="PopoverPortal",[Xf,Yf]=Vs(Ao,{forceMount:void 0}),Ks=e=>{const{__scopePopover:t,forceMount:n,children:o,container:r}=e,s=Ue(Ao,t);return f.jsx(Xf,{scope:t,forceMount:n,children:f.jsx(ke,{present:n||s.open,children:f.jsx(_t,{asChild:!0,container:r,children:o})})})};Ks.displayName=Ao;var it="PopoverContent",Xs=c.forwardRef((e,t)=>{const n=Yf(it,e.__scopePopover),{forceMount:o=n.forceMount,...r}=e,s=Ue(it,e.__scopePopover);return f.jsx(ke,{present:o||s.open,children:s.modal?f.jsx(Jf,{...r,ref:t}):f.jsx(Zf,{...r,ref:t})})});Xs.displayName=it;var qf=mt("PopoverContent.RemoveScroll"),Jf=c.forwardRef((e,t)=>{const n=Ue(it,e.__scopePopover),o=c.useRef(null),r=oe(t,o),s=c.useRef(!1);return c.useEffect(()=>{const i=o.current;if(i)return ho(i)},[]),f.jsx(xo,{as:qf,allowPinchZoom:!0,children:f.jsx(Ys,{...e,ref:r,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:H(e.onCloseAutoFocus,i=>{var a;i.preventDefault(),s.current||(a=n.triggerRef.current)==null||a.focus()}),onPointerDownOutside:H(e.onPointerDownOutside,i=>{const a=i.detail.originalEvent,l=a.button===0&&a.ctrlKey===!0,u=a.button===2||l;s.current=u},{checkForDefaultPrevented:!1}),onFocusOutside:H(e.onFocusOutside,i=>i.preventDefault(),{checkForDefaultPrevented:!1})})})}),Zf=c.forwardRef((e,t)=>{const n=Ue(it,e.__scopePopover),o=c.useRef(!1),r=c.useRef(!1);return f.jsx(Ys,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{var i,a;(i=e.onCloseAutoFocus)==null||i.call(e,s),s.defaultPrevented||(o.current||(a=n.triggerRef.current)==null||a.focus(),s.preventDefault()),o.current=!1,r.current=!1},onInteractOutside:s=>{var l,u;(l=e.onInteractOutside)==null||l.call(e,s),s.defaultPrevented||(o.current=!0,s.detail.originalEvent.type==="pointerdown"&&(r.current=!0));const i=s.target;((u=n.triggerRef.current)==null?void 0:u.contains(i))&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&r.current&&s.preventDefault()}})}),Ys=c.forwardRef((e,t)=>{const{__scopePopover:n,trapFocus:o,onOpenAutoFocus:r,onCloseAutoFocus:s,disableOutsidePointerEvents:i,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:u,onInteractOutside:p,...g}=e,x=Ue(it,n),w=Tn(n);return vo(),f.jsx(wo,{asChild:!0,loop:!0,trapped:o,onMountAutoFocus:r,onUnmountAutoFocus:s,children:f.jsx(un,{asChild:!0,disableOutsidePointerEvents:i,onInteractOutside:p,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:u,onDismiss:()=>x.onOpenChange(!1),children:f.jsx(En,{"data-state":Js(x.open),role:"dialog",id:x.contentId,...w,...g,ref:t,style:{...g.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),qs="PopoverClose",Qf=c.forwardRef((e,t)=>{const{__scopePopover:n,...o}=e,r=Ue(qs,n);return f.jsx(ee.button,{type:"button",...o,ref:t,onClick:H(e.onClick,()=>r.onOpenChange(!1))})});Qf.displayName=qs;var ep="PopoverArrow",tp=c.forwardRef((e,t)=>{const{__scopePopover:n,...o}=e,r=Tn(n);return f.jsx(Cn,{...r,...o,ref:t})});tp.displayName=ep;function Js(e){return e?"open":"closed"}var np=Ks,Zs=Xs;const op=c.forwardRef(({className:e,align:t="center",sideOffset:n=4,...o},r)=>f.jsx(np,{children:f.jsx(Zs,{ref:r,align:t,sideOffset:n,className:B("z-[9999] w-72 rounded-lg p-4","bg-bg-secondary border border-border shadow-lg outline-none","data-[state=open]:animate-fade-in",e),...o})}));op.displayName=Zs.displayName;function _n(e){const t=e+"CollectionProvider",[n,o]=_e(t),[r,s]=n(t,{collectionRef:{current:null},itemMap:new Map}),i=d=>{const{scope:h,children:y}=d,v=ye.useRef(null),b=ye.useRef(new Map).current;return f.jsx(r,{scope:h,itemMap:b,collectionRef:v,children:y})};i.displayName=t;const a=e+"CollectionSlot",l=mt(a),u=ye.forwardRef((d,h)=>{const{scope:y,children:v}=d,b=s(a,y),E=oe(h,b.collectionRef);return f.jsx(l,{ref:E,children:v})});u.displayName=a;const p=e+"CollectionItemSlot",g="data-radix-collection-item",x=mt(p),w=ye.forwardRef((d,h)=>{const{scope:y,children:v,...b}=d,E=ye.useRef(null),C=oe(h,E),R=s(p,y);return ye.useEffect(()=>(R.itemMap.set(E,{ref:E,...b}),()=>void R.itemMap.delete(E))),f.jsx(x,{[g]:"",ref:C,children:v})});w.displayName=p;function m(d){const h=s(e+"CollectionConsumer",d);return ye.useCallback(()=>{const v=h.collectionRef.current;if(!v)return[];const b=Array.from(v.querySelectorAll(`[${g}]`));return Array.from(h.itemMap.values()).sort((R,k)=>b.indexOf(R.ref.current)-b.indexOf(k.ref.current))},[h.collectionRef,h.itemMap])}return[{Provider:i,Slot:u,ItemSlot:w},m,o]}var rp=c.createContext(void 0);function sp(e){const t=c.useContext(rp);return e||t||"ltr"}var Bn="rovingFocusGroup.onEntryFocus",ip={bubbles:!1,cancelable:!0},It="RovingFocusGroup",[oo,Qs,ap]=_n(It),[cp,ei]=_e(It,[ap]),[lp,up]=cp(It),ti=c.forwardRef((e,t)=>f.jsx(oo.Provider,{scope:e.__scopeRovingFocusGroup,children:f.jsx(oo.Slot,{scope:e.__scopeRovingFocusGroup,children:f.jsx(dp,{...e,ref:t})})}));ti.displayName=It;var dp=c.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:n,orientation:o,loop:r=!1,dir:s,currentTabStopId:i,defaultCurrentTabStopId:a,onCurrentTabStopIdChange:l,onEntryFocus:u,preventScrollOnEntryFocus:p=!1,...g}=e,x=c.useRef(null),w=oe(t,x),m=sp(s),[d,h]=St({prop:i,defaultProp:a??null,onChange:l,caller:It}),[y,v]=c.useState(!1),b=We(u),E=Qs(n),C=c.useRef(!1),[R,k]=c.useState(0);return c.useEffect(()=>{const N=x.current;if(N)return N.addEventListener(Bn,b),()=>N.removeEventListener(Bn,b)},[b]),f.jsx(lp,{scope:n,orientation:o,dir:m,loop:r,currentTabStopId:d,onItemFocus:c.useCallback(N=>h(N),[h]),onItemShiftTab:c.useCallback(()=>v(!0),[]),onFocusableItemAdd:c.useCallback(()=>k(N=>N+1),[]),onFocusableItemRemove:c.useCallback(()=>k(N=>N-1),[]),children:f.jsx(ee.div,{tabIndex:y||R===0?-1:0,"data-orientation":o,...g,ref:w,style:{outline:"none",...e.style},onMouseDown:H(e.onMouseDown,()=>{C.current=!0}),onFocus:H(e.onFocus,N=>{const S=!C.current;if(N.target===N.currentTarget&&S&&!y){const z=new CustomEvent(Bn,ip);if(N.currentTarget.dispatchEvent(z),!z.defaultPrevented){const D=E().filter(P=>P.focusable),A=D.find(P=>P.active),F=D.find(P=>P.id===d),M=[A,F,...D].filter(Boolean).map(P=>P.ref.current);ri(M,p)}}C.current=!1}),onBlur:H(e.onBlur,()=>v(!1))})})}),ni="RovingFocusGroupItem",oi=c.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:n,focusable:o=!0,active:r=!1,tabStopId:s,children:i,...a}=e,l=dn(),u=s||l,p=up(ni,n),g=p.currentTabStopId===u,x=Qs(n),{onFocusableItemAdd:w,onFocusableItemRemove:m,currentTabStopId:d}=p;return c.useEffect(()=>{if(o)return w(),()=>m()},[o,w,m]),f.jsx(oo.ItemSlot,{scope:n,id:u,focusable:o,active:r,children:f.jsx(ee.span,{tabIndex:g?0:-1,"data-orientation":p.orientation,...a,ref:t,onMouseDown:H(e.onMouseDown,h=>{o?p.onItemFocus(u):h.preventDefault()}),onFocus:H(e.onFocus,()=>p.onItemFocus(u)),onKeyDown:H(e.onKeyDown,h=>{if(h.key==="Tab"&&h.shiftKey){p.onItemShiftTab();return}if(h.target!==h.currentTarget)return;const y=mp(h,p.orientation,p.dir);if(y!==void 0){if(h.metaKey||h.ctrlKey||h.altKey||h.shiftKey)return;h.preventDefault();let b=x().filter(E=>E.focusable).map(E=>E.ref.current);if(y==="last")b.reverse();else if(y==="prev"||y==="next"){y==="prev"&&b.reverse();const E=b.indexOf(h.currentTarget);b=p.loop?gp(b,E+1):b.slice(E+1)}setTimeout(()=>ri(b))}}),children:typeof i=="function"?i({isCurrentTabStop:g,hasTabStop:d!=null}):i})})});oi.displayName=ni;var fp={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function pp(e,t){return t!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function mp(e,t,n){const o=pp(e.key,n);if(!(t==="vertical"&&["ArrowLeft","ArrowRight"].includes(o))&&!(t==="horizontal"&&["ArrowUp","ArrowDown"].includes(o)))return fp[o]}function ri(e,t=!1){const n=document.activeElement;for(const o of e)if(o===n||(o.focus({preventScroll:t}),document.activeElement!==n))return}function gp(e,t){return e.map((n,o)=>e[(t+o)%e.length])}var hp=ti,xp=oi,ro=["Enter"," "],vp=["ArrowDown","PageUp","Home"],si=["ArrowUp","PageDown","End"],wp=[...vp,...si],yp={ltr:[...ro,"ArrowRight"],rtl:[...ro,"ArrowLeft"]},bp={ltr:["ArrowLeft"],rtl:["ArrowRight"]},Sn="Menu",[Et,Ep,Cp]=_n(Sn),[et,ii]=_e(Sn,[Cp,Ge,ei]),Oo=Ge(),ai=ei(),[ox,tt]=et(Sn),[rx,At]=et(Sn),Tp="MenuAnchor",Do=c.forwardRef((e,t)=>{const{__scopeMenu:n,...o}=e,r=Oo(n);return f.jsx(kt,{...r,...o,ref:t})});Do.displayName=Tp;var jo="MenuPortal",[_p,ci]=et(jo,{forceMount:void 0}),li=e=>{const{__scopeMenu:t,forceMount:n,children:o,container:r}=e,s=tt(jo,t);return f.jsx(_p,{scope:t,forceMount:n,children:f.jsx(ke,{present:n||s.open,children:f.jsx(_t,{asChild:!0,container:r,children:o})})})};li.displayName=jo;var xe="MenuContent",[Sp,Lo]=et(xe),ui=c.forwardRef((e,t)=>{const n=ci(xe,e.__scopeMenu),{forceMount:o=n.forceMount,...r}=e,s=tt(xe,e.__scopeMenu),i=At(xe,e.__scopeMenu);return f.jsx(Et.Provider,{scope:e.__scopeMenu,children:f.jsx(ke,{present:o||s.open,children:f.jsx(Et.Slot,{scope:e.__scopeMenu,children:i.modal?f.jsx(Rp,{...r,ref:t}):f.jsx(Np,{...r,ref:t})})})})}),Rp=c.forwardRef((e,t)=>{const n=tt(xe,e.__scopeMenu),o=c.useRef(null),r=oe(t,o);return c.useEffect(()=>{const s=o.current;if(s)return ho(s)},[]),f.jsx(Fo,{...e,ref:r,trapFocus:n.open,disableOutsidePointerEvents:n.open,disableOutsideScroll:!0,onFocusOutside:H(e.onFocusOutside,s=>s.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>n.onOpenChange(!1)})}),Np=c.forwardRef((e,t)=>{const n=tt(xe,e.__scopeMenu);return f.jsx(Fo,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>n.onOpenChange(!1)})}),Pp=mt("MenuContent.ScrollLock"),Fo=c.forwardRef((e,t)=>{const{__scopeMenu:n,loop:o=!1,trapFocus:r,onOpenAutoFocus:s,onCloseAutoFocus:i,disableOutsidePointerEvents:a,onEntryFocus:l,onEscapeKeyDown:u,onPointerDownOutside:p,onFocusOutside:g,onInteractOutside:x,onDismiss:w,disableOutsideScroll:m,...d}=e,h=tt(xe,n),y=At(xe,n),v=Oo(n),b=ai(n),E=Ep(n),[C,R]=c.useState(null),k=c.useRef(null),N=oe(t,k,h.onContentChange),S=c.useRef(0),z=c.useRef(""),D=c.useRef(0),A=c.useRef(null),F=c.useRef("right"),T=c.useRef(0),M=m?xo:c.Fragment,P=m?{as:Pp,allowPinchZoom:!0}:void 0,L=_=>{var W,O;const $=z.current+_,X=E().filter(j=>!j.disabled),U=document.activeElement,q=(W=X.find(j=>j.ref.current===U))==null?void 0:W.textValue,J=X.map(j=>j.textValue),Q=Hp(J,$,q),te=(O=X.find(j=>j.textValue===Q))==null?void 0:O.ref.current;(function j(V){z.current=V,window.clearTimeout(S.current),V!==""&&(S.current=window.setTimeout(()=>j(""),1e3))})($),te&&setTimeout(()=>te.focus())};c.useEffect(()=>()=>window.clearTimeout(S.current),[]),vo();const I=c.useCallback(_=>{var X,U;return F.current===((X=A.current)==null?void 0:X.side)&&Bp(_,(U=A.current)==null?void 0:U.area)},[]);return f.jsx(Sp,{scope:n,searchRef:z,onItemEnter:c.useCallback(_=>{I(_)&&_.preventDefault()},[I]),onItemLeave:c.useCallback(_=>{var $;I(_)||(($=k.current)==null||$.focus(),R(null))},[I]),onTriggerLeave:c.useCallback(_=>{I(_)&&_.preventDefault()},[I]),pointerGraceTimerRef:D,onPointerGraceIntentChange:c.useCallback(_=>{A.current=_},[]),children:f.jsx(M,{...P,children:f.jsx(wo,{asChild:!0,trapped:r,onMountAutoFocus:H(s,_=>{var $;_.preventDefault(),($=k.current)==null||$.focus({preventScroll:!0})}),onUnmountAutoFocus:i,children:f.jsx(un,{asChild:!0,disableOutsidePointerEvents:a,onEscapeKeyDown:u,onPointerDownOutside:p,onFocusOutside:g,onInteractOutside:x,onDismiss:w,children:f.jsx(hp,{asChild:!0,...b,dir:y.dir,orientation:"vertical",loop:o,currentTabStopId:C,onCurrentTabStopIdChange:R,onEntryFocus:H(l,_=>{y.isUsingKeyboardRef.current||_.preventDefault()}),preventScrollOnEntryFocus:!0,children:f.jsx(En,{role:"menu","aria-orientation":"vertical","data-state":Si(h.open),"data-radix-menu-content":"",dir:y.dir,...v,...d,ref:N,style:{outline:"none",...d.style},onKeyDown:H(d.onKeyDown,_=>{const X=_.target.closest("[data-radix-menu-content]")===_.currentTarget,U=_.ctrlKey||_.altKey||_.metaKey,q=_.key.length===1;X&&(_.key==="Tab"&&_.preventDefault(),!U&&q&&L(_.key));const J=k.current;if(_.target!==J||!wp.includes(_.key))return;_.preventDefault();const te=E().filter(W=>!W.disabled).map(W=>W.ref.current);si.includes(_.key)&&te.reverse(),$p(te)}),onBlur:H(e.onBlur,_=>{_.currentTarget.contains(_.target)||(window.clearTimeout(S.current),z.current="")}),onPointerMove:H(e.onPointerMove,Ct(_=>{const $=_.target,X=T.current!==_.clientX;if(_.currentTarget.contains($)&&X){const U=_.clientX>T.current?"right":"left";F.current=U,T.current=_.clientX}}))})})})})})})});ui.displayName=xe;var Mp="MenuGroup",$o=c.forwardRef((e,t)=>{const{__scopeMenu:n,...o}=e;return f.jsx(ee.div,{role:"group",...o,ref:t})});$o.displayName=Mp;var kp="MenuLabel",di=c.forwardRef((e,t)=>{const{__scopeMenu:n,...o}=e;return f.jsx(ee.div,{...o,ref:t})});di.displayName=kp;var rn="MenuItem",Ir="menu.itemSelect",Rn=c.forwardRef((e,t)=>{const{disabled:n=!1,onSelect:o,...r}=e,s=c.useRef(null),i=At(rn,e.__scopeMenu),a=Lo(rn,e.__scopeMenu),l=oe(t,s),u=c.useRef(!1),p=()=>{const g=s.current;if(!n&&g){const x=new CustomEvent(Ir,{bubbles:!0,cancelable:!0});g.addEventListener(Ir,w=>o==null?void 0:o(w),{once:!0}),Br(g,x),x.defaultPrevented?u.current=!1:i.onClose()}};return f.jsx(fi,{...r,ref:l,disabled:n,onClick:H(e.onClick,p),onPointerDown:g=>{var x;(x=e.onPointerDown)==null||x.call(e,g),u.current=!0},onPointerUp:H(e.onPointerUp,g=>{var x;u.current||(x=g.currentTarget)==null||x.click()}),onKeyDown:H(e.onKeyDown,g=>{const x=a.searchRef.current!=="";n||x&&g.key===" "||ro.includes(g.key)&&(g.currentTarget.click(),g.preventDefault())})})});Rn.displayName=rn;var fi=c.forwardRef((e,t)=>{const{__scopeMenu:n,disabled:o=!1,textValue:r,...s}=e,i=Lo(rn,n),a=ai(n),l=c.useRef(null),u=oe(t,l),[p,g]=c.useState(!1),[x,w]=c.useState("");return c.useEffect(()=>{const m=l.current;m&&w((m.textContent??"").trim())},[s.children]),f.jsx(Et.ItemSlot,{scope:n,disabled:o,textValue:r??x,children:f.jsx(xp,{asChild:!0,...a,focusable:!o,children:f.jsx(ee.div,{role:"menuitem","data-highlighted":p?"":void 0,"aria-disabled":o||void 0,"data-disabled":o?"":void 0,...s,ref:u,onPointerMove:H(e.onPointerMove,Ct(m=>{o?i.onItemLeave(m):(i.onItemEnter(m),m.defaultPrevented||m.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:H(e.onPointerLeave,Ct(m=>i.onItemLeave(m))),onFocus:H(e.onFocus,()=>g(!0)),onBlur:H(e.onBlur,()=>g(!1))})})})}),Ip="MenuCheckboxItem",pi=c.forwardRef((e,t)=>{const{checked:n=!1,onCheckedChange:o,...r}=e;return f.jsx(vi,{scope:e.__scopeMenu,checked:n,children:f.jsx(Rn,{role:"menuitemcheckbox","aria-checked":sn(n)?"mixed":n,...r,ref:t,"data-state":Ho(n),onSelect:H(r.onSelect,()=>o==null?void 0:o(sn(n)?!0:!n),{checkForDefaultPrevented:!1})})})});pi.displayName=Ip;var mi="MenuRadioGroup",[Ap,Op]=et(mi,{value:void 0,onValueChange:()=>{}}),gi=c.forwardRef((e,t)=>{const{value:n,onValueChange:o,...r}=e,s=We(o);return f.jsx(Ap,{scope:e.__scopeMenu,value:n,onValueChange:s,children:f.jsx($o,{...r,ref:t})})});gi.displayName=mi;var hi="MenuRadioItem",xi=c.forwardRef((e,t)=>{const{value:n,...o}=e,r=Op(hi,e.__scopeMenu),s=n===r.value;return f.jsx(vi,{scope:e.__scopeMenu,checked:s,children:f.jsx(Rn,{role:"menuitemradio","aria-checked":s,...o,ref:t,"data-state":Ho(s),onSelect:H(o.onSelect,()=>{var i;return(i=r.onValueChange)==null?void 0:i.call(r,n)},{checkForDefaultPrevented:!1})})})});xi.displayName=hi;var zo="MenuItemIndicator",[vi,Dp]=et(zo,{checked:!1}),wi=c.forwardRef((e,t)=>{const{__scopeMenu:n,forceMount:o,...r}=e,s=Dp(zo,n);return f.jsx(ke,{present:o||sn(s.checked)||s.checked===!0,children:f.jsx(ee.span,{...r,ref:t,"data-state":Ho(s.checked)})})});wi.displayName=zo;var jp="MenuSeparator",yi=c.forwardRef((e,t)=>{const{__scopeMenu:n,...o}=e;return f.jsx(ee.div,{role:"separator","aria-orientation":"horizontal",...o,ref:t})});yi.displayName=jp;var Lp="MenuArrow",bi=c.forwardRef((e,t)=>{const{__scopeMenu:n,...o}=e,r=Oo(n);return f.jsx(Cn,{...r,...o,ref:t})});bi.displayName=Lp;var Fp="MenuSub",[sx,Ei]=et(Fp),ft="MenuSubTrigger",Ci=c.forwardRef((e,t)=>{const n=tt(ft,e.__scopeMenu),o=At(ft,e.__scopeMenu),r=Ei(ft,e.__scopeMenu),s=Lo(ft,e.__scopeMenu),i=c.useRef(null),{pointerGraceTimerRef:a,onPointerGraceIntentChange:l}=s,u={__scopeMenu:e.__scopeMenu},p=c.useCallback(()=>{i.current&&window.clearTimeout(i.current),i.current=null},[]);return c.useEffect(()=>p,[p]),c.useEffect(()=>{const g=a.current;return()=>{window.clearTimeout(g),l(null)}},[a,l]),f.jsx(Do,{asChild:!0,...u,children:f.jsx(fi,{id:r.triggerId,"aria-haspopup":"menu","aria-expanded":n.open,"aria-controls":r.contentId,"data-state":Si(n.open),...e,ref:Wr(t,r.onTriggerChange),onClick:g=>{var x;(x=e.onClick)==null||x.call(e,g),!(e.disabled||g.defaultPrevented)&&(g.currentTarget.focus(),n.open||n.onOpenChange(!0))},onPointerMove:H(e.onPointerMove,Ct(g=>{s.onItemEnter(g),!g.defaultPrevented&&!e.disabled&&!n.open&&!i.current&&(s.onPointerGraceIntentChange(null),i.current=window.setTimeout(()=>{n.onOpenChange(!0),p()},100))})),onPointerLeave:H(e.onPointerLeave,Ct(g=>{var w,m;p();const x=(w=n.content)==null?void 0:w.getBoundingClientRect();if(x){const d=(m=n.content)==null?void 0:m.dataset.side,h=d==="right",y=h?-5:5,v=x[h?"left":"right"],b=x[h?"right":"left"];s.onPointerGraceIntentChange({area:[{x:g.clientX+y,y:g.clientY},{x:v,y:x.top},{x:b,y:x.top},{x:b,y:x.bottom},{x:v,y:x.bottom}],side:d}),window.clearTimeout(a.current),a.current=window.setTimeout(()=>s.onPointerGraceIntentChange(null),300)}else{if(s.onTriggerLeave(g),g.defaultPrevented)return;s.onPointerGraceIntentChange(null)}})),onKeyDown:H(e.onKeyDown,g=>{var w;const x=s.searchRef.current!=="";e.disabled||x&&g.key===" "||yp[o.dir].includes(g.key)&&(n.onOpenChange(!0),(w=n.content)==null||w.focus(),g.preventDefault())})})})});Ci.displayName=ft;var Ti="MenuSubContent",_i=c.forwardRef((e,t)=>{const n=ci(xe,e.__scopeMenu),{forceMount:o=n.forceMount,...r}=e,s=tt(xe,e.__scopeMenu),i=At(xe,e.__scopeMenu),a=Ei(Ti,e.__scopeMenu),l=c.useRef(null),u=oe(t,l);return f.jsx(Et.Provider,{scope:e.__scopeMenu,children:f.jsx(ke,{present:o||s.open,children:f.jsx(Et.Slot,{scope:e.__scopeMenu,children:f.jsx(Fo,{id:a.contentId,"aria-labelledby":a.triggerId,...r,ref:u,align:"start",side:i.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:p=>{var g;i.isUsingKeyboardRef.current&&((g=l.current)==null||g.focus()),p.preventDefault()},onCloseAutoFocus:p=>p.preventDefault(),onFocusOutside:H(e.onFocusOutside,p=>{p.target!==a.trigger&&s.onOpenChange(!1)}),onEscapeKeyDown:H(e.onEscapeKeyDown,p=>{i.onClose(),p.preventDefault()}),onKeyDown:H(e.onKeyDown,p=>{var w;const g=p.currentTarget.contains(p.target),x=bp[i.dir].includes(p.key);g&&x&&(s.onOpenChange(!1),(w=a.trigger)==null||w.focus(),p.preventDefault())})})})})})});_i.displayName=Ti;function Si(e){return e?"open":"closed"}function sn(e){return e==="indeterminate"}function Ho(e){return sn(e)?"indeterminate":e?"checked":"unchecked"}function $p(e){const t=document.activeElement;for(const n of e)if(n===t||(n.focus(),document.activeElement!==t))return}function zp(e,t){return e.map((n,o)=>e[(t+o)%e.length])}function Hp(e,t,n){const r=t.length>1&&Array.from(t).every(u=>u===t[0])?t[0]:t,s=n?e.indexOf(n):-1;let i=zp(e,Math.max(s,0));r.length===1&&(i=i.filter(u=>u!==n));const l=i.find(u=>u.toLowerCase().startsWith(r.toLowerCase()));return l!==n?l:void 0}function Wp(e,t){const{x:n,y:o}=e;let r=!1;for(let s=0,i=t.length-1;s<t.length;i=s++){const a=t[s],l=t[i],u=a.x,p=a.y,g=l.x,x=l.y;p>o!=x>o&&n<(g-u)*(o-p)/(x-p)+u&&(r=!r)}return r}function Bp(e,t){if(!t)return!1;const n={x:e.clientX,y:e.clientY};return Wp(n,t)}function Ct(e){return t=>t.pointerType==="mouse"?e(t):void 0}var Vp=Do,Gp=li,Up=ui,Kp=$o,Xp=di,Yp=Rn,qp=pi,Jp=gi,Zp=xi,Qp=wi,em=yi,tm=bi,nm=Ci,om=_i,Ri="DropdownMenu",[rm]=_e(Ri,[ii]),le=ii(),[ix,Ni]=rm(Ri),Pi="DropdownMenuTrigger",sm=c.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,disabled:o=!1,...r}=e,s=Ni(Pi,n),i=le(n);return f.jsx(Vp,{asChild:!0,...i,children:f.jsx(ee.button,{type:"button",id:s.triggerId,"aria-haspopup":"menu","aria-expanded":s.open,"aria-controls":s.open?s.contentId:void 0,"data-state":s.open?"open":"closed","data-disabled":o?"":void 0,disabled:o,...r,ref:Wr(t,s.triggerRef),onPointerDown:H(e.onPointerDown,a=>{!o&&a.button===0&&a.ctrlKey===!1&&(s.onOpenToggle(),s.open||a.preventDefault())}),onKeyDown:H(e.onKeyDown,a=>{o||(["Enter"," "].includes(a.key)&&s.onOpenToggle(),a.key==="ArrowDown"&&s.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(a.key)&&a.preventDefault())})})})});sm.displayName=Pi;var im="DropdownMenuPortal",Mi=e=>{const{__scopeDropdownMenu:t,...n}=e,o=le(t);return f.jsx(Gp,{...o,...n})};Mi.displayName=im;var ki="DropdownMenuContent",Ii=c.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...o}=e,r=Ni(ki,n),s=le(n),i=c.useRef(!1);return f.jsx(Up,{id:r.contentId,"aria-labelledby":r.triggerId,...s,...o,ref:t,onCloseAutoFocus:H(e.onCloseAutoFocus,a=>{var l;i.current||(l=r.triggerRef.current)==null||l.focus(),i.current=!1,a.preventDefault()}),onInteractOutside:H(e.onInteractOutside,a=>{const l=a.detail.originalEvent,u=l.button===0&&l.ctrlKey===!0,p=l.button===2||u;(!r.modal||p)&&(i.current=!0)}),style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Ii.displayName=ki;var am="DropdownMenuGroup",cm=c.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...o}=e,r=le(n);return f.jsx(Kp,{...r,...o,ref:t})});cm.displayName=am;var lm="DropdownMenuLabel",Ai=c.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...o}=e,r=le(n);return f.jsx(Xp,{...r,...o,ref:t})});Ai.displayName=lm;var um="DropdownMenuItem",Oi=c.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...o}=e,r=le(n);return f.jsx(Yp,{...r,...o,ref:t})});Oi.displayName=um;var dm="DropdownMenuCheckboxItem",Di=c.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...o}=e,r=le(n);return f.jsx(qp,{...r,...o,ref:t})});Di.displayName=dm;var fm="DropdownMenuRadioGroup",pm=c.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...o}=e,r=le(n);return f.jsx(Jp,{...r,...o,ref:t})});pm.displayName=fm;var mm="DropdownMenuRadioItem",ji=c.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...o}=e,r=le(n);return f.jsx(Zp,{...r,...o,ref:t})});ji.displayName=mm;var gm="DropdownMenuItemIndicator",Li=c.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...o}=e,r=le(n);return f.jsx(Qp,{...r,...o,ref:t})});Li.displayName=gm;var hm="DropdownMenuSeparator",Fi=c.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...o}=e,r=le(n);return f.jsx(em,{...r,...o,ref:t})});Fi.displayName=hm;var xm="DropdownMenuArrow",vm=c.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...o}=e,r=le(n);return f.jsx(tm,{...r,...o,ref:t})});vm.displayName=xm;var wm="DropdownMenuSubTrigger",$i=c.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...o}=e,r=le(n);return f.jsx(nm,{...r,...o,ref:t})});$i.displayName=wm;var ym="DropdownMenuSubContent",zi=c.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...o}=e,r=le(n);return f.jsx(om,{...r,...o,ref:t,style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});zi.displayName=ym;var bm=Mi,Hi=Ii,Wi=Ai,Bi=Oi,Vi=Di,Gi=ji,Ui=Li,Ki=Fi,Xi=$i,Yi=zi;const Em=c.forwardRef(({className:e,inset:t,children:n,...o},r)=>f.jsxs(Xi,{ref:r,className:B("flex cursor-pointer select-none items-center rounded px-2 py-1.5 text-sm","text-text-primary outline-none","focus:bg-surface-hover data-[state=open]:bg-surface-hover",t&&"pl-8",e),...o,children:[n,f.jsx(rl,{className:"ml-auto h-4 w-4"})]}));Em.displayName=Xi.displayName;const Cm=c.forwardRef(({className:e,...t},n)=>f.jsx(Yi,{ref:n,className:B("z-[9999] min-w-[8rem] overflow-hidden rounded-lg p-1","bg-bg-secondary border border-border shadow-lg","data-[state=open]:animate-fade-in",e),...t}));Cm.displayName=Yi.displayName;const Tm=c.forwardRef(({className:e,sideOffset:t=4,...n},o)=>f.jsx(bm,{children:f.jsx(Hi,{ref:o,sideOffset:t,className:B("z-[9999] min-w-[8rem] overflow-hidden rounded-lg p-1","bg-bg-secondary border border-border shadow-lg","data-[state=open]:animate-fade-in",e),...n})}));Tm.displayName=Hi.displayName;const _m=c.forwardRef(({className:e,inset:t,...n},o)=>f.jsx(Bi,{ref:o,className:B("relative flex cursor-pointer select-none items-center gap-2 rounded px-2 py-1.5 text-sm","text-text-primary outline-none transition-colors","focus:bg-surface-hover data-[highlighted]:bg-surface-hover","data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t&&"pl-8",e),...n}));_m.displayName=Bi.displayName;const Sm=c.forwardRef(({className:e,children:t,checked:n,...o},r)=>f.jsxs(Vi,{ref:r,className:B("relative flex cursor-pointer select-none items-center rounded py-1.5 pl-8 pr-2 text-sm","text-text-primary outline-none transition-colors","focus:bg-surface-hover data-[highlighted]:bg-surface-hover","data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),checked:n,...o,children:[f.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:f.jsx(Ui,{children:f.jsx(yo,{className:"h-4 w-4"})})}),t]}));Sm.displayName=Vi.displayName;const Rm=c.forwardRef(({className:e,children:t,...n},o)=>f.jsxs(Gi,{ref:o,className:B("relative flex cursor-pointer select-none items-center rounded py-1.5 pl-8 pr-2 text-sm","text-text-primary outline-none transition-colors","focus:bg-surface-hover data-[highlighted]:bg-surface-hover","data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...n,children:[f.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:f.jsx(Ui,{children:f.jsx(cl,{className:"h-2 w-2 fill-current"})})}),t]}));Rm.displayName=Gi.displayName;const Nm=c.forwardRef(({className:e,inset:t,...n},o)=>f.jsx(Wi,{ref:o,className:B("px-2 py-1.5 text-sm font-semibold text-text-muted",t&&"pl-8",e),...n}));Nm.displayName=Wi.displayName;const Pm=c.forwardRef(({className:e,...t},n)=>f.jsx(Ki,{ref:n,className:B("-mx-1 my-1 h-px bg-border",e),...t}));Pm.displayName=Ki.displayName;function Ar(e,[t,n]){return Math.min(n,Math.max(t,e))}function Wo(e){const t=c.useRef({value:e,previous:e});return c.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}var qi=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),Mm="VisuallyHidden",Nn=c.forwardRef((e,t)=>f.jsx(ee.span,{...e,ref:t,style:{...qi,...e.style}}));Nn.displayName=Mm;var km=Nn,Im=[" ","Enter","ArrowUp","ArrowDown"],Am=[" ","Enter"],Pn="Select",[Bo,Mn,Om]=_n(Pn),[dt]=_e(Pn,[Om,Ge]),Vo=Ge(),[ax,Ke]=dt(Pn),[cx,Dm]=dt(Pn),Ji="SelectTrigger",Zi=c.forwardRef((e,t)=>{const{__scopeSelect:n,disabled:o=!1,...r}=e,s=Vo(n),i=Ke(Ji,n),a=i.disabled||o,l=oe(t,i.onTriggerChange),u=Mn(n),p=c.useRef("touch"),[g,x,w]=ya(d=>{const h=u().filter(b=>!b.disabled),y=h.find(b=>b.value===i.value),v=ba(h,d,y);v!==void 0&&i.onValueChange(v.value)}),m=d=>{a||(i.onOpenChange(!0),w()),d&&(i.triggerPointerDownPosRef.current={x:Math.round(d.pageX),y:Math.round(d.pageY)})};return f.jsx(kt,{asChild:!0,...s,children:f.jsx(ee.button,{type:"button",role:"combobox","aria-controls":i.contentId,"aria-expanded":i.open,"aria-required":i.required,"aria-autocomplete":"none",dir:i.dir,"data-state":i.open?"open":"closed",disabled:a,"data-disabled":a?"":void 0,"data-placeholder":wa(i.value)?"":void 0,...r,ref:l,onClick:H(r.onClick,d=>{d.currentTarget.focus(),p.current!=="mouse"&&m(d)}),onPointerDown:H(r.onPointerDown,d=>{p.current=d.pointerType;const h=d.target;h.hasPointerCapture(d.pointerId)&&h.releasePointerCapture(d.pointerId),d.button===0&&d.ctrlKey===!1&&d.pointerType==="mouse"&&(m(d),d.preventDefault())}),onKeyDown:H(r.onKeyDown,d=>{const h=g.current!=="";!(d.ctrlKey||d.altKey||d.metaKey)&&d.key.length===1&&x(d.key),!(h&&d.key===" ")&&Im.includes(d.key)&&(m(),d.preventDefault())})})})});Zi.displayName=Ji;var Qi="SelectValue",jm=c.forwardRef((e,t)=>{const{__scopeSelect:n,className:o,style:r,children:s,placeholder:i="",...a}=e,l=Ke(Qi,n),{onValueNodeHasChildrenChange:u}=l,p=s!==void 0,g=oe(t,l.onValueNodeChange);return ve(()=>{u(p)},[u,p]),f.jsx(ee.span,{...a,ref:g,style:{pointerEvents:"none"},children:wa(l.value)?f.jsx(f.Fragment,{children:i}):s})});jm.displayName=Qi;var Lm="SelectIcon",ea=c.forwardRef((e,t)=>{const{__scopeSelect:n,children:o,...r}=e;return f.jsx(ee.span,{"aria-hidden":!0,...r,ref:t,children:o||""})});ea.displayName=Lm;var Fm="SelectPortal",ta=e=>f.jsx(_t,{asChild:!0,...e});ta.displayName=Fm;var Qe="SelectContent",na=c.forwardRef((e,t)=>{const n=Ke(Qe,e.__scopeSelect),[o,r]=c.useState();if(ve(()=>{r(new DocumentFragment)},[]),!n.open){const s=o;return s?Nt.createPortal(f.jsx(oa,{scope:e.__scopeSelect,children:f.jsx(Bo.Slot,{scope:e.__scopeSelect,children:f.jsx("div",{children:e.children})})}),s):null}return f.jsx(ra,{...e,ref:t})});na.displayName=Qe;var we=10,[oa,Xe]=dt(Qe),$m="SelectContentImpl",zm=mt("SelectContent.RemoveScroll"),ra=c.forwardRef((e,t)=>{const{__scopeSelect:n,position:o="item-aligned",onCloseAutoFocus:r,onEscapeKeyDown:s,onPointerDownOutside:i,side:a,sideOffset:l,align:u,alignOffset:p,arrowPadding:g,collisionBoundary:x,collisionPadding:w,sticky:m,hideWhenDetached:d,avoidCollisions:h,...y}=e,v=Ke(Qe,n),[b,E]=c.useState(null),[C,R]=c.useState(null),k=oe(t,W=>E(W)),[N,S]=c.useState(null),[z,D]=c.useState(null),A=Mn(n),[F,T]=c.useState(!1),M=c.useRef(!1);c.useEffect(()=>{if(b)return ho(b)},[b]),vo();const P=c.useCallback(W=>{const[O,...j]=A().map(Z=>Z.ref.current),[V]=j.slice(-1),Y=document.activeElement;for(const Z of W)if(Z===Y||(Z==null||Z.scrollIntoView({block:"nearest"}),Z===O&&C&&(C.scrollTop=0),Z===V&&C&&(C.scrollTop=C.scrollHeight),Z==null||Z.focus(),document.activeElement!==Y))return},[A,C]),L=c.useCallback(()=>P([N,b]),[P,N,b]);c.useEffect(()=>{F&&L()},[F,L]);const{onOpenChange:I,triggerPointerDownPosRef:_}=v;c.useEffect(()=>{if(b){let W={x:0,y:0};const O=V=>{var Y,Z;W={x:Math.abs(Math.round(V.pageX)-(((Y=_.current)==null?void 0:Y.x)??0)),y:Math.abs(Math.round(V.pageY)-(((Z=_.current)==null?void 0:Z.y)??0))}},j=V=>{W.x<=10&&W.y<=10?V.preventDefault():b.contains(V.target)||I(!1),document.removeEventListener("pointermove",O),_.current=null};return _.current!==null&&(document.addEventListener("pointermove",O),document.addEventListener("pointerup",j,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",O),document.removeEventListener("pointerup",j,{capture:!0})}}},[b,I,_]),c.useEffect(()=>{const W=()=>I(!1);return window.addEventListener("blur",W),window.addEventListener("resize",W),()=>{window.removeEventListener("blur",W),window.removeEventListener("resize",W)}},[I]);const[$,X]=ya(W=>{const O=A().filter(Y=>!Y.disabled),j=O.find(Y=>Y.ref.current===document.activeElement),V=ba(O,W,j);V&&setTimeout(()=>V.ref.current.focus())}),U=c.useCallback((W,O,j)=>{const V=!M.current&&!j;(v.value!==void 0&&v.value===O||V)&&(S(W),V&&(M.current=!0))},[v.value]),q=c.useCallback(()=>b==null?void 0:b.focus(),[b]),J=c.useCallback((W,O,j)=>{const V=!M.current&&!j;(v.value!==void 0&&v.value===O||V)&&D(W)},[v.value]),Q=o==="popper"?so:sa,te=Q===so?{side:a,sideOffset:l,align:u,alignOffset:p,arrowPadding:g,collisionBoundary:x,collisionPadding:w,sticky:m,hideWhenDetached:d,avoidCollisions:h}:{};return f.jsx(oa,{scope:n,content:b,viewport:C,onViewportChange:R,itemRefCallback:U,selectedItem:N,onItemLeave:q,itemTextRefCallback:J,focusSelectedItem:L,selectedItemText:z,position:o,isPositioned:F,searchRef:$,children:f.jsx(xo,{as:zm,allowPinchZoom:!0,children:f.jsx(wo,{asChild:!0,trapped:v.open,onMountAutoFocus:W=>{W.preventDefault()},onUnmountAutoFocus:H(r,W=>{var O;(O=v.trigger)==null||O.focus({preventScroll:!0}),W.preventDefault()}),children:f.jsx(un,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:s,onPointerDownOutside:i,onFocusOutside:W=>W.preventDefault(),onDismiss:()=>v.onOpenChange(!1),children:f.jsx(Q,{role:"listbox",id:v.contentId,"data-state":v.open?"open":"closed",dir:v.dir,onContextMenu:W=>W.preventDefault(),...y,...te,onPlaced:()=>T(!0),ref:k,style:{display:"flex",flexDirection:"column",outline:"none",...y.style},onKeyDown:H(y.onKeyDown,W=>{const O=W.ctrlKey||W.altKey||W.metaKey;if(W.key==="Tab"&&W.preventDefault(),!O&&W.key.length===1&&X(W.key),["ArrowUp","ArrowDown","Home","End"].includes(W.key)){let V=A().filter(Y=>!Y.disabled).map(Y=>Y.ref.current);if(["ArrowUp","End"].includes(W.key)&&(V=V.slice().reverse()),["ArrowUp","ArrowDown"].includes(W.key)){const Y=W.target,Z=V.indexOf(Y);V=V.slice(Z+1)}setTimeout(()=>P(V)),W.preventDefault()}})})})})})})});ra.displayName=$m;var Hm="SelectItemAlignedPosition",sa=c.forwardRef((e,t)=>{const{__scopeSelect:n,onPlaced:o,...r}=e,s=Ke(Qe,n),i=Xe(Qe,n),[a,l]=c.useState(null),[u,p]=c.useState(null),g=oe(t,k=>p(k)),x=Mn(n),w=c.useRef(!1),m=c.useRef(!0),{viewport:d,selectedItem:h,selectedItemText:y,focusSelectedItem:v}=i,b=c.useCallback(()=>{if(s.trigger&&s.valueNode&&a&&u&&d&&h&&y){const k=s.trigger.getBoundingClientRect(),N=u.getBoundingClientRect(),S=s.valueNode.getBoundingClientRect(),z=y.getBoundingClientRect();if(s.dir!=="rtl"){const Y=z.left-N.left,Z=S.left-Y,re=k.left-Z,ce=k.width+re,me=Math.max(ce,N.width),ge=window.innerWidth-we,ne=Ar(Z,[we,Math.max(we,ge-me)]);a.style.minWidth=ce+"px",a.style.left=ne+"px"}else{const Y=N.right-z.right,Z=window.innerWidth-S.right-Y,re=window.innerWidth-k.right-Z,ce=k.width+re,me=Math.max(ce,N.width),ge=window.innerWidth-we,ne=Ar(Z,[we,Math.max(we,ge-me)]);a.style.minWidth=ce+"px",a.style.right=ne+"px"}const D=x(),A=window.innerHeight-we*2,F=d.scrollHeight,T=window.getComputedStyle(u),M=parseInt(T.borderTopWidth,10),P=parseInt(T.paddingTop,10),L=parseInt(T.borderBottomWidth,10),I=parseInt(T.paddingBottom,10),_=M+P+F+I+L,$=Math.min(h.offsetHeight*5,_),X=window.getComputedStyle(d),U=parseInt(X.paddingTop,10),q=parseInt(X.paddingBottom,10),J=k.top+k.height/2-we,Q=A-J,te=h.offsetHeight/2,W=h.offsetTop+te,O=M+P+W,j=_-O;if(O<=J){const Y=D.length>0&&h===D[D.length-1].ref.current;a.style.bottom="0px";const Z=u.clientHeight-d.offsetTop-d.offsetHeight,re=Math.max(Q,te+(Y?q:0)+Z+L),ce=O+re;a.style.height=ce+"px"}else{const Y=D.length>0&&h===D[0].ref.current;a.style.top="0px";const re=Math.max(J,M+d.offsetTop+(Y?U:0)+te)+j;a.style.height=re+"px",d.scrollTop=O-J+d.offsetTop}a.style.margin=`${we}px 0`,a.style.minHeight=$+"px",a.style.maxHeight=A+"px",o==null||o(),requestAnimationFrame(()=>w.current=!0)}},[x,s.trigger,s.valueNode,a,u,d,h,y,s.dir,o]);ve(()=>b(),[b]);const[E,C]=c.useState();ve(()=>{u&&C(window.getComputedStyle(u).zIndex)},[u]);const R=c.useCallback(k=>{k&&m.current===!0&&(b(),v==null||v(),m.current=!1)},[b,v]);return f.jsx(Bm,{scope:n,contentWrapper:a,shouldExpandOnScrollRef:w,onScrollButtonChange:R,children:f.jsx("div",{ref:l,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:E},children:f.jsx(ee.div,{...r,ref:g,style:{boxSizing:"border-box",maxHeight:"100%",...r.style}})})})});sa.displayName=Hm;var Wm="SelectPopperPosition",so=c.forwardRef((e,t)=>{const{__scopeSelect:n,align:o="start",collisionPadding:r=we,...s}=e,i=Vo(n);return f.jsx(En,{...i,...s,ref:t,align:o,collisionPadding:r,style:{boxSizing:"border-box",...s.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});so.displayName=Wm;var[Bm,Go]=dt(Qe,{}),io="SelectViewport",ia=c.forwardRef((e,t)=>{const{__scopeSelect:n,nonce:o,...r}=e,s=Xe(io,n),i=Go(io,n),a=oe(t,s.onViewportChange),l=c.useRef(0);return f.jsxs(f.Fragment,{children:[f.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:o}),f.jsx(Bo.Slot,{scope:n,children:f.jsx(ee.div,{"data-radix-select-viewport":"",role:"presentation",...r,ref:a,style:{position:"relative",flex:1,overflow:"hidden auto",...r.style},onScroll:H(r.onScroll,u=>{const p=u.currentTarget,{contentWrapper:g,shouldExpandOnScrollRef:x}=i;if(x!=null&&x.current&&g){const w=Math.abs(l.current-p.scrollTop);if(w>0){const m=window.innerHeight-we*2,d=parseFloat(g.style.minHeight),h=parseFloat(g.style.height),y=Math.max(d,h);if(y<m){const v=y+w,b=Math.min(m,v),E=v-b;g.style.height=b+"px",g.style.bottom==="0px"&&(p.scrollTop=E>0?E:0,g.style.justifyContent="flex-end")}}}l.current=p.scrollTop})})})]})});ia.displayName=io;var aa="SelectGroup",[Vm,Gm]=dt(aa),Um=c.forwardRef((e,t)=>{const{__scopeSelect:n,...o}=e,r=dn();return f.jsx(Vm,{scope:n,id:r,children:f.jsx(ee.div,{role:"group","aria-labelledby":r,...o,ref:t})})});Um.displayName=aa;var ca="SelectLabel",la=c.forwardRef((e,t)=>{const{__scopeSelect:n,...o}=e,r=Gm(ca,n);return f.jsx(ee.div,{id:r.id,...o,ref:t})});la.displayName=ca;var an="SelectItem",[Km,ua]=dt(an),da=c.forwardRef((e,t)=>{const{__scopeSelect:n,value:o,disabled:r=!1,textValue:s,...i}=e,a=Ke(an,n),l=Xe(an,n),u=a.value===o,[p,g]=c.useState(s??""),[x,w]=c.useState(!1),m=oe(t,v=>{var b;return(b=l.itemRefCallback)==null?void 0:b.call(l,v,o,r)}),d=dn(),h=c.useRef("touch"),y=()=>{r||(a.onValueChange(o),a.onOpenChange(!1))};if(o==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return f.jsx(Km,{scope:n,value:o,disabled:r,textId:d,isSelected:u,onItemTextChange:c.useCallback(v=>{g(b=>b||((v==null?void 0:v.textContent)??"").trim())},[]),children:f.jsx(Bo.ItemSlot,{scope:n,value:o,disabled:r,textValue:p,children:f.jsx(ee.div,{role:"option","aria-labelledby":d,"data-highlighted":x?"":void 0,"aria-selected":u&&x,"data-state":u?"checked":"unchecked","aria-disabled":r||void 0,"data-disabled":r?"":void 0,tabIndex:r?void 0:-1,...i,ref:m,onFocus:H(i.onFocus,()=>w(!0)),onBlur:H(i.onBlur,()=>w(!1)),onClick:H(i.onClick,()=>{h.current!=="mouse"&&y()}),onPointerUp:H(i.onPointerUp,()=>{h.current==="mouse"&&y()}),onPointerDown:H(i.onPointerDown,v=>{h.current=v.pointerType}),onPointerMove:H(i.onPointerMove,v=>{var b;h.current=v.pointerType,r?(b=l.onItemLeave)==null||b.call(l):h.current==="mouse"&&v.currentTarget.focus({preventScroll:!0})}),onPointerLeave:H(i.onPointerLeave,v=>{var b;v.currentTarget===document.activeElement&&((b=l.onItemLeave)==null||b.call(l))}),onKeyDown:H(i.onKeyDown,v=>{var E;((E=l.searchRef)==null?void 0:E.current)!==""&&v.key===" "||(Am.includes(v.key)&&y(),v.key===" "&&v.preventDefault())})})})})});da.displayName=an;var pt="SelectItemText",fa=c.forwardRef((e,t)=>{const{__scopeSelect:n,className:o,style:r,...s}=e,i=Ke(pt,n),a=Xe(pt,n),l=ua(pt,n),u=Dm(pt,n),[p,g]=c.useState(null),x=oe(t,y=>g(y),l.onItemTextChange,y=>{var v;return(v=a.itemTextRefCallback)==null?void 0:v.call(a,y,l.value,l.disabled)}),w=p==null?void 0:p.textContent,m=c.useMemo(()=>f.jsx("option",{value:l.value,disabled:l.disabled,children:w},l.value),[l.disabled,l.value,w]),{onNativeOptionAdd:d,onNativeOptionRemove:h}=u;return ve(()=>(d(m),()=>h(m)),[d,h,m]),f.jsxs(f.Fragment,{children:[f.jsx(ee.span,{id:l.textId,...s,ref:x}),l.isSelected&&i.valueNode&&!i.valueNodeHasChildren?Nt.createPortal(s.children,i.valueNode):null]})});fa.displayName=pt;var pa="SelectItemIndicator",ma=c.forwardRef((e,t)=>{const{__scopeSelect:n,...o}=e;return ua(pa,n).isSelected?f.jsx(ee.span,{"aria-hidden":!0,...o,ref:t}):null});ma.displayName=pa;var ao="SelectScrollUpButton",ga=c.forwardRef((e,t)=>{const n=Xe(ao,e.__scopeSelect),o=Go(ao,e.__scopeSelect),[r,s]=c.useState(!1),i=oe(t,o.onScrollButtonChange);return ve(()=>{if(n.viewport&&n.isPositioned){let a=function(){const u=l.scrollTop>0;s(u)};const l=n.viewport;return a(),l.addEventListener("scroll",a),()=>l.removeEventListener("scroll",a)}},[n.viewport,n.isPositioned]),r?f.jsx(xa,{...e,ref:i,onAutoScroll:()=>{const{viewport:a,selectedItem:l}=n;a&&l&&(a.scrollTop=a.scrollTop-l.offsetHeight)}}):null});ga.displayName=ao;var co="SelectScrollDownButton",ha=c.forwardRef((e,t)=>{const n=Xe(co,e.__scopeSelect),o=Go(co,e.__scopeSelect),[r,s]=c.useState(!1),i=oe(t,o.onScrollButtonChange);return ve(()=>{if(n.viewport&&n.isPositioned){let a=function(){const u=l.scrollHeight-l.clientHeight,p=Math.ceil(l.scrollTop)<u;s(p)};const l=n.viewport;return a(),l.addEventListener("scroll",a),()=>l.removeEventListener("scroll",a)}},[n.viewport,n.isPositioned]),r?f.jsx(xa,{...e,ref:i,onAutoScroll:()=>{const{viewport:a,selectedItem:l}=n;a&&l&&(a.scrollTop=a.scrollTop+l.offsetHeight)}}):null});ha.displayName=co;var xa=c.forwardRef((e,t)=>{const{__scopeSelect:n,onAutoScroll:o,...r}=e,s=Xe("SelectScrollButton",n),i=c.useRef(null),a=Mn(n),l=c.useCallback(()=>{i.current!==null&&(window.clearInterval(i.current),i.current=null)},[]);return c.useEffect(()=>()=>l(),[l]),ve(()=>{var p;const u=a().find(g=>g.ref.current===document.activeElement);(p=u==null?void 0:u.ref.current)==null||p.scrollIntoView({block:"nearest"})},[a]),f.jsx(ee.div,{"aria-hidden":!0,...r,ref:t,style:{flexShrink:0,...r.style},onPointerDown:H(r.onPointerDown,()=>{i.current===null&&(i.current=window.setInterval(o,50))}),onPointerMove:H(r.onPointerMove,()=>{var u;(u=s.onItemLeave)==null||u.call(s),i.current===null&&(i.current=window.setInterval(o,50))}),onPointerLeave:H(r.onPointerLeave,()=>{l()})})}),Xm="SelectSeparator",va=c.forwardRef((e,t)=>{const{__scopeSelect:n,...o}=e;return f.jsx(ee.div,{"aria-hidden":!0,...o,ref:t})});va.displayName=Xm;var lo="SelectArrow",Ym=c.forwardRef((e,t)=>{const{__scopeSelect:n,...o}=e,r=Vo(n),s=Ke(lo,n),i=Xe(lo,n);return s.open&&i.position==="popper"?f.jsx(Cn,{...r,...o,ref:t}):null});Ym.displayName=lo;var qm="SelectBubbleInput",Jm=c.forwardRef(({__scopeSelect:e,value:t,...n},o)=>{const r=c.useRef(null),s=oe(o,r),i=Wo(t);return c.useEffect(()=>{const a=r.current;if(!a)return;const l=window.HTMLSelectElement.prototype,p=Object.getOwnPropertyDescriptor(l,"value").set;if(i!==t&&p){const g=new Event("change",{bubbles:!0});p.call(a,t),a.dispatchEvent(g)}},[i,t]),f.jsx(ee.select,{...n,style:{...qi,...n.style},ref:s,defaultValue:t})});Jm.displayName=qm;function wa(e){return e===""||e===void 0}function ya(e){const t=We(e),n=c.useRef(""),o=c.useRef(0),r=c.useCallback(i=>{const a=n.current+i;t(a),(function l(u){n.current=u,window.clearTimeout(o.current),u!==""&&(o.current=window.setTimeout(()=>l(""),1e3))})(a)},[t]),s=c.useCallback(()=>{n.current="",window.clearTimeout(o.current)},[]);return c.useEffect(()=>()=>window.clearTimeout(o.current),[]),[n,r,s]}function ba(e,t,n){const r=t.length>1&&Array.from(t).every(u=>u===t[0])?t[0]:t,s=n?e.indexOf(n):-1;let i=Zm(e,Math.max(s,0));r.length===1&&(i=i.filter(u=>u!==n));const l=i.find(u=>u.textValue.toLowerCase().startsWith(r.toLowerCase()));return l!==n?l:void 0}function Zm(e,t){return e.map((n,o)=>e[(t+o)%e.length])}var Ea=Zi,Qm=ea,eg=ta,Ca=na,tg=ia,Ta=la,_a=da,ng=fa,og=ma,Sa=ga,Ra=ha,Na=va;const rg=c.forwardRef(({className:e,children:t,...n},o)=>f.jsxs(Ea,{ref:o,className:B("flex h-10 w-full items-center justify-between rounded-md","px-3 py-2 text-sm","bg-bg-tertiary border border-border text-text-primary","placeholder:text-text-muted","focus:outline-none focus:border-accent focus:bg-surface-elevated","disabled:cursor-not-allowed disabled:opacity-50","transition-all duration-150",e),...n,children:[t,f.jsx(Qm,{asChild:!0,children:f.jsx(Kr,{className:"h-4 w-4 opacity-50"})})]}));rg.displayName=Ea.displayName;const Pa=c.forwardRef(({className:e,...t},n)=>f.jsx(Sa,{ref:n,className:B("flex cursor-default items-center justify-center py-1",e),...t,children:f.jsx(il,{className:"h-4 w-4"})}));Pa.displayName=Sa.displayName;const Ma=c.forwardRef(({className:e,...t},n)=>f.jsx(Ra,{ref:n,className:B("flex cursor-default items-center justify-center py-1",e),...t,children:f.jsx(Kr,{className:"h-4 w-4"})}));Ma.displayName=Ra.displayName;const sg=c.forwardRef(({className:e,children:t,position:n="popper",...o},r)=>f.jsx(eg,{children:f.jsxs(Ca,{ref:r,className:B("relative z-[9999] max-h-96 min-w-[8rem] overflow-hidden","bg-bg-secondary border border-border rounded-lg","shadow-lg","data-[state=open]:animate-fade-in",n==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:n,...o,children:[f.jsx(Pa,{}),f.jsx(tg,{className:B("p-1",n==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),f.jsx(Ma,{})]})}));sg.displayName=Ca.displayName;const ig=c.forwardRef(({className:e,...t},n)=>f.jsx(Ta,{ref:n,className:B("py-1.5 pl-8 pr-2 text-sm font-semibold text-text-muted",e),...t}));ig.displayName=Ta.displayName;const ag=c.forwardRef(({className:e,children:t,...n},o)=>f.jsxs(_a,{ref:o,className:B("relative flex w-full cursor-pointer select-none items-center","rounded py-2 pl-8 pr-2 text-sm","text-text-primary outline-none","focus:bg-surface-hover data-[highlighted]:bg-surface-hover","data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...n,children:[f.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:f.jsx(og,{children:f.jsx(yo,{className:"h-4 w-4"})})}),f.jsx(ng,{children:t})]}));ag.displayName=_a.displayName;const cg=c.forwardRef(({className:e,...t},n)=>f.jsx(Na,{ref:n,className:B("-mx-1 my-1 h-px bg-border",e),...t}));cg.displayName=Na.displayName;var kn="Checkbox",[lg]=_e(kn),[ug,Uo]=lg(kn);function dg(e){const{__scopeCheckbox:t,checked:n,children:o,defaultChecked:r,disabled:s,form:i,name:a,onCheckedChange:l,required:u,value:p="on",internal_do_not_use_render:g}=e,[x,w]=St({prop:n,defaultProp:r??!1,onChange:l,caller:kn}),[m,d]=c.useState(null),[h,y]=c.useState(null),v=c.useRef(!1),b=m?!!i||!!m.closest("form"):!0,E={checked:x,disabled:s,setChecked:w,control:m,setControl:d,name:a,form:i,value:p,hasConsumerStoppedPropagationRef:v,required:u,defaultChecked:He(r)?!1:r,isFormControl:b,bubbleInput:h,setBubbleInput:y};return f.jsx(ug,{scope:t,...E,children:fg(g)?g(E):o})}var ka="CheckboxTrigger",Ia=c.forwardRef(({__scopeCheckbox:e,onKeyDown:t,onClick:n,...o},r)=>{const{control:s,value:i,disabled:a,checked:l,required:u,setControl:p,setChecked:g,hasConsumerStoppedPropagationRef:x,isFormControl:w,bubbleInput:m}=Uo(ka,e),d=oe(r,p),h=c.useRef(l);return c.useEffect(()=>{const y=s==null?void 0:s.form;if(y){const v=()=>g(h.current);return y.addEventListener("reset",v),()=>y.removeEventListener("reset",v)}},[s,g]),f.jsx(ee.button,{type:"button",role:"checkbox","aria-checked":He(l)?"mixed":l,"aria-required":u,"data-state":La(l),"data-disabled":a?"":void 0,disabled:a,value:i,...o,ref:d,onKeyDown:H(t,y=>{y.key==="Enter"&&y.preventDefault()}),onClick:H(n,y=>{g(v=>He(v)?!0:!v),m&&w&&(x.current=y.isPropagationStopped(),x.current||y.stopPropagation())})})});Ia.displayName=ka;var Ko=c.forwardRef((e,t)=>{const{__scopeCheckbox:n,name:o,checked:r,defaultChecked:s,required:i,disabled:a,value:l,onCheckedChange:u,form:p,...g}=e;return f.jsx(dg,{__scopeCheckbox:n,checked:r,defaultChecked:s,disabled:a,required:i,onCheckedChange:u,name:o,form:p,value:l,internal_do_not_use_render:({isFormControl:x})=>f.jsxs(f.Fragment,{children:[f.jsx(Ia,{...g,ref:t,__scopeCheckbox:n}),x&&f.jsx(ja,{__scopeCheckbox:n})]})})});Ko.displayName=kn;var Aa="CheckboxIndicator",Oa=c.forwardRef((e,t)=>{const{__scopeCheckbox:n,forceMount:o,...r}=e,s=Uo(Aa,n);return f.jsx(ke,{present:o||He(s.checked)||s.checked===!0,children:f.jsx(ee.span,{"data-state":La(s.checked),"data-disabled":s.disabled?"":void 0,...r,ref:t,style:{pointerEvents:"none",...e.style}})})});Oa.displayName=Aa;var Da="CheckboxBubbleInput",ja=c.forwardRef(({__scopeCheckbox:e,...t},n)=>{const{control:o,hasConsumerStoppedPropagationRef:r,checked:s,defaultChecked:i,required:a,disabled:l,name:u,value:p,form:g,bubbleInput:x,setBubbleInput:w}=Uo(Da,e),m=oe(n,w),d=Wo(s),h=Mo(o);c.useEffect(()=>{const v=x;if(!v)return;const b=window.HTMLInputElement.prototype,C=Object.getOwnPropertyDescriptor(b,"checked").set,R=!r.current;if(d!==s&&C){const k=new Event("click",{bubbles:R});v.indeterminate=He(s),C.call(v,He(s)?!1:s),v.dispatchEvent(k)}},[x,d,s,r]);const y=c.useRef(He(s)?!1:s);return f.jsx(ee.input,{type:"checkbox","aria-hidden":!0,defaultChecked:i??y.current,required:a,disabled:l,name:u,value:p,form:g,...t,tabIndex:-1,ref:m,style:{...t.style,...h,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});ja.displayName=Da;function fg(e){return typeof e=="function"}function He(e){return e==="indeterminate"}function La(e){return He(e)?"indeterminate":e?"checked":"unchecked"}const pg=c.forwardRef(({className:e,...t},n)=>f.jsx(Ko,{ref:n,className:B("peer h-4 w-4 shrink-0 rounded-sm","border border-border bg-bg-tertiary","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent focus-visible:ring-offset-2","disabled:cursor-not-allowed disabled:opacity-50","data-[state=checked]:bg-accent data-[state=checked]:border-accent data-[state=checked]:text-white","transition-colors",e),...t,children:f.jsx(Oa,{className:B("flex items-center justify-center text-current"),children:f.jsx(yo,{className:"h-3 w-3"})})}));pg.displayName=Ko.displayName;var In="Switch",[mg]=_e(In),[gg,hg]=mg(In),Fa=c.forwardRef((e,t)=>{const{__scopeSwitch:n,name:o,checked:r,defaultChecked:s,required:i,disabled:a,value:l="on",onCheckedChange:u,form:p,...g}=e,[x,w]=c.useState(null),m=oe(t,b=>w(b)),d=c.useRef(!1),h=x?p||!!x.closest("form"):!0,[y,v]=St({prop:r,defaultProp:s??!1,onChange:u,caller:In});return f.jsxs(gg,{scope:n,checked:y,disabled:a,children:[f.jsx(ee.button,{type:"button",role:"switch","aria-checked":y,"aria-required":i,"data-state":Wa(y),"data-disabled":a?"":void 0,disabled:a,value:l,...g,ref:m,onClick:H(e.onClick,b=>{v(E=>!E),h&&(d.current=b.isPropagationStopped(),d.current||b.stopPropagation())})}),h&&f.jsx(Ha,{control:x,bubbles:!d.current,name:o,value:l,checked:y,required:i,disabled:a,form:p,style:{transform:"translateX(-100%)"}})]})});Fa.displayName=In;var $a="SwitchThumb",za=c.forwardRef((e,t)=>{const{__scopeSwitch:n,...o}=e,r=hg($a,n);return f.jsx(ee.span,{"data-state":Wa(r.checked),"data-disabled":r.disabled?"":void 0,...o,ref:t})});za.displayName=$a;var xg="SwitchBubbleInput",Ha=c.forwardRef(({__scopeSwitch:e,control:t,checked:n,bubbles:o=!0,...r},s)=>{const i=c.useRef(null),a=oe(i,s),l=Wo(n),u=Mo(t);return c.useEffect(()=>{const p=i.current;if(!p)return;const g=window.HTMLInputElement.prototype,w=Object.getOwnPropertyDescriptor(g,"checked").set;if(l!==n&&w){const m=new Event("click",{bubbles:o});w.call(p,n),p.dispatchEvent(m)}},[l,n,o]),f.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:n,...r,tabIndex:-1,ref:a,style:{...r.style,...u,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});Ha.displayName=xg;function Wa(e){return e?"checked":"unchecked"}var Ba=Fa,vg=za;const wg=c.forwardRef(({className:e,...t},n)=>f.jsx(Ba,{className:B("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full","border-2 border-transparent shadow-sm","bg-border transition-colors","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent focus-visible:ring-offset-2","disabled:cursor-not-allowed disabled:opacity-50","data-[state=checked]:bg-accent",e),...t,ref:n,children:f.jsx(vg,{className:B("pointer-events-none block h-4 w-4 rounded-full bg-white shadow-lg ring-0","transition-transform","data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})}));wg.displayName=Ba.displayName;var[An]=_e("Tooltip",[Ge]),On=Ge(),Va="TooltipProvider",yg=700,uo="tooltip.open",[bg,Xo]=An(Va),Ga=e=>{const{__scopeTooltip:t,delayDuration:n=yg,skipDelayDuration:o=300,disableHoverableContent:r=!1,children:s}=e,i=c.useRef(!0),a=c.useRef(!1),l=c.useRef(0);return c.useEffect(()=>{const u=l.current;return()=>window.clearTimeout(u)},[]),f.jsx(bg,{scope:t,isOpenDelayedRef:i,delayDuration:n,onOpen:c.useCallback(()=>{window.clearTimeout(l.current),i.current=!1},[]),onClose:c.useCallback(()=>{window.clearTimeout(l.current),l.current=window.setTimeout(()=>i.current=!0,o)},[o]),isPointerInTransitRef:a,onPointerInTransitChange:c.useCallback(u=>{a.current=u},[]),disableHoverableContent:r,children:s})};Ga.displayName=Va;var Tt="Tooltip",[Eg,Ot]=An(Tt),Ua=e=>{const{__scopeTooltip:t,children:n,open:o,defaultOpen:r,onOpenChange:s,disableHoverableContent:i,delayDuration:a}=e,l=Xo(Tt,e.__scopeTooltip),u=On(t),[p,g]=c.useState(null),x=dn(),w=c.useRef(0),m=i??l.disableHoverableContent,d=a??l.delayDuration,h=c.useRef(!1),[y,v]=St({prop:o,defaultProp:r??!1,onChange:k=>{k?(l.onOpen(),document.dispatchEvent(new CustomEvent(uo))):l.onClose(),s==null||s(k)},caller:Tt}),b=c.useMemo(()=>y?h.current?"delayed-open":"instant-open":"closed",[y]),E=c.useCallback(()=>{window.clearTimeout(w.current),w.current=0,h.current=!1,v(!0)},[v]),C=c.useCallback(()=>{window.clearTimeout(w.current),w.current=0,v(!1)},[v]),R=c.useCallback(()=>{window.clearTimeout(w.current),w.current=window.setTimeout(()=>{h.current=!0,v(!0),w.current=0},d)},[d,v]);return c.useEffect(()=>()=>{w.current&&(window.clearTimeout(w.current),w.current=0)},[]),f.jsx(Gf,{...u,children:f.jsx(Eg,{scope:t,contentId:x,open:y,stateAttribute:b,trigger:p,onTriggerChange:g,onTriggerEnter:c.useCallback(()=>{l.isOpenDelayedRef.current?R():E()},[l.isOpenDelayedRef,R,E]),onTriggerLeave:c.useCallback(()=>{m?C():(window.clearTimeout(w.current),w.current=0)},[C,m]),onOpen:E,onClose:C,disableHoverableContent:m,children:n})})};Ua.displayName=Tt;var fo="TooltipTrigger",Ka=c.forwardRef((e,t)=>{const{__scopeTooltip:n,...o}=e,r=Ot(fo,n),s=Xo(fo,n),i=On(n),a=c.useRef(null),l=oe(t,a,r.onTriggerChange),u=c.useRef(!1),p=c.useRef(!1),g=c.useCallback(()=>u.current=!1,[]);return c.useEffect(()=>()=>document.removeEventListener("pointerup",g),[g]),f.jsx(kt,{asChild:!0,...i,children:f.jsx(ee.button,{"aria-describedby":r.open?r.contentId:void 0,"data-state":r.stateAttribute,...o,ref:l,onPointerMove:H(e.onPointerMove,x=>{x.pointerType!=="touch"&&!p.current&&!s.isPointerInTransitRef.current&&(r.onTriggerEnter(),p.current=!0)}),onPointerLeave:H(e.onPointerLeave,()=>{r.onTriggerLeave(),p.current=!1}),onPointerDown:H(e.onPointerDown,()=>{r.open&&r.onClose(),u.current=!0,document.addEventListener("pointerup",g,{once:!0})}),onFocus:H(e.onFocus,()=>{u.current||r.onOpen()}),onBlur:H(e.onBlur,r.onClose),onClick:H(e.onClick,r.onClose)})})});Ka.displayName=fo;var Yo="TooltipPortal",[Cg,Tg]=An(Yo,{forceMount:void 0}),Xa=e=>{const{__scopeTooltip:t,forceMount:n,children:o,container:r}=e,s=Ot(Yo,t);return f.jsx(Cg,{scope:t,forceMount:n,children:f.jsx(ke,{present:n||s.open,children:f.jsx(_t,{asChild:!0,container:r,children:o})})})};Xa.displayName=Yo;var at="TooltipContent",Ya=c.forwardRef((e,t)=>{const n=Tg(at,e.__scopeTooltip),{forceMount:o=n.forceMount,side:r="top",...s}=e,i=Ot(at,e.__scopeTooltip);return f.jsx(ke,{present:o||i.open,children:i.disableHoverableContent?f.jsx(qa,{side:r,...s,ref:t}):f.jsx(_g,{side:r,...s,ref:t})})}),_g=c.forwardRef((e,t)=>{const n=Ot(at,e.__scopeTooltip),o=Xo(at,e.__scopeTooltip),r=c.useRef(null),s=oe(t,r),[i,a]=c.useState(null),{trigger:l,onClose:u}=n,p=r.current,{onPointerInTransitChange:g}=o,x=c.useCallback(()=>{a(null),g(!1)},[g]),w=c.useCallback((m,d)=>{const h=m.currentTarget,y={x:m.clientX,y:m.clientY},v=Mg(y,h.getBoundingClientRect()),b=kg(y,v),E=Ig(d.getBoundingClientRect()),C=Og([...b,...E]);a(C),g(!0)},[g]);return c.useEffect(()=>()=>x(),[x]),c.useEffect(()=>{if(l&&p){const m=h=>w(h,p),d=h=>w(h,l);return l.addEventListener("pointerleave",m),p.addEventListener("pointerleave",d),()=>{l.removeEventListener("pointerleave",m),p.removeEventListener("pointerleave",d)}}},[l,p,w,x]),c.useEffect(()=>{if(i){const m=d=>{const h=d.target,y={x:d.clientX,y:d.clientY},v=(l==null?void 0:l.contains(h))||(p==null?void 0:p.contains(h)),b=!Ag(y,i);v?x():b&&(x(),u())};return document.addEventListener("pointermove",m),()=>document.removeEventListener("pointermove",m)}},[l,p,i,u,x]),f.jsx(qa,{...e,ref:s})}),[Sg,Rg]=An(Tt,{isInside:!1}),Ng=jc("TooltipContent"),qa=c.forwardRef((e,t)=>{const{__scopeTooltip:n,children:o,"aria-label":r,onEscapeKeyDown:s,onPointerDownOutside:i,...a}=e,l=Ot(at,n),u=On(n),{onClose:p}=l;return c.useEffect(()=>(document.addEventListener(uo,p),()=>document.removeEventListener(uo,p)),[p]),c.useEffect(()=>{if(l.trigger){const g=x=>{const w=x.target;w!=null&&w.contains(l.trigger)&&p()};return window.addEventListener("scroll",g,{capture:!0}),()=>window.removeEventListener("scroll",g,{capture:!0})}},[l.trigger,p]),f.jsx(un,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:s,onPointerDownOutside:i,onFocusOutside:g=>g.preventDefault(),onDismiss:p,children:f.jsxs(En,{"data-state":l.stateAttribute,...u,...a,ref:t,style:{...a.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[f.jsx(Ng,{children:o}),f.jsx(Sg,{scope:n,isInside:!0,children:f.jsx(km,{id:l.contentId,role:"tooltip",children:r||o})})]})})});Ya.displayName=at;var Ja="TooltipArrow",Pg=c.forwardRef((e,t)=>{const{__scopeTooltip:n,...o}=e,r=On(n);return Rg(Ja,n).isInside?null:f.jsx(Cn,{...r,...o,ref:t})});Pg.displayName=Ja;function Mg(e,t){const n=Math.abs(t.top-e.y),o=Math.abs(t.bottom-e.y),r=Math.abs(t.right-e.x),s=Math.abs(t.left-e.x);switch(Math.min(n,o,r,s)){case s:return"left";case r:return"right";case n:return"top";case o:return"bottom";default:throw new Error("unreachable")}}function kg(e,t,n=5){const o=[];switch(t){case"top":o.push({x:e.x-n,y:e.y+n},{x:e.x+n,y:e.y+n});break;case"bottom":o.push({x:e.x-n,y:e.y-n},{x:e.x+n,y:e.y-n});break;case"left":o.push({x:e.x+n,y:e.y-n},{x:e.x+n,y:e.y+n});break;case"right":o.push({x:e.x-n,y:e.y-n},{x:e.x-n,y:e.y+n});break}return o}function Ig(e){const{top:t,right:n,bottom:o,left:r}=e;return[{x:r,y:t},{x:n,y:t},{x:n,y:o},{x:r,y:o}]}function Ag(e,t){const{x:n,y:o}=e;let r=!1;for(let s=0,i=t.length-1;s<t.length;i=s++){const a=t[s],l=t[i],u=a.x,p=a.y,g=l.x,x=l.y;p>o!=x>o&&n<(g-u)*(o-p)/(x-p)+u&&(r=!r)}return r}function Og(e){const t=e.slice();return t.sort((n,o)=>n.x<o.x?-1:n.x>o.x?1:n.y<o.y?-1:n.y>o.y?1:0),Dg(t)}function Dg(e){if(e.length<=1)return e.slice();const t=[];for(let o=0;o<e.length;o++){const r=e[o];for(;t.length>=2;){const s=t[t.length-1],i=t[t.length-2];if((s.x-i.x)*(r.y-i.y)>=(s.y-i.y)*(r.x-i.x))t.pop();else break}t.push(r)}t.pop();const n=[];for(let o=e.length-1;o>=0;o--){const r=e[o];for(;n.length>=2;){const s=n[n.length-1],i=n[n.length-2];if((s.x-i.x)*(r.y-i.y)>=(s.y-i.y)*(r.x-i.x))n.pop();else break}n.push(r)}return n.pop(),t.length===1&&n.length===1&&t[0].x===n[0].x&&t[0].y===n[0].y?t:t.concat(n)}var jg=Ga,Lg=Ua,Fg=Ka,$g=Xa,Za=Ya;const lx=jg,ux=Lg,dx=Fg,zg=c.forwardRef(({className:e,sideOffset:t=4,...n},o)=>f.jsx($g,{children:f.jsx(Za,{ref:o,sideOffset:t,className:B("z-[9999] overflow-hidden rounded-md px-2.5 py-1.5","bg-bg-tertiary text-text-primary text-xs","shadow-lg border border-border","animate-fade-in",e),...n})}));zg.displayName=Za.displayName;var Hg="ToastProvider",[Qa,Wg,Bg]=_n("Toast"),[ec]=_e("Toast",[Bg]),[fx,Dn]=ec(Hg),tc="ToastViewport",Vg=["F8"],po="toast.viewportPause",mo="toast.viewportResume",nc=c.forwardRef((e,t)=>{const{__scopeToast:n,hotkey:o=Vg,label:r="Notifications ({hotkey})",...s}=e,i=Dn(tc,n),a=Wg(n),l=c.useRef(null),u=c.useRef(null),p=c.useRef(null),g=c.useRef(null),x=oe(t,g,i.onViewportChange),w=o.join("+").replace(/Key/g,"").replace(/Digit/g,""),m=i.toastCount>0;c.useEffect(()=>{const h=y=>{var b;o.length!==0&&o.every(E=>y[E]||y.code===E)&&((b=g.current)==null||b.focus())};return document.addEventListener("keydown",h),()=>document.removeEventListener("keydown",h)},[o]),c.useEffect(()=>{const h=l.current,y=g.current;if(m&&h&&y){const v=()=>{if(!i.isClosePausedRef.current){const R=new CustomEvent(po);y.dispatchEvent(R),i.isClosePausedRef.current=!0}},b=()=>{if(i.isClosePausedRef.current){const R=new CustomEvent(mo);y.dispatchEvent(R),i.isClosePausedRef.current=!1}},E=R=>{!h.contains(R.relatedTarget)&&b()},C=()=>{h.contains(document.activeElement)||b()};return h.addEventListener("focusin",v),h.addEventListener("focusout",E),h.addEventListener("pointermove",v),h.addEventListener("pointerleave",C),window.addEventListener("blur",v),window.addEventListener("focus",b),()=>{h.removeEventListener("focusin",v),h.removeEventListener("focusout",E),h.removeEventListener("pointermove",v),h.removeEventListener("pointerleave",C),window.removeEventListener("blur",v),window.removeEventListener("focus",b)}}},[m,i.isClosePausedRef]);const d=c.useCallback(({tabbingDirection:h})=>{const v=a().map(b=>{const E=b.ref.current,C=[E,...oh(E)];return h==="forwards"?C:C.reverse()});return(h==="forwards"?v.reverse():v).flat()},[a]);return c.useEffect(()=>{const h=g.current;if(h){const y=v=>{var C,R,k;const b=v.altKey||v.ctrlKey||v.metaKey;if(v.key==="Tab"&&!b){const N=document.activeElement,S=v.shiftKey;if(v.target===h&&S){(C=u.current)==null||C.focus();return}const A=d({tabbingDirection:S?"backwards":"forwards"}),F=A.findIndex(T=>T===N);Vn(A.slice(F+1))?v.preventDefault():S?(R=u.current)==null||R.focus():(k=p.current)==null||k.focus()}};return h.addEventListener("keydown",y),()=>h.removeEventListener("keydown",y)}},[a,d]),f.jsxs(Lc,{ref:l,role:"region","aria-label":r.replace("{hotkey}",w),tabIndex:-1,style:{pointerEvents:m?void 0:"none"},children:[m&&f.jsx(go,{ref:u,onFocusFromOutsideViewport:()=>{const h=d({tabbingDirection:"forwards"});Vn(h)}}),f.jsx(Qa.Slot,{scope:n,children:f.jsx(ee.ol,{tabIndex:-1,...s,ref:x})}),m&&f.jsx(go,{ref:p,onFocusFromOutsideViewport:()=>{const h=d({tabbingDirection:"backwards"});Vn(h)}})]})});nc.displayName=tc;var oc="ToastFocusProxy",go=c.forwardRef((e,t)=>{const{__scopeToast:n,onFocusFromOutsideViewport:o,...r}=e,s=Dn(oc,n);return f.jsx(Nn,{tabIndex:0,...r,ref:t,style:{position:"fixed"},onFocus:i=>{var u;const a=i.relatedTarget;!((u=s.viewport)!=null&&u.contains(a))&&o()}})});go.displayName=oc;var Dt="Toast",Gg="toast.swipeStart",Ug="toast.swipeMove",Kg="toast.swipeCancel",Xg="toast.swipeEnd",rc=c.forwardRef((e,t)=>{const{forceMount:n,open:o,defaultOpen:r,onOpenChange:s,...i}=e,[a,l]=St({prop:o,defaultProp:r??!0,onChange:s,caller:Dt});return f.jsx(ke,{present:n||a,children:f.jsx(Jg,{open:a,...i,ref:t,onClose:()=>l(!1),onPause:We(e.onPause),onResume:We(e.onResume),onSwipeStart:H(e.onSwipeStart,u=>{u.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:H(e.onSwipeMove,u=>{const{x:p,y:g}=u.detail.delta;u.currentTarget.setAttribute("data-swipe","move"),u.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${p}px`),u.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${g}px`)}),onSwipeCancel:H(e.onSwipeCancel,u=>{u.currentTarget.setAttribute("data-swipe","cancel"),u.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),u.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),u.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),u.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:H(e.onSwipeEnd,u=>{const{x:p,y:g}=u.detail.delta;u.currentTarget.setAttribute("data-swipe","end"),u.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),u.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),u.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${p}px`),u.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${g}px`),l(!1)})})})});rc.displayName=Dt;var[Yg,qg]=ec(Dt,{onClose(){}}),Jg=c.forwardRef((e,t)=>{const{__scopeToast:n,type:o="foreground",duration:r,open:s,onClose:i,onEscapeKeyDown:a,onPause:l,onResume:u,onSwipeStart:p,onSwipeMove:g,onSwipeCancel:x,onSwipeEnd:w,...m}=e,d=Dn(Dt,n),[h,y]=c.useState(null),v=oe(t,T=>y(T)),b=c.useRef(null),E=c.useRef(null),C=r||d.duration,R=c.useRef(0),k=c.useRef(C),N=c.useRef(0),{onToastAdd:S,onToastRemove:z}=d,D=We(()=>{var M;(h==null?void 0:h.contains(document.activeElement))&&((M=d.viewport)==null||M.focus()),i()}),A=c.useCallback(T=>{!T||T===1/0||(window.clearTimeout(N.current),R.current=new Date().getTime(),N.current=window.setTimeout(D,T))},[D]);c.useEffect(()=>{const T=d.viewport;if(T){const M=()=>{A(k.current),u==null||u()},P=()=>{const L=new Date().getTime()-R.current;k.current=k.current-L,window.clearTimeout(N.current),l==null||l()};return T.addEventListener(po,P),T.addEventListener(mo,M),()=>{T.removeEventListener(po,P),T.removeEventListener(mo,M)}}},[d.viewport,C,l,u,A]),c.useEffect(()=>{s&&!d.isClosePausedRef.current&&A(C)},[s,C,d.isClosePausedRef,A]),c.useEffect(()=>(S(),()=>z()),[S,z]);const F=c.useMemo(()=>h?dc(h):null,[h]);return d.viewport?f.jsxs(f.Fragment,{children:[F&&f.jsx(Zg,{__scopeToast:n,role:"status","aria-live":o==="foreground"?"assertive":"polite",children:F}),f.jsx(Yg,{scope:n,onClose:D,children:Nt.createPortal(f.jsx(Qa.ItemSlot,{scope:n,children:f.jsx(Fc,{asChild:!0,onEscapeKeyDown:H(a,()=>{d.isFocusedToastEscapeKeyDownRef.current||D(),d.isFocusedToastEscapeKeyDownRef.current=!1}),children:f.jsx(ee.li,{tabIndex:0,"data-state":s?"open":"closed","data-swipe-direction":d.swipeDirection,...m,ref:v,style:{userSelect:"none",touchAction:"none",...e.style},onKeyDown:H(e.onKeyDown,T=>{T.key==="Escape"&&(a==null||a(T.nativeEvent),T.nativeEvent.defaultPrevented||(d.isFocusedToastEscapeKeyDownRef.current=!0,D()))}),onPointerDown:H(e.onPointerDown,T=>{T.button===0&&(b.current={x:T.clientX,y:T.clientY})}),onPointerMove:H(e.onPointerMove,T=>{if(!b.current)return;const M=T.clientX-b.current.x,P=T.clientY-b.current.y,L=!!E.current,I=["left","right"].includes(d.swipeDirection),_=["left","up"].includes(d.swipeDirection)?Math.min:Math.max,$=I?_(0,M):0,X=I?0:_(0,P),U=T.pointerType==="touch"?10:2,q={x:$,y:X},J={originalEvent:T,delta:q};L?(E.current=q,Gt(Ug,g,J,{discrete:!1})):Or(q,d.swipeDirection,U)?(E.current=q,Gt(Gg,p,J,{discrete:!1}),T.target.setPointerCapture(T.pointerId)):(Math.abs(M)>U||Math.abs(P)>U)&&(b.current=null)}),onPointerUp:H(e.onPointerUp,T=>{const M=E.current,P=T.target;if(P.hasPointerCapture(T.pointerId)&&P.releasePointerCapture(T.pointerId),E.current=null,b.current=null,M){const L=T.currentTarget,I={originalEvent:T,delta:M};Or(M,d.swipeDirection,d.swipeThreshold)?Gt(Xg,w,I,{discrete:!0}):Gt(Kg,x,I,{discrete:!0}),L.addEventListener("click",_=>_.preventDefault(),{once:!0})}})})})}),d.viewport)})]}):null}),Zg=e=>{const{__scopeToast:t,children:n,...o}=e,r=Dn(Dt,t),[s,i]=c.useState(!1),[a,l]=c.useState(!1);return th(()=>i(!0)),c.useEffect(()=>{const u=window.setTimeout(()=>l(!0),1e3);return()=>window.clearTimeout(u)},[]),a?null:f.jsx(_t,{asChild:!0,children:f.jsx(Nn,{...o,children:s&&f.jsxs(f.Fragment,{children:[r.label," ",n]})})})},Qg="ToastTitle",sc=c.forwardRef((e,t)=>{const{__scopeToast:n,...o}=e;return f.jsx(ee.div,{...o,ref:t})});sc.displayName=Qg;var eh="ToastDescription",ic=c.forwardRef((e,t)=>{const{__scopeToast:n,...o}=e;return f.jsx(ee.div,{...o,ref:t})});ic.displayName=eh;var ac="ToastAction",cc=c.forwardRef((e,t)=>{const{altText:n,...o}=e;return n.trim()?f.jsx(uc,{altText:n,asChild:!0,children:f.jsx(qo,{...o,ref:t})}):(console.error(`Invalid prop \`altText\` supplied to \`${ac}\`. Expected non-empty \`string\`.`),null)});cc.displayName=ac;var lc="ToastClose",qo=c.forwardRef((e,t)=>{const{__scopeToast:n,...o}=e,r=qg(lc,n);return f.jsx(uc,{asChild:!0,children:f.jsx(ee.button,{type:"button",...o,ref:t,onClick:H(e.onClick,r.onClose)})})});qo.displayName=lc;var uc=c.forwardRef((e,t)=>{const{__scopeToast:n,altText:o,...r}=e;return f.jsx(ee.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":o||void 0,...r,ref:t})});function dc(e){const t=[];return Array.from(e.childNodes).forEach(o=>{if(o.nodeType===o.TEXT_NODE&&o.textContent&&t.push(o.textContent),nh(o)){const r=o.ariaHidden||o.hidden||o.style.display==="none",s=o.dataset.radixToastAnnounceExclude==="";if(!r)if(s){const i=o.dataset.radixToastAnnounceAlt;i&&t.push(i)}else t.push(...dc(o))}}),t}function Gt(e,t,n,{discrete:o}){const r=n.originalEvent.currentTarget,s=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:n});t&&r.addEventListener(e,t,{once:!0}),o?Br(r,s):r.dispatchEvent(s)}var Or=(e,t,n=0)=>{const o=Math.abs(e.x),r=Math.abs(e.y),s=o>r;return t==="left"||t==="right"?s&&o>n:!s&&r>n};function th(e=()=>{}){const t=We(e);ve(()=>{let n=0,o=0;return n=window.requestAnimationFrame(()=>o=window.requestAnimationFrame(t)),()=>{window.cancelAnimationFrame(n),window.cancelAnimationFrame(o)}},[t])}function nh(e){return e.nodeType===e.ELEMENT_NODE}function oh(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:o=>{const r=o.tagName==="INPUT"&&o.type==="hidden";return o.disabled||o.hidden||r?NodeFilter.FILTER_SKIP:o.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function Vn(e){const t=document.activeElement;return e.some(n=>n===t?!0:(n.focus(),document.activeElement!==t))}var fc=nc,pc=rc,mc=sc,gc=ic,hc=cc,xc=qo;const rh=c.forwardRef(({className:e,...t},n)=>f.jsx(fc,{ref:n,className:B("fixed bottom-5 right-5 z-[9999] flex flex-col gap-2.5","max-w-[420px] w-full p-0 m-0","list-none outline-none",e),...t}));rh.displayName=fc.displayName;const sh={success:"border-l-4 border-l-success",error:"border-l-4 border-l-danger",info:"border-l-4 border-l-info",warning:"border-l-4 border-l-warning"},ih=c.forwardRef(({className:e,variant:t="info",...n},o)=>f.jsx(pc,{ref:o,className:B("group pointer-events-auto relative flex w-full items-start gap-3","bg-bg-secondary rounded-lg p-4","shadow-[var(--shadow-toast)] border border-border","data-[state=open]:animate-slide-in-right","data-[state=closed]:animate-slide-out-right","data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)]","data-[swipe=cancel]:translate-x-0 data-[swipe=cancel]:transition-transform","data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none",sh[t],e),...n}));ih.displayName=pc.displayName;const ah=c.forwardRef(({className:e,...t},n)=>f.jsx(hc,{ref:n,className:B("inline-flex items-center justify-center rounded-md px-3 py-1.5","text-sm font-medium text-text-primary","bg-bg-tertiary border border-border","hover:bg-surface-hover transition-colors","focus:outline-none focus:ring-2 focus:ring-accent focus:ring-offset-2","disabled:pointer-events-none disabled:opacity-50",e),...t}));ah.displayName=hc.displayName;const ch=c.forwardRef(({className:e,...t},n)=>f.jsx(xc,{ref:n,className:B("absolute right-2 top-2 rounded-md p-1","text-text-dim hover:text-text-primary","opacity-0 group-hover:opacity-100 transition-opacity","focus:opacity-100 focus:outline-none focus:ring-2 focus:ring-accent",e),"toast-close":"",...t,children:f.jsx(Xr,{className:"h-4 w-4"})}));ch.displayName=xc.displayName;const lh=c.forwardRef(({className:e,...t},n)=>f.jsx(mc,{ref:n,className:B("text-sm font-semibold text-text-primary",e),...t}));lh.displayName=mc.displayName;const uh=c.forwardRef(({className:e,...t},n)=>f.jsx(gc,{ref:n,className:B("text-sm text-text-muted",e),...t}));uh.displayName=gc.displayName;function px({open:e,onOpenChange:t,onConfirm:n,title:o,description:r,confirmLabel:s="Confirmer",cancelLabel:i="Annuler"}){const a=()=>{n(),t(!1)};return f.jsx($c,{open:e,onOpenChange:t,children:f.jsxs(zc,{children:[f.jsxs(Hc,{children:[f.jsx(Wc,{children:o}),f.jsx(Bc,{children:r})]}),f.jsxs(Vc,{children:[f.jsx(Gc,{children:i}),f.jsx(Uc,{onClick:a,children:s})]})]})})}const vc=10,cn=50;function dh(e,t){const n=c.useRef([]);return c.useEffect(()=>()=>{n.current.forEach(clearTimeout)},[]),{execute:c.useCallback((r,s)=>{const{isRunning:i,start:a,triggerNode:l,selectTransition:u}=e;if(n.current.forEach(clearTimeout),n.current=[],t!=null&&t.isSourceWaiting)u(s);else if(i){l(r);const p=setTimeout(()=>{u(s)},cn);n.current.push(p)}else{a();const p=setTimeout(()=>{l(r);const g=setTimeout(()=>{u(s)},cn);n.current.push(g)},vc);n.current.push(p)}},[e,t==null?void 0:t.isSourceWaiting])}}function mx(e){const t=c.useRef([]);return c.useEffect(()=>()=>{t.current.forEach(clearTimeout)},[]),{execute:c.useCallback(o=>{const{isRunning:r,start:s,triggerNode:i,completeManualNode:a}=e;if(t.current.forEach(clearTimeout),t.current=[],r){i(o);const l=setTimeout(()=>{a(o)},cn);t.current.push(l)}else{s();const l=setTimeout(()=>{i(o);const u=setTimeout(()=>{a(o)},cn);t.current.push(u)},vc);t.current.push(l)}},[e])}}function fh({ref:e,onClose:t,enabled:n=!0,listenEscape:o=!0,listenClickOutside:r=!0}){c.useEffect(()=>{if(!n)return;const s=l=>{e.current&&!e.current.contains(l.target)&&t()},i=l=>{l.key==="Escape"&&t()},a=setTimeout(()=>{r&&document.addEventListener("mousedown",s),o&&document.addEventListener("keydown",i)},0);return()=>{clearTimeout(a),r&&document.removeEventListener("mousedown",s),o&&document.removeEventListener("keydown",i)}},[e,t,n,o,r])}function gx(e,t=!0){c.useEffect(()=>{if(!t)return;const n=o=>{o.key==="Escape"&&e()};return document.addEventListener("keydown",n),()=>document.removeEventListener("keydown",n)},[e,t])}function hx(){const e=Ne(o=>o.sidebarCollapsed),t=Ne(o=>o.setSidebarCollapsed),n=Ne(o=>o.toggleSidebar);return{collapsed:e,setCollapsed:t,toggleCollapsed:n}}const nt={event:{gradient:"gradient-event",rotate:"rotate-event",selected:"node-selected-event",pulse:"animate-pulse-event"},command:{gradient:"gradient-command",rotate:"rotate-command",selected:"node-selected-command",pulse:"animate-pulse-command"},policy:{gradient:"gradient-policy",rotate:"rotate-policy",selected:"node-selected-policy",pulse:"animate-pulse-policy"},trigger:{gradient:"gradient-trigger",rotate:"rotate-trigger",selected:"node-selected-trigger",pulse:"animate-pulse-trigger"},externalSystem:{gradient:"gradient-external",rotate:"rotate-external-system",selected:"node-selected-external",pulse:"animate-pulse-external"},externalEvent:{gradient:"gradient-external",rotate:"rotate-external-event",selected:"node-selected-external",pulse:"animate-pulse-external"},hotspot:{gradient:"gradient-hotspot",rotate:"rotate-hotspot",selected:"node-selected-hotspot"}};function ph({text:e,maxWidth:t,maxHeight:n,minFontSize:o=8,maxFontSize:r=18}){return c.useMemo(()=>{if(!e||t<=0||n<=0)return{fontSize:r};const s=document.createElement("div");s.style.cssText=`
      position: absolute;
      left: -9999px;
      top: -9999px;
      width: ${t}px;
      height: ${n}px;
      overflow: hidden;
      font-family: system-ui, -apple-system, sans-serif;
      font-weight: 400;
      line-height: 1.3;
      white-space: pre-wrap;
      word-wrap: break-word;
      text-align: center;
      box-sizing: border-box;
    `,s.textContent=e,document.body.appendChild(s);let i=o;for(let a=r;a>=o;a--){s.style.fontSize=`${a}px`;const l=s.scrollHeight<=s.clientHeight,u=s.scrollWidth<=s.clientWidth;if(l&&u){i=a;break}}return document.body.removeChild(s),{fontSize:i}},[e,t,n,o,r])}const mh=128,gh=78,Ae=c.memo(c.forwardRef(function({value:t,onChange:n,className:o,placeholder:r="Label",maxWidth:s=mh,maxHeight:i=gh,minFontSize:a=8,maxFontSize:l=18,autoSize:u=!1,onEditEnd:p},g){const[x,w]=c.useState(!1),m=c.useRef(null),{fontSize:d}=ph({text:u?"":t||r,maxWidth:s,maxHeight:i,minFontSize:a,maxFontSize:l});c.useImperativeHandle(g,()=>({startEditing:()=>w(!0)}),[]),c.useEffect(()=>{if(x&&m.current){m.current.focus();const N=window.getSelection(),S=document.createRange();S.selectNodeContents(m.current),N==null||N.removeAllRanges(),N==null||N.addRange(S)}},[x]);const h=c.useCallback(N=>{N.stopPropagation(),w(!0)},[]),y=c.useCallback(()=>{var S;if(!m.current)return;const N=((S=m.current.textContent)==null?void 0:S.trim())||"";N!==t&&n(N),w(!1),p==null||p(N)},[t,n,p]),v=c.useCallback(()=>{m.current&&(m.current.textContent=t),w(!1),p==null||p(t)},[t,p]),b=c.useCallback(N=>{N.key==="Enter"&&!N.shiftKey?(N.preventDefault(),y()):N.key==="Escape"&&(N.preventDefault(),v())},[y,v]),E=c.useCallback(()=>{y()},[y]),C=c.useCallback(N=>{x&&N.stopPropagation()},[x]),R=c.useCallback(N=>{x&&N.stopPropagation()},[x]),k=u?void 0:{fontSize:`${d}px`};return f.jsx("span",{ref:m,className:B("flex items-center text-center font-normal text-[0.75rem] whitespace-pre-wrap leading-[1.3] break-words overflow-hidden flex-1 min-w-[4em] min-h-[1.3em] text-postit-text","cursor-text",x&&"outline-none bg-black/20 rounded px-1.5 py-0.5 shadow-[0_0_0_1px_rgba(255,255,255,0.4)] nodrag nopan",o),style:k,contentEditable:x,suppressContentEditableWarning:!0,onDoubleClick:h,onKeyDown:x?b:void 0,onBlur:x?E:void 0,onMouseDown:C,onClick:R,children:t})})),xx=c.memo(function({label:t,selected:n,isCompleted:o,isActive:r,isTargetConnectable:s,isSourceConnectable:i,onLabelChange:a,placeholder:l="Event",instanceCount:u,toolbar:p,quickCreateButtons:g}){const x=nt.event;return f.jsxs("div",{className:B("node-postit",x.gradient,x.rotate,"w-[152px] h-[112px] p-3 flex items-center justify-center","transition-shadow duration-200 hover:scale-[1.02]",n&&`node-selected ${x.selected}`,o&&"bg-success! node-completed",r&&x.pulse),children:[p,g,f.jsx(K,{type:"target",position:G.Top,id:"target-top",className:"node-handle node-handle-horizontal",isConnectable:s}),f.jsx(K,{type:"target",position:G.Bottom,id:"target-bottom",className:"node-handle node-handle-horizontal",isConnectable:s}),f.jsx(K,{type:"target",position:G.Left,id:"target-left",className:"node-handle node-handle-vertical",isConnectable:s}),f.jsx(K,{type:"target",position:G.Right,id:"target-right",className:"node-handle node-handle-vertical",isConnectable:s}),f.jsx(K,{type:"source",position:G.Top,id:"source-top",className:"node-handle node-handle-horizontal",isConnectable:i}),f.jsx(K,{type:"source",position:G.Bottom,id:"source-bottom",className:"node-handle node-handle-horizontal",isConnectable:i}),f.jsx(K,{type:"source",position:G.Left,id:"source-left",className:"node-handle node-handle-vertical",isConnectable:i}),f.jsx(K,{type:"source",position:G.Right,id:"source-right",className:"node-handle node-handle-vertical",isConnectable:i}),f.jsx("div",{className:"p-0 text-center w-full h-full flex flex-col items-center justify-center",children:f.jsx(Ae,{value:t,onChange:a,placeholder:l})}),u&&u>1&&f.jsx("div",{className:"absolute top-1 left-1 flex gap-[3px] z-10",children:f.jsxs("span",{className:"text-[0.4rem] px-[5px] py-0.5 rounded-[3px] bg-black/30 text-white/80 font-semibold tracking-[0.3px] cursor-help",title:`${u} instances share this definition`,children:["x",u]})})]})}),vx=c.memo(function({label:t,selected:n,isCompact:o,isCompleted:r,isActive:s,isWaiting:i,isTargetConnectable:a,isSourceConnectable:l,onLabelChange:u,onDoubleClick:p,onEditEnd:g,labelRef:x,placeholder:w="Command",instanceCount:m,toolbar:d,quickCreateButtons:h}){const y=nt.command;return f.jsxs("div",{className:B("node-postit",y.gradient,y.rotate,"h-[112px] p-3 flex items-center justify-center","transition-shadow duration-200 hover:scale-[1.02]",o?"w-8 [&_.node-content]:hidden [&_.top-left-tags]:hidden [&::before]:left-[10%] [&::before]:right-[10%] [&::before]:h-1.5":"w-[152px]",n&&`node-selected ${y.selected}`,r&&"bg-success! node-completed",s&&"animate-pulse-success",i&&y.pulse),onDoubleClick:p,children:[d,h,f.jsx(K,{type:"target",position:G.Top,id:"target-top",className:"node-handle node-handle-horizontal",isConnectable:a}),f.jsx(K,{type:"target",position:G.Bottom,id:"target-bottom",className:"node-handle node-handle-horizontal",isConnectable:a}),f.jsx(K,{type:"target",position:G.Left,id:"target-left",className:"node-handle node-handle-vertical",isConnectable:a}),f.jsx(K,{type:"target",position:G.Right,id:"target-right",className:"node-handle node-handle-vertical",isConnectable:a}),f.jsx(K,{type:"source",position:G.Top,id:"source-top",className:"node-handle node-handle-horizontal",isConnectable:l}),f.jsx(K,{type:"source",position:G.Bottom,id:"source-bottom",className:"node-handle node-handle-horizontal",isConnectable:l}),f.jsx(K,{type:"source",position:G.Left,id:"source-left",className:"node-handle node-handle-vertical",isConnectable:l}),f.jsx(K,{type:"source",position:G.Right,id:"source-right",className:"node-handle node-handle-vertical",isConnectable:l}),f.jsx("div",{className:"node-content p-0 text-center w-full h-full flex flex-col items-center justify-center",children:f.jsx(Ae,{ref:x,value:t,onChange:u,placeholder:w,onEditEnd:g})}),m&&m>1&&f.jsx("div",{className:"top-left-tags absolute top-1 left-1 flex gap-[3px] z-10",children:f.jsxs("span",{className:"text-[0.4rem] px-[5px] py-0.5 rounded-[3px] bg-black/30 text-white/80 font-semibold tracking-[0.3px] cursor-help",title:`${m} instances share this definition`,children:["x",m]})})]})}),wx=c.memo(function({label:t,selected:n,isCompleted:o,isActive:r,isWaiting:s,isTargetConnectable:i,isSourceConnectable:a,onLabelChange:l,placeholder:u="Policy",instanceCount:p,toolbar:g,quickCreateButtons:x,children:w}){const m=nt.policy;return f.jsxs("div",{className:B("node-postit",m.gradient,m.rotate,"w-[152px] h-[112px] p-3 flex items-center justify-center","transition-shadow duration-200 hover:scale-[1.02]",n&&`node-selected ${m.selected}`,o&&"bg-success! node-completed",r&&"animate-pulse-success",s&&m.pulse),children:[g,x,f.jsx(K,{type:"target",position:G.Top,id:"target-top",className:"node-handle node-handle-horizontal",isConnectable:i}),f.jsx(K,{type:"target",position:G.Bottom,id:"target-bottom",className:"node-handle node-handle-horizontal",isConnectable:i}),f.jsx(K,{type:"target",position:G.Left,id:"target-left",className:"node-handle node-handle-vertical",isConnectable:i}),f.jsx(K,{type:"target",position:G.Right,id:"target-right",className:"node-handle node-handle-vertical",isConnectable:i}),a!==void 0&&f.jsxs(f.Fragment,{children:[f.jsx(K,{type:"source",position:G.Top,id:"source-top",className:"node-handle node-handle-horizontal",isConnectable:a}),f.jsx(K,{type:"source",position:G.Bottom,id:"source-bottom",className:"node-handle node-handle-horizontal",isConnectable:a}),f.jsx(K,{type:"source",position:G.Left,id:"source-left",className:"node-handle node-handle-vertical",isConnectable:a}),f.jsx(K,{type:"source",position:G.Right,id:"source-right",className:"node-handle node-handle-vertical",isConnectable:a})]}),f.jsx("div",{className:"p-0 text-center w-full h-full flex flex-col items-center justify-center",children:f.jsx(Ae,{value:t,onChange:l,placeholder:u})}),p&&p>1&&f.jsx("div",{className:"absolute top-1 left-1 flex gap-[3px] z-10",children:f.jsxs("span",{className:"text-[0.4rem] px-[5px] py-0.5 rounded-[3px] bg-black/30 text-white/80 font-semibold tracking-[0.3px] cursor-help",title:`${p} instances share this definition`,children:["x",p]})}),w]})}),yx=c.memo(function({label:t,selected:n,isCompact:o,isCompleted:r,isActive:s,isWaiting:i,isTargetConnectable:a,isSourceConnectable:l,onLabelChange:u,onDoubleClick:p,onEditEnd:g,labelRef:x,placeholder:w="Trigger",instanceCount:m,toolbar:d,quickCreateButtons:h,playButton:y}){const v=nt.trigger;return f.jsxs("div",{className:B("node-postit",v.gradient,v.rotate,"h-[112px] p-3 flex items-center justify-center","transition-shadow duration-200 hover:scale-[1.02]",o?"w-8 [&_.node-content]:hidden [&_.top-left-tags]:hidden [&::before]:left-[10%] [&::before]:right-[10%] [&::before]:h-1.5 [&_.play-btn]:right-auto [&_.play-btn]:left-1/2 [&_.play-btn]:-translate-x-1/2":"w-[152px]",n&&`node-selected ${v.selected}`,r&&"bg-success! node-completed",s&&"animate-pulse-success",i&&v.pulse),onDoubleClick:p,children:[d,h,f.jsx(K,{type:"target",position:G.Top,id:"target-top",className:"node-handle node-handle-horizontal",isConnectable:a}),f.jsx(K,{type:"target",position:G.Bottom,id:"target-bottom",className:"node-handle node-handle-horizontal",isConnectable:a}),f.jsx(K,{type:"target",position:G.Left,id:"target-left",className:"node-handle node-handle-vertical",isConnectable:a}),f.jsx(K,{type:"target",position:G.Right,id:"target-right",className:"node-handle node-handle-vertical",isConnectable:a}),f.jsx(K,{type:"source",position:G.Top,id:"source-top",className:"node-handle node-handle-horizontal",isConnectable:l}),f.jsx(K,{type:"source",position:G.Bottom,id:"source-bottom",className:"node-handle node-handle-horizontal",isConnectable:l}),f.jsx(K,{type:"source",position:G.Left,id:"source-left",className:"node-handle node-handle-vertical",isConnectable:l}),f.jsx(K,{type:"source",position:G.Right,id:"source-right",className:"node-handle node-handle-vertical",isConnectable:l}),f.jsx("div",{className:"node-content p-0 text-center w-full h-full flex flex-col items-center justify-center",children:f.jsx(Ae,{ref:x,value:t,onChange:u,placeholder:w,onEditEnd:g})}),y,m&&m>1&&f.jsx("div",{className:"top-left-tags absolute top-1 left-1 flex gap-[3px] z-10",children:f.jsxs("span",{className:"text-[0.4rem] px-[5px] py-0.5 rounded-[3px] bg-black/30 text-white/80 font-semibold tracking-[0.3px] cursor-help",title:`${m} instances share this definition`,children:["x",m]})})]})}),bx=c.memo(function({label:t,selected:n,isCompact:o,isCompleted:r,isActive:s,isWaiting:i,isTargetConnectable:a,isSourceConnectable:l,onLabelChange:u,onDoubleClick:p,onEditEnd:g,labelRef:x,placeholder:w="External System",instanceCount:m,toolbar:d,quickCreateButtons:h,playButton:y}){const v=nt.externalSystem;return f.jsxs("div",{className:B("node-postit",v.gradient,v.rotate,"h-[112px] p-3 flex items-center justify-center","transition-shadow duration-200 hover:scale-[1.02]",o?"w-8 [&_.node-content]:hidden [&_.top-left-tags]:hidden [&::before]:left-[10%] [&::before]:right-[10%] [&::before]:h-1.5 [&_.play-btn]:right-auto [&_.play-btn]:left-1/2 [&_.play-btn]:-translate-x-1/2":"w-[152px]",n&&`node-selected ${v.selected}`,r&&"bg-success! node-completed",s&&"animate-pulse-success",i&&v.pulse),onDoubleClick:p,children:[d,h,f.jsx(K,{type:"target",position:G.Top,id:"target-top",className:"node-handle node-handle-horizontal",isConnectable:a}),f.jsx(K,{type:"target",position:G.Bottom,id:"target-bottom",className:"node-handle node-handle-horizontal",isConnectable:a}),f.jsx(K,{type:"target",position:G.Left,id:"target-left",className:"node-handle node-handle-vertical",isConnectable:a}),f.jsx(K,{type:"target",position:G.Right,id:"target-right",className:"node-handle node-handle-vertical",isConnectable:a}),f.jsx(K,{type:"source",position:G.Top,id:"source-top",className:"node-handle node-handle-horizontal",isConnectable:l}),f.jsx(K,{type:"source",position:G.Bottom,id:"source-bottom",className:"node-handle node-handle-horizontal",isConnectable:l}),f.jsx(K,{type:"source",position:G.Left,id:"source-left",className:"node-handle node-handle-vertical",isConnectable:l}),f.jsx(K,{type:"source",position:G.Right,id:"source-right",className:"node-handle node-handle-vertical",isConnectable:l}),f.jsx("div",{className:"node-content p-0 text-center w-full h-full flex flex-col items-center justify-center",children:f.jsx(Ae,{ref:x,value:t,onChange:u,placeholder:w,onEditEnd:g})}),y,m&&m>1&&f.jsx("div",{className:"top-left-tags absolute top-1 left-1 flex gap-[3px] z-10",children:f.jsxs("span",{className:"text-[0.4rem] px-[5px] py-0.5 rounded-[3px] bg-black/30 text-white/80 font-semibold tracking-[0.3px] cursor-help",title:`${m} instances share this definition`,children:["x",m]})})]})}),Ex=c.memo(function({label:t,selected:n,isCompact:o,isCompleted:r,isActive:s,isWaiting:i,isTargetConnectable:a,isSourceConnectable:l,onLabelChange:u,onDoubleClick:p,onEditEnd:g,labelRef:x,placeholder:w="External Event",instanceCount:m,toolbar:d,quickCreateButtons:h,playButton:y}){const v=nt.externalEvent;return f.jsxs("div",{className:B("node-postit",v.gradient,v.rotate,"h-[112px] p-3 flex items-center justify-center","transition-shadow duration-200 hover:scale-[1.02]",o?"w-8 [&_.node-content]:hidden [&_.top-left-tags]:hidden [&::before]:left-[10%] [&::before]:right-[10%] [&::before]:h-1.5 [&_.play-btn]:right-auto [&_.play-btn]:left-1/2 [&_.play-btn]:-translate-x-1/2":"w-[152px]",n&&`node-selected ${v.selected}`,r&&"bg-success! node-completed",s&&"animate-pulse-success",i&&v.pulse),onDoubleClick:p,children:[d,h,f.jsx(K,{type:"target",position:G.Top,id:"target-top",className:"node-handle node-handle-horizontal",isConnectable:a}),f.jsx(K,{type:"target",position:G.Bottom,id:"target-bottom",className:"node-handle node-handle-horizontal",isConnectable:a}),f.jsx(K,{type:"target",position:G.Left,id:"target-left",className:"node-handle node-handle-vertical",isConnectable:a}),f.jsx(K,{type:"target",position:G.Right,id:"target-right",className:"node-handle node-handle-vertical",isConnectable:a}),f.jsx(K,{type:"source",position:G.Top,id:"source-top",className:"node-handle node-handle-horizontal",isConnectable:l}),f.jsx(K,{type:"source",position:G.Bottom,id:"source-bottom",className:"node-handle node-handle-horizontal",isConnectable:l}),f.jsx(K,{type:"source",position:G.Left,id:"source-left",className:"node-handle node-handle-vertical",isConnectable:l}),f.jsx(K,{type:"source",position:G.Right,id:"source-right",className:"node-handle node-handle-vertical",isConnectable:l}),f.jsx("div",{className:"node-content p-0 text-center w-full h-full flex flex-col items-center justify-center",children:f.jsx(Ae,{ref:x,value:t,onChange:u,placeholder:w,onEditEnd:g})}),y,m&&m>1&&f.jsx("div",{className:"top-left-tags absolute top-1 left-1 flex gap-[3px] z-10",children:f.jsxs("span",{className:"text-[0.4rem] px-[5px] py-0.5 rounded-[3px] bg-black/30 text-white/80 font-semibold tracking-[0.3px] cursor-help",title:`${m} instances share this definition`,children:["x",m]})})]})}),Cx=c.memo(function({label:t,selected:n,description:o,onLabelChange:r,placeholder:s="HotSpot",instanceCount:i,toolbar:a}){const l=nt.hotspot;return f.jsxs("div",{className:B("node-postit",l.gradient,l.rotate,"w-[152px] h-[112px] p-3 flex items-center justify-center","transition-shadow duration-200 hover:scale-[1.02]",n&&`node-selected ${l.selected}`),children:[a,f.jsxs("div",{className:"p-0 text-center w-full h-full flex flex-col items-center justify-center",children:[f.jsx(Ae,{value:t,onChange:r,placeholder:s}),o&&f.jsx("div",{className:"text-[0.6rem] text-black/70 mt-1 text-center overflow-hidden line-clamp-2 leading-[1.2]",children:o})]}),i&&i>1&&f.jsx("div",{className:"absolute top-1 left-1 flex gap-[3px] z-10",children:f.jsxs("span",{className:"text-[0.4rem] px-[5px] py-0.5 rounded-[3px] bg-black/30 text-white/80 font-semibold tracking-[0.3px] cursor-help",title:`${i} instances share this definition`,children:["x",i]})})]})}),Tx=c.memo(function({label:t,selected:n,isCompleted:o,isActive:r,isTargetConnectable:s,isSourceConnectable:i,onLabelChange:a,placeholder:l="Actor",toolbar:u,quickCreateButtons:p}){return f.jsxs("div",{className:B("node-postit gradient-actor rotate-actor","w-[152px] h-[112px] p-3 flex items-center justify-center","transition-shadow duration-200 hover:scale-[1.02]",n&&"node-selected node-selected-actor",o&&"bg-success! node-completed",r&&"animate-pulse-actor"),children:[u,p,s!==void 0&&f.jsxs(f.Fragment,{children:[f.jsx(K,{type:"target",position:G.Top,id:"target-top",className:"node-handle node-handle-horizontal",isConnectable:s}),f.jsx(K,{type:"target",position:G.Bottom,id:"target-bottom",className:"node-handle node-handle-horizontal",isConnectable:s}),f.jsx(K,{type:"target",position:G.Left,id:"target-left",className:"node-handle node-handle-vertical",isConnectable:s}),f.jsx(K,{type:"target",position:G.Right,id:"target-right",className:"node-handle node-handle-vertical",isConnectable:s})]}),i!==void 0&&f.jsxs(f.Fragment,{children:[f.jsx(K,{type:"source",position:G.Top,id:"source-top",className:"node-handle node-handle-horizontal",isConnectable:i}),f.jsx(K,{type:"source",position:G.Bottom,id:"source-bottom",className:"node-handle node-handle-horizontal",isConnectable:i}),f.jsx(K,{type:"source",position:G.Left,id:"source-left",className:"node-handle node-handle-vertical",isConnectable:i}),f.jsx(K,{type:"source",position:G.Right,id:"source-right",className:"node-handle node-handle-vertical",isConnectable:i})]}),f.jsx("div",{className:"p-0 text-center w-full h-full flex flex-col items-center justify-center",children:f.jsx(Ae,{value:t,onChange:a,placeholder:l})})]})}),_x=c.memo(function({label:t,selected:n,onLabelChange:o,placeholder:r="Note",toolbar:s}){return f.jsxs("div",{className:B("node-postit gradient-note rotate-note","w-[152px] h-[112px] p-3 flex items-center justify-center","transition-shadow duration-200 hover:scale-[1.02]",n&&"node-selected node-selected-note"),children:[s,f.jsx("div",{className:"p-0 text-center w-full h-full flex flex-col items-center justify-center",children:f.jsx(Ae,{value:t,onChange:o,placeholder:r})})]})}),hh=200,xh=150,Sx=c.memo(function({label:t,selected:n,onLabelChange:o,onResizeStart:r,onResize:s,onResizeEnd:i,placeholder:a="Group",toolbar:l,children:u}){const{zoom:p}=qc(),g=c.useRef(null),x=c.useRef(null),w=Math.min(8,Math.max(.7,1/p));return c.useEffect(()=>{if(g.current&&x.current){x.current.textContent=t||a;const m=x.current.offsetWidth;g.current.style.width=`${Math.max(60,m+4)}px`}},[t,a]),f.jsxs("div",{className:B("relative w-full h-full rounded-lg","border-[1.5px] border-[rgba(139,92,246,0.5)]"),style:{background:"radial-gradient(ellipse at center, transparent 30%, rgba(139,92,246,0.06) 100%)"},children:[f.jsx(Jc,{minWidth:hh,minHeight:xh,isVisible:!0,lineClassName:"group-resize-line !z-[1000]",handleClassName:"group-resize-handle !z-[1000]",onResizeStart:()=>r==null?void 0:r(),onResize:(m,d)=>s==null?void 0:s(d.width,d.height),onResizeEnd:(m,d)=>i==null?void 0:i(d.width,d.height)}),l,f.jsxs("div",{className:B("absolute z-10 origin-bottom-left"),style:{top:`${-10*w-20}px`,left:"8px",transform:`scale(${w})`},children:[f.jsx("span",{ref:x,className:"absolute invisible whitespace-pre text-sm font-semibold","aria-hidden":"true"}),f.jsx("input",{ref:g,type:"text",value:t,onChange:m=>o(m.target.value),placeholder:a,className:B("bg-transparent border-none outline-none","text-sm font-semibold","min-w-[60px]","text-[rgba(139,92,246,0.7)] placeholder:text-[rgba(139,92,246,0.4)]")})]}),f.jsx("div",{className:"w-full h-full pointer-events-none",children:u})]})}),Rx="w-4 h-4",Nx=10,vh=B("w-7 h-7 rounded-md flex items-center justify-center","border-none cursor-pointer","transition-all duration-150","hover:scale-110 active:scale-95","focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-1 focus-visible:ring-text-primary"),wh=B("p-1.5 rounded","transition-colors","focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-1"),Px=B("flex items-center gap-1.5 p-1.5 rounded-lg","bg-bg-secondary/95 backdrop-blur-sm","border border-border shadow-[var(--shadow-toolbar)]"),Mx=B("flex gap-1 bg-white rounded-lg shadow-lg p-1 border border-gray-200","dark:bg-bg-secondary dark:border-border");function kx(e){return B(vh,{default:"bg-text-muted/20 text-text-secondary hover:bg-text-muted/30",danger:"bg-danger/20 text-danger hover:bg-danger/30",info:"bg-info/20 text-info hover:bg-info/30",accent:"bg-accent/20 text-accent hover:bg-accent/30",event:"bg-node-event/20 text-node-event hover:bg-node-event/30",trigger:"bg-node-trigger/20 text-node-trigger hover:bg-node-trigger/30",command:"bg-node-command/20 text-node-command hover:bg-node-command/30"}[e])}function Ix(e){return B(wh,{default:"text-gray-500 hover:bg-gray-50 hover:text-gray-700 dark:hover:bg-text-muted/20 dark:hover:text-text-primary",danger:"text-gray-500 hover:bg-red-50 hover:text-red-500 dark:hover:bg-danger/20 dark:hover:text-danger",purple:"text-gray-500 hover:bg-purple-50 hover:text-purple-500 dark:hover:bg-node-policy/20 dark:hover:text-node-policy"}[e])}function yh(){const{getNode:e}=Rt(),{addNode:t,onConnect:n}=mn(),o=c.useCallback((s,i=!1)=>{const l=Un[i?"policy":s];return l?[...l.canConnectTo]:[]},[]),r=c.useCallback((s,i,a)=>{var h,y;const l=e(s);if(!l)return;const u=l.parentId?e(l.parentId):void 0,p=Fl(l.position,u==null?void 0:u.position),g=((h=l.measured)==null?void 0:h.width)??Bl,x=((y=l.measured)==null?void 0:y.height)??Vl,w=Kl(p,g,x,a),m=t(i,w),d=Ul(a);n({source:s,target:m,sourceHandle:d.source,targetHandle:d.target})},[e,t,n]);return{getValidTargetTypes:o,createConnectedNode:r}}const bh={event:{label:"Event",Icon:Yr},command:{label:"Command",Icon:yl},policy:{label:"Policy",Icon:ul},trigger:{label:"Trigger",Icon:bo},externalSystem:{label:"Ext System",Icon:Zo},externalEvent:{label:"Ext Event",Icon:Zo}},Eh={event:"bg-node-event text-postit-text",command:"bg-[#3b82f6] text-white",policy:"bg-node-policy text-postit-text",trigger:"bg-node-trigger text-postit-text",externalSystem:"bg-node-external text-postit-text",externalEvent:"bg-node-external text-postit-text"};function Ch({validTypes:e,anchorPosition:t,direction:n,onSelect:o,onClose:r,typeConfig:s,getIconColorClass:i}){const a=c.useRef(null);fh({ref:a,onClose:r});const u=c.useCallback(()=>{const h=e.length*44+8,y=10,v=8;let b,E;switch(n){case"top":b=t.x-180/2,E=t.y-h-v;break;case"bottom":b=t.x-180/2,E=t.y+v;break;case"left":b=t.x-180-v,E=t.y-h/2;break;case"right":b=t.x+v,E=t.y-h/2;break}return b+180>window.innerWidth-y&&(b=window.innerWidth-180-y),E+h>window.innerHeight-y&&(E=window.innerHeight-h-y),b<y&&(b=y),E<y&&(E=y),{x:b,y:E}},[t,n,e.length])(),p=c.useMemo(()=>{if(!e.includes("event"))return e;const d=e.filter(y=>y!=="event"),h=Math.floor(d.length/2);return[...d.slice(0,h),"event",...d.slice(h)]},[e]),g=c.useCallback(d=>{o(d),r()},[o,r]),x=c.useCallback(d=>s&&d in s?s[d]:bh[d]??{label:d,Icon:Yr},[s]),w=c.useCallback(d=>i?i(d):Eh[d]??"bg-gray-500 text-white",[i]);if(p.length===0)return null;const m=f.jsx("div",{ref:a,className:B("fixed bg-bg-secondary border border-border rounded-lg","shadow-[0_4px_16px_rgba(0,0,0,0.3)] p-1 z-[10000] min-w-[160px]","animate-zoom-in","light:bg-white light:shadow-[0_4px_16px_rgba(0,0,0,0.15)]"),style:{left:u.x,top:u.y},children:p.map(d=>{const h=x(d);return f.jsxs("button",{className:B("flex items-center gap-2.5 py-2 px-3 rounded-md","cursor-pointer transition-colors duration-100","text-text-primary border-none bg-transparent w-full text-[13px]","hover:bg-bg-tertiary active:scale-[0.98]"),onClick:()=>g(d),children:[f.jsx("span",{className:B("w-6 h-6 rounded flex items-center justify-center shrink-0","[&_svg]:w-3.5 [&_svg]:h-3.5",w(d)),children:f.jsx(h.Icon,{})}),f.jsx("span",{className:"flex-1 text-left",children:h.label})]},d)})});return Nt.createPortal(m,document.body)}const Th=c.memo(Ch),_h=c.memo(function({outcomeId:t,canDelete:n,onDelete:o}){const r=c.useCallback(s=>{s.stopPropagation(),n&&o(t)},[t,n,o]);return f.jsx(Zc,{position:G.Top,offset:10,className:B("flex items-center gap-1.5 p-1.5 rounded-lg","bg-bg-secondary/95 backdrop-blur-sm","border border-border shadow-[var(--shadow-toolbar)]"),children:f.jsx("button",{className:B("w-7 h-7 rounded-md flex items-center justify-center","border-none cursor-pointer transition-all duration-150","hover:scale-110 active:scale-95","bg-danger/20 text-danger hover:bg-danger/30","disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100"),onClick:r,disabled:!n,title:n?"Delete outcome":"Cannot delete - minimum 2 outcomes required",children:f.jsx(Kc,{className:"w-4 h-4"})})})}),Ax=c.memo(function({id:t,data:n,selected:o}){const r=Qc(),s=o||r.inProgress,{state:i,selectTransition:a,isRunning:l,start:u,triggerNode:p}=xu(),{getOutcomeTransition:g,updateOutcomeLabel:x,deleteOutcome:w,getOutcomesForPolicy:m}=mn(),h=(n.parentPolicyDefId?i==null?void 0:i.nodeStates.get(n.parentPolicyDefId):void 0)==="waiting_for_action",y=t,v=g(y),b=!!v,C=m(n.parentPolicyInstanceId).length>2,R=c.useCallback(S=>{C&&w(S)},[C,w]),k=c.useCallback(S=>{S.stopPropagation(),!(!v||!n.parentPolicyDefId)&&(h?a(v):l?(p(n.parentPolicyDefId),setTimeout(()=>{a(v)},50)):(u(),setTimeout(()=>{p(n.parentPolicyDefId),setTimeout(()=>{a(v)},50)},10)))},[v,n.parentPolicyDefId,h,l,u,p,a]),N=c.useCallback(S=>{x(t,S)},[t,x]);return f.jsxs("div",{className:B("gradient-outcome border border-node-policy/50 rounded-md","w-auto h-auto min-w-[50px] min-h-8 p-0","shadow-[0_2px_4px_rgba(0,0,0,0.3)] transition-all duration-200","hover:scale-[1.02]",o&&"node-selected node-selected-outcome shadow-[0_0_8px_rgba(147,51,234,0.8)] border-node-policy",h&&"gradient-outcome-clickable border-node-policy cursor-pointer animate-pulse-outcome hover:scale-[1.08] hover:shadow-[0_0_12px_rgba(147,51,234,0.9)]"),children:[f.jsx(_h,{outcomeId:y,canDelete:C,onDelete:R}),o&&f.jsx(kh,{instanceId:y,nodeType:"policy",isOutcome:!0}),f.jsx(K,{type:"source",position:G.Top,id:"source-top",className:"node-handle node-handle-horizontal",isConnectable:s}),f.jsx(K,{type:"source",position:G.Bottom,id:"source-bottom",className:"node-handle node-handle-horizontal",isConnectable:s}),f.jsx(K,{type:"source",position:G.Left,id:"source-left",className:"node-handle node-handle-vertical",isConnectable:s}),f.jsx(K,{type:"source",position:G.Right,id:"source-right",className:"node-handle node-handle-vertical",isConnectable:s}),f.jsxs("div",{className:"flex flex-row items-center gap-1.5 py-1 px-2",children:[f.jsx("button",{className:B("w-[18px] h-[18px] rounded-full border flex items-center justify-center","shadow-[0_1px_3px_rgba(0,0,0,0.2)] transition-all duration-200 p-0 outline-none shrink-0",b?"bg-node-policy border-white/30 text-white cursor-pointer hover:scale-[1.15] hover:bg-[#a855f7] hover:border-white/50":"bg-node-policy/40 border-white/20 text-white/50 cursor-default"),onClick:k,disabled:!b,title:b?h?`Select ${n.label}`:`Trigger from ${n.label}`:"Connect this outcome to enable",children:f.jsx(bo,{className:"w-2.5 h-2.5"})}),f.jsx(Ae,{value:n.label,onChange:N,placeholder:"Outcome",autoSize:!0,className:"text-white [.light_&]:text-postit-text"})]})]})}),Sh=["right"];function Rh(e){switch(e){case"top":return"top-[-28px] left-1/2 -translate-x-1/2 hover:-translate-x-1/2";case"right":return"right-[-28px] top-1/2 -translate-y-1/2 hover:-translate-y-1/2";case"bottom":return"bottom-[-28px] left-1/2 -translate-x-1/2 hover:-translate-x-1/2";case"left":return"left-[-28px] top-1/2 -translate-y-1/2 hover:-translate-y-1/2"}}function Nh(e){return B("absolute rounded-full border-2 border-border","cursor-pointer flex items-center justify-center text-sm font-bold","pointer-events-auto p-0 transition-all duration-150 z-[5]","shadow-[0_2px_4px_rgba(0,0,0,0.3)]","focus:outline-none focus-visible:outline-2 focus-visible:outline-text-primary focus-visible:outline-offset-2","hover:scale-[1.2] hover:shadow-[0_3px_8px_rgba(0,0,0,0.4)] active:scale-110","dark:bg-[#e0e0e8] dark:border-[#d0d0d8] dark:text-[#1e1e3a]","dark:hover:bg-[#5a5a7a] dark:hover:border-[#f0f0f8] dark:hover:text-[#f0f0f8]","bg-[#6a6a8a] border-[#7a7a9a] text-white shadow-[0_2px_4px_rgba(0,0,0,0.15)]","hover:bg-[#5a5a7a] hover:border-white hover:text-white",e?"w-4 h-4":"w-5 h-5")}function Ph({validTypes:e,isCompact:t=!1,onCreateNode:n,renderMenu:o,directions:r=Sh}){const[s,i]=c.useState(!1),[a,l]=c.useState(null),[u,p]=c.useState(null),g=c.useRef({top:null,right:null,bottom:null,left:null}),x=c.useCallback((h,y)=>{if(y.stopPropagation(),e.length===1){n(e[0],h);return}const v=g.current[h];if(!v)return;const b=v.getBoundingClientRect();p({x:b.x+b.width/2,y:b.y+b.height/2}),l(h),i(!0)},[e,n]),w=c.useCallback(h=>{a&&(n(h,a),i(!1),l(null))},[a,n]),m=c.useCallback(()=>{i(!1),l(null)},[]);if(e.length===0)return null;const d=Nh(t);return f.jsxs(f.Fragment,{children:[f.jsx("div",{className:"absolute top-0 left-0 w-full h-full pointer-events-none",children:r.map(h=>f.jsx("button",{ref:y=>{g.current[h]=y},className:B(d,Rh(h),"nodrag nopan"),onClick:y=>x(h,y),"aria-label":`Create node ${h==="top"?"above":h==="bottom"?"below":`to the ${h}`}`,title:"Add connected node",children:f.jsx(Xc,{className:"w-3 h-3"})},h))}),s&&u&&a&&o({validTypes:e,anchorPosition:u,direction:a,onSelect:w,onClose:m})]})}const Mh=c.memo(Ph),kh=c.memo(function({instanceId:t,nodeType:n,isOutcome:o=!1,isCompact:r=!1}){const{getValidTargetTypes:s,createConnectedNode:i}=yh(),a=s(n,o),l=c.useCallback((p,g)=>{i(t,p,g)},[t,i]),u=c.useCallback(p=>f.jsx(Th,{...p}),[]);return f.jsx(Mh,{validTypes:a,isCompact:r,onCreateNode:l,renderMenu:u})});function Ox({id:e,source:t,sourceX:n,sourceY:o,targetX:r,targetY:s,sourcePosition:i,targetPosition:a,selected:l,markerEnd:u,markerStart:p,data:g,simulationState:x,isRunning:w,start:m,triggerNode:d,selectTransition:h,getSourceDefinitionId:y}){const v=g,b=(v==null?void 0:v.state)||"idle",E=(v==null?void 0:v.progress)||0,C=(v==null?void 0:v.labelOffset)??.5,R=v==null?void 0:v.transitionId,k=(v==null?void 0:v.isNonStandard)||!1,N=v==null?void 0:v.sourceKind,S=v==null?void 0:v.targetKind,{setEdges:z}=Rt(),{showTooltip:D,hideTooltip:A,setHoveredWarningEdgeId:F}=ds(),T=c.useRef(null),[M,P]=c.useState({x:0,y:0}),[L,I]=c.useState({x:0,y:0}),[_,$]=c.useState(0),X=c.useRef(void 0),U=c.useCallback((ne,Se)=>{z(se=>se.map(he=>he.id===ne?{...he,data:{...he.data,labelOffset:Se}}:he))},[z]),{isDragging:q,hasDraggedRef:J,handleDragStart:Q}=Yu({pathRef:T,edgeId:e,onOffsetChange:U}),te=y(t),O=(te?x==null?void 0:x.nodeStates.get(te):void 0)==="waiting_for_action",j=c.useMemo(()=>({isRunning:w,start:m,triggerNode:d,selectTransition:h}),[w,m,d,h]),V=c.useMemo(()=>({isSourceWaiting:O}),[O]),{execute:Y}=dh(j,V),Z=qr(n,o,r,s,i,a);c.useLayoutEffect(()=>{if(T.current){const ne=T.current.getTotalLength();$(ne)}},[Z]),c.useLayoutEffect(()=>{if(T.current&&_>0){const ne=T.current.getPointAtLength(_*C);I({x:ne.x,y:ne.y})}},[_,C]),c.useEffect(()=>{if(b!=="animating"||!T.current)return;const ne=T.current,Se=ne.getTotalLength(),se=()=>{const he=(v==null?void 0:v.progress)||0,jt=ne.getPointAtLength(Se*he);P({x:jt.x,y:jt.y}),he<1&&(X.current=requestAnimationFrame(se))};return X.current=requestAnimationFrame(se),()=>{X.current&&cancelAnimationFrame(X.current)}},[b,v==null?void 0:v.progress]);const re=c.useCallback(ne=>{ne.stopPropagation(),ne.preventDefault(),!J.current&&(!R||!te||Y(te,R))},[R,te,Y,J]),ce=_*(1-E),me=!!R,ge=me;return c.useEffect(()=>{if(l&&k&&N&&S)return F(e),D({edgeId:e,sourceKind:N,targetKind:S,targetPosition:{x:r,y:s}}),()=>{F(null),A()}},[l,k,N,S,e,r,s,D,A,F]),f.jsxs(f.Fragment,{children:[!k&&f.jsx("path",{d:Z,fill:"none",stroke:b==="executed"?"#22c55e":"oklch(55% 0.18 303)",strokeWidth:16,strokeLinecap:"butt",style:{opacity:.15,pointerEvents:"none"}}),f.jsx(Ur,{id:e,path:Z,markerEnd:u,markerStart:p,className:[b==="idle"&&!l?"animate-dash-flow":"",k?"non-standard":""].filter(Boolean).join(" ")||void 0,style:{strokeDasharray:b==="idle"&&!l?"5 5":"none",opacity:b==="executed"?0:1}}),f.jsx("path",{ref:T,d:Z,fill:"none",stroke:"transparent",strokeWidth:0}),(b==="animating"||b==="executed"||b==="waiting_at_label")&&_>0&&f.jsx("path",{d:Z,fill:"none",stroke:"#22c55e",strokeWidth:2,style:{strokeDasharray:b!=="executed"?_:"none",strokeDashoffset:b!=="executed"?ce:0}}),b==="animating"&&f.jsxs(f.Fragment,{children:[f.jsx("circle",{cx:M.x,cy:M.y,r:10,fill:"rgba(34, 197, 94, 0.3)"}),f.jsx("circle",{cx:M.x,cy:M.y,r:6,fill:"#22c55e",style:{filter:"drop-shadow(0 0 4px rgba(34, 197, 94, 0.6))"}})]}),b==="waiting_at_label"&&f.jsxs(f.Fragment,{children:[f.jsx("circle",{cx:L.x,cy:L.y,r:10,fill:"rgba(34, 197, 94, 0.3)",className:"animate-ball-fade-out"}),f.jsx("circle",{cx:L.x,cy:L.y,r:6,fill:"#22c55e",className:"animate-ball-fade-out",style:{filter:"drop-shadow(0 0 4px rgba(34, 197, 94, 0.6))"}})]}),l&&f.jsxs(f.Fragment,{children:[f.jsx(Dr,{x:n,y:o}),f.jsx(Dr,{x:r,y:s})]}),f.jsx(el,{children:f.jsx("div",{className:B("absolute cursor-grab select-none z-[1000] nodrag nopan",q&&"cursor-grabbing",O&&"[&_.play-btn]:animate-button-pulse"),style:{position:"absolute",transform:`translate(-50%, -50%) translate(${L.x}px, ${L.y}px)`,pointerEvents:"all"},onMouseDown:Q,children:f.jsx("button",{className:B("play-btn w-[18px] h-[18px] rounded-full flex items-center justify-center p-0 outline-none shrink-0","shadow-[0_1px_3px_rgba(0,0,0,0.2)] transition-all duration-200",ge?"bg-[#3b82f6] border border-white/30 text-white cursor-pointer hover:scale-[1.15] hover:bg-[#60a5fa] hover:border-white/50":"bg-[#3b82f6]/40 border border-white/20 text-white/50 cursor-default"),onClick:re,disabled:!ge,title:me?O?"Select this path":"Trigger command":"No transition connected",children:f.jsx(bo,{className:"w-2.5 h-2.5"})})})})]})}function Dr({x:e,y:t}){return f.jsx("circle",{cx:e,cy:t,r:6,fill:"oklch(40% 0.18 303)",stroke:"#fff",strokeWidth:2,style:{cursor:"grab",filter:"drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3))"}})}function Dx({id:e,sourceX:t,sourceY:n,targetX:o,targetY:r,sourcePosition:s,targetPosition:i,selected:a,markerEnd:l,markerStart:u,data:p}){const{theme:g}=Xu(),{showTooltip:x,hideTooltip:w,setHoveredWarningEdgeId:m}=ds(),d=p,h=(d==null?void 0:d.state)||"idle",y=(d==null?void 0:d.progress)||0,v=(d==null?void 0:d.isNonStandard)||!1,b=d==null?void 0:d.sourceKind,E=d==null?void 0:d.targetKind,C=c.useRef(null),[R,k]=c.useState({x:0,y:0}),[N,S]=c.useState(0),z=c.useRef(void 0),D=qr(t,n,o,r,s,i);c.useLayoutEffect(()=>{if(C.current){const F=C.current.getTotalLength();S(F)}},[D]),c.useEffect(()=>{if(h!=="animating"||!C.current)return;const F=C.current,T=F.getTotalLength(),M=()=>{const P=(d==null?void 0:d.progress)||0,L=F.getPointAtLength(T*P);k({x:L.x,y:L.y}),P<1&&(z.current=requestAnimationFrame(M))};return z.current=requestAnimationFrame(M),()=>{z.current&&cancelAnimationFrame(z.current)}},[h,d==null?void 0:d.progress]);const A=N*(1-y);return c.useEffect(()=>{if(a&&v&&b&&E)return m(e),x({edgeId:e,sourceKind:b,targetKind:E,targetPosition:{x:o,y:r}}),()=>{m(null),w()}},[a,v,b,E,e,o,r,x,w,m]),f.jsxs(f.Fragment,{children:[!v&&f.jsx("path",{d:D,fill:"none",stroke:h==="executed"?"#22c55e":"oklch(55% 0.18 303)",strokeWidth:16,strokeLinecap:"butt",style:{opacity:.15,pointerEvents:"none"}}),f.jsx(Ur,{id:e,path:D,markerEnd:l,markerStart:u,className:[h==="idle"&&!a?"animate-dash-flow":"",v?"non-standard":""].filter(Boolean).join(" ")||void 0,style:{strokeDasharray:h==="idle"&&!a?"5 5":"none",opacity:h==="executed"?0:1}}),f.jsx("path",{ref:C,d:D,fill:"none",stroke:"transparent",strokeWidth:0}),(h==="animating"||h==="executed")&&N>0&&f.jsx("path",{d:D,fill:"none",stroke:"#22c55e",strokeWidth:2,style:{strokeDasharray:h==="animating"?N:"none",strokeDashoffset:h==="animating"?A:0}}),h==="animating"&&f.jsxs(f.Fragment,{children:[f.jsx("circle",{cx:R.x,cy:R.y,r:10,fill:"rgba(34, 197, 94, 0.3)"}),f.jsx("circle",{cx:R.x,cy:R.y,r:6,fill:"#22c55e",style:{filter:"drop-shadow(0 0 4px rgba(34, 197, 94, 0.6))"}})]}),a&&f.jsxs(f.Fragment,{children:[f.jsx(jr,{x:t,y:n,isLight:g==="light"}),f.jsx(jr,{x:o,y:r,isLight:g==="light"})]})]})}function jr({x:e,y:t,isLight:n}){const o=n?"#ffffff":"#1e1e3f",r=n?"oklch(45% 0.18 303)":"oklch(70% 0.15 303)";return f.jsx("circle",{cx:e,cy:t,r:6,fill:o,stroke:r,strokeWidth:2,style:{cursor:"grab",filter:"drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3))"}})}const Ih=()=>({activeTransitions:new Map,animationFrame:void 0,processedEvents:new Set,previousEventsLength:0,wasWaiting:new Map,animate:null}),Lr=1e3,Ah=500;function jx(e){const{setEdges:t,getEdges:n}=Rt(),o=c.useRef(Ih()),r=c.useCallback((a,l,u)=>{t(p=>p.map(g=>{const x=g.data;return(x==null?void 0:x.transitionId)===a?{...g,data:{...g.data,state:l,progress:u}}:g}))},[t]),s=c.useCallback(()=>{const a=o.current,l=Date.now();let u=!1;a.activeTransitions.forEach((p,g)=>{const x=l-p.startTime,w=p.targetProgress-p.startProgress,m=Math.min(x/p.duration,1),d=p.startProgress+m*w;m<1?(u=!0,r(g,"animating",d)):(p.targetProgress<1?(r(g,"waiting_at_label",p.targetProgress),a.wasWaiting.set(g,p.targetProgress)):r(g,"executed",1),a.activeTransitions.delete(g))}),u&&a.animate?a.animationFrame=requestAnimationFrame(a.animate):a.animationFrame=void 0},[r]);c.useEffect(()=>{o.current.animate=s},[s]);const i=c.useCallback(()=>{const a=o.current;a.animationFrame&&(cancelAnimationFrame(a.animationFrame),a.animationFrame=void 0),a.activeTransitions.clear(),a.processedEvents.clear(),a.wasWaiting.clear(),t(l=>l.map(u=>({...u,data:{...u.data,state:"idle",progress:0}})))},[t]);c.useEffect(()=>{const a=o.current;e.length===0&&a.previousEventsLength>0&&i(),a.previousEventsLength=e.length;let l=!1;e.forEach(u=>{var p,g,x;if(!a.processedEvents.has(u.id)){if(a.processedEvents.add(u.id),u.type==="transition:start"){const m=(p=u.data.transition)==null?void 0:p.id;if(!m)return;const d=a.wasWaiting.get(m),h=d!==void 0?d:0,y=d!==void 0?Lr*(1-d):Lr;a.wasWaiting.delete(m),a.activeTransitions.set(m,{transitionId:m,startTime:Date.now(),duration:y,startProgress:h,targetProgress:1}),r(m,"animating",h),l=!0}if(u.type==="transition:reset"){const m=(g=u.data.transition)==null?void 0:g.id;if(!m)return;a.activeTransitions.delete(m),r(m,"idle",0)}if(u.type==="simulation:reset"&&i(),u.type==="node:waiting"){const w=u.data;if(((x=w.node)==null?void 0:x.kind)!=="command")return;const m=w.availableTransitions||[],d=n();for(const h of m){const y=h.id,v=d.find(C=>{const R=C.data;return(R==null?void 0:R.transitionId)===y});if(!v)continue;const b=v.data,E=(b==null?void 0:b.labelOffset)??.5;a.activeTransitions.set(y,{transitionId:y,startTime:Date.now(),duration:Ah,startProgress:0,targetProgress:E}),r(y,"animating",0),l=!0}}}}),l&&!a.animationFrame&&(a.animationFrame=requestAnimationFrame(s))},[e,s,r,i,n]),c.useEffect(()=>{const a=o.current;return()=>{a.animationFrame&&cancelAnimationFrame(a.animationFrame)}},[])}export{yx as $,Zh as A,Wh as B,Kr as C,tx as D,ux as E,Lh as F,dx as G,zg as H,wg as I,px as J,Px as K,Nx as L,Fh as M,kx as N,Rx as O,hd as P,xx as Q,$h as R,zh as S,yl as T,Bh as U,kh as V,Qu as W,Xr as X,vx as Y,Yr as Z,wx as _,mu as a,bx as a0,Ex as a1,Cx as a2,_x as a3,Tx as a4,Ax as a5,Ox as a6,Dx as a7,ds as a8,jx as a9,Mx as aA,Ix as aB,Fl as aC,Bl as aD,Vl as aE,Kl as aF,Ul as aG,Th as aH,Mh as aI,mx as aJ,Sx as aK,dh as aL,_h as aM,Ae as aN,Vh as aO,pd as aP,Ku as aa,lx as ab,qh as ac,Xh as ad,ex as ae,Yh as af,Ll as ag,gt as ah,Yl as ai,Xt as aj,pn as ak,Qr as al,Zr as am,ht as an,ql as ao,ts as ap,Zl as aq,Fe as ar,ns as as,Kh as at,eu as au,Ql as av,tu as aw,os as ax,Jl as ay,hu as az,Gn as b,Ml as c,$e as d,rl as e,mn as f,Ft as g,Uh as h,Gh as i,gx as j,Qh as k,bo as l,Zo as m,Hh as n,wd as o,yd as p,bd as q,_d as r,Cd as s,yo as t,Ne as u,Td as v,xu as w,hx as x,Xu as y,Jh as z};
