import{j as e,b as g,c as I}from"./react-flow-ruwbRUGr.js";import{a as j,C as P,T as V,b as U,A as R,c as M}from"./ConceptionPage-BocKiW0k.js";import{c as S,a as v,T as q,j as H,X as F}from"./Toast-Bv7rl_JM.js";import{R as z}from"./style-tArnu08A.js";import"./ts-morph-SaAo0aQ4.js";import"./index-CPYQZmO7.js";import"./ToastContext-BpLXtKbY.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]],X=S("arrow-left-right",B);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],T=S("arrow-left",Y);function J(s){switch(s){case"safe":return e.jsx(U,{className:"conflict-status-icon safe"});case"modified":return e.jsx(V,{className:"conflict-status-icon modified"});case"new":return e.jsx(P,{className:"conflict-status-icon new"});case"deleted":return e.jsx(q,{className:"conflict-status-icon deleted"});case"merged":return e.jsx(z,{className:"conflict-status-icon merged"})}}function Q(s){return s.split("/").pop()??s}function Z(s){const t=s.split("/");return t.pop(),t.join("/")}function ee({file:s,isSelected:t,onSelect:n}){const o=Q(s.path),c=Z(s.path),r=s.status==="modified"||s.status==="deleted",a=s.resolution!=="pending";return e.jsxs("button",{className:v("conflict-file-item",t&&"selected"),onClick:n,title:s.path,children:[e.jsxs("div",{className:"conflict-file-info",children:[J(s.status),e.jsxs("div",{className:"conflict-file-details",children:[e.jsx("span",{className:"conflict-file-name",children:o}),e.jsx("span",{className:"conflict-file-path",children:c})]})]}),r&&e.jsx("div",{className:v("conflict-resolution-indicator",a?"resolved":"pending"),children:a?s.resolution:"pending"})]})}function L(){const{state:s,selectFile:t}=j();if(!s.report)return null;const n=s.report.files.filter(l=>l.status==="modified"),o=s.report.files.filter(l=>l.status==="new"),c=s.report.files.filter(l=>l.status==="safe"),r=s.report.files.filter(l=>l.status==="deleted"),a=s.report.files.filter(l=>l.status==="merged"),u=(l,f)=>f.length===0?null:e.jsxs("div",{className:"conflict-section",children:[e.jsxs("div",{className:"conflict-section-header",children:[l," (",f.length,")"]}),e.jsx("div",{className:"conflict-section-content",children:f.map(i=>e.jsx(ee,{file:i,isSelected:s.selectedFilePath===i.path,onSelect:()=>t(i.path)},i.path))})]});return e.jsxs("div",{className:"conflict-files-container",children:[u("Conflicts",n),u("Auto-merged",a),u("New Files",o),u("Deleted",r),u("Unchanged",c)]})}const C=20;function N({title:s,content:t,lineHighlights:n=new Map,scrollTop:o,onScroll:c,className:r}){const a=g.useRef(null),u=g.useRef(!1);g.useEffect(()=>{a.current&&!u.current&&(a.current.scrollTop=o)},[o]);const l=g.useCallback(()=>{a.current&&(u.current=!0,c(a.current.scrollTop),requestAnimationFrame(()=>{u.current=!1}))},[c]),f=t.split(`
`);return e.jsxs("div",{className:v("merge-column",r),children:[e.jsx("div",{className:"merge-column-header",children:s}),e.jsx("div",{ref:a,className:"merge-column-content",onScroll:l,children:f.map((i,d)=>{const m=d+1,h=n.get(m);return e.jsxs("div",{className:v("merge-line",h),style:{height:C},children:[e.jsx("span",{className:"merge-line-number",children:m}),e.jsx("span",{className:"merge-line-content",children:i||" "})]},m)})})]})}const se=37;function te(s,t){const n=t==="left"?"-":"+";let o=0;for(const c of s.lines){if(c.startsWith(n))return o;c.startsWith(" ")&&o++}return o}function y({hunks:s,resolutions:t,side:n,scrollTop:o,contentLineCount:c,onResolve:r}){const a=n==="left"?"keep-mine":"accept-new",u=n==="left"?"→":"←",l=n==="left"?"Keep your version":"Accept generated version",f=g.useMemo(()=>c*C,[c]);return e.jsxs("div",{className:"hunk-gutter",children:[e.jsx("div",{className:"hunk-gutter-header",style:{height:se}}),e.jsx("div",{className:"hunk-gutter-content",children:e.jsx("div",{className:"hunk-gutter-inner",style:{height:f,transform:`translateY(-${o}px)`},children:s.map(i=>{const d=t[i.id]??"pending",m=d===a,h=d!=="pending"&&!m,p=n==="left"?i.oldStart:i.newStart,x=te(i,n),b=(p-1+x)*C;return h?e.jsx("button",{className:"hunk-gutter-btn other-resolved",style:{top:b},onClick:()=>r(i.id,a),title:`Switch to: ${l}`,children:u},i.id):e.jsx("button",{className:v("hunk-gutter-btn",m&&"resolved"),style:{top:b},onClick:()=>r(i.id,m?"pending":a),title:m?"Click to undo":l,children:m?e.jsx(H,{className:"hunk-check-icon"}):u},i.id)})})})]})}function ne(s){return s.split("/").pop()??s}function le(s,t){const n=new Map;for(const o of s){const c=t[o.id]??"pending";let r=o.oldStart;for(const a of o.lines)a.startsWith("-")?(c==="accept-new"?n.set(r,"removed"):c==="keep-mine"?n.set(r,"context"):n.set(r,"removed"),r++):a.startsWith(" ")&&r++}return n}function ie(s,t){const n=new Map;for(const o of s){const c=t[o.id]??"pending";let r=o.newStart;for(const a of o.lines)a.startsWith("+")?(c==="accept-new"?n.set(r,"context"):c==="keep-mine"?n.set(r,"removed"):n.set(r,"added"),r++):a.startsWith(" ")&&r++}return n}function ce({file:s}){const{getHunksForFile:t,getHunkResolutions:n,setHunkResolution:o,areAllHunksResolved:c,getMergedContentForFile:r,resolveAllHunksWithMine:a,resolveAllHunksWithNew:u}=j(),[l,f]=g.useState(0),{path:i,currentContent:d,newContent:m}=s,h=ne(i),p=t(i),x=n(i),b=c(i),E=g.useMemo(()=>r(i)??d??"",[r,i,d]),K=(d??"").split(`
`).length,$=m.split(`
`).length,D=g.useMemo(()=>le(p,x),[p,x]),G=g.useMemo(()=>ie(p,x),[p,x]),k=g.useCallback((w,_)=>{o(i,w,_)},[o,i]),O=g.useMemo(()=>p.filter(w=>x[w.id]!=="pending").length,[p,x]);return e.jsxs("div",{className:"flex flex-col h-full overflow-hidden",children:[e.jsxs("div",{className:"merge-view-header",children:[e.jsxs("div",{className:"merge-view-header-left",children:[e.jsx("div",{className:"merge-view-filename",children:h}),e.jsx("div",{className:"merge-view-filepath",children:i})]}),e.jsxs("div",{className:"merge-view-header-right",children:[e.jsxs("div",{className:"conflict-bulk-actions",children:[e.jsx("button",{className:"conflict-bulk-btn",onClick:()=>a(i),title:"Keep all your changes",children:"Keep All Mine"}),e.jsx("button",{className:"conflict-bulk-btn",onClick:()=>u(i),title:"Accept all generated changes",children:"Accept All New"})]}),b?e.jsxs("div",{className:"merge-resolved-indicator",children:[e.jsx(H,{className:"merge-check-icon"}),"All changes resolved"]}):e.jsxs("div",{className:"merge-progress-indicator",children:[O," / ",p.length," resolved"]})]})]}),e.jsxs("div",{className:"merge-container-5col",children:[e.jsx(N,{title:"Current (yours)",content:d??"",lineHighlights:D,scrollTop:l,onScroll:f,className:"merge-column left"}),e.jsx(y,{hunks:p,resolutions:x,side:"left",scrollTop:l,contentLineCount:K,onResolve:k}),e.jsx(N,{title:"Merged (result)",content:E,scrollTop:l,onScroll:f,className:"merge-column center"}),e.jsx(y,{hunks:p,resolutions:x,side:"right",scrollTop:l,contentLineCount:$,onResolve:k}),e.jsx(N,{title:"Generated (new)",content:m,lineHighlights:G,scrollTop:l,onScroll:f,className:"merge-column right"})]})]})}function oe(s){return s.split("/").pop()??s}function A(s,t){const n=new Map,o=Math.max(s.length,t.length);for(let c=0;c<o;c++){const r=s[c]??"",a=t[c]??"";r!==a&&n.set(c+1,"removed")}return n}function re({file:s}){const{setResolution:t}=j(),[n,o]=g.useState(0),{path:c,currentContent:r,newContent:a,mergeInfo:u,resolution:l}=s,f=oe(c),i=(u==null?void 0:u.mergedContent)??"",d=(r??"").split(`
`),m=i.split(`
`),h=a.split(`
`),p=g.useMemo(()=>A(m,d),[m,d]),x=g.useMemo(()=>A(m,h),[m,h]);return e.jsxs("div",{className:"flex flex-col h-full overflow-hidden",children:[e.jsxs("div",{className:"merge-view-header",children:[e.jsxs("div",{className:"merge-view-header-left",children:[e.jsx("div",{className:"merge-view-filename",children:f}),e.jsx("div",{className:"merge-view-filepath",children:c})]}),e.jsx("div",{className:"merge-view-header-right",children:e.jsxs("div",{className:"resolution-buttons",children:[e.jsxs("button",{className:v("resolution-btn",l==="keep-mine"&&"active"),onClick:()=>t(c,"keep-mine"),title:"Keep your current version",children:[e.jsx(R,{className:"resolution-btn-icon"}),"Keep Mine"]}),e.jsxs("button",{className:v("resolution-btn merge-btn",l==="merged"&&"active"),onClick:()=>t(c,"merged"),title:"Use auto-merged version",children:[e.jsx(X,{className:"resolution-btn-icon"}),"Use Merged"]}),e.jsxs("button",{className:v("resolution-btn",l==="accept-new"&&"active"),onClick:()=>t(c,"accept-new"),title:"Accept generated version",children:["Accept New",e.jsx(T,{className:"resolution-btn-icon"})]})]})})]}),e.jsxs("div",{className:"merge-container-3col",children:[e.jsx(N,{title:"Current (yours)",content:r??"",lineHighlights:p,scrollTop:n,onScroll:o,className:"merge-column left"}),e.jsx(N,{title:"Merged (auto)",content:i,scrollTop:n,onScroll:o,className:"merge-column center-bordered"}),e.jsx(N,{title:"Generated (new)",content:a,lineHighlights:x,scrollTop:n,onScroll:o,className:"merge-column"})]})]})}function ae(s){return s.split("/").pop()??s}function de({file:s}){const{setResolution:t}=j(),[n,o]=g.useState(0),{path:c,status:r,currentContent:a,newContent:u,resolution:l}=s,f=ae(c),i=r==="new",d=i?u:a??"",m=i?"Generated (new file)":"Current (will be deleted)";return e.jsxs("div",{className:"flex flex-col h-full overflow-hidden",children:[e.jsxs("div",{className:"merge-view-header",children:[e.jsxs("div",{className:"merge-view-header-left",children:[e.jsx("div",{className:"merge-view-filename",children:f}),e.jsx("div",{className:"merge-view-filepath",children:c})]}),e.jsx("div",{className:"merge-view-header-right",children:e.jsxs("div",{className:"resolution-buttons",children:[!i&&e.jsxs("button",{className:v("resolution-btn",l==="keep-mine"&&"active"),onClick:()=>t(c,"keep-mine"),title:"Keep this file (don't delete)",children:[e.jsx(R,{className:"resolution-btn-icon"}),"Keep File"]}),e.jsxs("button",{className:v("resolution-btn",l==="accept-new"&&"active"),onClick:()=>t(c,"accept-new"),title:i?"Create this file":"Delete this file",children:[i?"Create File":"Delete File",e.jsx(T,{className:"resolution-btn-icon"})]})]})})]}),e.jsx("div",{className:"merge-container-single",children:e.jsx(N,{title:m,content:d,scrollTop:n,onScroll:o,className:"merge-column flex-1"})})]})}function W(){const{getSelectedFile:s}=j(),t=s();if(!t)return e.jsx("div",{className:"conflict-diff-empty",children:e.jsx("p",{children:"Select a file to view changes"})});const{status:n,currentContent:o}=t;return n==="modified"&&o!==null?e.jsx(ce,{file:t}):n==="merged"?e.jsx(re,{file:t}):n==="new"||n==="deleted"?e.jsx(de,{file:t}):e.jsx("div",{className:"conflict-diff-empty",children:e.jsx("p",{children:"This file has no changes to review"})})}function ve(){const{state:s,closeConflictResolution:t,resolveAllWithMine:n,resolveAllWithNew:o,areAllConflictsResolved:c}=j(),{applyResolutions:r,isGenerating:a}=M();g.useEffect(()=>{if(!s.isOpen)return;const d=m=>{m.key==="Escape"&&t()};return document.addEventListener("keydown",d),()=>document.removeEventListener("keydown",d)},[s.isOpen,t]),g.useEffect(()=>(s.isOpen?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[s.isOpen]);const u=async()=>{if(!s.vfs||!s.report)return;(await r(s.vfs,s.report)).success&&t()};if(!s.isOpen||!s.report)return null;const{summary:l}=s.report,f=c(),i=s.report.files.filter(d=>d.resolution==="pending").length;return I.createPortal(e.jsx("div",{className:"conflict-overlay",children:e.jsxs("div",{className:"conflict-modal",role:"dialog","aria-modal":"true","aria-labelledby":"conflict-modal-title",children:[e.jsxs("div",{className:"conflict-header",children:[e.jsxs("div",{className:"conflict-header-left",children:[e.jsx("h2",{id:"conflict-modal-title",className:"conflict-title",children:"Resolve Conflicts"}),e.jsxs("div",{className:"conflict-badges",children:[l.modified>0&&e.jsxs("span",{className:"conflict-badge modified",children:[l.modified," modified"]}),l.new>0&&e.jsxs("span",{className:"conflict-badge new",children:[l.new," new"]}),l.safe>0&&e.jsxs("span",{className:"conflict-badge safe",children:[l.safe," unchanged"]}),l.deleted>0&&e.jsxs("span",{className:"conflict-badge deleted",children:[l.deleted," deleted"]})]})]}),e.jsxs("div",{className:"conflict-header-right",children:[e.jsxs("div",{className:"conflict-bulk-actions",children:[e.jsx("button",{className:"conflict-bulk-btn",onClick:n,title:"Keep all user versions",children:"Keep All Mine"}),e.jsx("button",{className:"conflict-bulk-btn",onClick:o,title:"Accept all generated versions",children:"Accept All New"})]}),e.jsx("button",{className:"conflict-close-btn",onClick:t,"aria-label":"Close modal",children:e.jsx(F,{className:"conflict-close-icon"})})]})]}),e.jsxs("div",{className:"conflict-body",children:[e.jsx("div",{className:"conflict-files-list",children:e.jsx(L,{})}),e.jsx("div",{className:"conflict-diff-view",children:e.jsx(W,{})})]}),e.jsxs("div",{className:"conflict-footer",children:[e.jsx("button",{className:"conflict-cancel-btn",onClick:t,children:"Cancel"}),e.jsx("button",{className:v("conflict-apply-btn"),onClick:u,disabled:!f||a,children:a?"Applying...":i>0?`Resolve ${i} pending`:`Apply Resolutions (${l.total} files)`})]})]})}),document.body)}function Ne(){const{state:s,closeConflictResolution:t,resolveAllWithMine:n,resolveAllWithNew:o,areAllConflictsResolved:c,areAllHunksResolved:r,getReportWithHunkMerges:a}=j(),{applyResolutions:u,isGenerating:l}=M(),f=async()=>{if(!s.vfs||!s.report)return;const h=a();if(!h)return;(await u(s.vfs,h)).success&&t()},i=g.useMemo(()=>s.report?s.report.files.filter(h=>h.status==="safe"||h.status==="new"||h.status==="modified"&&h.currentContent&&r(h.path)?!1:h.resolution==="pending").length:0,[s.report,r]);if(!s.report)return null;const{summary:d}=s.report,m=c();return e.jsxs("div",{className:"conflict-container",children:[e.jsxs("div",{className:"conflict-header",children:[e.jsxs("div",{className:"conflict-header-left",children:[e.jsx("h2",{className:"conflict-title",children:"Resolve Conflicts"}),e.jsxs("div",{className:"conflict-badges",children:[d.modified>0&&e.jsxs("span",{className:"conflict-badge modified",children:[d.modified," modified"]}),d.merged>0&&e.jsxs("span",{className:"conflict-badge merged",children:[d.merged," merged"]}),d.new>0&&e.jsxs("span",{className:"conflict-badge new",children:[d.new," new"]}),d.safe>0&&e.jsxs("span",{className:"conflict-badge safe",children:[d.safe," unchanged"]}),d.deleted>0&&e.jsxs("span",{className:"conflict-badge deleted",children:[d.deleted," deleted"]})]})]}),e.jsxs("div",{className:"conflict-header-right",children:[e.jsxs("div",{className:"conflict-bulk-actions",children:[e.jsx("button",{className:"conflict-bulk-btn",onClick:n,title:"Keep all user versions",children:"Keep All Mine"}),e.jsx("button",{className:"conflict-bulk-btn",onClick:o,title:"Accept all generated versions",children:"Accept All New"})]}),e.jsx("button",{className:"conflict-close-btn",onClick:t,"aria-label":"Cancel and return to canvas",children:e.jsx(F,{className:"conflict-close-icon"})})]})]}),e.jsxs("div",{className:"conflict-body",children:[e.jsx("div",{className:"conflict-files-list",children:e.jsx(L,{})}),e.jsx("div",{className:"conflict-diff-view",children:e.jsx(W,{})})]}),e.jsxs("div",{className:"conflict-footer",children:[e.jsx("button",{className:"conflict-cancel-btn",onClick:t,children:"Cancel"}),e.jsx("button",{className:v("conflict-apply-btn"),onClick:f,disabled:!m||l,children:l?"Applying...":i>0?`Resolve ${i} pending`:`Apply Resolutions (${d.total} files)`})]})]})}export{W as ConflictDiffView,L as ConflictFilesList,ve as ConflictResolutionModal,Ne as ConflictResolutionView};
