var Wt=Object.defineProperty;var Xt=(n,e,t)=>e in n?Wt(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var ee=(n,e,t)=>Xt(n,typeof e!="symbol"?e+"":e,t);import{c as re,I as Oe,u as xe,d as Se,J as Bt,A as Vt,x as Gt,y as Ht,z as Ut,B as qt,E as Yt,F as Kt,G as Qt,a as Y,T as Jt,P as Zt}from"./Toast-Bv7rl_JM.js";import{P as I,b as c,l as Ge,m as en,h as at,k as it,u as ve,j as g,H as O,n as tn,o as nn,c as on,N as sn,d as rn,p as ct,E as an}from"./react-flow-ruwbRUGr.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cn=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]],ln=re("clipboard-list",cn);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dn=[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]],He=re("cloud",dn);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const un=[["path",{d:"M12 3q1 4 4 6.5t3 5.5a1 1 0 0 1-14 0 5 5 0 0 1 1-3 1 1 0 0 0 5 0c0-2-1.5-3-1.5-5q0-2 2.5-4",key:"1slcih"}]],us=re("flame",un);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fn=[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]],fs=re("moon",fn);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gn=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],Ve=re("play",gn);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mn=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],gs=re("refresh-cw",mn);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hn=[["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"m19 8 3 8a5 5 0 0 1-6 0zV7",key:"zcdpyk"}],["path",{d:"M3 7h1a17 17 0 0 0 8-2 17 17 0 0 0 8 2h1",key:"1yorad"}],["path",{d:"m5 8 3 8a5 5 0 0 1-6 0zV7",key:"eua70x"}],["path",{d:"M7 21h10",key:"1b0cd5"}]],ms=re("scale",hn);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pn=[["path",{d:"M21 9a2.4 2.4 0 0 0-.706-1.706l-3.588-3.588A2.4 2.4 0 0 0 15 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2z",key:"1dfntj"}],["path",{d:"M15 3v5a1 1 0 0 0 1 1h5",key:"6s6qgf"}]],hs=re("sticky-note",pn);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xn=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],ps=re("sun",xn);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bn=[["path",{d:"M12 19h8",key:"baeox8"}],["path",{d:"m4 17 6-6-6-6",key:"1yngyt"}]],En=re("terminal",bn);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yn=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],xs=re("user",yn);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wn=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],lt=re("zap",wn);function le(n){switch(n){case"trigger":case"externalSystem":case"externalEvent":case"hotspot":case"note":case"actor":return"manual";case"event":case"policy":case"command":default:return"automatic"}}function vn(n,e){if(n!=="command"&&n!=="policy")throw new Error(`calculateDynamicExecutionMode called with non-dynamic kind: ${n}`);return e<=1?"automatic":"manual"}function Tn(n){return n.executionMode==="manual"}function Nn(n,e){return n.executionMode==="manual"?!1:e>0}class ye{constructor(){ee(this,"nodes",new Map);ee(this,"transitions",new Map);ee(this,"outgoingEdges",new Map);ee(this,"incomingEdges",new Map)}addNode(e){if(this.nodes.has(e.id))throw new Error(`Node with id ${e.id} already exists`);this.nodes.set(e.id,e),this.outgoingEdges.set(e.id,new Set),this.incomingEdges.set(e.id,new Set)}getNode(e){return this.nodes.get(e)}hasNode(e){return this.nodes.has(e)}getAllNodes(){return Array.from(this.nodes.values())}updateNode(e,t){const o=this.nodes.get(e);if(!o)return;const s={...o,...t};return this.nodes.set(e,s),s}removeNode(e){if(!this.nodes.has(e))return!1;const t=this.outgoingEdges.get(e)??new Set,o=this.incomingEdges.get(e)??new Set;for(const s of t)this.removeTransition(s);for(const s of o)this.removeTransition(s);return this.nodes.delete(e),this.outgoingEdges.delete(e),this.incomingEdges.delete(e),!0}addTransition(e){if(this.transitions.has(e.id))throw new Error(`Transition with id ${e.id} already exists`);if(!this.nodes.has(e.sourceDefId))throw new Error(`Source node ${e.sourceDefId} does not exist`);if(!this.nodes.has(e.targetDefId))throw new Error(`Target node ${e.targetDefId} does not exist`);this.transitions.set(e.id,e),this.outgoingEdges.get(e.sourceDefId).add(e.id),this.incomingEdges.get(e.targetDefId).add(e.id),this.recalculateExecutionMode(e.sourceDefId)}getTransition(e){return this.transitions.get(e)}getAllTransitions(){return Array.from(this.transitions.values())}removeTransition(e){var s,r;const t=this.transitions.get(e);if(!t)return!1;const o=t.sourceDefId;return(s=this.outgoingEdges.get(t.sourceDefId))==null||s.delete(e),(r=this.incomingEdges.get(t.targetDefId))==null||r.delete(e),this.transitions.delete(e),this.recalculateExecutionMode(o),!0}getOutgoingTransitions(e){const t=this.outgoingEdges.get(e);return t?Array.from(t).map(o=>this.transitions.get(o)).filter(Boolean):[]}getIncomingTransitions(e){const t=this.incomingEdges.get(e);return t?Array.from(t).map(o=>this.transitions.get(o)).filter(Boolean):[]}getSuccessors(e){return this.getOutgoingTransitions(e).map(t=>this.nodes.get(t.targetDefId)).filter(Boolean)}getPredecessors(e){return this.getIncomingTransitions(e).map(t=>this.nodes.get(t.sourceDefId)).filter(Boolean)}get nodeCount(){return this.nodes.size}get transitionCount(){return this.transitions.size}getEntryNodes(){return this.getAllNodes().filter(e=>{var t;return(((t=this.incomingEdges.get(e.id))==null?void 0:t.size)??0)===0})}getTerminalNodes(){return this.getAllNodes().filter(e=>{var t;return(((t=this.outgoingEdges.get(e.id))==null?void 0:t.size)??0)===0})}recalculateExecutionMode(e){var r;const t=this.nodes.get(e);if(!t||t.kind!=="command"&&t.kind!=="policy")return;const o=((r=this.outgoingEdges.get(e))==null?void 0:r.size)??0,s=vn(t.kind,o);t.executionMode!==s&&this.nodes.set(e,{...t,executionMode:s})}requiresUserAction(e){const t=this.nodes.get(e);return t?Tn(t):!1}canAutoTraverse(e){var s;const t=this.nodes.get(e);if(!t)return!1;const o=((s=this.outgoingEdges.get(e))==null?void 0:s.size)??0;return Nn(t,o)}getReachableNodes(e){const t=[],o=new Set,s=[];for(const r of this.getSuccessors(e))o.has(r.id)||(o.add(r.id),s.push(r.id),t.push(r));for(;s.length>0;){const r=s.shift();for(const l of this.getSuccessors(r))o.has(l.id)||(o.add(l.id),s.push(l.id),t.push(l))}return t}getReachableTransitions(e){const t=[],o=new Set;for(const s of this.getOutgoingTransitions(e))o.has(s.id)||(o.add(s.id),t.push(s));for(const s of this.getReachableNodes(e))for(const r of this.getOutgoingTransitions(s.id))o.has(r.id)||(o.add(r.id),t.push(r));return t}}function ae(n,e=""){return n.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]+/g,"-").replace(/^-+|-+$/g,"").replace(/-+/g,"-")||e}function Le(n,e=""){return n.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase().replace(/\s+/g,".").replace(/[^a-z0-9.-]+/g,".").replace(/^[.-]+|[.-]+$/g,"").replace(/\.+/g,".").replace(/-+/g,"-")||e}function bs(n){return n.length<=13?n:`${n.slice(0,5)}...${n.slice(-5)}`}function ge(n){return n.replace(/^(def_|trans_|inst_|outcome_)/,"")}function Es(n,e,t){const o=ae(n);if(o)return o;const s=e.replace(/^def_/,"").toLowerCase();return`${t}-${s.slice(0,8)}`}function ys(n,e){const t=Le(n);return t||`event.${e.replace(/^def_/,"").toLowerCase().slice(0,8)}`}function kn(n){const e=n.match(/\{([^}]+)\}/g);return e?e.map(t=>t.slice(1,-1)):[]}function Cn(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)})}function Ue(n,e,t,o){switch(t){case I.Top:return{x:n,y:e-o};case I.Bottom:return{x:n,y:e+o};case I.Left:return{x:n-o,y:e};case I.Right:return{x:n+o,y:e};default:return{x:n,y:e}}}function _n(n,e,t,o,s=100){const r=t-n,l=o-e,d=Math.sqrt(r*r+l*l);return Math.min(s,d/2)}function dt(n,e,t,o,s,r){const l=_n(n,e,t,o),d=Ue(n,e,s,l),h=Ue(t,o,r,l);return`M${n},${e} C${d.x},${d.y} ${h.x},${h.y} ${t},${o}`}function de(){return`def_${Oe()}`}function Mn(){return`trans_${Oe()}`}function ke(){return`inst_${Oe()}`}function Xe(){return`outcome_${Oe()}`}function ze(n){const e=Le(n.label);return{id:de(),label:n.label,kind:"event",category:"business",executionMode:le("event"),config:e?{type:e}:void 0}}function qe(n){return{id:de(),label:n.label,kind:"policy",category:"business",executionMode:le("policy")}}function In(n){const e=ae(n.label);return{id:de(),label:n.label,kind:"trigger",category:"business",executionMode:le("trigger"),config:e?{slugName:e}:void 0}}function Ye(n){const e=ae(n.label);return{id:de(),label:n.label,kind:"externalSystem",category:"technical",executionMode:le("externalSystem"),config:e?{slugName:e}:void 0}}function Sn(n){const e=ae(n.label);return{id:de(),label:n.label,kind:"externalEvent",category:"technical",executionMode:le("externalEvent"),config:e?{slugName:e}:void 0}}function Ke(n){const e=ae(n.label);return{id:de(),label:n.label,kind:"command",category:"business",executionMode:le("command"),config:e?{slugName:e}:void 0}}function Qe(n){return{id:de(),label:n.label,kind:"hotspot",category:"business",executionMode:le("hotspot")}}function Je(n){return{id:de(),label:n.label,kind:"note",category:"business",executionMode:le("note")}}function Ze(n){return{id:de(),label:n.label,kind:"actor",category:"business",executionMode:le("actor")}}function Rn(n){return{id:Mn(),sourceDefId:n.sourceDefId,targetDefId:n.targetDefId}}const An={transitionDelay:1e3,autoStart:!1};class Pn{constructor(){ee(this,"listeners",new Map)}on(e,t){return this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t),()=>this.off(e,t)}off(e,t){var o;(o=this.listeners.get(e))==null||o.delete(t)}emit(e,t){const o=this.listeners.get(e);if(o)for(const s of o)try{s(t)}catch(r){console.error(`Error in event handler for ${String(e)}:`,r)}}once(e,t){const o=s=>{this.off(e,o),t(s)};return this.on(e,o)}removeAllListeners(e){e?this.listeners.delete(e):this.listeners.clear()}listenerCount(e){var t;return((t=this.listeners.get(e))==null?void 0:t.size)??0}}class Dn extends Pn{constructor(t,o={}){super();ee(this,"graph");ee(this,"config");ee(this,"running",!1);ee(this,"nodeStates",new Map);ee(this,"transitionStates",new Map);ee(this,"activeNodes",new Set);ee(this,"pendingActions",new Set);ee(this,"activeTimeouts",new Set);this.graph=t,this.config={...An,...o},this.initializeState()}initializeState(){for(const t of this.graph.getAllNodes())this.nodeStates.set(t.id,"idle");for(const t of this.graph.getAllTransitions())this.transitionStates.set(t.id,"idle")}getState(){return{isRunning:this.running,nodeStates:new Map(this.nodeStates),transitionStates:new Map(this.transitionStates),activeNodes:new Set(this.activeNodes),pendingActions:new Set(this.pendingActions)}}getNodeState(t){return this.nodeStates.get(t)}getTransitionState(t){return this.transitionStates.get(t)}isSimulationRunning(){return this.running}start(){if(!this.running&&(this.running=!0,this.emit("simulation:start",{timestamp:Date.now()}),this.config.autoStart))for(const t of this.graph.getEntryNodes())this.triggerNode(t.id)}stop(){if(this.running){this.running=!1;for(const t of this.activeTimeouts)clearTimeout(t);this.activeTimeouts.clear(),this.emit("simulation:stop",{timestamp:Date.now()})}}reset(){this.stop(),this.nodeStates.clear(),this.transitionStates.clear(),this.activeNodes.clear(),this.pendingActions.clear(),this.initializeState(),this.emit("simulation:reset",{timestamp:Date.now()})}resetAllStates(){const t=Date.now();for(const o of this.graph.getAllNodes())this.nodeStates.set(o.id,"idle"),this.emit("node:reset",{node:o,timestamp:t});for(const o of this.graph.getAllTransitions())this.transitionStates.set(o.id,"idle"),this.emit("transition:reset",{transition:o,timestamp:t});this.activeNodes.clear(),this.pendingActions.clear()}triggerNode(t){if(!this.running){this.emitError(`Cannot trigger node ${t}: simulation is not running`,t);return}if(!this.graph.getNode(t)){this.emitError(`Node ${t} not found`,t);return}this.resetAllStates(),this.enterNode(t)}selectTransition(t){if(!this.running){this.emitError("Cannot select transition: simulation is not running",void 0,t);return}const o=this.graph.getTransition(t);if(!o){this.emitError(`Transition ${t} not found`,void 0,t);return}if(!this.graph.getNode(o.sourceDefId)){this.emitError("Source node for transition not found",o.sourceDefId,t);return}if(!this.pendingActions.has(o.sourceDefId)){this.emitError(`Node ${o.sourceDefId} is not waiting for action`,o.sourceDefId);return}this.resetAllStates(),this.executeTransition(o)}completeManualNode(t){if(!this.running){this.emitError("Cannot complete node: simulation is not running",t);return}if(!this.graph.getNode(t)){this.emitError(`Node ${t} not found`,t);return}if(!this.pendingActions.has(t)){this.emitError(`Node ${t} is not waiting for action`,t);return}this.resetAllStates(),this.pendingActions.delete(t),this.exitNode(t)}enterNode(t){const o=this.graph.getNode(t);o&&(this.nodeStates.set(t,"entering"),this.activeNodes.add(t),this.emit("node:enter",{node:o,timestamp:Date.now()}),this.activateNode(t))}activateNode(t){const o=this.graph.getNode(t);o&&(this.nodeStates.set(t,"active"),this.emit("node:active",{node:o,timestamp:Date.now()}),this.graph.requiresUserAction(t)?this.waitForAction(t):this.graph.canAutoTraverse(t)?this.exitNode(t):this.completeNode(t))}waitForAction(t){const o=this.graph.getNode(t);if(!o)return;this.nodeStates.set(t,"waiting_for_action"),this.pendingActions.add(t);const s=this.graph.getOutgoingTransitions(t);this.emit("node:waiting",{node:o,availableTransitions:s,timestamp:Date.now()})}exitNode(t){const o=this.graph.getNode(t);if(!o)return;this.nodeStates.set(t,"exiting"),this.emit("node:exit",{node:o,timestamp:Date.now()});const s=this.graph.getOutgoingTransitions(t);if(s.length===0)this.completeNode(t);else if(s.length===1)this.executeTransition(s[0]),this.completeNode(t);else{for(const r of s)this.executeTransition(r);this.completeNode(t)}}completeNode(t){const o=this.graph.getNode(t);o&&(this.nodeStates.set(t,"completed"),this.activeNodes.delete(t),this.emit("node:complete",{node:o,timestamp:Date.now()}))}executeTransition(t){this.transitionStates.set(t.id,"in_progress"),this.emit("transition:start",{transition:t,timestamp:Date.now()});const o=setTimeout(()=>{this.activeTimeouts.delete(o),this.completeTransition(t)},this.config.transitionDelay);this.activeTimeouts.add(o)}completeTransition(t){this.transitionStates.set(t.id,"completed"),this.emit("transition:complete",{transition:t,timestamp:Date.now()}),this.enterNode(t.targetDefId)}emitError(t,o,s){this.emit("error",{message:t,nodeId:o,transitionId:s,timestamp:Date.now()})}}function ut(){const n=c.useRef(new Map),e=c.useRef(new Map),t=c.useRef(new Map),o=c.useRef(new Map),s=c.useCallback(i=>n.current.get(i),[]),r=c.useCallback(i=>{const a=e.current.get(i);return a?Array.from(a):[]},[]),l=c.useCallback((i,a,f)=>{if(!i.current)return;const y=i.current.getOutgoingTransitions(a).find(T=>T.targetDefId===f);return y==null?void 0:y.id},[]),d=c.useCallback(i=>t.current.get(i),[]),h=c.useCallback(i=>o.current.get(i),[]),u=c.useCallback((i,a)=>{n.current.set(i,a);let f=e.current.get(a);f||(f=new Set,e.current.set(a,f)),f.add(i)},[]),p=c.useCallback(i=>{const a=n.current.get(i);if(!a)return;n.current.delete(i);const f=e.current.get(a);return f&&(f.delete(i),f.size===0&&e.current.delete(a)),a},[]),b=c.useCallback((i,a)=>{t.current.set(i,a);let f=o.current.get(a);f||(f=new Set,o.current.set(a,f)),f.add(i)},[]),m=c.useCallback(i=>{const a=t.current.get(i);if(!a)return;t.current.delete(i);const f=o.current.get(a);return f&&(f.delete(i),f.size===0&&o.current.delete(a)),a},[]),E=c.useCallback(()=>{n.current.clear(),e.current.clear(),t.current.clear(),o.current.clear()},[]);return{instanceToDefRef:n,defToInstancesRef:e,edgeToTransitionRef:t,transitionToEdgesRef:o,getDefinitionForInstance:s,getInstancesForDefinition:r,findExistingTransition:l,getEdgeTransition:d,getEdgesForTransition:h,registerInstance:u,unregisterInstance:p,registerEdge:b,unregisterEdge:m,resetMappings:E}}function ws(n,e){return{x:n.x-e.x,y:n.y-e.y}}function On(n,e){return{x:n.x+e.x,y:n.y+e.y}}function Ln(n,e){return e?On(n,e):n}const we=152,ft=102,gt=80,je=32,oe=10;function Re(n,e,t=we,o=ft,s=gt,r=je){const l=n+s<=0,d=n>=t,h=e+r<=0,u=e>=o;if(l)return{x:-s-oe,y:Math.max(-r,Math.min(e,o))};if(d)return{x:t+oe,y:Math.max(-r,Math.min(e,o))};if(h)return{x:Math.max(-s,Math.min(n,t)),y:-r-oe};if(u)return{x:Math.max(-s,Math.min(n,t)),y:o+oe};const p=n+s/2,b=e+r/2,m=t/2,E=o/2,i=p-m,a=b-E;return Math.abs(i)>Math.abs(a)?i>0?{x:t+oe,y:Math.max(-r,Math.min(e,o))}:{x:-s-oe,y:Math.max(-r,Math.min(e,o))}:a>0?{x:Math.max(-s,Math.min(n,t)),y:o+oe}:{x:Math.max(-s,Math.min(n,t)),y:-r-oe}}const Be={command:{canConnectTo:["event"],canReceiveFrom:["event","policy","externalEvent"]},policy:{canConnectTo:["command","externalEvent","trigger","externalSystem"],canReceiveFrom:["event"]},externalEvent:{canConnectTo:["command","trigger"],canReceiveFrom:["event","policy"]},externalSystem:{canConnectTo:["event"],canReceiveFrom:["event","policy","externalEvent"]},trigger:{canConnectTo:["event"],canReceiveFrom:["event","policy","externalEvent"]},event:{canConnectTo:["policy","command","externalEvent","trigger","externalSystem"],canReceiveFrom:["command","trigger","externalSystem"]}};function jn(n,e){const t=Be[n],o=Be[e];if(!t||!o)return!1;const s=t.canConnectTo.includes(e),r=o.canReceiveFrom.includes(n);return s&&r}function Fn(n,e){return e?"policy":n}function mt(n){return n==="command"?"commandEdge":"floating"}function $e(n){return n>=2?"commandEdge":"floating"}function zn(n,e){return{sourceHandle:"source-right",targetHandle:"target-left"}}function Ae(){return{label:"Path",labelOffset:.5}}function Pe(n,e){return!n||!e?{isNonStandard:!1}:{isNonStandard:!jn(n,e),sourceKind:n,targetKind:e}}function $n(n,e,t,o){const s=n.source,r=n.target,l=o.has(s);let d;if(l){const i=o.get(s);d=i?t.get(i):void 0}else d=t.get(s);const h=t.get(r);if(!d||!h)return n;const u=e.getNode(d),p=e.getNode(h),b=l?"policy":u==null?void 0:u.kind,m=p==null?void 0:p.kind,E=Pe(b,m);return{...n,data:{...n.data,...E}}}const Ce=120,Wn=152,Xn=112,Bn={top:{source:"source-top",target:"target-bottom"},right:{source:"source-right",target:"target-left"},bottom:{source:"source-bottom",target:"target-top"},left:{source:"source-left",target:"target-right"}};function Vn(n){return Bn[n]}function Gn(n,e,t,o){switch(o){case"top":return{x:n.x,y:n.y-Ce};case"right":return{x:n.x+e+Ce,y:n.y};case"bottom":return{x:n.x,y:n.y+t+Ce};case"left":return{x:n.x-Ce,y:n.y}}}function ht(n,e,t,o){n.set(t,o);let s=e.get(o);s||(s=new Set,e.set(o,s)),s.add(t)}function pt(n,e,t,o){const s=n.get(o);if(!s)return;n.delete(o),t.delete(o);const r=e.get(s);r&&(r.delete(o),r.size===0&&e.delete(s))}function xt(n,e){var t;return((t=n.get(e))==null?void 0:t.size)??0}function Hn(n,e,t){var r;const o=e.get(n);return o?(((r=t.get(o))==null?void 0:r.size)??0)>2:!1}function Un(n,e,t,o){return n.filter(s=>{const r=s;return r.type!=="remove"||!r.id||!e.has(r.id)||o!=null&&o.has(r.id)?!0:Hn(r.id,e,t)})}function qn(n,e,t,o){return n}function Yn(n,e=we){return Re(e+oe,n*(je+oe))}function Kn(n,e,t,o,s){return{id:n,type:"outcome",position:s,parentId:e,data:{label:o,parentPolicyId:e,parentPolicyInstanceId:e,parentPolicyDefId:t}}}function Qn(n,e,t,o,s,r,l){var p;const d=e.get(n);if(!d||(((p=t.get(d))==null?void 0:p.size)??0)<=2)return!1;if(o.get(n)){const b=s.cleanupEdgesFromSource(n);b.length>0&&l(m=>m.filter(E=>!b.includes(E.id)))}return pt(e,t,o,n),r(b=>b.filter(m=>m.id!==n)),!0}function Jn(n,e,t,o,s,r,l){const d=l(),h=xt(s,n),u=Yn(h),p=Kn(d,n,e,t,u);return ht(o,s,d,n),r(b=>[...b,p]),d}function Zn(n,e,t){t(o=>o.map(s=>s.id===n?{...s,data:{...s.data,label:e}}:s))}function bt(n){const{instanceToDefRef:e,setNodes:t,getNodes:o}=n,s=c.useRef(new Map),r=c.useRef(new Map),l=c.useRef(new Map),d=c.useCallback(v=>l.current.get(v),[]),h=c.useCallback(v=>{const w=r.current.get(v);return w?Array.from(w):[]},[]),u=c.useCallback(v=>{const w=r.current.get(v);if(!w)return[];const F=o();return Array.from(w).map(X=>{var $;const S=F.find(R=>R.id===X),N=(($=S==null?void 0:S.data)==null?void 0:$.label)||"Outcome";return{id:X,label:N}})},[o]),p=c.useCallback(v=>s.current.has(v),[]),b=c.useCallback(v=>s.current.get(v),[]),m=c.useCallback(v=>xt(r.current,v),[]),E=c.useCallback((v,w)=>{ht(s.current,r.current,v,w)},[]),i=c.useCallback(v=>{pt(s.current,r.current,l.current,v)},[]),a=c.useCallback((v,w)=>{l.current.set(v,w)},[]),f=c.useCallback(v=>{l.current.delete(v)},[]),x=c.useCallback((v,w)=>{var X;const F=(X=e.current)==null?void 0:X.get(v);if(!F)throw new Error(`Policy instance ${v} not found`);return Jn(v,F,w,s.current,r.current,t,Xe)},[e,t]),y=c.useCallback((v,w)=>{Zn(v,w,t)},[t]),T=c.useCallback(()=>{s.current.clear(),r.current.clear(),l.current.clear()},[]);return{outcomeToParentRef:s,policyToOutcomesRef:r,outcomeToTransitionRef:l,getOutcomeTransition:d,getOutcomesForPolicy:h,getOutcomesWithLabels:u,isOutcome:p,getOutcomeParent:b,getOutcomeCount:m,registerOutcome:E,unregisterOutcome:i,setOutcomeTransition:a,clearOutcomeTransition:f,addOutcomeToPolicy:x,updateOutcomeLabel:y,resetMappings:T}}function Et(n,e){const{edgeToTransitionRef:t,transitionToEdgesRef:o}=e,s=c.useCallback(m=>t.current.get(m),[t]),r=c.useCallback(m=>o.current.get(m),[o]),l=c.useCallback(m=>{const E=o.current.get(m);return E!==void 0&&E.size>0},[o]),d=c.useCallback((m,E)=>{if(!n.current)return;const a=n.current.getOutgoingTransitions(m).find(f=>f.targetDefId===E);return a==null?void 0:a.id},[n]),h=c.useCallback((m,E)=>{t.current.set(m,E);let i=o.current.get(E);i||(i=new Set,o.current.set(E,i)),i.add(m)},[t,o]),u=c.useCallback((m,E,i)=>{const a=Rn({sourceDefId:E,targetDefId:i});return n.current.addTransition(a),t.current.set(m,a.id),o.current.set(a.id,new Set([m])),a.id},[n,t,o]),p=c.useCallback(m=>{const E=t.current.get(m);if(!E)return{transitionDeleted:!1};t.current.delete(m);const i=o.current.get(E);return i==null||i.delete(m),!i||i.size===0?(o.current.delete(E),n.current.removeTransition(E),{transitionDeleted:!0,transitionId:E}):{transitionDeleted:!1,transitionId:E}},[n,t,o]),b=c.useCallback((m,E,i,a)=>{if((a==null?void 0:a.allowReuseExisting)??!0){const x=d(E,i);if(x)return h(m,x),x}return u(m,E,i)},[d,h,u]);return{getTransitionForEdge:s,getEdgesForTransition:r,hasEdgesForTransition:l,findExistingTransition:d,linkEdgeToTransition:h,linkEdgeToNewTransition:u,unlinkEdgeFromTransition:p,getOrCreateTransitionAndLink:b}}function yt(n,e){const t=c.useCallback(h=>{var p;const u=(p=e.current)==null?void 0:p.get(h);return u?Array.from(u):[]},[e]),o=c.useCallback(h=>{var u,p;return((p=(u=n.current)==null?void 0:u.getNode(h))==null?void 0:p.kind)==="command"},[n]),s=c.useCallback((h,u)=>{const p=t(h);if(p.length===0)return 0;const b=new Set(p);let m=0;for(const E of u)b.has(E.source)&&m++;return m},[t]),r=c.useCallback((h,u,p)=>{let b=s(h,u);return b+=(p==null?void 0:p.pendingAdd)??0,$e(b)},[s]),l=c.useCallback((h,u,p)=>{const b=t(h);if(b.length===0)return u;const m=new Set(b);let E=0;for(const a of u)m.has(a.source)&&E++;E+=(p==null?void 0:p.pendingAdd)??0;const i=$e(E);return u.map(a=>{var f;return!m.has(a.source)||a.type===i?a:{...a,type:i,data:{...a.data,...i==="commandEdge"&&!((f=a.data)!=null&&f.label)?Ae():{}}}})},[t]),d=c.useCallback((h,u,p,b)=>{const m=new Map;for(const E of h){const i=p.get(E.source);if(!i)continue;const a=u.getNode(i);(a==null?void 0:a.kind)==="command"&&m.set(i,(m.get(i)??0)+1)}return h.map(E=>{var y;const i=p.get(E.source);if(!i)return E;const a=u.getNode(i);if((a==null?void 0:a.kind)!=="command")return E;const f=m.get(i)??0,x=$e(f);return E.type===x?E:{...E,type:x,data:{...E.data,...x==="commandEdge"&&!((y=E.data)!=null&&y.label)?Ae():{}}}})},[]);return{countCommandEdges:s,resolveEdgeType:r,normalizeCommandEdges:l,normalizeAllCommandEdges:d,isCommandDefinition:o,getCommandInstanceIds:t}}const et=["hotspot","note","actor"];function eo(n){const{edges:e,setNodes:t,setEdges:o,onNodesChangeInternal:s,onEdgesChangeInternal:r,graphRef:l,getNode:d,nodesRef:h,instanceToDefRef:u,defToInstancesRef:p,edgeToTransitionRef:b,transitionToEdgesRef:m,outcomeManagement:E,edgeTransitionManager:i,commandEdgeResolver:a}=n,{isOutcome:f,unregisterOutcome:x,getOutcomesForPolicy:y,setOutcomeTransition:T,clearOutcomeTransition:v,outcomeToParentRef:w,policyToOutcomesRef:F}=E,X=c.useCallback(P=>{const k=u.current.get(P);if(!k)return;const M=y(P);for(const W of M)x(W);u.current.delete(P);const D=p.current.get(k);if(D==null||D.delete(P),!D||D.size===0){p.current.delete(k),l.current.removeNode(k);for(const[W,L]of b.current)l.current.getTransition(L)||(b.current.delete(W),m.current.delete(L))}},[l,u,p,b,m,y,x]),S=c.useCallback(P=>{i.unlinkEdgeFromTransition(P)},[i]),N=c.useCallback(P=>{const k=new Set;for(const j of P)if(j.type==="remove"){const G=F.current.get(j.id);if(G)for(const B of G)k.add(B)}const M=Un(P,w.current,F.current,k);for(const j of k)M.some(G=>G.type==="remove"&&G.id===j)||M.push({type:"remove",id:j});const D=M.map(j=>{var G,B,H,U;if(j.type==="position"&&j.position){const K=w.current.get(j.id);if(K){const J=d(j.id),Z=d(K),C=Re(j.position.x,j.position.y,((G=Z==null?void 0:Z.measured)==null?void 0:G.width)??we,((B=Z==null?void 0:Z.measured)==null?void 0:B.height)??ft,((H=J==null?void 0:J.measured)==null?void 0:H.width)??gt,((U=J==null?void 0:J.measured)==null?void 0:U.height)??je);return{...j,position:C}}}return j}),W=new Set;for(const j of D)j.type==="remove"&&W.add(j.id);const L=new Set;for(const j of e)(W.has(j.source)||W.has(j.target))&&L.add(j.id);for(const j of L)S(j);L.size>0&&o(j=>j.filter(G=>!L.has(G.id)));for(const j of D)j.type==="remove"&&X(j.id);s(D)},[s,X,S,d,e,o,F,w]),$=c.useCallback(P=>{const k=qn(P,e,w.current,F.current),M=new Set,D=new Set;for(const W of k)if(W.type==="remove"){const L=e.find(j=>j.id===W.id);if(L){const j=L.source,G=L.target,B=u.current.get(j);if(B){const H=l.current.getNode(B);if((H==null?void 0:H.kind)==="command"){M.add(B);const U=u.current.get(G);if(U){const K=l.current.getNode(U);(K==null?void 0:K.kind)==="event"&&D.add(G)}}}}S(W.id)}r(k),M.size>0&&o(W=>{let L=W;for(const j of M)L=a.normalizeCommandEdges(j,L);return L}),D.size>0&&t(W=>W.map(L=>D.has(L.id)?e.some(G=>{if(G.target!==L.id||k.some(K=>K.type==="remove"&&K.id===G.id))return!1;const H=u.current.get(G.source);if(!H)return!1;const U=l.current.getNode(H);return(U==null?void 0:U.kind)==="command"})?L:{...L,data:{...L.data,hasCommandParent:!1}}:L))},[r,S,e,o,t,a,l,u,w,F]),R=c.useCallback(P=>{if(!P.source||!P.target)return!1;const k=P.source,M=P.target;if(k===M)return!1;const D=f(k),W=h.current.find(B=>B.id===k),L=Fn(W==null?void 0:W.type,D),j=h.current.find(B=>B.id===M),G=j==null?void 0:j.type;return!(!L||!G||et.includes(L)||et.includes(G))},[f,h]),A=c.useCallback(P=>{if(!P.source||!P.target)return;const k=P.source,M=P.target,D=`edge_${k}_${M}`;if(b.current.has(D))return;const W=f(k);let L;if(W){const C=k,_=w.current.get(C);L=u.current.get(_)}else L=u.current.get(k);const j=u.current.get(M);if(!L||!j)return;const G=i.findExistingTransition(L,j);if(G&&!W&&i.hasEdgesForTransition(G))return;const B=W?i.linkEdgeToNewTransition(D,L,j):i.getOrCreateTransitionAndLink(D,L,j);W&&T(k,B);const H=l.current.getNode(L),U=l.current.getNode(j),K=(H==null?void 0:H.kind)==="command",J=W?"policy":H==null?void 0:H.kind,Z=Pe(J,U==null?void 0:U.kind);K?(o(C=>{const _=a.resolveEdgeType(L,C,{pendingAdd:1}),V=Ge({...P,id:D,type:_,data:{state:"idle",transitionId:B,...Z,..._==="commandEdge"?Ae():{}}},C);return a.normalizeCommandEdges(L,V)}),(U==null?void 0:U.kind)==="event"&&t(C=>C.map(_=>_.id===M?{..._,data:{..._.data,hasCommandParent:!0}}:_))):o(C=>Ge({...P,id:D,type:"floating",data:{state:"idle",transitionId:B,...Z}},C))},[o,t,i,a,l,u,b,w,f,T]),z=c.useCallback((P,k)=>{if(!k.source||!k.target)return;const M=P.id,D=k.source,W=k.target,L=`edge_${D}_${W}`,j=M!==L;if(e.some(q=>q.id!==M&&q.id!==L&&q.source===D&&q.target===W)||j&&b.current.has(L))return;const B=f(D);let H;if(B){const q=D,fe=w.current.get(q);H=u.current.get(fe)}else H=u.current.get(D);const U=u.current.get(W);if(!H||!U)return;const K=b.current.get(M),J=K?l.current.getTransition(K):void 0,Z=!J||J.sourceDefId!==H||J.targetDefId!==U;let C;const _=P.source,V=w.current.has(_);if(Z){K&&(i.unlinkEdgeFromTransition(M),V&&v(_));const q=i.findExistingTransition(H,U);if(q&&!B&&i.hasEdgesForTransition(q))return;C=B?i.linkEdgeToNewTransition(L,H,U):i.getOrCreateTransitionAndLink(L,H,U),B&&T(D,C)}else{if(C=K,j){b.current.delete(M),b.current.set(L,C);const q=m.current.get(C);q&&(q.delete(M),q.add(L))}V&&_!==D&&v(_),B&&T(D,C)}const Q=l.current.getNode(H),te=l.current.getNode(U),ue=(Q==null?void 0:Q.kind)==="command",Ee=ue?"commandEdge":"floating",he=B?"policy":Q==null?void 0:Q.kind,pe=Pe(he,te==null?void 0:te.kind);o(q=>en(P,k,q).map(ne=>{var se;return ne.source===k.source&&ne.target===k.target?{...ne,id:L,type:Ee,data:{...ne.data,...Z?{state:"idle",progress:0}:{},transitionId:C,...pe,...ue&&!((se=ne.data)!=null&&se.label)?{label:"Path",labelOffset:.5}:{}}}:ne}))},[e,o,i,l,u,b,m,w,f,T,v]);return{onNodesChange:N,onEdgesChange:$,onConnect:A,onReconnect:z,isValidConnection:R}}function tt(n,e,t,o,s){return{id:n,type:"outcome",position:s,parentId:t,data:{label:e,parentPolicyInstanceId:t,parentPolicyDefId:o}}}function to(n){const{edges:e,setNodes:t,setEdges:o,graphRef:s,getNode:r,instanceMapping:l,outcomeManagement:d,edgeTransitionManager:h}=n,{instanceToDefRef:u,defToInstancesRef:p,edgeToTransitionRef:b,transitionToEdgesRef:m}=l,{outcomeToParentRef:E,policyToOutcomesRef:i,getOutcomesForPolicy:a,registerOutcome:f,unregisterOutcome:x}=d,y=c.useCallback(N=>{const $=u.current.get(N);if(!$)return;const R=a(N);for(const z of R)x(z);u.current.delete(N);const A=p.current.get($);if(A==null||A.delete(N),!A||A.size===0){p.current.delete($),s.current.removeNode($);for(const[z,P]of b.current)s.current.getTransition(P)||(b.current.delete(z),m.current.delete(P))}},[s,u,p,b,m,a,x]),T=c.useCallback((N,$,R)=>{let A,z="event";if(N==="event"){const k=ze({label:R||"Event"});s.current.addNode(k);const M=ke();u.current.set(M,k.id),p.current.set(k.id,new Set([M]));const D={id:M,type:"event",position:$,data:{label:k.label,executionMode:k.executionMode,definitionId:k.id}};return t(W=>[...W,D]),M}if(N==="trigger"){const k=In({label:R||"Trigger"});s.current.addNode(k);const M=ke();u.current.set(M,k.id),p.current.set(k.id,new Set([M]));const D={id:M,type:"trigger",position:$,data:{label:k.label,definitionId:k.id}};return t(W=>[...W,D]),M}N==="policy"?(A=qe({label:R||"Policy"}),z="policy"):N==="externalSystem"?(A=Ye({label:R||"External System"}),z="externalSystem"):N==="externalEvent"?(A=Sn({label:R||"External Event"}),z="externalEvent"):N==="command"?(A=Ke({label:R??"Command"}),z="command"):N==="hotspot"?(A=Qe({label:R||"HotSpot"}),z="hotspot"):N==="note"?(A=Je({label:R||"Note"}),z="note"):N==="actor"?(A=Ze({label:R||"Actor"}),z="actor"):(A=ze({label:R||"Event"}),z="event"),s.current.addNode(A);const P=ke();if(u.current.set(P,A.id),p.current.set(A.id,new Set([P])),N==="policy"){const k={id:P,type:"policy",position:$,data:{label:A.label,executionMode:A.executionMode,definitionId:A.id}},M=Xe(),D=Xe(),W=Re(we+oe,0),L=Re(we+oe,je+oe),j=tt(M,"Yes",P,A.id,W),G=tt(D,"No",P,A.id,L);f(M,P),f(D,P),t(B=>[...B,k,j,G])}else{const k={id:P,type:z,position:$,data:{label:A.label,executionMode:A.executionMode,definitionId:A.id}};t(M=>[...M,k])}return P},[s,u,p,t,f]),v=c.useCallback((N,$)=>{const R=s.current.getNode(N);if(!R)throw new Error(`Definition ${N} does not exist`);const A=ke();u.current.set(A,N);const z=p.current.get(N)??new Set;z.add(A),p.current.set(N,z);const P={id:A,type:R.kind,position:$,data:{label:R.label,executionMode:R.executionMode,definitionId:N}};return t(k=>[...k,P]),A},[s,u,p,t]),w=c.useCallback(N=>{const $=u.current.get(N);if(!$)return;const R=r(N);if(!R)return;const A={x:R.position.x+50,y:R.position.y+50};return v($,A)},[u,r,v]),F=c.useCallback(N=>{const $=u.current.get(N);if(!$)return;const R=s.current.getNode($);if(!R)return;const A=p.current.get($);if(!A||A.size<=1)return;let z;R.kind==="event"?z=ze({label:R.label}):R.kind==="policy"?z=qe({label:R.label}):R.kind==="command"?z=Ke({label:R.label}):R.kind==="hotspot"?z=Qe({label:R.label}):R.kind==="note"?z=Je({label:R.label}):R.kind==="actor"?z=Ze({label:R.label}):z=Ye({label:R.label}),s.current.addNode(z),u.current.set(N,z.id),A.delete(N),p.current.set(z.id,new Set([N]));const P=e.filter(k=>k.source===N||k.target===N);for(const k of P){const M=k.source===N,D=M?k.target:k.source;if(E.current.has(D))continue;const W=u.current.get(D);if(!W||W===$)continue;const L=M?z.id:W,j=M?W:z.id;h.getOrCreateTransitionAndLink(k.id,L,j)}t(k=>k.map(M=>M.id===N?{...M,data:{...M.data,definitionId:z.id}}:M)),o(k=>k.map(M=>{if(M.source===N||M.target===N){const D=b.current.get(M.id);if(D)return{...M,data:{...M.data,transitionId:D}}}return M}))},[s,u,p,E,b,e,t,o,h]),X=c.useCallback(N=>{const $=i.current.get(N),R=new Set([N]);if($)for(const A of $)R.add(A);y(N),t(A=>A.filter(z=>!R.has(z.id)))},[i,y,t]),S=c.useCallback(N=>{const $=p.current.get(N);if(!$)return;const R=new Set($);for(const A of R)u.current.delete(A);p.current.delete(N),s.current.removeNode(N),t(A=>A.filter(z=>!R.has(z.id)))},[s,u,p,t]);return{addNode:T,addInstance:v,duplicateInstance:w,dissociateInstance:F,deleteInstance:X,deleteDefinition:S,handleInstanceDeletion:y}}function no(n){const{setNodes:e,graphRef:t,instanceMapping:o}=n,{defToInstancesRef:s,getDefinitionForInstance:r,getInstancesForDefinition:l}=o,d=c.useCallback(a=>l(a),[l]),h=c.useCallback((a,f)=>{t.current.updateNode(a,{executionMode:f});const x=s.current.get(a);x&&e(y=>y.map(T=>x.has(T.id)?{...T,data:{...T.data,executionMode:f}}:T))},[t,s,e]),u=c.useCallback((a,f)=>{const x=t.current.getNode(a);if(!x)return;t.current.updateNode(a,{label:f});const y=x.config;if(x.kind==="command"||x.kind==="trigger"||x.kind==="externalSystem"||x.kind==="externalEvent"){const v=ae(f);if(v){const w=y;if((w==null?void 0:w.slugName)!==v){const X={...w,slugName:v};t.current.updateNode(a,{config:X})}}}else if(x.kind==="event"){const v=Le(f);if(v){const w=y;if((w==null?void 0:w.type)!==v){const X={...w,type:v};t.current.updateNode(a,{config:X})}}}const T=s.current.get(a);T&&e(v=>v.map(w=>T.has(w.id)?{...w,data:{...w.data,label:f}}:w))},[t,s,e]),p=c.useCallback((a,f)=>{t.current.updateNode(a,{config:f})},[t]),b=c.useCallback((a,f)=>{t.current.updateNode(a,{awsExtension:f})},[t]),m=c.useCallback(a=>{var f;return(f=t.current.getNode(a))==null?void 0:f.config},[t]),E=c.useCallback(a=>{var f;return(f=t.current.getNode(a))==null?void 0:f.awsExtension},[t]),i=c.useCallback((a,f)=>{var w;const x=t.current.getNode(a);if(!x||x.kind!=="command"&&x.kind!=="trigger"||x.kind===f)return;const y=f==="trigger"?"manual":"automatic";t.current.updateNode(a,{kind:f,executionMode:y}),f==="command"&&t.current.recalculateExecutionMode(a);const T=s.current.get(a);if(!T)return;const v=(w=t.current.getNode(a))==null?void 0:w.executionMode;e(F=>F.map(X=>T.has(X.id)?{...X,type:f,data:{...X.data,executionMode:v}}:X))},[t,s,e]);return{getDefinitionForInstance:r,getInstancesForDefinition:d,updateNodeExecutionMode:h,updateNodeLabel:u,updateNodeConfig:p,updateNodeAwsExtension:b,getNodeConfig:m,getNodeAwsExtension:E,convertNodeKind:i}}function oo(n){const{edges:e,setNodes:t,setEdges:o,outcomeManagement:s,edgeTransitionManager:r}=n,{outcomeToParentRef:l,policyToOutcomesRef:d,outcomeToTransitionRef:h,getOutcomeTransition:u,getOutcomesForPolicy:p,getOutcomesWithLabels:b,addOutcomeToPolicy:m,updateOutcomeLabel:E}=s,i=c.useMemo(()=>({cleanupEdgesFromSource:f=>{const x=e.filter(y=>y.source===f).map(y=>y.id);for(const y of x)r.unlinkEdgeFromTransition(y);return x}}),[e,r]),a=c.useCallback(f=>Qn(f,l.current,d.current,h.current,i,t,o),[l,d,h,i,t,o]);return{getOutcomeTransition:u,getOutcomesForPolicy:p,getOutcomesWithLabels:b,addOutcomeToPolicy:m,deleteOutcome:a,updateOutcomeLabel:E}}const _e=16;function so(n){const{nodes:e,edges:t,setNodes:o,setEdges:s,graphRef:r,instanceMapping:l,outcomeManagement:d,commandEdgeResolver:h,incrementGraphVersion:u}=n,{instanceToDefRef:p,defToInstancesRef:b,edgeToTransitionRef:m,transitionToEdgesRef:E}=l,{outcomeToParentRef:i,policyToOutcomesRef:a,outcomeToTransitionRef:f,resetMappings:x}=d,y=c.useCallback(()=>{r.current=new ye,l.resetMappings(),x(),o([]),s([]),u()},[r,o,s,l,x,u]),T=c.useCallback(()=>({graph:r.current,nodes:e,edges:t,mappings:{instanceToDefRef:new Map(p.current),defToInstancesRef:new Map(Array.from(b.current.entries()).map(([w,F])=>[w,new Set(F)])),edgeToTransitionRef:new Map(m.current),transitionToEdgesRef:new Map(Array.from(E.current.entries()).map(([w,F])=>[w,new Set(F)])),outcomeToParentRef:new Map(i.current),policyToOutcomesRef:new Map(Array.from(a.current.entries()).map(([w,F])=>[w,new Set(F)])),outcomeToTransitionRef:new Map(f.current)}}),[e,t,r,p,b,m,E,i,a,f]),v=c.useCallback(w=>{r.current=w.graph,p.current=w.mappings.instanceToDefRef,b.current=w.mappings.defToInstancesRef,m.current=w.mappings.edgeToTransitionRef,E.current=w.mappings.transitionToEdgesRef,i.current=w.mappings.outcomeToParentRef??new Map,a.current=w.mappings.policyToOutcomesRef??new Map,f.current=w.mappings.outcomeToTransitionRef??new Map;const F=w.nodes.map(N=>({...N,position:{x:Math.round(N.position.x/_e)*_e,y:Math.round(N.position.y/_e)*_e}})),S=h.normalizeAllCommandEdges(w.edges,w.graph,w.mappings.instanceToDefRef,w.mappings.defToInstancesRef).map(N=>$n(N,w.graph,w.mappings.instanceToDefRef,w.mappings.outcomeToParentRef??new Map));o(F),s(S),u()},[r,p,b,m,E,i,a,f,o,s,h,u]);return{reset:y,getWorkflowState:T,hydrateWorkflow:v}}const ro=[],ao=[];function io(n){const e=c.useRef(new ye),[t,o]=c.useState(0),s=ut(),[r,l,d]=at(ro),[h,u,p]=it(ao),b=c.useRef([]);b.current=r;const{getNode:m,getNodes:E}=ve(),i=Et(e,{edgeToTransitionRef:s.edgeToTransitionRef,transitionToEdgesRef:s.transitionToEdgesRef}),a=yt(e,s.defToInstancesRef),f=bt({instanceToDefRef:s.instanceToDefRef,setNodes:l,getNodes:E}),x=(n==null?void 0:n.graphRef)??e,y=n?n.incrementGraphVersion:()=>o(Ne=>Ne+1),T=(n==null?void 0:n.nodes)??r,v=(n==null?void 0:n.edges)??h,w=(n==null?void 0:n.setNodes)??l,F=(n==null?void 0:n.setEdges)??u,X=(n==null?void 0:n.onNodesChangeInternal)??d,S=(n==null?void 0:n.onEdgesChangeInternal)??p,N=(n==null?void 0:n.nodesRef)??b,$=(n==null?void 0:n.instanceMapping)??s,{instanceToDefRef:R,defToInstancesRef:A,edgeToTransitionRef:z,transitionToEdgesRef:P}=$,k=(n==null?void 0:n.edgeTransitionManager)??i,M=(n==null?void 0:n.commandEdgeResolver)??a,D=(n==null?void 0:n.outcomeManagement)??f,W=c.useMemo(()=>v.map(Ne=>({...Ne,reconnectable:Ne.selected??!1})),[v]),{outcomeToParentRef:L,policyToOutcomesRef:j,outcomeToTransitionRef:G}=D,B={nodes:T,edges:v,setNodes:w,setEdges:F,onNodesChangeInternal:X,onEdgesChangeInternal:S,graphRef:x,graph:x.current,getNode:m,nodesRef:N,instanceMapping:$,instanceToDefRef:R,defToInstancesRef:A,edgeToTransitionRef:z,transitionToEdgesRef:P,outcomeManagement:D,edgeTransitionManager:k,commandEdgeResolver:M,incrementGraphVersion:y},{onNodesChange:H,onEdgesChange:U,onConnect:K,onReconnect:J,isValidConnection:Z}=eo(B),{addNode:C,addInstance:_,duplicateInstance:V,dissociateInstance:Q,deleteInstance:te,deleteDefinition:ue}=to(B),{getDefinitionForInstance:Ee,getInstancesForDefinition:he,updateNodeExecutionMode:pe,updateNodeLabel:q,updateNodeConfig:fe,updateNodeAwsExtension:ne,getNodeConfig:se,getNodeAwsExtension:Te,convertNodeKind:It}=no(B),{getOutcomeTransition:St,getOutcomesForPolicy:Rt,getOutcomesWithLabels:At,addOutcomeToPolicy:Pt,deleteOutcome:Dt,updateOutcomeLabel:Ot}=oo(B),{reset:Lt,getWorkflowState:jt,hydrateWorkflow:Ft}=so(B),zt=c.useMemo(()=>e.current,[t]),$t=(n==null?void 0:n.graph)??zt;return{nodes:T,edges:W,graph:$t,onNodesChange:H,onEdgesChange:U,onConnect:K,isValidConnection:Z,onReconnect:J,addNode:C,addInstance:_,duplicateInstance:V,dissociateInstance:Q,deleteInstance:te,deleteDefinition:ue,getDefinitionForInstance:Ee,getInstancesForDefinition:he,updateNodeExecutionMode:pe,updateNodeLabel:q,updateNodeConfig:fe,updateNodeAwsExtension:ne,getNodeConfig:se,getNodeAwsExtension:Te,convertNodeKind:It,reset:Lt,getWorkflowState:jt,hydrateWorkflow:Ft,getOutcomeTransition:St,getOutcomesForPolicy:Rt,getOutcomesWithLabels:At,addOutcomeToPolicy:Pt,deleteOutcome:Dt,updateOutcomeLabel:Ot}}const co=[],lo=[];function uo(){const n=c.useRef(new ye),[e,t]=c.useState(0),o=ut(),{instanceToDefRef:s,defToInstancesRef:r,edgeToTransitionRef:l,transitionToEdgesRef:d}=o,[h,u,p]=at(co),[b,m,E]=it(lo),i=c.useRef([]);i.current=h;const a=c.useMemo(()=>b.map(A=>({...A,reconnectable:A.selected??!1})),[b]),{getNode:f,getNodes:x}=ve(),y=Et(n,{edgeToTransitionRef:l,transitionToEdgesRef:d}),T=yt(n,r),v=bt({instanceToDefRef:s,setNodes:u,getNodes:x}),{outcomeToParentRef:w,policyToOutcomesRef:F,outcomeToTransitionRef:X,resetMappings:S}=v,N=c.useCallback(()=>{t(A=>A+1)},[]),$=c.useCallback(()=>{n.current=new ye,o.resetMappings(),S(),u([]),m([]),t(A=>A+1)},[u,m,o,S]),R=c.useMemo(()=>n.current,[e]);return{nodes:h,edges:b,edgesWithReconnectable:a,setNodes:u,setEdges:m,onNodesChangeInternal:p,onEdgesChangeInternal:E,graphRef:n,graph:R,getNode:f,getNodes:x,nodesRef:i,instanceMapping:o,instanceToDefRef:s,defToInstancesRef:r,edgeToTransitionRef:l,transitionToEdgesRef:d,outcomeManagement:v,outcomeToParentRef:w,policyToOutcomesRef:F,outcomeToTransitionRef:X,edgeTransitionManager:y,commandEdgeResolver:T,incrementGraphVersion:N,reset:$}}const wt=c.createContext(null);function fo({children:n}){const e=uo();return g.jsx(wt.Provider,{value:e,children:n})}function go(){const n=c.useContext(wt);if(!n)throw new Error("useWorkflowCoreContext must be used within a WorkflowCoreProvider");return n}const vt=c.createContext(null);function mo({children:n}){const e=go(),t=io(e);return g.jsx(vt.Provider,{value:t,children:n})}function vs({children:n}){return g.jsx(fo,{children:g.jsx(mo,{children:n})})}function Fe(){const n=c.useContext(vt);if(!n)throw new Error("useWorkflow must be used within a WorkflowProvider");return n}function ho(n){const e=c.useRef(null),[t,o]=c.useState(null),[s,r]=c.useState([]),[l,d]=c.useState(!1);c.useEffect(()=>{const i=new Dn(n,{transitionDelay:1e3});e.current=i;const a=(x,y)=>{const T={id:`${Date.now()}-${Math.random()}`,type:x,timestamp:y.timestamp,data:y};r(v=>[...v,T]),o(i.getState())},f=[i.on("simulation:start",x=>{a("simulation:start",x),d(!0)}),i.on("simulation:stop",x=>{a("simulation:stop",x),d(!1)}),i.on("simulation:reset",x=>{a("simulation:reset",x),d(!1)}),i.on("node:enter",x=>a("node:enter",x)),i.on("node:active",x=>a("node:active",x)),i.on("node:waiting",x=>a("node:waiting",x)),i.on("node:exit",x=>a("node:exit",x)),i.on("node:complete",x=>a("node:complete",x)),i.on("node:reset",x=>a("node:reset",x)),i.on("transition:start",x=>a("transition:start",x)),i.on("transition:complete",x=>a("transition:complete",x)),i.on("transition:reset",x=>a("transition:reset",x)),i.on("error",x=>a("error",x)),i.on("state:initialized",()=>{o(i.getState())})];return queueMicrotask(()=>{o(i.getState())}),()=>{f.forEach(x=>x()),i.stop(),e.current=null}},[n]);const h=c.useCallback(()=>{var i;(i=e.current)==null||i.start()},[]),u=c.useCallback(()=>{var i;(i=e.current)==null||i.stop()},[]),p=c.useCallback(()=>{var i;(i=e.current)==null||i.reset(),r([])},[]),b=c.useCallback(i=>{var a;(a=e.current)==null||a.triggerNode(i)},[]),m=c.useCallback(i=>{var a;(a=e.current)==null||a.selectTransition(i)},[]),E=c.useCallback(i=>{var a;(a=e.current)==null||a.completeManualNode(i)},[]);return{isRunning:l,state:t,events:s,start:h,stop:u,reset:p,triggerNode:b,selectTransition:m,completeManualNode:E}}const Tt=c.createContext(null);function Ts({children:n}){const{graph:e}=Fe(),t=ho(e);return g.jsx(Tt.Provider,{value:t,children:n})}function po(){const n=c.useContext(Tt);if(!n)throw new Error("useSimulationContext must be used within a SimulationProvider");return n}const Nt=c.createContext(null);function Ns({children:n}){const[e,t]=c.useState(null),[o,s]=c.useState(null),r=c.useCallback(h=>{t(h)},[]),l=c.useCallback(()=>{t(null)},[]),d={pendingTooltip:e,hoveredWarningEdgeId:o,showTooltip:r,hideTooltip:l,setHoveredWarningEdgeId:s};return g.jsx(Nt.Provider,{value:d,children:n})}function kt(){const n=c.useContext(Nt);if(!n)throw new Error("useNonStandardConnectionContext must be used within a NonStandardConnectionProvider");return n}function xo(){const n=xe(o=>o.theme),e=xe(o=>o.setTheme),t=xe(o=>o.toggleTheme);return{theme:n,setTheme:e,toggleTheme:t}}function bo({pathRef:n,edgeId:e,onOffsetChange:t}){const[o,s]=c.useState(!1),r=c.useRef(!1),l=c.useCallback(d=>{d.stopPropagation(),d.preventDefault(),r.current=!1,s(!0)},[]);return c.useEffect(()=>{if(!o||!n.current)return;const d=u=>{var x;if(!n.current)return;r.current=!0;const p=n.current.ownerSVGElement;if(!p)return;const b=p.createSVGPoint();b.x=u.clientX,b.y=u.clientY;const m=b.matrixTransform((x=p.getScreenCTM())==null?void 0:x.inverse()),E=n.current.getTotalLength();let i=.5,a=1/0;for(let y=0;y<=100;y++){const T=y/100,v=n.current.getPointAtLength(E*T),w=Math.sqrt(Math.pow(v.x-m.x,2)+Math.pow(v.y-m.y,2));w<a&&(a=w,i=T)}const f=Math.max(.1,Math.min(.9,i));t(e,f)},h=()=>{s(!1)};return document.addEventListener("mousemove",d),document.addEventListener("mouseup",h),()=>{document.removeEventListener("mousemove",d),document.removeEventListener("mouseup",h)}},[o,e,n,t]),{isDragging:o,hasDraggedRef:r,handleDragStart:l}}class Eo{serialize(e){try{const{graph:t,nodes:o,edges:s,mappings:r}=e,l=t.getAllNodes().map(m=>({id:m.id,label:m.label,kind:m.kind,category:m.category,executionMode:m.executionMode,config:m.config,awsExtension:m.awsExtension})),d=t.getAllTransitions().map(m=>({id:m.id,sourceDefId:m.sourceDefId,targetDefId:m.targetDefId})),h=o.filter(m=>m.type!=="outcome").map(m=>({id:m.id,definitionId:r.instanceToDefRef.get(m.id),position:{x:m.position.x,y:m.position.y}})),u=o.filter(m=>m.type==="outcome").map(m=>({id:m.id,label:m.data.label||"Outcome",parentPolicyInstanceId:m.parentId,parentPolicyDefId:m.data.parentPolicyDefId||"",position:{x:m.position.x,y:m.position.y}})),p=r.outcomeToTransitionRef?Array.from(r.outcomeToTransitionRef.entries()).map(([m,E])=>({outcomeId:m,transitionId:E})):[],b=s.filter(m=>r.edgeToTransitionRef.has(m.id)).map(m=>{const E=m.data;return{edgeId:m.id,transitionId:r.edgeToTransitionRef.get(m.id),source:m.source,target:m.target,sourceHandle:m.sourceHandle??void 0,targetHandle:m.targetHandle??void 0,label:E==null?void 0:E.label,labelOffset:E==null?void 0:E.labelOffset}});return{success:!0,workflow:{definitions:l,transitions:d,instances:h,edgeMappings:b,outcomes:u,outcomeEdgeMappings:p}}}catch(t){return{success:!1,error:{code:"VALIDATION_ERROR",message:"Failed to serialize workflow",details:t}}}}}class yo{recoverOrphanEdges(e,t,o,s){var E;const{instanceToDefRef:r,defToInstancesRef:l,edgeToTransitionRef:d,transitionToEdgesRef:h}=o,u=e.filter(i=>{const a=d.get(i.id);return a?t.getTransition(a)!==void 0:!1}),p=new Set(u.map(i=>i.id));for(const i of d.keys())if(!p.has(i)){const a=d.get(i);d.delete(i),a&&((E=h.get(a))==null||E.delete(i))}const b=new Set(d.values()),m=t.getAllTransitions().filter(i=>!b.has(i.id));for(const i of m){const a=this.createEdgeForTransition(i,t,r,l,s);a&&(u.push(a),d.set(a.id,i.id),h.has(i.id)||h.set(i.id,new Set),h.get(i.id).add(a.id))}return{edges:u,edgeToTransitionRef:d,transitionToEdgesRef:h}}createEdgeForTransition(e,t,o,s,r){const l=s.get(e.sourceDefId),d=s.get(e.targetDefId);if(!(l!=null&&l.size)||!(d!=null&&d.size))return null;const h=l.values().next().value,u=d.values().next().value,p=r.get(h),b=r.get(u);if(!p||!b)return null;const{sourceHandle:m,targetHandle:E}=zn(),i=`edge_${h}_${u}`,a=t.getNode(e.sourceDefId),f=t.getNode(e.targetDefId),x=a?mt(a.kind):"floating",y=Pe(a==null?void 0:a.kind,f==null?void 0:f.kind);return{id:i,source:h,target:u,sourceHandle:m,targetHandle:E,type:x,data:{state:"idle",transitionId:e.id,...y,...x==="commandEdge"?Ae():{}}}}}class wo{constructor(){ee(this,"edgeRecovery",new yo)}deserialize(e){try{const t=new ye;for(const f of e.definitions){const x={id:f.id,label:f.label,kind:f.kind,category:f.category,executionMode:f.executionMode,config:f.config,awsExtension:f.awsExtension};t.addNode(x)}for(const f of e.transitions){const x={id:f.id,sourceDefId:f.sourceDefId,targetDefId:f.targetDefId};t.addTransition(x)}const o=new Map,s=new Map,r=e.instances.map(f=>{const x=f.id,y=f.definitionId,T=t.getNode(y);o.set(x,y),s.has(y)||s.set(y,new Set),s.get(y).add(x);let v="event";return T.kind==="policy"?v="policy":T.kind==="externalSystem"?v="externalSystem":T.kind==="externalEvent"?v="externalEvent":T.kind==="command"?v="command":T.kind==="trigger"?v="trigger":T.kind==="hotspot"&&(v="hotspot"),{id:f.id,type:v,position:f.position,data:{label:T.label,executionMode:T.executionMode,definitionId:y}}}),l=new Map,d=new Map,h=new Map;if(e.outcomes)for(const f of e.outcomes){const x=f.id,y=f.parentPolicyInstanceId,T=f.parentPolicyDefId;l.set(x,y),d.has(y)||d.set(y,new Set),d.get(y).add(x),r.push({id:f.id,type:"outcome",position:f.position,parentId:f.parentPolicyInstanceId,data:{label:f.label,parentPolicyInstanceId:y,parentPolicyDefId:T}})}if(e.outcomeEdgeMappings)for(const f of e.outcomeEdgeMappings)h.set(f.outcomeId,f.transitionId);const u=new Map,p=new Map,b=e.edgeMappings.map(f=>{const x=f.transitionId,y=`edge_${f.source}_${f.target}`;u.set(y,x),p.has(x)||p.set(x,new Set),p.get(x).add(y);const T=l.has(f.source);let v;if(T){const X=l.get(f.source);v=X?o.get(X):void 0}else v=o.get(f.source);const w=v?t.getNode(v):void 0,F=w?mt(w.kind):"floating";return{id:y,source:f.source,target:f.target,sourceHandle:f.sourceHandle??"source-right",targetHandle:f.targetHandle??"target-left",type:F,data:{state:"idle",transitionId:x,...f.label!==void 0?{label:f.label}:{},...f.labelOffset!==void 0?{labelOffset:f.labelOffset}:{}}}}),m=new Map(r.map(f=>[f.id,f])),E={instanceToDefRef:o,defToInstancesRef:s,edgeToTransitionRef:u,transitionToEdgesRef:p,outcomeToParentRef:l,policyToOutcomesRef:d,outcomeToTransitionRef:h},i=this.edgeRecovery.recoverOrphanEdges(b,t,E,m),a={instanceToDefRef:o,defToInstancesRef:s,edgeToTransitionRef:i.edgeToTransitionRef,transitionToEdgesRef:i.transitionToEdgesRef,outcomeToParentRef:l,policyToOutcomesRef:d,outcomeToTransitionRef:h};return{success:!0,workflow:{graph:t,nodes:r,edges:i.edges,mappings:a}}}catch(t){return{success:!1,error:{code:"VALIDATION_ERROR",message:"Failed to deserialize workflow",details:t}}}}}class vo{constructor(){ee(this,"serialization",new Eo);ee(this,"deserialization",new wo)}serialize(e){return this.serialization.serialize(e)}deserialize(e){return this.deserialization.deserialize(e)}}const be=new Map,To=n=>{const e=n.workflow,t=new Set(e.definitions.filter(l=>l.kind==="command"&&l.label.trim()==="").map(l=>l.id));if(t.size===0)return n;const o=new Set(e.transitions.filter(l=>t.has(l.sourceDefId)).map(l=>l.id)),s=new Set(e.instances.filter(l=>t.has(l.definitionId)).map(l=>l.id)),r=new Set(e.edgeMappings.filter(l=>o.has(l.transitionId)||s.has(l.source)||s.has(l.target)).map(l=>l.edgeId));return{...n,workflow:{...e,definitions:e.definitions.filter(l=>!t.has(l.id)),transitions:e.transitions.filter(l=>!o.has(l.id)),instances:e.instances.filter(l=>!s.has(l.id)),edgeMappings:e.edgeMappings.filter(l=>!r.has(l.edgeId))}}},No=n=>{const e=n.metadata.name.toLowerCase().trim().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-");return{...n,metadata:{...n.metadata,slugName:e}}},ko=n=>{const t=n.metadata.targetPlugin==="none"?void 0:n.metadata.targetPlugin;return{...n,metadata:{...n.metadata,targetPlugin:t}}},Co=n=>({...n,metadata:{...n.metadata,pluginConfig:{}}}),_o=n=>({...n,workflow:{...n.workflow,definitions:n.workflow.definitions.map(e=>({...e,kind:e.kind==="externalSystem"?"externalEvent":e.kind}))}});be.set(2,To);be.set(3,No);be.set(4,ko);be.set(5,Co);be.set(6,_o);class Mo{migrate(e){try{let t=e;for(;t.version<Se;){const o=be.get(t.version);if(!o)return{success:!1,error:{code:"MIGRATION_ERROR",message:`No migration found for version ${t.version}`}};t=o(t),t={...t,version:t.version+1}}return{success:!0,document:t}}catch(t){return{success:!1,error:{code:"MIGRATION_ERROR",message:"Migration failed",details:t}}}}validate(e){if(!e.version||typeof e.version!="number"||!e.metadata||!e.workflow||!Array.isArray(e.workflow.definitions)||!Array.isArray(e.workflow.transitions)||!Array.isArray(e.workflow.instances)||!Array.isArray(e.workflow.edgeMappings))return!1;for(const t of e.workflow.definitions)if(!t.id.startsWith("def_"))return!1;for(const t of e.workflow.transitions)if(!t.id.startsWith("trans_"))return!1;for(const t of e.workflow.instances)if(!t.id.startsWith("inst_"))return!1;return!0}}const Me="arko:workflow";class Io{async save(e){try{const t=JSON.stringify(e);return localStorage.setItem(Me,t),{success:!0}}catch(t){return{success:!1,error:{code:"STORAGE_ERROR",message:"Failed to save to localStorage",details:t}}}}async load(){try{const e=localStorage.getItem(Me);return e?{success:!0,document:JSON.parse(e)}:{success:!1,error:{code:"NOT_FOUND",message:"No workflow found in localStorage"}}}catch(e){return{success:!1,error:{code:"PARSE_ERROR",message:"Failed to parse stored workflow",details:e}}}}async exists(){return localStorage.getItem(Me)!==null}async clear(){try{return localStorage.removeItem(Me),{success:!0}}catch(e){return{success:!1,error:{code:"STORAGE_ERROR",message:"Failed to clear localStorage",details:e}}}}}const So="1.0",Ro="https://arko.dev/ir/v1.json",Ao={id:"serverless-aws-ts",name:"Serverless / TypeScript / AWS",description:"AWS Lambda with TypeScript and Serverless Framework",nodeExtensions:{command:{timeout:30,memory:128},trigger:{timeout:30,memory:128}}},Po={id:"serverless-aws-php",name:"Serverless / PHP / AWS (Bref)",description:"AWS Lambda with PHP 8.3 and Bref.sh",nodeExtensions:{command:{timeout:30,memory:128},trigger:{timeout:30,memory:128}}},Ct=new Map([["serverless-aws-ts",Ao],["serverless-aws-php",Po]]);function Do(n){return Ct.get(n)}function ks(){return Array.from(Ct.values())}class Oo{compile(e,t){try{const{graph:o,nodes:s,mappings:r}=e,l=t.metadata.targetPlugin?Do(t.metadata.targetPlugin):void 0,d=l?this.getExtensionProviderForPlugin(l.id):void 0,h=o.getAllNodes(),u=[],p=[],b=[],m=[];for(const y of h)switch(y.kind){case"event":u.push(y);break;case"command":p.push(y);break;case"trigger":b.push(y);break;case"policy":m.push(y);break}const E=this.buildEventTypeMap(u),i=this.compileEvents(u,E),a=this.compilePolicies(m,o,s,r,E),f=this.compileCommands(p,b,o,E,a,d);return{success:!0,ir:{$schema:Ro,version:So,metadata:{workflowId:Cn(),name:t.metadata.name,slugName:t.metadata.slugName||ae(t.metadata.name),targetPlugin:t.metadata.targetPlugin,generatedAt:new Date().toISOString(),sourceVersion:6,pluginConfig:t.metadata.pluginConfig},events:i,commands:f,policies:a}}}catch(o){return{success:!1,error:{code:"COMPILATION_ERROR",message:o instanceof Error?o.message:"Unknown compilation error",details:o}}}}getExtensionProviderForPlugin(e){if(e==="serverless-aws-ts")return{getExtensions(t,o){if(!(t.kind!=="command"&&t.kind!=="trigger")&&o)return{aws:{timeout:o.timeout,memory:o.memory}}}}}buildEventTypeMap(e){const t=new Map;for(const o of e){const s=o.config,r=(s==null?void 0:s.type)||Le(o.label);t.set(o.id,r)}return t}compileEvents(e,t){return e.map(o=>{const s=o.config;return{id:ge(o.id),name:o.label,type:t.get(o.id),schema:s!=null&&s.schema?this.convertSchema(s.schema):null,outputPath:s==null?void 0:s.outputPath}})}compilePolicies(e,t,o,s,r){return e.map(l=>{var E,i,a,f;const h=t.getIncomingTransitions(l.id).map(x=>r.get(x.sourceDefId)).filter(x=>x!==void 0),u=s.defToInstancesRef.get(l.id),p=u==null?void 0:u.values().next().value,b=p?(E=s.policyToOutcomesRef)==null?void 0:E.get(p):void 0,m=[];if(b){const x=l.config;for(const y of b){const T=o.find(S=>S.id===y),v=((i=T==null?void 0:T.data)==null?void 0:i.label)||"Outcome",w=(a=x==null?void 0:x.outcomeConditions)==null?void 0:a.find(S=>S.outcomeLabel===v),F=(f=s.outcomeToTransitionRef)==null?void 0:f.get(y),X=[];if(F){const S=t.getTransition(F);if(S){const N=t.getNode(S.targetDefId);N&&(N.kind==="command"||N.kind==="trigger")&&X.push(ge(N.id))}}m.push({id:ge(y),label:v,condition:(w==null?void 0:w.condition)||"",targetCommandIds:X})}}return{id:ge(l.id),name:l.label,slugName:ae(l.label),consumes:h,outcomes:m}})}compileCommands(e,t,o,s,r,l){const d=[];for(const h of e){const u=this.compileCommand(h,o,s,r,l);d.push(u)}for(const h of t){const u=this.compileTriggerAsCommand(h,o,s,l);u&&d.push(u)}return d}compileCommand(e,t,o,s,r){const l=e.config,h=t.getOutgoingTransitions(e.id).map(b=>o.get(b.targetDefId)).filter(b=>b!==void 0),u=this.buildConsumptions(e.id,t,o,s),p=r==null?void 0:r.getExtensions(e,e.awsExtension);return{id:ge(e.id),name:e.label,slugName:(l==null?void 0:l.slugName)||ae(e.label,"unnamed"),produces:h,trigger:"consumer",consumes:u,requestSchema:l!=null&&l.requestSchema?this.convertSchema(l.requestSchema):null,extensions:p,outputPath:l==null?void 0:l.outputPath}}compileTriggerAsCommand(e,t,o,s){const r=e.config,d=t.getOutgoingTransitions(e.id).map(b=>o.get(b.targetDefId)).filter(b=>b!==void 0),h=s==null?void 0:s.getExtensions(e,e.awsExtension),u={id:ge(e.id),name:e.label,slugName:(r==null?void 0:r.slugName)||ae(e.label),produces:d,extensions:h,outputPath:r==null?void 0:r.outputPath};if((r==null?void 0:r.triggerType)==="schedule"&&r.schedule)return{...u,trigger:"scheduled",schedule:r.schedule};const p=(r==null?void 0:r.path)||`/${ae(e.label)}`;return{...u,trigger:"http",http:{method:(r==null?void 0:r.httpMethod)||"POST",path:p,pathParameters:kn(p)},requestSchema:r!=null&&r.schema?this.convertSchema(r.schema):null}}buildConsumptions(e,t,o,s){const r=[],l=t.getIncomingTransitions(e);for(const d of l){const h=t.getNode(d.sourceDefId);if(h){if(h.kind==="event"){const u=o.get(h.id);u&&r.push({type:"event",eventType:u})}else if(h.kind==="policy"){const u=s.find(p=>p.id===ge(h.id));if(u){const p=u.outcomes.find(b=>b.targetCommandIds.includes(ge(e)));p&&r.push({type:"policy",policyId:u.id,outcomeId:p.id})}}}}return r}convertSchema(e){return{properties:e.map(t=>this.convertSchemaProperty(t))}}convertSchemaProperty(e){const t={name:e.name,required:e.required??!1};return e.type==="array"&&e.items?{...t,type:"array",items:{properties:[this.convertSchemaProperty(e.items)]}}:e.type==="object"&&e.properties?{...t,type:"object",nested:this.convertSchema(e.properties)}:{...t,type:e.type}}}const We={version:7,metadata:{name:"E-commerce Order",slugName:"ecommerce-order",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),description:"Example workflow demonstrating an e-commerce order flow with stock checking"},workflow:{definitions:[{id:"def_01EXAMPLE_TRIGGER",label:"Order Received",kind:"trigger",category:"technical",executionMode:"manual",config:{slugName:"order-received",triggerType:"http",httpMethod:"POST",path:"/orders"}},{id:"def_01EXAMPLE_CMD_CREATE",label:"Create Order",kind:"command",category:"business",executionMode:"automatic",config:{slugName:"create-order"}},{id:"def_01EXAMPLE_EVT_CREATED",label:"Order Created",kind:"event",category:"business",executionMode:"automatic",config:{type:"order.created"}},{id:"def_01EXAMPLE_POLICY",label:"Check Stock",kind:"policy",category:"business",executionMode:"manual",config:{type:"check-stock",outcomeConditions:[{outcomeLabel:"In Stock",condition:"item.quantity > 0"},{outcomeLabel:"Out of Stock",condition:"item.quantity === 0"}]}},{id:"def_01EXAMPLE_CMD_PAYMENT",label:"Process Payment",kind:"command",category:"business",executionMode:"automatic",config:{slugName:"process-payment"}},{id:"def_01EXAMPLE_CMD_NOTIFY",label:"Notify Out of Stock",kind:"command",category:"business",executionMode:"automatic",config:{slugName:"notify-out-of-stock"}},{id:"def_01EXAMPLE_EVT_PAYMENT",label:"Payment Processed",kind:"event",category:"business",executionMode:"automatic",config:{type:"payment.processed"}},{id:"def_01EXAMPLE_EVT_NOTIFIED",label:"Customer Notified",kind:"event",category:"business",executionMode:"automatic",config:{type:"customer.notified"}}],transitions:[{id:"trans_01EXAMPLE_T1",sourceDefId:"def_01EXAMPLE_TRIGGER",targetDefId:"def_01EXAMPLE_CMD_CREATE"},{id:"trans_01EXAMPLE_T2",sourceDefId:"def_01EXAMPLE_CMD_CREATE",targetDefId:"def_01EXAMPLE_EVT_CREATED"},{id:"trans_01EXAMPLE_T3",sourceDefId:"def_01EXAMPLE_EVT_CREATED",targetDefId:"def_01EXAMPLE_POLICY"},{id:"trans_01EXAMPLE_T4",sourceDefId:"def_01EXAMPLE_POLICY",targetDefId:"def_01EXAMPLE_CMD_PAYMENT"},{id:"trans_01EXAMPLE_T5",sourceDefId:"def_01EXAMPLE_POLICY",targetDefId:"def_01EXAMPLE_CMD_NOTIFY"},{id:"trans_01EXAMPLE_T6",sourceDefId:"def_01EXAMPLE_CMD_PAYMENT",targetDefId:"def_01EXAMPLE_EVT_PAYMENT"},{id:"trans_01EXAMPLE_T7",sourceDefId:"def_01EXAMPLE_CMD_NOTIFY",targetDefId:"def_01EXAMPLE_EVT_NOTIFIED"}],instances:[{id:"inst_01EXAMPLE_TRIGGER",definitionId:"def_01EXAMPLE_TRIGGER",position:{x:100,y:300}},{id:"inst_01EXAMPLE_CMD_CREATE",definitionId:"def_01EXAMPLE_CMD_CREATE",position:{x:320,y:300}},{id:"inst_01EXAMPLE_EVT_CREATED",definitionId:"def_01EXAMPLE_EVT_CREATED",position:{x:540,y:300}},{id:"inst_01EXAMPLE_POLICY",definitionId:"def_01EXAMPLE_POLICY",position:{x:760,y:300}},{id:"inst_01EXAMPLE_CMD_PAYMENT",definitionId:"def_01EXAMPLE_CMD_PAYMENT",position:{x:1100,y:180}},{id:"inst_01EXAMPLE_CMD_NOTIFY",definitionId:"def_01EXAMPLE_CMD_NOTIFY",position:{x:1100,y:420}},{id:"inst_01EXAMPLE_EVT_PAYMENT",definitionId:"def_01EXAMPLE_EVT_PAYMENT",position:{x:1320,y:180}},{id:"inst_01EXAMPLE_EVT_NOTIFIED",definitionId:"def_01EXAMPLE_EVT_NOTIFIED",position:{x:1320,y:420}}],edgeMappings:[{edgeId:"edge_01EXAMPLE_E1",transitionId:"trans_01EXAMPLE_T1",source:"inst_01EXAMPLE_TRIGGER",target:"inst_01EXAMPLE_CMD_CREATE"},{edgeId:"edge_01EXAMPLE_E2",transitionId:"trans_01EXAMPLE_T2",source:"inst_01EXAMPLE_CMD_CREATE",target:"inst_01EXAMPLE_EVT_CREATED"},{edgeId:"edge_01EXAMPLE_E3",transitionId:"trans_01EXAMPLE_T3",source:"inst_01EXAMPLE_EVT_CREATED",target:"inst_01EXAMPLE_POLICY"},{edgeId:"edge_01EXAMPLE_E4",transitionId:"trans_01EXAMPLE_T4",source:"outcome_01EXAMPLE_INSTOCK",target:"inst_01EXAMPLE_CMD_PAYMENT"},{edgeId:"edge_01EXAMPLE_E5",transitionId:"trans_01EXAMPLE_T5",source:"outcome_01EXAMPLE_OUTSTOCK",target:"inst_01EXAMPLE_CMD_NOTIFY"},{edgeId:"edge_01EXAMPLE_E6",transitionId:"trans_01EXAMPLE_T6",source:"inst_01EXAMPLE_CMD_PAYMENT",target:"inst_01EXAMPLE_EVT_PAYMENT"},{edgeId:"edge_01EXAMPLE_E7",transitionId:"trans_01EXAMPLE_T7",source:"inst_01EXAMPLE_CMD_NOTIFY",target:"inst_01EXAMPLE_EVT_NOTIFIED"}],outcomes:[{id:"outcome_01EXAMPLE_INSTOCK",label:"In Stock",parentPolicyInstanceId:"inst_01EXAMPLE_POLICY",parentPolicyDefId:"def_01EXAMPLE_POLICY",position:{x:162,y:-30}},{id:"outcome_01EXAMPLE_OUTSTOCK",label:"Out of Stock",parentPolicyInstanceId:"inst_01EXAMPLE_POLICY",parentPolicyDefId:"def_01EXAMPLE_POLICY",position:{x:162,y:100}}],outcomeEdgeMappings:[{outcomeId:"outcome_01EXAMPLE_INSTOCK",transitionId:"trans_01EXAMPLE_T4"},{outcomeId:"outcome_01EXAMPLE_OUTSTOCK",transitionId:"trans_01EXAMPLE_T5"}]}},Ie="Untitled Workflow",Lo=1e3,_t="arko:workflows";function ce(n){return n.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"")||"workflow"}function nt(){try{const n=localStorage.getItem(_t);return n?JSON.parse(n):[]}catch{return[]}}function jo(n){try{localStorage.setItem(_t,JSON.stringify(n))}catch(e){console.error("Failed to save workflows to localStorage:",e)}}const Fo=c.createContext(null);function Cs({children:n,initialWorkflowId:e}){const t=Fe(),[o,s]=c.useState(!0),[r,l]=c.useState(null),[d,h]=c.useState(Ie),[u,p]=c.useState(()=>ce(Ie)),[b,m]=c.useState(void 0),[E,i]=c.useState({}),[a,f]=c.useState(null),[x,y]=c.useState(null),[T,v]=c.useState(!1),w=c.useRef(null),F=c.useCallback(C=>{h(_=>(p(V=>V===ce(_)?ce(C):V),C))},[]),X=c.useCallback(C=>{p(C)},[]),S=c.useRef(new vo),N=c.useRef(new Mo),$=c.useRef(new Io),R=c.useRef(new Bt),A=c.useRef(new Oo),z=c.useRef(void 0),P=c.useRef(!1),k=c.useRef(!1),M=c.useCallback(C=>{const _=S.current.deserialize(C.workflow);return _.success?(t.hydrateWorkflow(_.workflow),h(C.metadata.name),p(C.metadata.slugName||ce(C.metadata.name)),m(C.metadata.targetPlugin),i(C.metadata.pluginConfig??{}),f(C.metadata.createdAt),!0):!1},[t]);c.useEffect(()=>{(async()=>{try{const _=await $.current.load();if(_.success){if(!N.current.validate(_.document)){console.warn("Invalid workflow document in localStorage, loading example instead"),M(We),s(!1);return}const V=N.current.migrate(_.document);V.success&&M(V.document)}else console.info("No saved workflow found, loading example workflow"),M(We)}catch(_){console.error("Failed to load workflow from localStorage:",_),M(We)}finally{s(!1)}})()},[]);const D=c.useCallback(async()=>{const C=t.getWorkflowState(),_=S.current.serialize(C);if(!_.success)return{success:!1,error:_.error};const V=new Date().toISOString(),Q={version:Se,metadata:{name:d,slugName:u,targetPlugin:b,pluginConfig:E,createdAt:a||V,updatedAt:V},workflow:_.workflow};return a||f(V),$.current.save(Q)},[t,d,u,b,E,a]),{nodes:W,edges:L}=t;c.useEffect(()=>{if(!o){if(!P.current){P.current=!0;return}return z.current&&clearTimeout(z.current),z.current=setTimeout(()=>{D()},Lo),()=>{z.current&&clearTimeout(z.current)}}},[W,L,d,u,b,E,D,o]);const j=c.useCallback(()=>{const C=t.getWorkflowState(),_=S.current.serialize(C);if(!_.success)return{success:!1,error:_.error};const V=new Date().toISOString(),Q={version:Se,metadata:{name:d,slugName:u,targetPlugin:b,pluginConfig:E,createdAt:a||V,updatedAt:V},workflow:_.workflow},te=`${u||ce(d)}.json`;return R.current.exportToFile(Q,te)},[t,d,u,b,E,a]),G=c.useCallback(()=>{const C=t.getWorkflowState(),_=new Date().toISOString();return A.current.compile(C,{metadata:{name:d,slugName:u||ce(d),targetPlugin:b,pluginConfig:E,createdAt:a||_,updatedAt:_}})},[t,d,u,b,E,a]),B=c.useCallback(()=>{const C=t.getWorkflowState(),_=S.current.serialize(C);if(!_.success)throw new Error(_.error.message);const V=new Date().toISOString();return{version:Se,metadata:{name:d,slugName:u||ce(d),targetPlugin:b,pluginConfig:E,createdAt:a||V,updatedAt:V},workflow:_.workflow}},[t,d,u,b,E,a]),H=c.useCallback(async()=>{const C=await R.current.importFromFile();if(!C.success)return C;if(!N.current.validate(C.document))return{success:!1,error:{code:"VALIDATION_ERROR",message:"Invalid workflow file format"}};const _=N.current.migrate(C.document);if(!_.success)return{success:!1,error:_.error};const V=S.current.deserialize(_.document.workflow);return V.success?(t.hydrateWorkflow(V.workflow),h(_.document.metadata.name),p(_.document.metadata.slugName||ce(_.document.metadata.name)),m(_.document.metadata.targetPlugin),i(_.document.metadata.pluginConfig??{}),f(_.document.metadata.createdAt),await $.current.save(_.document),{success:!0,document:_.document}):{success:!1,error:V.error}},[t]),U=c.useCallback(async()=>(h(Ie),p(ce(Ie)),m(void 0),i({}),f(null),y(null),v(!1),w.current=null,$.current.clear()),[]),K=c.useCallback(C=>JSON.stringify({workflow:C.workflow,name:C.metadata.name,slugName:C.metadata.slugName,targetPlugin:C.metadata.targetPlugin,pluginConfig:C.metadata.pluginConfig}),[]),J=c.useCallback(async()=>{const C=B();try{const _=nt(),V=new Date().toISOString();if(x){const Q=_.findIndex(te=>te.id===x);Q!==-1&&(_[Q]={..._[Q],document:C,updatedAt:V})}else console.warn("saveToApi called without currentWorkflowId");return jo(_),w.current=K(C),v(!1),{success:!0}}catch(_){return{success:!1,error:{code:"STORAGE_ERROR",message:_ instanceof Error?_.message:"Failed to save workflow"}}}},[B,x,K]),Z=c.useCallback(async C=>{try{const V=nt().find(ue=>ue.id===C);if(!V)return{success:!1,error:{code:"NOT_FOUND",message:"Workflow not found"}};if(!N.current.validate(V.document))return{success:!1,error:{code:"VALIDATION_ERROR",message:"Invalid workflow document"}};const Q=N.current.migrate(V.document);return Q.success?M(Q.document)?(y(V.id),w.current=K(Q.document),v(!1),await $.current.save(Q.document),{success:!0,document:Q.document}):{success:!1,error:{code:"PARSE_ERROR",message:"Failed to hydrate workflow"}}:{success:!1,error:Q.error}}catch(_){return{success:!1,error:{code:"STORAGE_ERROR",message:_ instanceof Error?_.message:"Failed to load workflow"}}}},[M,K]);return c.useEffect(()=>{if(o||w.current!==null||x!==null)return;const C=B();w.current=K(C)},[o,x,B,K]),c.useEffect(()=>{if(o||!P.current||w.current===null)return;const C=B(),_=K(C);v(_!==w.current)},[W,L,d,u,b,E,o,B,K]),c.useEffect(()=>{o||e&&!k.current&&(k.current=!0,s(!0),l(null),Z(e).then(C=>{C.success||(console.error("Failed to load workflow from URL:",C.error.message),l(C.error))}).finally(()=>{s(!1)}))},[o,e,Z]),g.jsx(Fo.Provider,{value:{isLoading:o,loadError:r,workflowName:d,setWorkflowName:F,slugName:u,setSlugName:X,targetPlugin:b,setTargetPlugin:m,pluginConfig:E,setPluginConfig:i,saveToLocalStorage:D,exportToFile:j,exportToIR:G,getWorkflowDocument:B,importFromFile:H,clearStorage:U,currentWorkflowId:x,isDirty:T,saveToApi:J,loadFromApi:Z,hydrateDocument:M},children:n})}function _s({open:n,onOpenChange:e,onConfirm:t,title:o,description:s,confirmLabel:r="Confirmer",cancelLabel:l="Annuler"}){const d=()=>{t(),e(!1)};return g.jsx(Vt,{open:n,onOpenChange:e,children:g.jsxs(Gt,{children:[g.jsxs(Ht,{children:[g.jsx(Ut,{children:o}),g.jsx(qt,{children:s})]}),g.jsxs(Yt,{children:[g.jsx(Kt,{children:l}),g.jsx(Qt,{onClick:d,children:r})]})]})})}const Mt=10,De=50;function zo(n,e){const t=c.useRef([]);return c.useEffect(()=>()=>{t.current.forEach(clearTimeout)},[]),{execute:c.useCallback((s,r)=>{const{isRunning:l,start:d,triggerNode:h,selectTransition:u}=n;if(t.current.forEach(clearTimeout),t.current=[],e!=null&&e.isSourceWaiting)u(r);else if(l){h(s);const p=setTimeout(()=>{u(r)},De);t.current.push(p)}else{d();const p=setTimeout(()=>{h(s);const b=setTimeout(()=>{u(r)},De);t.current.push(b)},Mt);t.current.push(p)}},[n,e==null?void 0:e.isSourceWaiting])}}function Ms(n){const e=c.useRef([]);return c.useEffect(()=>()=>{e.current.forEach(clearTimeout)},[]),{execute:c.useCallback(o=>{const{isRunning:s,start:r,triggerNode:l,completeManualNode:d}=n;if(e.current.forEach(clearTimeout),e.current=[],s){l(o);const h=setTimeout(()=>{d(o)},De);e.current.push(h)}else{r();const h=setTimeout(()=>{l(o);const u=setTimeout(()=>{d(o)},De);e.current.push(u)},Mt);e.current.push(h)}},[n])}}function $o({ref:n,onClose:e,enabled:t=!0,listenEscape:o=!0,listenClickOutside:s=!0}){c.useEffect(()=>{if(!t)return;const r=h=>{n.current&&!n.current.contains(h.target)&&e()},l=h=>{h.key==="Escape"&&e()},d=setTimeout(()=>{s&&document.addEventListener("mousedown",r),o&&document.addEventListener("keydown",l)},0);return()=>{clearTimeout(d),s&&document.removeEventListener("mousedown",r),o&&document.removeEventListener("keydown",l)}},[n,e,t,o,s])}function Is(n,e=!0){c.useEffect(()=>{if(!e)return;const t=o=>{o.key==="Escape"&&n()};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[n,e])}function Ss(){const n=xe(o=>o.sidebarCollapsed),e=xe(o=>o.setSidebarCollapsed),t=xe(o=>o.toggleSidebar);return{collapsed:n,setCollapsed:e,toggleCollapsed:t}}const me={event:{gradient:"gradient-event",rotate:"rotate-event",selected:"node-selected-event",pulse:"animate-pulse-event"},command:{gradient:"gradient-command",rotate:"rotate-command",selected:"node-selected-command",pulse:"animate-pulse-command"},policy:{gradient:"gradient-policy",rotate:"rotate-policy",selected:"node-selected-policy",pulse:"animate-pulse-policy"},trigger:{gradient:"gradient-trigger",rotate:"rotate-trigger",selected:"node-selected-trigger",pulse:"animate-pulse-trigger"},externalSystem:{gradient:"gradient-external",rotate:"rotate-external-system",selected:"node-selected-external",pulse:"animate-pulse-external"},externalEvent:{gradient:"gradient-external",rotate:"rotate-external-event",selected:"node-selected-external",pulse:"animate-pulse-external"},hotspot:{gradient:"gradient-hotspot",rotate:"rotate-hotspot",selected:"node-selected-hotspot"}};function Wo({text:n,maxWidth:e,maxHeight:t,minFontSize:o=8,maxFontSize:s=18}){return c.useMemo(()=>{if(!n||e<=0||t<=0)return{fontSize:s};const r=document.createElement("div");r.style.cssText=`
      position: absolute;
      left: -9999px;
      top: -9999px;
      width: ${e}px;
      height: ${t}px;
      overflow: hidden;
      font-family: system-ui, -apple-system, sans-serif;
      font-weight: 400;
      line-height: 1.3;
      white-space: pre-wrap;
      word-wrap: break-word;
      text-align: center;
      box-sizing: border-box;
    `,r.textContent=n,document.body.appendChild(r);let l=o;for(let d=s;d>=o;d--){r.style.fontSize=`${d}px`;const h=r.scrollHeight<=r.clientHeight,u=r.scrollWidth<=r.clientWidth;if(h&&u){l=d;break}}return document.body.removeChild(r),{fontSize:l}},[n,e,t,o,s])}const Xo=128,Bo=78,ie=c.memo(c.forwardRef(function({value:e,onChange:t,className:o,placeholder:s="Label",maxWidth:r=Xo,maxHeight:l=Bo,minFontSize:d=8,maxFontSize:h=18,autoSize:u=!1,onEditEnd:p},b){const[m,E]=c.useState(!1),i=c.useRef(null),{fontSize:a}=Wo({text:u?"":e||s,maxWidth:r,maxHeight:l,minFontSize:d,maxFontSize:h});c.useImperativeHandle(b,()=>({startEditing:()=>E(!0)}),[]),c.useEffect(()=>{if(m&&i.current){i.current.focus();const S=window.getSelection(),N=document.createRange();N.selectNodeContents(i.current),S==null||S.removeAllRanges(),S==null||S.addRange(N)}},[m]);const f=c.useCallback(S=>{S.stopPropagation(),E(!0)},[]),x=c.useCallback(()=>{var N;if(!i.current)return;const S=((N=i.current.textContent)==null?void 0:N.trim())||"";S!==e&&t(S),E(!1),p==null||p(S)},[e,t,p]),y=c.useCallback(()=>{i.current&&(i.current.textContent=e),E(!1),p==null||p(e)},[e,p]),T=c.useCallback(S=>{S.key==="Enter"&&!S.shiftKey?(S.preventDefault(),x()):S.key==="Escape"&&(S.preventDefault(),y())},[x,y]),v=c.useCallback(()=>{x()},[x]),w=c.useCallback(S=>{m&&S.stopPropagation()},[m]),F=c.useCallback(S=>{m&&S.stopPropagation()},[m]),X=u?void 0:{fontSize:`${a}px`};return g.jsx("span",{ref:i,className:Y("flex items-center text-center font-normal text-[0.75rem] whitespace-pre-wrap leading-[1.3] break-words overflow-hidden flex-1 min-w-[4em] min-h-[1.3em] text-postit-text","cursor-text",m&&"outline-none bg-black/20 rounded px-1.5 py-0.5 shadow-[0_0_0_1px_rgba(255,255,255,0.4)] nodrag nopan",o),style:X,contentEditable:m,suppressContentEditableWarning:!0,onDoubleClick:f,onKeyDown:m?T:void 0,onBlur:m?v:void 0,onMouseDown:w,onClick:F,children:e})})),Rs=c.memo(function({label:e,selected:t,isCompleted:o,isActive:s,isTargetConnectable:r,isSourceConnectable:l,onLabelChange:d,placeholder:h="Event",instanceCount:u,toolbar:p,quickCreateButtons:b}){const m=me.event;return g.jsxs("div",{className:Y("node-postit",m.gradient,m.rotate,"w-[152px] h-[112px] p-3 flex items-center justify-center","transition-shadow duration-200 hover:scale-[1.02]",t&&`node-selected ${m.selected}`,o&&"bg-success! node-completed",s&&m.pulse),children:[p,b,g.jsx(O,{type:"target",position:I.Top,id:"target-top",className:"node-handle node-handle-horizontal",isConnectable:r}),g.jsx(O,{type:"target",position:I.Bottom,id:"target-bottom",className:"node-handle node-handle-horizontal",isConnectable:r}),g.jsx(O,{type:"target",position:I.Left,id:"target-left",className:"node-handle node-handle-vertical",isConnectable:r}),g.jsx(O,{type:"target",position:I.Right,id:"target-right",className:"node-handle node-handle-vertical",isConnectable:r}),g.jsx(O,{type:"source",position:I.Top,id:"source-top",className:"node-handle node-handle-horizontal",isConnectable:l}),g.jsx(O,{type:"source",position:I.Bottom,id:"source-bottom",className:"node-handle node-handle-horizontal",isConnectable:l}),g.jsx(O,{type:"source",position:I.Left,id:"source-left",className:"node-handle node-handle-vertical",isConnectable:l}),g.jsx(O,{type:"source",position:I.Right,id:"source-right",className:"node-handle node-handle-vertical",isConnectable:l}),g.jsx("div",{className:"p-0 text-center w-full h-full flex flex-col items-center justify-center",children:g.jsx(ie,{value:e,onChange:d,placeholder:h})}),u&&u>1&&g.jsx("div",{className:"absolute top-1 left-1 flex gap-[3px] z-10",children:g.jsxs("span",{className:"text-[0.4rem] px-[5px] py-0.5 rounded-[3px] bg-black/30 text-white/80 font-semibold tracking-[0.3px] cursor-help",title:`${u} instances share this definition`,children:["x",u]})})]})}),As=c.memo(function({label:e,selected:t,isCompact:o,isCompleted:s,isActive:r,isWaiting:l,isTargetConnectable:d,isSourceConnectable:h,onLabelChange:u,onDoubleClick:p,onEditEnd:b,labelRef:m,placeholder:E="Command",instanceCount:i,toolbar:a,quickCreateButtons:f}){const x=me.command;return g.jsxs("div",{className:Y("node-postit",x.gradient,x.rotate,"h-[112px] p-3 flex items-center justify-center","transition-shadow duration-200 hover:scale-[1.02]",o?"w-8 [&_.node-content]:hidden [&_.top-left-tags]:hidden [&::before]:left-[10%] [&::before]:right-[10%] [&::before]:h-1.5":"w-[152px]",t&&`node-selected ${x.selected}`,s&&"bg-success! node-completed",r&&"animate-pulse-success",l&&x.pulse),onDoubleClick:p,children:[a,f,g.jsx(O,{type:"target",position:I.Top,id:"target-top",className:"node-handle node-handle-horizontal",isConnectable:d}),g.jsx(O,{type:"target",position:I.Bottom,id:"target-bottom",className:"node-handle node-handle-horizontal",isConnectable:d}),g.jsx(O,{type:"target",position:I.Left,id:"target-left",className:"node-handle node-handle-vertical",isConnectable:d}),g.jsx(O,{type:"target",position:I.Right,id:"target-right",className:"node-handle node-handle-vertical",isConnectable:d}),g.jsx(O,{type:"source",position:I.Top,id:"source-top",className:"node-handle node-handle-horizontal",isConnectable:h}),g.jsx(O,{type:"source",position:I.Bottom,id:"source-bottom",className:"node-handle node-handle-horizontal",isConnectable:h}),g.jsx(O,{type:"source",position:I.Left,id:"source-left",className:"node-handle node-handle-vertical",isConnectable:h}),g.jsx(O,{type:"source",position:I.Right,id:"source-right",className:"node-handle node-handle-vertical",isConnectable:h}),g.jsx("div",{className:"node-content p-0 text-center w-full h-full flex flex-col items-center justify-center",children:g.jsx(ie,{ref:m,value:e,onChange:u,placeholder:E,onEditEnd:b})}),i&&i>1&&g.jsx("div",{className:"top-left-tags absolute top-1 left-1 flex gap-[3px] z-10",children:g.jsxs("span",{className:"text-[0.4rem] px-[5px] py-0.5 rounded-[3px] bg-black/30 text-white/80 font-semibold tracking-[0.3px] cursor-help",title:`${i} instances share this definition`,children:["x",i]})})]})}),Ps=c.memo(function({label:e,selected:t,isCompleted:o,isActive:s,isWaiting:r,isTargetConnectable:l,isSourceConnectable:d,onLabelChange:h,placeholder:u="Policy",instanceCount:p,toolbar:b,quickCreateButtons:m,children:E}){const i=me.policy;return g.jsxs("div",{className:Y("node-postit",i.gradient,i.rotate,"w-[152px] h-[112px] p-3 flex items-center justify-center","transition-shadow duration-200 hover:scale-[1.02]",t&&`node-selected ${i.selected}`,o&&"bg-success! node-completed",s&&"animate-pulse-success",r&&i.pulse),children:[b,m,g.jsx(O,{type:"target",position:I.Top,id:"target-top",className:"node-handle node-handle-horizontal",isConnectable:l}),g.jsx(O,{type:"target",position:I.Bottom,id:"target-bottom",className:"node-handle node-handle-horizontal",isConnectable:l}),g.jsx(O,{type:"target",position:I.Left,id:"target-left",className:"node-handle node-handle-vertical",isConnectable:l}),g.jsx(O,{type:"target",position:I.Right,id:"target-right",className:"node-handle node-handle-vertical",isConnectable:l}),d!==void 0&&g.jsxs(g.Fragment,{children:[g.jsx(O,{type:"source",position:I.Top,id:"source-top",className:"node-handle node-handle-horizontal",isConnectable:d}),g.jsx(O,{type:"source",position:I.Bottom,id:"source-bottom",className:"node-handle node-handle-horizontal",isConnectable:d}),g.jsx(O,{type:"source",position:I.Left,id:"source-left",className:"node-handle node-handle-vertical",isConnectable:d}),g.jsx(O,{type:"source",position:I.Right,id:"source-right",className:"node-handle node-handle-vertical",isConnectable:d})]}),g.jsx("div",{className:"p-0 text-center w-full h-full flex flex-col items-center justify-center",children:g.jsx(ie,{value:e,onChange:h,placeholder:u})}),p&&p>1&&g.jsx("div",{className:"absolute top-1 left-1 flex gap-[3px] z-10",children:g.jsxs("span",{className:"text-[0.4rem] px-[5px] py-0.5 rounded-[3px] bg-black/30 text-white/80 font-semibold tracking-[0.3px] cursor-help",title:`${p} instances share this definition`,children:["x",p]})}),E]})}),Ds=c.memo(function({label:e,selected:t,isCompact:o,isCompleted:s,isActive:r,isWaiting:l,isTargetConnectable:d,isSourceConnectable:h,onLabelChange:u,onDoubleClick:p,onEditEnd:b,labelRef:m,placeholder:E="Trigger",instanceCount:i,toolbar:a,quickCreateButtons:f,playButton:x}){const y=me.trigger;return g.jsxs("div",{className:Y("node-postit",y.gradient,y.rotate,"h-[112px] p-3 flex items-center justify-center","transition-shadow duration-200 hover:scale-[1.02]",o?"w-8 [&_.node-content]:hidden [&_.top-left-tags]:hidden [&::before]:left-[10%] [&::before]:right-[10%] [&::before]:h-1.5 [&_.play-btn]:right-auto [&_.play-btn]:left-1/2 [&_.play-btn]:-translate-x-1/2":"w-[152px]",t&&`node-selected ${y.selected}`,s&&"bg-success! node-completed",r&&"animate-pulse-success",l&&y.pulse),onDoubleClick:p,children:[a,f,g.jsx(O,{type:"target",position:I.Top,id:"target-top",className:"node-handle node-handle-horizontal",isConnectable:d}),g.jsx(O,{type:"target",position:I.Bottom,id:"target-bottom",className:"node-handle node-handle-horizontal",isConnectable:d}),g.jsx(O,{type:"target",position:I.Left,id:"target-left",className:"node-handle node-handle-vertical",isConnectable:d}),g.jsx(O,{type:"target",position:I.Right,id:"target-right",className:"node-handle node-handle-vertical",isConnectable:d}),g.jsx(O,{type:"source",position:I.Top,id:"source-top",className:"node-handle node-handle-horizontal",isConnectable:h}),g.jsx(O,{type:"source",position:I.Bottom,id:"source-bottom",className:"node-handle node-handle-horizontal",isConnectable:h}),g.jsx(O,{type:"source",position:I.Left,id:"source-left",className:"node-handle node-handle-vertical",isConnectable:h}),g.jsx(O,{type:"source",position:I.Right,id:"source-right",className:"node-handle node-handle-vertical",isConnectable:h}),g.jsx("div",{className:"node-content p-0 text-center w-full h-full flex flex-col items-center justify-center",children:g.jsx(ie,{ref:m,value:e,onChange:u,placeholder:E,onEditEnd:b})}),x,i&&i>1&&g.jsx("div",{className:"top-left-tags absolute top-1 left-1 flex gap-[3px] z-10",children:g.jsxs("span",{className:"text-[0.4rem] px-[5px] py-0.5 rounded-[3px] bg-black/30 text-white/80 font-semibold tracking-[0.3px] cursor-help",title:`${i} instances share this definition`,children:["x",i]})})]})}),Os=c.memo(function({label:e,selected:t,isCompact:o,isCompleted:s,isActive:r,isWaiting:l,isTargetConnectable:d,isSourceConnectable:h,onLabelChange:u,onDoubleClick:p,onEditEnd:b,labelRef:m,placeholder:E="External System",instanceCount:i,toolbar:a,quickCreateButtons:f,playButton:x}){const y=me.externalSystem;return g.jsxs("div",{className:Y("node-postit",y.gradient,y.rotate,"h-[112px] p-3 flex items-center justify-center","transition-shadow duration-200 hover:scale-[1.02]",o?"w-8 [&_.node-content]:hidden [&_.top-left-tags]:hidden [&::before]:left-[10%] [&::before]:right-[10%] [&::before]:h-1.5 [&_.play-btn]:right-auto [&_.play-btn]:left-1/2 [&_.play-btn]:-translate-x-1/2":"w-[152px]",t&&`node-selected ${y.selected}`,s&&"bg-success! node-completed",r&&"animate-pulse-success",l&&y.pulse),onDoubleClick:p,children:[a,f,g.jsx(O,{type:"target",position:I.Top,id:"target-top",className:"node-handle node-handle-horizontal",isConnectable:d}),g.jsx(O,{type:"target",position:I.Bottom,id:"target-bottom",className:"node-handle node-handle-horizontal",isConnectable:d}),g.jsx(O,{type:"target",position:I.Left,id:"target-left",className:"node-handle node-handle-vertical",isConnectable:d}),g.jsx(O,{type:"target",position:I.Right,id:"target-right",className:"node-handle node-handle-vertical",isConnectable:d}),g.jsx(O,{type:"source",position:I.Top,id:"source-top",className:"node-handle node-handle-horizontal",isConnectable:h}),g.jsx(O,{type:"source",position:I.Bottom,id:"source-bottom",className:"node-handle node-handle-horizontal",isConnectable:h}),g.jsx(O,{type:"source",position:I.Left,id:"source-left",className:"node-handle node-handle-vertical",isConnectable:h}),g.jsx(O,{type:"source",position:I.Right,id:"source-right",className:"node-handle node-handle-vertical",isConnectable:h}),g.jsx("div",{className:"node-content p-0 text-center w-full h-full flex flex-col items-center justify-center",children:g.jsx(ie,{ref:m,value:e,onChange:u,placeholder:E,onEditEnd:b})}),x,i&&i>1&&g.jsx("div",{className:"top-left-tags absolute top-1 left-1 flex gap-[3px] z-10",children:g.jsxs("span",{className:"text-[0.4rem] px-[5px] py-0.5 rounded-[3px] bg-black/30 text-white/80 font-semibold tracking-[0.3px] cursor-help",title:`${i} instances share this definition`,children:["x",i]})})]})}),Ls=c.memo(function({label:e,selected:t,isCompact:o,isCompleted:s,isActive:r,isWaiting:l,isTargetConnectable:d,isSourceConnectable:h,onLabelChange:u,onDoubleClick:p,onEditEnd:b,labelRef:m,placeholder:E="External Event",instanceCount:i,toolbar:a,quickCreateButtons:f,playButton:x}){const y=me.externalEvent;return g.jsxs("div",{className:Y("node-postit",y.gradient,y.rotate,"h-[112px] p-3 flex items-center justify-center","transition-shadow duration-200 hover:scale-[1.02]",o?"w-8 [&_.node-content]:hidden [&_.top-left-tags]:hidden [&::before]:left-[10%] [&::before]:right-[10%] [&::before]:h-1.5 [&_.play-btn]:right-auto [&_.play-btn]:left-1/2 [&_.play-btn]:-translate-x-1/2":"w-[152px]",t&&`node-selected ${y.selected}`,s&&"bg-success! node-completed",r&&"animate-pulse-success",l&&y.pulse),onDoubleClick:p,children:[a,f,g.jsx(O,{type:"target",position:I.Top,id:"target-top",className:"node-handle node-handle-horizontal",isConnectable:d}),g.jsx(O,{type:"target",position:I.Bottom,id:"target-bottom",className:"node-handle node-handle-horizontal",isConnectable:d}),g.jsx(O,{type:"target",position:I.Left,id:"target-left",className:"node-handle node-handle-vertical",isConnectable:d}),g.jsx(O,{type:"target",position:I.Right,id:"target-right",className:"node-handle node-handle-vertical",isConnectable:d}),g.jsx(O,{type:"source",position:I.Top,id:"source-top",className:"node-handle node-handle-horizontal",isConnectable:h}),g.jsx(O,{type:"source",position:I.Bottom,id:"source-bottom",className:"node-handle node-handle-horizontal",isConnectable:h}),g.jsx(O,{type:"source",position:I.Left,id:"source-left",className:"node-handle node-handle-vertical",isConnectable:h}),g.jsx(O,{type:"source",position:I.Right,id:"source-right",className:"node-handle node-handle-vertical",isConnectable:h}),g.jsx("div",{className:"node-content p-0 text-center w-full h-full flex flex-col items-center justify-center",children:g.jsx(ie,{ref:m,value:e,onChange:u,placeholder:E,onEditEnd:b})}),x,i&&i>1&&g.jsx("div",{className:"top-left-tags absolute top-1 left-1 flex gap-[3px] z-10",children:g.jsxs("span",{className:"text-[0.4rem] px-[5px] py-0.5 rounded-[3px] bg-black/30 text-white/80 font-semibold tracking-[0.3px] cursor-help",title:`${i} instances share this definition`,children:["x",i]})})]})}),js=c.memo(function({label:e,selected:t,description:o,onLabelChange:s,placeholder:r="HotSpot",instanceCount:l,toolbar:d}){const h=me.hotspot;return g.jsxs("div",{className:Y("node-postit",h.gradient,h.rotate,"w-[152px] h-[112px] p-3 flex items-center justify-center","transition-shadow duration-200 hover:scale-[1.02]",t&&`node-selected ${h.selected}`),children:[d,g.jsxs("div",{className:"p-0 text-center w-full h-full flex flex-col items-center justify-center",children:[g.jsx(ie,{value:e,onChange:s,placeholder:r}),o&&g.jsx("div",{className:"text-[0.6rem] text-black/70 mt-1 text-center overflow-hidden line-clamp-2 leading-[1.2]",children:o})]}),l&&l>1&&g.jsx("div",{className:"absolute top-1 left-1 flex gap-[3px] z-10",children:g.jsxs("span",{className:"text-[0.4rem] px-[5px] py-0.5 rounded-[3px] bg-black/30 text-white/80 font-semibold tracking-[0.3px] cursor-help",title:`${l} instances share this definition`,children:["x",l]})})]})}),Fs=c.memo(function({label:e,selected:t,isCompleted:o,isActive:s,isTargetConnectable:r,isSourceConnectable:l,onLabelChange:d,placeholder:h="Actor",toolbar:u,quickCreateButtons:p}){return g.jsxs("div",{className:Y("node-postit gradient-actor rotate-actor","w-[152px] h-[112px] p-3 flex items-center justify-center","transition-shadow duration-200 hover:scale-[1.02]",t&&"node-selected node-selected-actor",o&&"bg-success! node-completed",s&&"animate-pulse-actor"),children:[u,p,r!==void 0&&g.jsxs(g.Fragment,{children:[g.jsx(O,{type:"target",position:I.Top,id:"target-top",className:"node-handle node-handle-horizontal",isConnectable:r}),g.jsx(O,{type:"target",position:I.Bottom,id:"target-bottom",className:"node-handle node-handle-horizontal",isConnectable:r}),g.jsx(O,{type:"target",position:I.Left,id:"target-left",className:"node-handle node-handle-vertical",isConnectable:r}),g.jsx(O,{type:"target",position:I.Right,id:"target-right",className:"node-handle node-handle-vertical",isConnectable:r})]}),l!==void 0&&g.jsxs(g.Fragment,{children:[g.jsx(O,{type:"source",position:I.Top,id:"source-top",className:"node-handle node-handle-horizontal",isConnectable:l}),g.jsx(O,{type:"source",position:I.Bottom,id:"source-bottom",className:"node-handle node-handle-horizontal",isConnectable:l}),g.jsx(O,{type:"source",position:I.Left,id:"source-left",className:"node-handle node-handle-vertical",isConnectable:l}),g.jsx(O,{type:"source",position:I.Right,id:"source-right",className:"node-handle node-handle-vertical",isConnectable:l})]}),g.jsx("div",{className:"p-0 text-center w-full h-full flex flex-col items-center justify-center",children:g.jsx(ie,{value:e,onChange:d,placeholder:h})})]})}),zs=c.memo(function({label:e,selected:t,onLabelChange:o,placeholder:s="Note",toolbar:r}){return g.jsxs("div",{className:Y("node-postit gradient-note rotate-note","w-[152px] h-[112px] p-3 flex items-center justify-center","transition-shadow duration-200 hover:scale-[1.02]",t&&"node-selected node-selected-note"),children:[r,g.jsx("div",{className:"p-0 text-center w-full h-full flex flex-col items-center justify-center",children:g.jsx(ie,{value:e,onChange:o,placeholder:s})})]})}),Vo=200,Go=150,$s=c.memo(function({label:e,selected:t,onLabelChange:o,onResizeStart:s,onResize:r,onResizeEnd:l,placeholder:d="Group",toolbar:h,children:u}){const{zoom:p}=tn(),b=c.useRef(null),m=c.useRef(null),E=Math.min(8,Math.max(.7,1/p));return c.useEffect(()=>{if(b.current&&m.current){m.current.textContent=e||d;const i=m.current.offsetWidth;b.current.style.width=`${Math.max(60,i+4)}px`}},[e,d]),g.jsxs("div",{className:Y("relative w-full h-full rounded-lg","border-[1.5px] border-[rgba(139,92,246,0.5)]"),style:{background:"radial-gradient(ellipse at center, transparent 30%, rgba(139,92,246,0.06) 100%)"},children:[g.jsx(nn,{minWidth:Vo,minHeight:Go,isVisible:!0,lineClassName:"group-resize-line !z-[1000]",handleClassName:"group-resize-handle !z-[1000]",onResizeStart:()=>s==null?void 0:s(),onResize:(i,a)=>r==null?void 0:r(a.width,a.height),onResizeEnd:(i,a)=>l==null?void 0:l(a.width,a.height)}),h,g.jsxs("div",{className:Y("absolute z-10 origin-bottom-left"),style:{top:`${-10*E-20}px`,left:"8px",transform:`scale(${E})`},children:[g.jsx("span",{ref:m,className:"absolute invisible whitespace-pre text-sm font-semibold","aria-hidden":"true"}),g.jsx("input",{ref:b,type:"text",value:e,onChange:i=>o(i.target.value),placeholder:d,className:Y("bg-transparent border-none outline-none","text-sm font-semibold","min-w-[60px]","text-[rgba(139,92,246,0.7)] placeholder:text-[rgba(139,92,246,0.4)]")})]}),g.jsx("div",{className:"w-full h-full pointer-events-none",children:u})]})}),Ws="w-4 h-4",Xs=10,Ho=Y("w-7 h-7 rounded-md flex items-center justify-center","border-none cursor-pointer","transition-all duration-150","hover:scale-110 active:scale-95","focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-1 focus-visible:ring-text-primary"),Uo=Y("p-1.5 rounded","transition-colors","focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-1"),Bs=Y("flex items-center gap-1.5 p-1.5 rounded-lg","bg-bg-secondary/95 backdrop-blur-sm","border border-border shadow-[var(--shadow-toolbar)]"),Vs=Y("flex gap-1 bg-white rounded-lg shadow-lg p-1 border border-gray-200","dark:bg-bg-secondary dark:border-border");function Gs(n){return Y(Ho,{default:"bg-text-muted/20 text-text-secondary hover:bg-text-muted/30",danger:"bg-danger/20 text-danger hover:bg-danger/30",info:"bg-info/20 text-info hover:bg-info/30",accent:"bg-accent/20 text-accent hover:bg-accent/30",event:"bg-node-event/20 text-node-event hover:bg-node-event/30",trigger:"bg-node-trigger/20 text-node-trigger hover:bg-node-trigger/30",command:"bg-node-command/20 text-node-command hover:bg-node-command/30"}[n])}function Hs(n){return Y(Uo,{default:"text-gray-500 hover:bg-gray-50 hover:text-gray-700 dark:hover:bg-text-muted/20 dark:hover:text-text-primary",danger:"text-gray-500 hover:bg-red-50 hover:text-red-500 dark:hover:bg-danger/20 dark:hover:text-danger",purple:"text-gray-500 hover:bg-purple-50 hover:text-purple-500 dark:hover:bg-node-policy/20 dark:hover:text-node-policy"}[n])}function qo(){const{getNode:n}=ve(),{addNode:e,onConnect:t}=Fe(),o=c.useCallback((r,l=!1)=>{const h=Be[l?"policy":r];return h?[...h.canConnectTo]:[]},[]),s=c.useCallback((r,l,d)=>{var f,x;const h=n(r);if(!h)return;const u=h.parentId?n(h.parentId):void 0,p=Ln(h.position,u==null?void 0:u.position),b=((f=h.measured)==null?void 0:f.width)??Wn,m=((x=h.measured)==null?void 0:x.height)??Xn,E=Gn(p,b,m,d),i=e(l,E),a=Vn(d);t({source:r,target:i,sourceHandle:a.source,targetHandle:a.target})},[n,e,t]);return{getValidTargetTypes:o,createConnectedNode:s}}const Yo={event:{label:"Event",Icon:lt},command:{label:"Command",Icon:En},policy:{label:"Policy",Icon:ln},trigger:{label:"Trigger",Icon:Ve},externalSystem:{label:"Ext System",Icon:He},externalEvent:{label:"Ext Event",Icon:He}},Ko={event:"bg-node-event text-postit-text",command:"bg-[#3b82f6] text-white",policy:"bg-node-policy text-postit-text",trigger:"bg-node-trigger text-postit-text",externalSystem:"bg-node-external text-postit-text",externalEvent:"bg-node-external text-postit-text"};function Qo({validTypes:n,anchorPosition:e,direction:t,onSelect:o,onClose:s,typeConfig:r,getIconColorClass:l}){const d=c.useRef(null);$o({ref:d,onClose:s});const u=c.useCallback(()=>{const f=n.length*44+8,x=10,y=8;let T,v;switch(t){case"top":T=e.x-180/2,v=e.y-f-y;break;case"bottom":T=e.x-180/2,v=e.y+y;break;case"left":T=e.x-180-y,v=e.y-f/2;break;case"right":T=e.x+y,v=e.y-f/2;break}return T+180>window.innerWidth-x&&(T=window.innerWidth-180-x),v+f>window.innerHeight-x&&(v=window.innerHeight-f-x),T<x&&(T=x),v<x&&(v=x),{x:T,y:v}},[e,t,n.length])(),p=c.useMemo(()=>{if(!n.includes("event"))return n;const a=n.filter(x=>x!=="event"),f=Math.floor(a.length/2);return[...a.slice(0,f),"event",...a.slice(f)]},[n]),b=c.useCallback(a=>{o(a),s()},[o,s]),m=c.useCallback(a=>r&&a in r?r[a]:Yo[a]??{label:a,Icon:lt},[r]),E=c.useCallback(a=>l?l(a):Ko[a]??"bg-gray-500 text-white",[l]);if(p.length===0)return null;const i=g.jsx("div",{ref:d,className:Y("fixed bg-bg-secondary border border-border rounded-lg","shadow-[0_4px_16px_rgba(0,0,0,0.3)] p-1 z-[10000] min-w-[160px]","animate-zoom-in","light:bg-white light:shadow-[0_4px_16px_rgba(0,0,0,0.15)]"),style:{left:u.x,top:u.y},children:p.map(a=>{const f=m(a);return g.jsxs("button",{className:Y("flex items-center gap-2.5 py-2 px-3 rounded-md","cursor-pointer transition-colors duration-100","text-text-primary border-none bg-transparent w-full text-[13px]","hover:bg-bg-tertiary active:scale-[0.98]"),onClick:()=>b(a),children:[g.jsx("span",{className:Y("w-6 h-6 rounded flex items-center justify-center shrink-0","[&_svg]:w-3.5 [&_svg]:h-3.5",E(a)),children:g.jsx(f.Icon,{})}),g.jsx("span",{className:"flex-1 text-left",children:f.label})]},a)})});return on.createPortal(i,document.body)}const Jo=c.memo(Qo),Zo=c.memo(function({outcomeId:e,canDelete:t,onDelete:o}){const s=c.useCallback(r=>{r.stopPropagation(),t&&o(e)},[e,t,o]);return g.jsx(sn,{position:I.Top,offset:10,className:Y("flex items-center gap-1.5 p-1.5 rounded-lg","bg-bg-secondary/95 backdrop-blur-sm","border border-border shadow-[var(--shadow-toolbar)]"),children:g.jsx("button",{className:Y("w-7 h-7 rounded-md flex items-center justify-center","border-none cursor-pointer transition-all duration-150","hover:scale-110 active:scale-95","bg-danger/20 text-danger hover:bg-danger/30","disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100"),onClick:s,disabled:!t,title:t?"Delete outcome":"Cannot delete - minimum 2 outcomes required",children:g.jsx(Jt,{className:"w-4 h-4"})})})}),Us=c.memo(function({id:e,data:t,selected:o}){const s=rn(),r=o||s.inProgress,{state:l,selectTransition:d,isRunning:h,start:u,triggerNode:p}=po(),{getOutcomeTransition:b,updateOutcomeLabel:m,deleteOutcome:E,getOutcomesForPolicy:i}=Fe(),f=(t.parentPolicyDefId?l==null?void 0:l.nodeStates.get(t.parentPolicyDefId):void 0)==="waiting_for_action",x=e,y=b(x),T=!!y,w=i(t.parentPolicyInstanceId).length>2,F=c.useCallback(N=>{w&&E(N)},[w,E]),X=c.useCallback(N=>{N.stopPropagation(),!(!y||!t.parentPolicyDefId)&&(f?d(y):h?(p(t.parentPolicyDefId),setTimeout(()=>{d(y)},50)):(u(),setTimeout(()=>{p(t.parentPolicyDefId),setTimeout(()=>{d(y)},50)},10)))},[y,t.parentPolicyDefId,f,h,u,p,d]),S=c.useCallback(N=>{m(e,N)},[e,m]);return g.jsxs("div",{className:Y("gradient-outcome border border-node-policy/50 rounded-md","w-auto h-auto min-w-[50px] min-h-8 p-0","shadow-[0_2px_4px_rgba(0,0,0,0.3)] transition-all duration-200","hover:scale-[1.02]",o&&"node-selected node-selected-outcome shadow-[0_0_8px_rgba(147,51,234,0.8)] border-node-policy",f&&"gradient-outcome-clickable border-node-policy cursor-pointer animate-pulse-outcome hover:scale-[1.08] hover:shadow-[0_0_12px_rgba(147,51,234,0.9)]"),children:[g.jsx(Zo,{outcomeId:x,canDelete:w,onDelete:F}),o&&g.jsx(rs,{instanceId:x,nodeType:"policy",isOutcome:!0}),g.jsx(O,{type:"source",position:I.Top,id:"source-top",className:"node-handle node-handle-horizontal",isConnectable:r}),g.jsx(O,{type:"source",position:I.Bottom,id:"source-bottom",className:"node-handle node-handle-horizontal",isConnectable:r}),g.jsx(O,{type:"source",position:I.Left,id:"source-left",className:"node-handle node-handle-vertical",isConnectable:r}),g.jsx(O,{type:"source",position:I.Right,id:"source-right",className:"node-handle node-handle-vertical",isConnectable:r}),g.jsxs("div",{className:"flex flex-row items-center gap-1.5 py-1 px-2",children:[g.jsx("button",{className:Y("w-[18px] h-[18px] rounded-full border flex items-center justify-center","shadow-[0_1px_3px_rgba(0,0,0,0.2)] transition-all duration-200 p-0 outline-none shrink-0",T?"bg-node-policy border-white/30 text-white cursor-pointer hover:scale-[1.15] hover:bg-[#a855f7] hover:border-white/50":"bg-node-policy/40 border-white/20 text-white/50 cursor-default"),onClick:X,disabled:!T,title:T?f?`Select ${t.label}`:`Trigger from ${t.label}`:"Connect this outcome to enable",children:g.jsx(Ve,{className:"w-2.5 h-2.5"})}),g.jsx(ie,{value:t.label,onChange:S,placeholder:"Outcome",autoSize:!0,className:"text-white [.light_&]:text-postit-text"})]})]})}),es=["right"];function ts(n){switch(n){case"top":return"top-[-28px] left-1/2 -translate-x-1/2 hover:-translate-x-1/2";case"right":return"right-[-28px] top-1/2 -translate-y-1/2 hover:-translate-y-1/2";case"bottom":return"bottom-[-28px] left-1/2 -translate-x-1/2 hover:-translate-x-1/2";case"left":return"left-[-28px] top-1/2 -translate-y-1/2 hover:-translate-y-1/2"}}function ns(n){return Y("absolute rounded-full border-2 border-border","cursor-pointer flex items-center justify-center text-sm font-bold","pointer-events-auto p-0 transition-all duration-150 z-[5]","shadow-[0_2px_4px_rgba(0,0,0,0.3)]","focus:outline-none focus-visible:outline-2 focus-visible:outline-text-primary focus-visible:outline-offset-2","hover:scale-[1.2] hover:shadow-[0_3px_8px_rgba(0,0,0,0.4)] active:scale-110","dark:bg-[#e0e0e8] dark:border-[#d0d0d8] dark:text-[#1e1e3a]","dark:hover:bg-[#5a5a7a] dark:hover:border-[#f0f0f8] dark:hover:text-[#f0f0f8]","bg-[#6a6a8a] border-[#7a7a9a] text-white shadow-[0_2px_4px_rgba(0,0,0,0.15)]","hover:bg-[#5a5a7a] hover:border-white hover:text-white",n?"w-4 h-4":"w-5 h-5")}function os({validTypes:n,isCompact:e=!1,onCreateNode:t,renderMenu:o,directions:s=es}){const[r,l]=c.useState(!1),[d,h]=c.useState(null),[u,p]=c.useState(null),b=c.useRef({top:null,right:null,bottom:null,left:null}),m=c.useCallback((f,x)=>{if(x.stopPropagation(),n.length===1){t(n[0],f);return}const y=b.current[f];if(!y)return;const T=y.getBoundingClientRect();p({x:T.x+T.width/2,y:T.y+T.height/2}),h(f),l(!0)},[n,t]),E=c.useCallback(f=>{d&&(t(f,d),l(!1),h(null))},[d,t]),i=c.useCallback(()=>{l(!1),h(null)},[]);if(n.length===0)return null;const a=ns(e);return g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"absolute top-0 left-0 w-full h-full pointer-events-none",children:s.map(f=>g.jsx("button",{ref:x=>{b.current[f]=x},className:Y(a,ts(f),"nodrag nopan"),onClick:x=>m(f,x),"aria-label":`Create node ${f==="top"?"above":f==="bottom"?"below":`to the ${f}`}`,title:"Add connected node",children:g.jsx(Zt,{className:"w-3 h-3"})},f))}),r&&u&&d&&o({validTypes:n,anchorPosition:u,direction:d,onSelect:E,onClose:i})]})}const ss=c.memo(os),rs=c.memo(function({instanceId:e,nodeType:t,isOutcome:o=!1,isCompact:s=!1}){const{getValidTargetTypes:r,createConnectedNode:l}=qo(),d=r(t,o),h=c.useCallback((p,b)=>{l(e,p,b)},[e,l]),u=c.useCallback(p=>g.jsx(Jo,{...p}),[]);return g.jsx(ss,{validTypes:d,isCompact:s,onCreateNode:h,renderMenu:u})});function qs({id:n,source:e,sourceX:t,sourceY:o,targetX:s,targetY:r,sourcePosition:l,targetPosition:d,selected:h,markerEnd:u,markerStart:p,data:b,simulationState:m,isRunning:E,start:i,triggerNode:a,selectTransition:f,getSourceDefinitionId:x}){const y=b,T=(y==null?void 0:y.state)||"idle",v=(y==null?void 0:y.progress)||0,w=(y==null?void 0:y.labelOffset)??.5,F=y==null?void 0:y.transitionId,X=(y==null?void 0:y.isNonStandard)||!1,S=y==null?void 0:y.sourceKind,N=y==null?void 0:y.targetKind,{setEdges:$}=ve(),{showTooltip:R,hideTooltip:A,setHoveredWarningEdgeId:z}=kt(),P=c.useRef(null),[k,M]=c.useState({x:0,y:0}),[D,W]=c.useState({x:0,y:0}),[L,j]=c.useState(0),G=c.useRef(void 0),B=c.useCallback((q,fe)=>{$(ne=>ne.map(se=>se.id===q?{...se,data:{...se.data,labelOffset:fe}}:se))},[$]),{isDragging:H,hasDraggedRef:U,handleDragStart:K}=bo({pathRef:P,edgeId:n,onOffsetChange:B}),J=x(e),C=(J?m==null?void 0:m.nodeStates.get(J):void 0)==="waiting_for_action",_=c.useMemo(()=>({isRunning:E,start:i,triggerNode:a,selectTransition:f}),[E,i,a,f]),V=c.useMemo(()=>({isSourceWaiting:C}),[C]),{execute:Q}=zo(_,V),te=dt(t,o,s,r,l,d);c.useLayoutEffect(()=>{if(P.current){const q=P.current.getTotalLength();j(q)}},[te]),c.useLayoutEffect(()=>{if(P.current&&L>0){const q=P.current.getPointAtLength(L*w);W({x:q.x,y:q.y})}},[L,w]),c.useEffect(()=>{if(T!=="animating"||!P.current)return;const q=P.current,fe=q.getTotalLength(),ne=()=>{const se=(y==null?void 0:y.progress)||0,Te=q.getPointAtLength(fe*se);M({x:Te.x,y:Te.y}),se<1&&(G.current=requestAnimationFrame(ne))};return G.current=requestAnimationFrame(ne),()=>{G.current&&cancelAnimationFrame(G.current)}},[T,y==null?void 0:y.progress]);const ue=c.useCallback(q=>{q.stopPropagation(),q.preventDefault(),!U.current&&(!F||!J||Q(J,F))},[F,J,Q,U]),Ee=L*(1-v),he=!!F,pe=he;return c.useEffect(()=>{if(h&&X&&S&&N)return z(n),R({edgeId:n,sourceKind:S,targetKind:N,targetPosition:{x:s,y:r}}),()=>{z(null),A()}},[h,X,S,N,n,s,r,R,A,z]),g.jsxs(g.Fragment,{children:[!X&&g.jsx("path",{d:te,fill:"none",stroke:T==="executed"?"#22c55e":"oklch(55% 0.18 303)",strokeWidth:16,strokeLinecap:"butt",style:{opacity:.15,pointerEvents:"none"}}),g.jsx(ct,{id:n,path:te,markerEnd:u,markerStart:p,className:[T==="idle"&&!h?"animate-dash-flow":"",X?"non-standard":""].filter(Boolean).join(" ")||void 0,style:{strokeDasharray:T==="idle"&&!h?"5 5":"none",opacity:T==="executed"?0:1}}),g.jsx("path",{ref:P,d:te,fill:"none",stroke:"transparent",strokeWidth:0}),(T==="animating"||T==="executed"||T==="waiting_at_label")&&L>0&&g.jsx("path",{d:te,fill:"none",stroke:"#22c55e",strokeWidth:2,style:{strokeDasharray:T!=="executed"?L:"none",strokeDashoffset:T!=="executed"?Ee:0}}),T==="animating"&&g.jsxs(g.Fragment,{children:[g.jsx("circle",{cx:k.x,cy:k.y,r:10,fill:"rgba(34, 197, 94, 0.3)"}),g.jsx("circle",{cx:k.x,cy:k.y,r:6,fill:"#22c55e",style:{filter:"drop-shadow(0 0 4px rgba(34, 197, 94, 0.6))"}})]}),T==="waiting_at_label"&&g.jsxs(g.Fragment,{children:[g.jsx("circle",{cx:D.x,cy:D.y,r:10,fill:"rgba(34, 197, 94, 0.3)",className:"animate-ball-fade-out"}),g.jsx("circle",{cx:D.x,cy:D.y,r:6,fill:"#22c55e",className:"animate-ball-fade-out",style:{filter:"drop-shadow(0 0 4px rgba(34, 197, 94, 0.6))"}})]}),h&&g.jsxs(g.Fragment,{children:[g.jsx(ot,{x:t,y:o}),g.jsx(ot,{x:s,y:r})]}),g.jsx(an,{children:g.jsx("div",{className:Y("absolute cursor-grab select-none z-[1000] nodrag nopan",H&&"cursor-grabbing",C&&"[&_.play-btn]:animate-button-pulse"),style:{position:"absolute",transform:`translate(-50%, -50%) translate(${D.x}px, ${D.y}px)`,pointerEvents:"all"},onMouseDown:K,children:g.jsx("button",{className:Y("play-btn w-[18px] h-[18px] rounded-full flex items-center justify-center p-0 outline-none shrink-0","shadow-[0_1px_3px_rgba(0,0,0,0.2)] transition-all duration-200",pe?"bg-[#3b82f6] border border-white/30 text-white cursor-pointer hover:scale-[1.15] hover:bg-[#60a5fa] hover:border-white/50":"bg-[#3b82f6]/40 border border-white/20 text-white/50 cursor-default"),onClick:ue,disabled:!pe,title:he?C?"Select this path":"Trigger command":"No transition connected",children:g.jsx(Ve,{className:"w-2.5 h-2.5"})})})})]})}function ot({x:n,y:e}){return g.jsx("circle",{cx:n,cy:e,r:6,fill:"oklch(40% 0.18 303)",stroke:"#fff",strokeWidth:2,style:{cursor:"grab",filter:"drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3))"}})}function Ys({id:n,sourceX:e,sourceY:t,targetX:o,targetY:s,sourcePosition:r,targetPosition:l,selected:d,markerEnd:h,markerStart:u,data:p}){const{theme:b}=xo(),{showTooltip:m,hideTooltip:E,setHoveredWarningEdgeId:i}=kt(),a=p,f=(a==null?void 0:a.state)||"idle",x=(a==null?void 0:a.progress)||0,y=(a==null?void 0:a.isNonStandard)||!1,T=a==null?void 0:a.sourceKind,v=a==null?void 0:a.targetKind,w=c.useRef(null),[F,X]=c.useState({x:0,y:0}),[S,N]=c.useState(0),$=c.useRef(void 0),R=dt(e,t,o,s,r,l);c.useLayoutEffect(()=>{if(w.current){const z=w.current.getTotalLength();N(z)}},[R]),c.useEffect(()=>{if(f!=="animating"||!w.current)return;const z=w.current,P=z.getTotalLength(),k=()=>{const M=(a==null?void 0:a.progress)||0,D=z.getPointAtLength(P*M);X({x:D.x,y:D.y}),M<1&&($.current=requestAnimationFrame(k))};return $.current=requestAnimationFrame(k),()=>{$.current&&cancelAnimationFrame($.current)}},[f,a==null?void 0:a.progress]);const A=S*(1-x);return c.useEffect(()=>{if(d&&y&&T&&v)return i(n),m({edgeId:n,sourceKind:T,targetKind:v,targetPosition:{x:o,y:s}}),()=>{i(null),E()}},[d,y,T,v,n,o,s,m,E,i]),g.jsxs(g.Fragment,{children:[!y&&g.jsx("path",{d:R,fill:"none",stroke:f==="executed"?"#22c55e":"oklch(55% 0.18 303)",strokeWidth:16,strokeLinecap:"butt",style:{opacity:.15,pointerEvents:"none"}}),g.jsx(ct,{id:n,path:R,markerEnd:h,markerStart:u,className:[f==="idle"&&!d?"animate-dash-flow":"",y?"non-standard":""].filter(Boolean).join(" ")||void 0,style:{strokeDasharray:f==="idle"&&!d?"5 5":"none",opacity:f==="executed"?0:1}}),g.jsx("path",{ref:w,d:R,fill:"none",stroke:"transparent",strokeWidth:0}),(f==="animating"||f==="executed")&&S>0&&g.jsx("path",{d:R,fill:"none",stroke:"#22c55e",strokeWidth:2,style:{strokeDasharray:f==="animating"?S:"none",strokeDashoffset:f==="animating"?A:0}}),f==="animating"&&g.jsxs(g.Fragment,{children:[g.jsx("circle",{cx:F.x,cy:F.y,r:10,fill:"rgba(34, 197, 94, 0.3)"}),g.jsx("circle",{cx:F.x,cy:F.y,r:6,fill:"#22c55e",style:{filter:"drop-shadow(0 0 4px rgba(34, 197, 94, 0.6))"}})]}),d&&g.jsxs(g.Fragment,{children:[g.jsx(st,{x:e,y:t,isLight:b==="light"}),g.jsx(st,{x:o,y:s,isLight:b==="light"})]})]})}function st({x:n,y:e,isLight:t}){const o=t?"#ffffff":"#1e1e3f",s=t?"oklch(45% 0.18 303)":"oklch(70% 0.15 303)";return g.jsx("circle",{cx:n,cy:e,r:6,fill:o,stroke:s,strokeWidth:2,style:{cursor:"grab",filter:"drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3))"}})}const as=()=>({activeTransitions:new Map,animationFrame:void 0,processedEvents:new Set,previousEventsLength:0,wasWaiting:new Map,animate:null}),rt=1e3,is=500;function Ks(n){const{setEdges:e,getEdges:t}=ve(),o=c.useRef(as()),s=c.useCallback((d,h,u)=>{e(p=>p.map(b=>{const m=b.data;return(m==null?void 0:m.transitionId)===d?{...b,data:{...b.data,state:h,progress:u}}:b}))},[e]),r=c.useCallback(()=>{const d=o.current,h=Date.now();let u=!1;d.activeTransitions.forEach((p,b)=>{const m=h-p.startTime,E=p.targetProgress-p.startProgress,i=Math.min(m/p.duration,1),a=p.startProgress+i*E;i<1?(u=!0,s(b,"animating",a)):(p.targetProgress<1?(s(b,"waiting_at_label",p.targetProgress),d.wasWaiting.set(b,p.targetProgress)):s(b,"executed",1),d.activeTransitions.delete(b))}),u&&d.animate?d.animationFrame=requestAnimationFrame(d.animate):d.animationFrame=void 0},[s]);c.useEffect(()=>{o.current.animate=r},[r]);const l=c.useCallback(()=>{const d=o.current;d.animationFrame&&(cancelAnimationFrame(d.animationFrame),d.animationFrame=void 0),d.activeTransitions.clear(),d.processedEvents.clear(),d.wasWaiting.clear(),e(h=>h.map(u=>({...u,data:{...u.data,state:"idle",progress:0}})))},[e]);c.useEffect(()=>{const d=o.current;n.length===0&&d.previousEventsLength>0&&l(),d.previousEventsLength=n.length;let h=!1;n.forEach(u=>{var p,b,m;if(!d.processedEvents.has(u.id)){if(d.processedEvents.add(u.id),u.type==="transition:start"){const i=(p=u.data.transition)==null?void 0:p.id;if(!i)return;const a=d.wasWaiting.get(i),f=a!==void 0?a:0,x=a!==void 0?rt*(1-a):rt;d.wasWaiting.delete(i),d.activeTransitions.set(i,{transitionId:i,startTime:Date.now(),duration:x,startProgress:f,targetProgress:1}),s(i,"animating",f),h=!0}if(u.type==="transition:reset"){const i=(b=u.data.transition)==null?void 0:b.id;if(!i)return;d.activeTransitions.delete(i),s(i,"idle",0)}if(u.type==="simulation:reset"&&l(),u.type==="node:waiting"){const E=u.data;if(((m=E.node)==null?void 0:m.kind)!=="command")return;const i=E.availableTransitions||[],a=t();for(const f of i){const x=f.id,y=a.find(w=>{const F=w.data;return(F==null?void 0:F.transitionId)===x});if(!y)continue;const T=y.data,v=(T==null?void 0:T.labelOffset)??.5;d.activeTransitions.set(x,{transitionId:x,startTime:Date.now(),duration:is,startProgress:0,targetProgress:v}),s(x,"animating",0),h=!0}}}}),h&&!d.animationFrame&&(d.animationFrame=requestAnimationFrame(r))},[n,r,s,l,t]),c.useEffect(()=>{const d=o.current;return()=>{d.animationFrame&&cancelAnimationFrame(d.animationFrame)}},[])}export{Re as $,Fs as A,qs as B,He as C,Ys as D,Rs as E,us as F,kt as G,js as H,Ks as I,Ns as J,vs as K,Cs as L,fs as M,zs as N,Us as O,Fo as P,rs as Q,gs as R,ms as S,En as T,xs as U,Ts as V,vo as W,On as X,ye as Y,lt as Z,Un as _,Xe as a,je as a0,gt as a1,ft as a2,we as a3,qn as a4,ht as a5,Kn as a6,le as a7,pt as a8,ws as a9,Jn as aa,Qn as ab,Zn as ac,xt as ad,Yn as ae,ho as af,Vs as ag,Hs as ah,Ln as ai,Wn as aj,Xn as ak,Gn as al,Vn as am,Jo as an,ss as ao,Ms as ap,$s as aq,zo as ar,Zo as as,ie as at,bs as au,Oo as av,Mn as b,de as c,Fe as d,ys as e,Es as f,ke as g,Is as h,ks as i,Ve as j,hs as k,po as l,Ss as m,xo as n,ps as o,_s as p,Xs as q,Gs as r,Ws as s,Bs as t,go as u,As as v,Ps as w,Ds as x,Os as y,Ls as z};
